<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
     <head>
         <title>XAP 8.0 Documentation : Space Mode Context Loader</title>
<link rel="stylesheet" href="styles/site.css" type="text/css" />
         <META http-equiv="Content-Type" content="text/html; charset=UTF-8">
		 <style>
.back-to {
	color: #666666;
	font-weight: bold;
}	 
a.back-to:link, a.back-to:visited, a.back-to:hover, a.back-to:active  {
	color: #666666;
}	 
		 </style>
     </head>

     <body>
<table class="pagecontent" border="0" cellpadding="0" cellspacing="0" width="100%" bgcolor="#ffffff">
<tr>
<td valign="top" class="pagebody">
<div class="pageheader">
<span class="back-to">XAP 8.0 Documentation > <a href="index.html">Back to Table of Contents</a></span><br>
<h1>Space Mode Context Loader</h1>
</div>
<br>

<script type='text/javascript'>//<![CDATA[
function debug() { }
// ]]></script><script type='text/javascript' src='/wiki/download/resources/net.customware.confluence.plugin.composition:composition-setup/js/browser.js'>//<![CDATA[
// ]]></script><script type='text/javascript' src='/wiki/download/resources/net.customware.confluence.plugin.composition:composition-setup/js/behaviour.js'>//<![CDATA[
// ]]></script><script type='text/javascript' src='/wiki/download/resources/net.customware.confluence.plugin.composition:composition-setup/js/memory.js'>//<![CDATA[
// ]]></script><script type='text/javascript' src='/wiki/download/resources/net.customware.confluence.plugin.composition:composition-setup/js/cloak.js'>//<![CDATA[
// ]]></script><script type='text/javascript'>//<![CDATA[
Cloak.closeHTML = "<img src=\'/wiki/download/resources/net.customware.confluence.plugin.composition:toggle-cloak/img/navigate_down_10.gif\'/>";
Cloak.openHTML = "<img src=\'/wiki/download/resources/net.customware.confluence.plugin.composition:toggle-cloak/img/navigate_right_10.gif\'/>";
Cloak.toggleZone = true;
Cloak.memoryDuration = 0;
Cloak.memoryPrefix = "contentId:53903616";
Cloak.memoryPath = "/wiki/";
// ]]></script><style type='text/css'>
.cloakToggle { /* Definition for state toggling image */
cursor:hand;
cursor:pointer;
}
</style><script type='text/javascript' src='/wiki/download/resources/net.customware.confluence.plugin.composition:composition-setup/js/transitions.js'>//<![CDATA[
// ]]></script><script type='text/javascript' src='/wiki/download/resources/net.customware.confluence.plugin.composition:composition-setup/js/deck.js'>//<![CDATA[
// ]]></script><link rel='stylesheet' type='text/css'  href='/wiki/styles/main-action.css?pluginCompleteKey=net.customware.confluence.plugin.composition:composition-setup&stylesheetName=deck&spaceKey=XAP8'/><script type='text/javascript'>//<![CDATA[
Deck.memoryDuration = 0;
Deck.memoryPrefix = "contentId:53903616";
Deck.memoryPath = "/wiki/";
// ]]></script>


<div style="border-style:solid; border-color:#3C78B5; border-width:thin; padding-left:20px; padding-bottom:20px; padding-top:20px; padding-right:20px; background-color:#D8E4F1"> 

<p><b>Section Summary:</b>  Allows you to load a Spring application context only when the Processing Unit or space is in primary mode, and unload it when the Processing Unit or space is in backup mode. </p>
</div>

<h1><a name="SpaceModeContextLoader-Overview"></a>Overview</h1>

<p>Most of the OpenSpaces built-in components take into account the state of the space (mainly applicable when starting an embedded space within the Processing Unit). This is important when working directly on a cluster member, since operations cannot be performed directly on a backup member.</p>

<p>Many times, custom beans or POJOs would like to operate directly on the cluster member. To do this, they need to take the space mode into account &#8211; by not performing any actions against the cluster member when it is in backup mode, and by starting to perform all relevant actions when the space mode changes to primary.</p>

<p>Using the custom space mode events described in the <a href="The Space Component.html" title="The Space Component">Space</a> section, the bean can register for such events (by implementing the Spring <tt>ApplicationListener</tt> interface), and perform relevant actions based on the space mode event.</p>

<p>OpenSpaces provides a simpler solution, allowing you to load a Spring application context (based on a separate Spring XML configuration file) only when the Processing Unit or space is in primary mode, and unload it when the Processing Unit or space is in backup mode. If we take the following simple bean:</p>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java"><span class="code-keyword">public</span> class SpaceModeContextBean <span class="code-keyword">implements</span> InitializingBean, DisposableBean {

    @GigaSpaceContext(name = <span class="code-quote">"gigaSpace"</span>)
    <span class="code-keyword">private</span> GigaSpace gigaSpace;

    <span class="code-keyword">public</span> void afterPropertiesSet() <span class="code-keyword">throws</span> Exception {
        <span class="code-object">System</span>.out.println(<span class="code-quote">"SPACE MODE BEAN LOADED, SPACE ["</span> + gigaSpace + <span class="code-quote">"]"</span>);
    }

    <span class="code-keyword">public</span> void destroy() <span class="code-keyword">throws</span> Exception {
        <span class="code-object">System</span>.out.println(<span class="code-quote">"SPACE MODE BEAN DESTROYED, SPACE ["</span> + gigaSpace + <span class="code-quote">"]"</span>);
    }
}</pre>
</div></div>

<p>and the following Spring XML definition constructing this bean (stored in a separate XML file than the Processing Unit definition called <tt>mode.xml</tt>):</p>


<div class="panel" style="background-color: #FFFFFF;border-color: #3C78B5;border-style: solid;border-width: 1px;"><div class="panelContent" style="background-color: #FFFFFF;">
<h5><a name="SpaceModeContextLoader-Namespace"></a>Namespace</h5>
<hr 
 size="1" 
 color="#3C78B5" 
 >

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-xml"><span class="code-tag">&lt;os-core:giga-space-context /&gt;</span>

<span class="code-tag">&lt;bean id=<span class="code-quote">"spaceModeContextBean"</span> class=<span class="code-quote">"org.openspaces.example.data.processor.SpaceModeContextBean"</span>/&gt;</span></pre>
</div></div> 


<h5><a name="SpaceModeContextLoader-PlainXML"></a>Plain XML</h5>
<hr 
 size="1" 
 color="#3C78B5" 
 >

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-xml">&lt;!--
    Enables the usage of @GigaSpaceContext annotation based injection.
--&gt;
<span class="code-tag">&lt;bean id=<span class="code-quote">"gsContext"</span> class=<span class="code-quote">"org.openspaces.core.context.GigaSpaceContextBeanPostProcessor"</span> /&gt;</span>

<span class="code-tag">&lt;bean id=<span class="code-quote">"spaceModeContextBean"</span> class=<span class="code-quote">"org.openspaces.example.data.processor.SpaceModeContextBean"</span>/&gt;</span></pre>
</div></div>
</div></div>

<p>with the following Processing Unit definition:</p>


<div class="panel" style="background-color: #FFFFFF;border-color: #3C78B5;border-style: solid;border-width: 1px;"><div class="panelContent" style="background-color: #FFFFFF;">
<h5><a name="SpaceModeContextLoader-Namespace"></a>Namespace</h5>
<hr 
 size="1" 
 color="#3C78B5" 
 >

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-xml"><span class="code-tag">&lt;os-core:space id=<span class="code-quote">"space"</span> url=<span class="code-quote">"/./space"</span> /&gt;</span>

<span class="code-tag">&lt;os-core:giga-space id=<span class="code-quote">"gigaSpace"</span> space=<span class="code-quote">"space"</span>/&gt;</span>

&lt;!--
    Enables the usage of @GigaSpaceContext annotation based injection.
--&gt;
<span class="code-tag">&lt;os-core:giga-space-context/&gt;</span>

<span class="code-tag">&lt;os-core:context-loader id=<span class="code-quote">"modeExample"</span> location=<span class="code-quote">"classpath:/META-INF/spring/mode/mode.xml"</span>/&gt;</span></pre>
</div></div> 


<h5><a name="SpaceModeContextLoader-PlainXML"></a>Plain XML</h5>
<hr 
 size="1" 
 color="#3C78B5" 
 >

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-xml"><span class="code-tag">&lt;bean id=<span class="code-quote">"space"</span> class=<span class="code-quote">"org.openspaces.core.space.UrlSpaceFactoryBean"</span>&gt;</span>
    <span class="code-tag">&lt;property name=<span class="code-quote">"url"</span> value=<span class="code-quote">"/./space"</span> /&gt;</span>
<span class="code-tag">&lt;/bean&gt;</span>

<span class="code-tag">&lt;bean id=<span class="code-quote">"gigaSpace"</span> class=<span class="code-quote">"org.openspaces.core.GigaSpaceFactoryBean"</span>&gt;</span>
	<span class="code-tag">&lt;property name=<span class="code-quote">"space"</span> ref=<span class="code-quote">"space"</span> /&gt;</span>
<span class="code-tag">&lt;/bean&gt;</span>

&lt;!--
    Enables the usage of @GigaSpaceContext annotation based injection.
--&gt;
<span class="code-tag">&lt;bean id=<span class="code-quote">"gsContext"</span> class=<span class="code-quote">"org.openspaces.core.context.GigaSpaceContextBeanPostProcessor"</span> /&gt;</span>

<span class="code-tag">&lt;bean id=<span class="code-quote">"modeExample"</span> class=<span class="code-quote">"org.openspaces.core.space.mode.SpaceModeContextLoader"</span>&gt;</span>
    <span class="code-tag">&lt;property name=<span class="code-quote">"location"</span> value=<span class="code-quote">"classpath:/META-INF/spring/mode/mode.xml"</span> /&gt;</span>
<span class="code-tag">&lt;/bean&gt;</span></pre>
</div></div>
</div></div>

<div class='panelMacro'><table class='tipMacro'><colgroup><col width='24'><col></colgroup><tr><td valign='top'><img src="images/icons/emoticons/check.gif" width="16" height="16" align="absmiddle" alt="" border="0"></td><td>If there is more then one gigaSpace proxy in the pu you should bind the context to the gigaSpace instance by setting the giga-space property e.g:<br/>
&lt;os-core:context-loader id="modeExample" location="classpath:/META-INF/spring/mode/mode.xml" giga-space="gigaSpace"&gt;</td></tr></table></div>
<p>we can see that the <tt>SpaceModeContextBean</tt> <tt>afterPropertiesSet</tt> callback is called when the Processing Unit instance is in primary mode. When it moves to backup mode, the Spring application context is unloaded, and the <tt>destroy</tt> callback is invoked. Note the usage of the <tt>GigaSpace</tt> instance, which is defined in the Processing Unit definition, as part of the bean defined in the <tt>mode.xml</tt> file. This is allowed because of the fact that the Processing Unit definition acts as a parent application context to the application context loaded with <tt>mode.xml</tt>.</p>

                     </td>
</tr>
</table>
<table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr>
<td height="12" background="http://www.gigaspaces.com/wiki/images/border/border_bottom.gif"><img src="images/border/spacer.gif" width="1" height="1" border="0"/></td>
</tr>
<tr>
<td align="center"><font color="grey"><a href="http://www.gigaspaces.com">GigaSpaces.com</a> -
		<a href="http://www.gigaspaces.com/wiki/x/xwBmAg" class="smalltext">Legal Notice</a> -
		<a href="http://www.gigaspaces.com/wiki/x/xgBmAg" class="smalltext">3rd Party Licenses</a> -
		<a href="http://www.gigaspaces.com/wiki/x/BQFmAg" class="smalltext">Site Map</a> -
		<a href="http://www.gigaspaces.com/wiki/display/API/API+Documentation+Portal" class="version-link">API Docs</a> -
		<a href="http://forum.openspaces.org/forum.jspa?forumID=175" class="version-link">Forum</a> -
		<a href="http://www.gigaspaces.com/LatestProductVersion" class="version-link">Downloads</a> -
		<a href="http://blog.gigaspaces.com/" class="version-link">Blog</a> -
		<a href="http://www.gigaspaces.com/os_papers.html" class="version-link">White Papers</a> -
		<a href="mailto:techw@gigaspaces.com">Contact Tech Writing</a> -
		<i><a href="http://www.atlassian.com/software/confluence">Gen. by Atlassian Confluence</a></i></font></td>
</tr>
</table>
     </body>
</html>
