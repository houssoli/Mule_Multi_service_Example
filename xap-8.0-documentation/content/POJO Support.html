<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
     <head>
         <title>XAP 8.0 Documentation : POJO Support</title>
<link rel="stylesheet" href="styles/site.css" type="text/css" />
         <META http-equiv="Content-Type" content="text/html; charset=UTF-8">
		 <style>
.back-to {
	color: #666666;
	font-weight: bold;
}	 
a.back-to:link, a.back-to:visited, a.back-to:hover, a.back-to:active  {
	color: #666666;
}	 
		 </style>
     </head>

     <body>
<table class="pagecontent" border="0" cellpadding="0" cellspacing="0" width="100%" bgcolor="#ffffff">
<tr>
<td valign="top" class="pagebody">
<div class="pageheader">
<span class="back-to">XAP 8.0 Documentation > <a href="index.html">Back to Table of Contents</a></span><br>
<h1>POJO Support</h1>
</div>
<br>

<script type='text/javascript'>//<![CDATA[
function debug() { }
// ]]></script><script type='text/javascript' src='/wiki/download/resources/net.customware.confluence.plugin.composition:composition-setup/js/browser.js'>//<![CDATA[
// ]]></script><script type='text/javascript' src='/wiki/download/resources/net.customware.confluence.plugin.composition:composition-setup/js/behaviour.js'>//<![CDATA[
// ]]></script><script type='text/javascript' src='/wiki/download/resources/net.customware.confluence.plugin.composition:composition-setup/js/memory.js'>//<![CDATA[
// ]]></script><script type='text/javascript' src='/wiki/download/resources/net.customware.confluence.plugin.composition:composition-setup/js/cloak.js'>//<![CDATA[
// ]]></script><script type='text/javascript'>//<![CDATA[
Cloak.closeHTML = "<img src=\'/wiki/download/resources/net.customware.confluence.plugin.composition:toggle-cloak/img/navigate_down_10.gif\'/>";
Cloak.openHTML = "<img src=\'/wiki/download/resources/net.customware.confluence.plugin.composition:toggle-cloak/img/navigate_right_10.gif\'/>";
Cloak.toggleZone = true;
Cloak.memoryDuration = 0;
Cloak.memoryPrefix = "contentId:53903617";
Cloak.memoryPath = "/wiki/";
// ]]></script><style type='text/css'>
.cloakToggle { /* Definition for state toggling image */
cursor:hand;
cursor:pointer;
}
</style><script type='text/javascript' src='/wiki/download/resources/net.customware.confluence.plugin.composition:composition-setup/js/transitions.js'>//<![CDATA[
// ]]></script><script type='text/javascript' src='/wiki/download/resources/net.customware.confluence.plugin.composition:composition-setup/js/deck.js'>//<![CDATA[
// ]]></script><link rel='stylesheet' type='text/css'  href='/wiki/styles/main-action.css?pluginCompleteKey=net.customware.confluence.plugin.composition:composition-setup&stylesheetName=deck&spaceKey=XAP8'/><script type='text/javascript'>//<![CDATA[
Deck.memoryDuration = 0;
Deck.memoryPrefix = "contentId:53903617";
Deck.memoryPath = "/wiki/";
// ]]></script>


<div style="border-style:solid; border-color:#3C78B5; border-width:thin; padding-left:20px; padding-bottom:20px; padding-top:20px; padding-right:20px; background-color:#D8E4F1"> 

<p><b>Section Summary:</b>  GigaSpaces JavaSpaces API Plain Old Java Object support - the <a href="http://en.wikipedia.org/wiki/Plain_Old_Java_Object">POJO</a>. </p>
</div>

<h1><a name="POJOSupport-Overview"></a>Overview</h1>
<p>GigaSpaces JavaSpaces <tt>POJO</tt> support allows you to use <tt>JavaBean</tt> classes as space domain classes, and perform space operations using these objects. POJO domain Classes should follow rules similar to the ones defined by <a href="http://en.wikipedia.org/wiki/Java_Persistence_API">JPA</a>, <a href="http://www.hibernate.org">Hibernate</a> and other domain class frameworks.</p>

<h1><a name="POJOSupport-POJOsasDataObjects"></a>POJOs as Data Objects  </h1>
<p>As mentioned earlier, one of the differences between the <tt>GigaSpace</tt> interface and the classic <tt>net.jini.Space.JavaSpace</tt> interface, is its support for POJOs as Space entries. The <tt>JavaSpace</tt> interface is rather intrusive and forces objects that are written to the Space to implement the <tt>net.jini.core.entry.Entry</tt> interface, and mark any field to be stored on the Space as <tt>public</tt>. <br/>
The <tt>GigaSpace</tt> interface fully supports POJOs, and is much less intrusive than the original <tt>JavaSpace</tt> interface. Although {{Entry}}s are still supported, this is discouraged, and you should only use POJOs as a Space data object. </p>

<p>In terms of preconditions, your POJO classes need to follow the JavaBeans conventions, i.e. have a no-argument constructor, and declare a getter and setter to every field you want saved on the Space. Also, they cannot implement the <tt>net.jini.core.entry.Entry</tt> interface (there shouldn't be any reason to do that anyway, since it is an empty tagging interface). The POJO class does not have to implement <tt>java.io.Serializable</tt>, but its properties must. The reason for this, is that the POJOs fields are extracted when written to the Space, and stored in a special tuple format that enables the Space to index and analyze them more easily. Therefore the actual POJO is not sent over the network, but rather its properties. <br/>
You can override the default serialization behaviour of your POJO by <a href="Externalizable Support.html" title="Externalizable Support">implementing the <tt>java.io.Externalizable</tt> interface</a>.</p>

<h3><a name="POJOSupport-ProvidingMetadatatotheSpaceaboutthePOJOClass"></a>Providing Metadata to the Space about the POJO Class </h3>
<p>When writing POJOs to the Space, you can provide some metadata about the POJO's class to the space, using Java 5 annotations, or an XML configuration. This overview uses annotation to provide metadata. For a complete reference to POJO annotations and XML configuration, refer to <a href="POJO Metadata.html" title="POJO Metadata">this page</a>. <br/>
Here is an overview of the most commonly used POJO annotations: </p>

<ul>
	<li><tt>@SpaceClass</tt>: Class level annotation - not mandatory. Used to mark a class that is written to the space (by default if you write a class to the space, it is marked as such automatically). Use this when you would like to provide additional metadata at the class level, such as whether or not this class is persisted to a database if <a href="Persistency.html" title="Persistency">Persistency</a> is configured on the Space.</li>
</ul>


<ul>
	<li><tt>@SpaceId</tt>: The identifier property of the POJO. This property uniquely identifies the POJO within the space, and is similar to a primary key in a database. You can choose between an application-generated ID (<tt>autoGenarate=false</tt>), and an automatically-generated ID (<tt>autoGenerate=true</tt>).</li>
</ul>


<ul>
	<li><tt>@SpaceProperty</tt>: Defines various attributes related to a POJO property - the null value if you are using a primitive property (e.g. <tt>nullValue=-1</tt>), and whether they should be indexed for faster querying (<tt>index=BASIC</tt>).</li>
</ul>


<ul>
	<li><tt>@SpaceVersion</tt>: The version property of the POJO  - optional. Defines a property to be used to indicate the version of the instance (used to implement optimistic locking).</li>
</ul>


<ul>
	<li><tt>@SpaceRouting</tt>: The routing property for the POJO. In a partitioned space, this controls how instances of a certain class are distributed across the partitions. When two instances (even of different classes), have the same value for their routing property, they end up in the same partition.</li>
</ul>


<div class='panelMacro'><table class='infoMacro'><colgroup><col width='24'><col></colgroup><tr><td valign='top'><img src="images/icons/emoticons/information.gif" width="16" height="16" align="absmiddle" alt="" border="0"></td><td><b>Primitives or Wrapper Classes for POJO Properties?</b><br />
<p>GigaSpaces supports both primitives (<tt>int</tt>, <tt>long</tt>, <tt>double</tt>, <tt>float</tt>, etc.), and primitive wrappers (<tt>java.lang.Integer</tt>, <tt>java.lang.Double</tt>, etc.). In general, it is recommended that you use the primitive wrapper. This enables you to use the <tt>null</tt> values as a wildcard when using template matching (see below).<br/>
Using primitives is more efficient in terms of memory utilization, but make sure you define the following for your POJO class:</p>
<ul>
	<li>The <tt>null</tt> value for the property - since primitive types are not nullable, you have to indicate to the space a value that is treated as <tt>null</tt>. This is important for template matching (see below), where null values are considered as wildcards, and do not restrict the search.</li>
	<li>It is recommended that the initial value (assigned in the constructor) for this field matches the null value. This enables you to quickly create new instances, and use them as templates for template matching, without changing any property except the ones you want to use for matching.</li>
</ul>
</td></tr></table></div>

<p>Here is a sample POJO class:</p>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">@SpaceClass
<span class="code-keyword">public</span> class Person {
    <span class="code-keyword">private</span> <span class="code-object">Integer</span> id; 
    <span class="code-keyword">private</span> <span class="code-object">String</span> name;
    <span class="code-keyword">private</span> <span class="code-object">String</span> lastName;
    <span class="code-keyword">private</span> <span class="code-object">Integer</span> age;	
	
    ...
    <span class="code-keyword">public</span> Person() {}

    @SpaceId(autoGenerate=<span class="code-keyword">false</span>)
    @SpaceRouting
    <span class="code-keyword">public</span> <span class="code-object">Integer</span> getId() { <span class="code-keyword">return</span> id;}
    
    <span class="code-keyword">public</span> void setId(<span class="code-object">Integer</span> id) {  <span class="code-keyword">this</span>.id = id; }
	
    @SpaceProperty(index=BASIC)
    <span class="code-keyword">public</span> <span class="code-object">Long</span> getLastName() { <span class="code-keyword">return</span> lastName; }

    <span class="code-keyword">public</span> void setLastName(<span class="code-object">String</span> type) { <span class="code-keyword">this</span>.lastName = lastName; }
	    
    ...
}</pre>
</div></div>

<p>GigaSpaces <tt>POJO</tt> rules:</p>
<ul>
	<li>Do not implement the <tt>net.jini.core.entry</tt> interface.</li>
	<li>Follow the <a href="http://java.sun.com/javase/technologies/desktop/javabeans/docs/spec.html">JavaBeans specification</a>.</li>
	<li>Have private fields.</li>
	<li>Avoid using numeric <a href="http://download.oracle.com/javase/tutorial/java/nutsandbolts/datatypes.html">primitives</a> (long , int) as the POJO fields. Use their relevant Object wrapper instead (<a href="http://download-llnw.oracle.com/javase/6/docs/api/java/lang/Long.html">Long</a> , <a href="http://download-llnw.oracle.com/javase/6/docs/api/java/lang/Integer.html">Integer</a>). This will avoid the need to specify a null-value and simplify query construction when using the <a href="SQLQuery.html" title="SQLQuery">SQLQuery</a>.</li>
	<li>Have getter and setter methods for every field you would like to be stored within the space object.</li>
	<li>Include space class metadata decorations (indexed fields, affinity-keys, persisted mode, etc.).
<div class='panelMacro'><table class='infoMacro'><colgroup><col width='24'><col></colgroup><tr><td valign='top'><img src="images/icons/emoticons/information.gif" width="16" height="16" align="absmiddle" alt="" border="0"></td><td> You can define space classes metadata by class and field level decorations. These can be defined via annotations or XML configurations files (*gs.xml file).</td></tr></table></div></li>
</ul>


<p>This page deals with the POJO class as a space domain class, used to model the space, and store application data into the IMDG. POJO classes deployed as services into the Service Grid are described in the <a href="Data Event Listener.html" title="Data Event Listener">Data Event Listener</a> and <a href="Space Based Remoting.html" title="Space Based Remoting">Space Based Remoting</a> sections. In these cases, the POJO class is used to process incoming data, or is invoked remotely.</p>

<h1><a name="POJOSupport-APOJOasaSpaceDomainClass"></a>A POJO as a Space Domain Class</h1>
<p>When using a POJO as a space domain class, follow these guidelines:</p>
<ul>
	<li>A POJO class must implement a default (zero argument) constructor.</li>
	<li>A POJO class cannot implement the <tt>net.jini.core.entry</tt> interface; otherwise, it is treated differently.</li>
	<li>A POJO class should have space class metadata decorations using annotations or a <tt>gs.xml</tt> file with relevant metadata (indexed field list, version field, FIFO mode, persistency mode, primary key (i.e. <tt>id</tt>)). If neither are provided, the <b>defaults</b> are presumed. (The default settings might not always match your needs.)</li>
	<li>Getter/setter methods for fields that you want to be persisted in the space.</li>
	<li>Non-primitive fields must implement <tt>Serializable</tt> or <tt>Externalizable</tt>. For example, if you are using a POJO class that contains a nested class.</li>
	<li>When performing matching/queries using primitive fields (<tt>int</tt> , <tt>long</tt> , <tt>double</tt>, etc.) <b>the</b> <tt><b>nullValue</b></tt> <b>annotation or</b> <tt><b>null-value</b></tt> <b>tag must be specified</b> with relevant values, to function correctly.
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">@SpaceProperty(nullValue=<span class="code-quote">"-1"</span>)
<span class="code-keyword">public</span> <span class="code-object">int</span> getEmployeeID()
{
	<span class="code-keyword">return</span> employeeID;
}</pre>
</div></div></li>
	<li>The ID can be determined using the <tt>@SpaceId</tt> annotation or the <tt>id</tt> tag.</li>
	<li>The ID field can be determined using the <tt>@SpaceId</tt> annotation or the <tt>id</tt> tag.</li>
	<li>To force GigaSpaces to ignore a POJO field when the space class being first time introduced to the space you should use one of the following:
	<ul>
		<li>Use the <tt>@SpaceExclude</tt> annotation on the getter method for the fields you don't want to be included as part of the space class.</li>
		<li>Use the <tt>@SpaceClass(includeProperties=IncludeProperties.EXPLICIT)</tt> class level annotation and use the <tt>@SpaceProperty()</tt> with each getter method for fields you would like to be considered as part of the space class.</li>
	</ul>
	</li>
	<li>When using POJOs, the <b>write operation</b> uses the <a href="http://www.gigaspaces.com/docs/JavaDoc8.0/index.html?com/j_spaces/core/client/UpdateModifiers.html" target="_blank">UpdateModifiers.UPDATE_OR_WRITE</a> mode by default. This means that when the space already includes an object with the same UID (<tt>@SpaceId(autoGenerate=false)</tt> with the same value), the POJO is updated, and a new object is not inserted.</li>
	<li>When using <tt>SpaceId(autoGenerate=true)</tt>, the UID is stored inside the <tt>SpaceId</tt> field, causing an overhead when indexed.</li>
	<li><tt>TokenQuery</tt> is not supported with POJOs.</li>
	<li>POJO space mapping files <tt>gs.xml</tt> files can be loaded from:
	<ul>
		<li><tt>&lt;CLASSPATH&gt;\config\mapping</tt> folder, or</li>
		<li>The same package where the class file is located using the format <tt>&lt;&lt;Class Name&gt;&gt;.gs.xml</tt>.</li>
	</ul>
	</li>
	<li>A <tt>null</tt> value as template is not supported. Use <tt>new Object()</tt> instead.</li>
	<li>A POJO class must implement the <tt>Serializable</tt> or <tt>Externalizable</tt> interface if used as a parameter for a remote call (<a href="Space Based Remoting.html" title="Space Based Remoting">OpenSpaces remoting</a>).</li>
	<li>When using the
<a href="http://www.gigaspaces.com/docs/JavaDoc7.1/org/openspaces/core/GigaSpace.html" target="_blank">org.openspaces.core.GigaSpace</a>
<p>interface, you can use <a href="http://en.wikipedia.org/wiki/Generics_in_Java">generics</a> when conducting space operations.</p></li>
	<li>The <tt>@Spaceid</tt> annotation or <tt>id</tt> tag must be declared when performing update operations.</li>
	<li>To persist a POJO object using the <tt>ExternalDataSource</tt> , Mirror Service, JDBC Storage Adapter, or indexed file options, the <tt>persist</tt> decoration must have the value <tt>true</tt>.</li>
	<li>When a space is configured to use the <tt>ExternalDataSource</tt>, the <tt>@Spaceid</tt> annotation or <tt>id</tt> tag <tt>auto-generate</tt> attribute should be set to <tt><b>false</b></tt>. The object must include a unique value with the <tt>SpaceId</tt> field when written into the space.</li>
	<li>The <tt>SpaceId</tt> field can be <tt>java.lang.String</tt> type or any other type that implements the <tt>toString()</tt> which provides&nbsp; a unique value.</li>
</ul>


<ul class="alternate" type="square">
	<li>All <tt>net.jini.core.entry.Entry</tt> based classes meta data methods are not supported with POJO based classes. These include: _<em>setEntryInfo() , &#95;_getEntryInfo() , &#95;_setEntryUID() , &#95;_getEntryUID() ,</em>&#95;getSpaceIndexedFields(). With POJO based space domain classes, meta data is declared using relevant annotations or xml tags.</li>
	<li>Primitive <tt>boolean</tt> should not be used as a POJO field as this could lead to problems when using template based matching. <tt>Boolean</tt> should be used instead.</li>
	<li>In order to query a base abstract class you, due to the fact that one can't create an instance of an abstract class, SQLQuery should be used.</li>
</ul>


<div class='panelMacro'><table class='tipMacro'><colgroup><col width='24'><col></colgroup><tr><td valign='top'><img src="images/icons/emoticons/check.gif" width="16" height="16" align="absmiddle" alt="" border="0"></td><td><a href="Indexing.html" title="Indexing">Indexing</a> is <b>critical</b> for good performance over large spaces. Don't forget to index properly with the @SpaceIndex(type=SpaceIndexType.BASIC) or @SpaceIndex(type=SpaceIndexType.EXTENDED) annotation or use the gs.xml equivalent.</td></tr></table></div>

<h1><a name="POJOSupport-CodeSnippets"></a>Code Snippets</h1>
<p><img class="emoticon" src="images/icons/emoticons/lightbulb_on.gif" height="16" width="16" align="absmiddle" alt="" border="0"/> Space operations with POJO objects can be conducted using the <a href="http://www.gigaspaces.com/docs/JavaDoc7.1/org/openspaces/core/GigaSpace.html" target="_blank">org.openspaces.core.GigaSpace</a> interface or the <a href="http://www.gigaspaces.com/docs/JavaDoc8.0/index.html?com/j_spaces/core/IJSpace.html" target="_blank">com.j_spaces.core.IJSpace</a> interface.</p>

<p><img class="emoticon" src="images/icons/emoticons/lightbulb_on.gif" height="16" width="16" align="absmiddle" alt="" border="0"/> <b>The code snippets below use the</b> <a href="http://www.gigaspaces.com/docs/JavaDoc7.1/org/openspaces/core/GigaSpace.html" target="_blank">org.openspaces.core.GigaSpace</a> interface that is the recommended interface.</p>

<div class="panel" style="background-color: #FFFFFF;border-color: #3C78B5;border-style: solid;border-width: 1px;"><div class="panelContent" style="background-color: #FFFFFF;">
<h5><a name="POJOSupport-Writing%2FReadingPOJOs"></a>Writing/Reading POJOs</h5>
<hr 
 size="1" 
 color="#3C78B5" 
 >


<h2><a name="POJOSupport-WritingandReadingPOJOs"></a>Writing and Reading POJOs</h2>
<div class="indent20 inline" style="margin-left: 20px;"><style type="text/css">div.inline p:first-child { display: inline; }</style><p><img src="download/attachments/48235229/POJO_write.jpg" align="absmiddle" border="0"/></p></div>
<div class="indent20 inline" style="margin-left: 20px;"><style type="text/css">div.inline p:first-child { display: inline; }</style><p><img src="download/attachments/48235229/POJO_read.jpg" align="absmiddle" border="0"/></p></div>
<p>Getting Space proxy:</p>
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">UrlSpaceConfigurer urlSpaceConfigurer = <span class="code-keyword">new</span> UrlSpaceConfigurer(<span class="code-quote">"jini:<span class="code-comment">//*/*/mySpace"</span>);
</span>GigaSpace space = <span class="code-keyword">new</span> GigaSpaceConfigurer(urlSpaceConfigurer.space())
	.defaultTakeTimeout(1000)
 	.defaultReadTimeout(1000)
 	.gigaSpace();</pre>
</div></div>
<p>The following writes an <tt>Employee</tt> object and reads it back using a simple template:</p>
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">GigaSpace space;
Employee employee = <span class="code-keyword">new</span> Employee(<span class="code-quote">"Last Name"</span>, <span class="code-keyword">new</span> <span class="code-object">Integer</span>(32));
employee.setFirstName(<span class="code-quote">"first name"</span>);
space.write(employee);
Employee template = <span class="code-keyword">new</span> Employee();
Employee result = space.read(template);</pre>
</div></div>


<h5><a name="POJOSupport-Notifications"></a>Notifications</h5>
<hr 
 size="1" 
 color="#3C78B5" 
 >


<h2><a name="POJOSupport-RegisteringforNotifications"></a>Registering for Notifications</h2>
<p>The following registers for notifications:</p>
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">GigaSpace space;
SimpleNotifyEventListenerContainer
	notifyEventListenerContainer = <span class="code-keyword">new</span> SimpleNotifyContainerConfigurer(space)
	.template(<span class="code-keyword">new</span> Employee())
	.eventListenerAnnotation(<span class="code-keyword">new</span> <span class="code-object">Object</span>()
		{
		@SpaceDataEvent
		<span class="code-keyword">public</span> void eventHappened(<span class="code-object">Object</span> event) {
		<span class="code-object">System</span>.out.println(<span class="code-quote">"onEvent called Got"</span> + event);
	   	}
	})
	.fifo(<span class="code-keyword">true</span>)
	.notifyWrite(<span class="code-keyword">true</span>)
	.notifyUpdate(<span class="code-keyword">true</span>)
	.notifyContainer();</pre>
</div></div>


<h5><a name="POJOSupport-WritingaBatch"></a>Writing a Batch</h5>
<hr 
 size="1" 
 color="#3C78B5" 
 >


<h2><a name="POJOSupport-WritingaBatchofObjects"></a>Writing a Batch of Objects</h2>
<p>When writing a batch of objects into the space, these should be placed into an array to be used by the <tt>GigaSpace.writeMultiple</tt> operation. The returned array will include the corresponding <tt>LeaseContext</tt> object.</p>
<div class="indent20 inline" style="margin-left: 20px;"><style type="text/css">div.inline p:first-child { display: inline; }</style><p><img src="download/attachments/48235229/POJO_write_multi.jpg" align="absmiddle" border="0"/></p></div>
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">GigaSpace space; 
Employee emps[] = <span class="code-keyword">new</span> Employee[2]; 
emps[0] = <span class="code-keyword">new</span> Employee(<span class="code-quote">"Last Name A"</span>, <span class="code-keyword">new</span> <span class="code-object">Integer</span>(10)); 
emps[1] = <span class="code-keyword">new</span> Employee(<span class="code-quote">"Last Name B"</span>, <span class="code-keyword">new</span> <span class="code-object">Integer</span>(20)); 
<span class="code-keyword">try</span> { 
    LeaseContext[] leaseContexts = space.writeMultiple(emps); 
    <span class="code-keyword">for</span> (<span class="code-object">int</span> i = 0;i&lt;leaseContexts.length ; i++) { 
        <span class="code-object">System</span>.out.println (<span class="code-quote">"<span class="code-object">Object</span> UID "</span> + leaseContexts[i].getUID() + <span class="code-quote">" inserted into the space"</span>); 
    } 
} <span class="code-keyword">catch</span> (WriteMultipleException e) { 
    IWriteResult[] writeResult = e.getResults(); 
    <span class="code-keyword">for</span> (<span class="code-object">int</span> i = 0;i&lt; writeResult.length ; i++) { 
        <span class="code-object">System</span>.out.println (<span class="code-quote">"Problem with <span class="code-object">Object</span> UID "</span> + writeResult "); 
    } 
}</pre>
</div></div>


<h5><a name="POJOSupport-ReadingusingSQLQuery"></a>Reading using SQLQuery</h5>
<hr 
 size="1" 
 color="#3C78B5" 
 >


<h2><a name="POJOSupport-ReadingObjectsusingSQLQuery"></a>Reading Objects using SQLQuery</h2>
<div class="indent20 inline" style="margin-left: 20px;"><style type="text/css">div.inline p:first-child { display: inline; }</style><p><img src="download/attachments/48235229/POJO_read_multi.jpg" align="absmiddle" border="0"/></p></div>
<p>The following queries the space using SQL:</p>
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">GigaSpace space;
<span class="code-object">String</span> querystr	= <span class="code-quote">"employeeID=1 or employeeID=2"</span>;
SQLQuery query = <span class="code-keyword">new</span> SQLQuery(Employee.class.getName(), querystr);
Employee results[] = space.readMultiple(query , 10000);</pre>
</div></div>
<div class='panelMacro'><table class='noteMacro'><colgroup><col width='24'><col></colgroup><tr><td valign='top'><img src="images/icons/emoticons/warning.gif" width="16" height="16" align="absmiddle" alt="" border="0"></td><td>Constructing <tt>SQLQuery</tt> objects is a relatively expensive operation. You <b>should not construct these with every space query</b> operation. Instead, it is recommended to construct it once, and then use it with dynamic query options: <tt>SQLQuery.setParameters</tt> and <tt>SQLQuery.setParameter</tt>.</td></tr></table></div>


<h5><a name="POJOSupport-Clear"></a>Clear</h5>
<hr 
 size="1" 
 color="#3C78B5" 
 >

<h2><a name="POJOSupport-ClearObjects"></a>Clear Objects</h2>
<div class="indent20 inline" style="margin-left: 20px;"><style type="text/css">div.inline p:first-child { display: inline; }</style><p><img src="download/attachments/48235229/POJO_clear.jpg" align="absmiddle" border="0"/></p></div>
<p>You can use the SQLQuery with the <tt>GigaSpace.clear</tt> to remove objects from the space:</p>
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">GigaSpace space;
<span class="code-object">String</span> querystr	= <span class="code-quote">"age&gt;70"</span>;
SQLQuery query = <span class="code-keyword">new</span> SQLQuery(Employee.class.getName(), querystr);
space.clear(query);</pre>
</div></div>
<div class='panelMacro'><table class='noteMacro'><colgroup><col width='24'><col></colgroup><tr><td valign='top'><img src="images/icons/emoticons/warning.gif" width="16" height="16" align="absmiddle" alt="" border="0"></td><td>When using the SQLQuery with bigger/less than queries, turn on the <a href="Indexing.html#Indexing-ExtendedIndexing">extended indexing</a>.</td></tr></table></div>


<h5><a name="POJOSupport-UpdatinganObject"></a>Updating an Object</h5>
<hr 
 size="1" 
 color="#3C78B5" 
 >


<h2><a name="POJOSupport-UpdatinganObject"></a>Updating an Object</h2>
<div class="indent20 inline" style="margin-left: 20px;"><style type="text/css">div.inline p:first-child { display: inline; }</style><p><img src="download/attachments/48235229/POJO_update.jpg" align="absmiddle" border="0"/></p></div>
<p>The <tt>GigaSpace.write</tt> with the <a href="http://www.gigaspaces.com/docs/JavaDoc8.0/index.html?com/j_spaces/core/client/UpdateModifiers.html" target="_blank">UpdateModifiers.UPDATE_ONLY</a> modifier should be used to explicitly perform an update operation. The <a href="http://www.gigaspaces.com/docs/JavaDoc8.0/index.html?com/j_spaces/core/client/UpdateModifiers.html" target="_blank">UpdateModifiers.UPDATE_OR_WRITE</a> is the default mode with <tt>write</tt> operations. This means that subsequent calls to the <tt>write</tt> operation with an object with identical <tt>SpaceId</tt> will result in an update operation - i.e. a new object will not be inserted into the space.</p>

<p><img class="emoticon" src="images/icons/emoticons/warning.gif" height="16" width="16" align="absmiddle" alt="" border="0"/> Make sure your Space Class will have the <tt>SpaceId(autoGenerate=false)</tt> when performing <b>update</b> operations.</p>

<p>The <tt>GigaSpace.write</tt> has a few activity modes - <b>With each mode the return object options are different.</b>:</p>
<ol>
	<li>Inserting or updating an existing object - The <a href="http://www.gigaspaces.com/docs/JavaDoc8.0/index.html?com/j_spaces/core/client/UpdateModifiers.html" target="_blank">UpdateModifiers.UPDATE_OR_WRITE</a> modifier should be used. This is the default mode.</li>
	<li>Inserting a new object into the space - The <a href="http://www.gigaspaces.com/docs/JavaDoc8.0/index.html?com/j_spaces/core/client/UpdateModifiers.html" target="_blank">UpdateModifiers.WRITE_ONLY</a> modifier should be used.</li>
	<li>Updating an existing object - The <a href="http://www.gigaspaces.com/docs/JavaDoc8.0/index.html?com/j_spaces/core/client/UpdateModifiers.html" target="_blank">UpdateModifiers.UPDATE_ONLY</a> modifier should be used.</li>
	<li>Updating an existing object but sending only the modified fields to the space - The <a href="http://www.gigaspaces.com/docs/JavaDoc8.0/index.html?com/j_spaces/core/client/UpdateModifiers.html" target="_blank">UpdateModifiers.PARTIAL_UPDATE</a> modifier should be used.</li>
</ol>


<ul>
	<li>when the <a href="http://www.gigaspaces.com/docs/JavaDoc8.0/index.html?com/j_spaces/core/client/UpdateModifiers.html" target="_blank">UpdateModifiers.UPDATE_OR_WRITE</a> modifier is applied, the following returns:
	<ul>
		<li>For a successful operation:
		<ul>
			<li><tt>LeaseContext</tt> &#45; The <tt>LeaseContext.getObject()</tt> will return:
			<ul>
				<li><tt>null</tt> &#45; if a new object is inserted (write operation)</li>
				<li>The previous version of the object (update operation)</li>
			</ul>
			</li>
		</ul>
		</li>
		<li>For an unsuccessful operation:
		<ul>
			<li>an
<a href="http://www.gigaspaces.com/docs/JavaDoc7.1/org/openspaces/core/UpdateOperationTimeoutException.html" target="_blank">UpdateOperationTimeoutException</a>
<p>is thrown if a timeout occurred. This means the object is locked under another transaction.</p></li>
		</ul>
		</li>
	</ul>
	</li>
</ul>


<ul>
	<li>when the <a href="http://www.gigaspaces.com/docs/JavaDoc8.0/index.html?com/j_spaces/core/client/UpdateModifiers.html" target="_blank">UpdateModifiers.WRITE_ONLY</a> modifier is applied the following returns:
	<ul>
		<li>For a successful operation:
		<ul>
			<li><tt>LeaseContext</tt> &#45; Where the <tt>LeaseContext.getObject()</tt> will return a <tt>null</tt>.</li>
		</ul>
		</li>
		<li>For an unsuccessful operation:
		<ul>
			<li>an
<a href="http://www.gigaspaces.com/docs/JavaDoc7.1/org/openspaces/core/EntryAlreadyInSpaceException.html" target="_blank">EntryAlreadyInSpaceException</a>
<p>is thrown.</p></li>
		</ul>
		</li>
	</ul>
	</li>
</ul>


<ul>
	<li>when the <a href="http://www.gigaspaces.com/docs/JavaDoc8.0/index.html?com/j_spaces/core/client/UpdateModifiers.html" target="_blank">UpdateModifiers.UPDATE_ONLY</a> modifier is applied the following returns:
	<ul>
		<li>For a successful operation:
		<ul>
			<li><tt>LeaseContext</tt> &#45; Where the <tt>LeaseContext.getObject()</tt> will return the previous version of the object.</li>
		</ul>
		</li>
		<li>For an unsuccessful operation
		<ul>
			<li><tt>null</tt> &#45; if a timeout occurred. This means the object is locked under another transaction.</li>
			<li>an Exception object is thrown - the options are:
			<ul>
				<li><a href="http://www.gigaspaces.com/docs/JavaDoc7.1/org/openspaces/core/EntryNotInSpaceException.html" target="_blank">EntryNotInSpaceException</a>
<p>&#45; in case the object does not exist in the space.</p></li>
				<li><a href="http://www.gigaspaces.com/docs/JavaDoc7.1/org/openspaces/core/SpaceOptimisticLockingFailureException.html" target="_blank">SpaceOptimisticLockingFailureException</a>
<p>. Thrown only when running in Optimistic Locking mode. This Exception includes the existing version id of the object within the space and the client side version id of the object. In this case you should read the object again and retry the update operation. See <a href="Optimistic Locking.html" title="Optimistic Locking">Optimistic Locking</a> for more details.</p></li>
			</ul>
			</li>
		</ul>
		</li>
	</ul>
	</li>
</ul>


<ul>
	<li>when the <a href="http://www.gigaspaces.com/docs/JavaDoc8.0/index.html?com/j_spaces/core/client/UpdateModifiers.html" target="_blank">UpdateModifiers.PARTIAL_UPDATE</a> modifier is applied the return values are the same as with the <tt>UpdateModifiers.UPDATE_ONLY</tt> case. Fields that should not be updated <b>should have the value <tt>null</tt></b>. This means that only fields which are set will be sent into the space to replace the existing field's value. Make sure the updated object include its ID when using this option.</li>
</ul>


<p>When updating an object, you can specify 0 (ZERO) as the lease time. This will instruct the space to use the original lease time used when the object has been written into the space.</p>

<p>UPDATE_OR_WRITE Example:</p>
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java"><span class="code-keyword">try</span>
{
	LeaseContext ret = space.write(employee ,/*lease*/  0 ,/*timeout*/  1000 , UpdateModifiers.UPDATE_OR_WRITE);
	<span class="code-keyword">if</span> ( ret.getObject() == <span class="code-keyword">null</span>)
	{
		<span class="code-comment">//  successful write
</span>	}
	<span class="code-keyword">if</span> (ret.getObject() <span class="code-keyword">instanceof</span> Employee)
	{
		<span class="code-comment">//  successful update
</span>	}
}
<span class="code-keyword">catch</span> (UpdateOperationTimeoutException uote)
{
	<span class="code-comment">// <span class="code-object">Object</span> is locked - unsuccessful update
</span>}</pre>
</div></div>
<p>WRITE_ONLY Example:</p>
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java"><span class="code-keyword">try</span>
{
	LeaseContext ret = space.write(employee ,/*lease*/  0 ,/*timeout*/  1000 , UpdateModifiers.WRITE_ONLY);
	<span class="code-keyword">if</span> ( ret.getObject() == <span class="code-keyword">null</span>)
	{
		<span class="code-comment">//  successful write
</span>	}
}
<span class="code-keyword">catch</span> (EntryAlreadyInSpaceException eainse)
{
	<span class="code-comment">// <span class="code-object">Object</span> already exists - unsuccessful write
</span>}</pre>
</div></div>
<p>UPDATE_ONLY Example:</p>
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java"><span class="code-keyword">try</span>
{
	LeaseContext ret = space.write(employee ,/*lease*/  0 ,/*timeout*/  1000 , UpdateModifiers.UPDATE_ONLY);
	<span class="code-keyword">if</span> ( ret == <span class="code-keyword">null</span>)
	{
		<span class="code-comment">// <span class="code-object">Object</span> is locked - unsuccessful update
</span>	}
	<span class="code-keyword">else</span> <span class="code-keyword">if</span> (ret.getObject() <span class="code-keyword">instanceof</span> Employee)
	{
		<span class="code-comment">//  successful update
</span>	}
}
<span class="code-keyword">catch</span> (EntryNotInSpaceException enise)
{
	<span class="code-comment">// <span class="code-object">Object</span> not in space - unsuccessful update
</span>}
<span class="code-keyword">catch</span> (SpaceOptimisticLockingFailureException solfe)
{
	<span class="code-comment">// Client holds wrong version of the object - unsuccessful update. We need to read it again and issue the update call again.
</span>}</pre>
</div></div>

<p>PARTIAL_UPDATE Example:</p>
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">GigaSpace space = <span class="code-keyword">new</span> GigaSpaceConfigurer (<span class="code-keyword">new</span> UrlSpaceConfigurer(<span class="code-quote">"jini:<span class="code-comment">//*/*/mySpace"</span>).noWriteLease(<span class="code-keyword">true</span>)).gigaSpace();
</span>MyClass obj = <span class="code-keyword">new</span> MyClass();
obj.setId(<span class="code-quote">"1"</span>);
obj.setField1(<span class="code-quote">"A"</span>);
obj.setField2(<span class="code-quote">"B"</span>);
obj.setField3(<span class="code-quote">"C"</span>);                               
space.write(obj);
 
obj.setField1(<span class="code-keyword">null</span>);
obj.setField2(<span class="code-quote">"BBBB"</span>);
obj.setField3(<span class="code-keyword">null</span>);
<span class="code-keyword">try</span>
{
	space.write(obj,0,0,UpdateModifiers.PARTIAL_UPDATE);
	MyClass ret = space.readById(MyClass.class , <span class="code-quote">"1"</span>);
}
<span class="code-keyword">catch</span> (EntryNotInSpaceException enise)
{
	<span class="code-comment">// <span class="code-object">Object</span> not in space - unsuccessful update
</span>}</pre>
</div></div>


<h5><a name="POJOSupport-UpdatingaBatch"></a>Updating a Batch</h5>
<hr 
 size="1" 
 color="#3C78B5" 
 >


<h2><a name="POJOSupport-UpdatingaBatchofObjects"></a>Updating a Batch of Objects</h2>
<div class="indent20 inline" style="margin-left: 20px;"><style type="text/css">div.inline p:first-child { display: inline; }</style><p><img src="download/attachments/48235229/POJO_update_multi.jpg" align="absmiddle" border="0"/></p></div>
<p><img class="emoticon" src="images/icons/emoticons/warning.gif" height="16" width="16" align="absmiddle" alt="" border="0"/> Make sure your Space Class will have the <tt>SpaceId(autoGenerate=false)</tt> when performing update operations.</p>

<p>The <tt>GigaSpace.updateMultiple</tt> returns an array of objects which correspond to the input object array. The returned object element can be one of the following:</p>
<ul>
	<li>when the <a href="http://www.gigaspaces.com/docs/JavaDoc8.0/index.html?com/j_spaces/core/client/UpdateModifiers.html" target="_blank">UpdateModifiers.UPDATE_ONLY</a> modifier is applied the following returns:
	<ul>
		<li>For a successful operation:
		<ul>
			<li><b>The previous version of the object</b></li>
		</ul>
		</li>
		<li>For an unsuccessful operation:
		<ul>
			<li>null - if a timeout occurred. This means the object is locked under another transaction.</li>
			<li>an Exception object - the options are:
			<ul>
				<li><a href="http://www.gigaspaces.com/docs/JavaDoc7.1/org/openspaces/core/EntryNotInSpaceException.html" target="_blank">EntryNotInSpaceException</a>
<p>&#45; in case the entry does not exist</p></li>
				<li><a href="http://www.gigaspaces.com/docs/JavaDoc7.1/org/openspaces/core/SpaceOptimisticLockingFailureException.html" target="_blank">SpaceOptimisticLockingFailureException</a></li>
			</ul>
			</li>
		</ul>
		</li>
	</ul>
	</li>
</ul>


<ul>
	<li>when the <a href="http://www.gigaspaces.com/docs/JavaDoc8.0/index.html?com/j_spaces/core/client/UpdateModifiers.html" target="_blank">UpdateModifiers.UPDATE_OR_WRITE</a> modifier is applied the following returns:
	<ul>
		<li>For a successful operation:
		<ul>
			<li>null - if a new object is inserted (write operation)</li>
			<li>The previous version of the object (update operation)
<div class='panelMacro'><table class='tipMacro'><colgroup><col width='24'><col></colgroup><tr><td valign='top'><img src="images/icons/emoticons/check.gif" width="16" height="16" align="absmiddle" alt="" border="0"></td><td>Since the <tt>GigaSpace.updateMultiple</tt> in
<a href="http://www.gigaspaces.com/docs/JavaDoc8.0/index.html?com/j_spaces/core/client/UpdateModifiers.html" target="_blank">UpdateModifiers.UPDATE_OR_WRITE</a>
<p>mode does not support timeout based updates, there is no way to identify if an updated object is already locked under a transaction - i.e. the<br/>
<a href="http://www.gigaspaces.com/docs/JavaDoc7.1/org/openspaces/core/UpdateOperationTimeoutException.html" target="_blank">UpdateOperationTimeoutException</a> <b>is not returned</b> as part of the returned array elements.<br/>
With a transactional system, it is recommended to perform batch updates using the <a href="http://www.gigaspaces.com/docs/JavaDoc8.0/index.html?com/j_spaces/core/client/UpdateModifiers.html" target="_blank">UpdateModifiers.UPDATE_ONLY</a><br/>
modifier.</p></td></tr></table></div>
<p>UPDATE_ONLY Example:</p>
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">GigaSpace space;
Employee employees[] = space.readMultiple(query , 10000);
	<span class="code-object">Object</span> retUpdateMulti[] = space.updateMultiple(employees ,/*leases*/ <span class="code-keyword">new</span> <span class="code-object">long</span>[results.length],UpdateModifiers.UPDATE_ONLY);

<span class="code-keyword">for</span> (<span class="code-object">int</span> i = 0;i&lt;retUpdateMulti ; i++)
{
	<span class="code-keyword">if</span>  (retUpdateMulti[i] == <span class="code-keyword">null</span> ) {
		<span class="code-comment">//  unsuccessful update
</span>		<span class="code-keyword">break</span>;
	}
	<span class="code-keyword">else</span> <span class="code-keyword">if</span>  (retUpdateMulti[i] <span class="code-keyword">instanceof</span> Exception) {
		<span class="code-comment">//  unsuccessful update
</span>		<span class="code-keyword">if</span> (retUpdateMulti[i] <span class="code-keyword">instanceof</span> EntryNotInSpaceException)
		{
		...
		}

		<span class="code-keyword">else</span> <span class="code-keyword">if</span> (retUpdateMulti[i] <span class="code-keyword">instanceof</span> SpaceOptimisticLockingFailureException)
		{
		...
		}


		<span class="code-keyword">break</span>;
	}

	<span class="code-keyword">else</span> <span class="code-keyword">if</span>  (retUpdateMulti[i] <span class="code-keyword">instanceof</span> Employee ) {
		<span class="code-comment">//  successful update
</span>	}
}</pre>
</div></div>
<p>PARTIAL_UPDATE Example:</p>
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">GigaSpace space;
<span class="code-keyword">for</span> (<span class="code-object">int</span> i=0;i&lt;employees.length;i++)
{
	employees[i].setFirstName(<span class="code-keyword">null</span>);
	employees[i].setLastName(<span class="code-keyword">null</span>);
	employees[i].setBalance(newValue);
	leases[i] = Lease.FOREVER;
}

space.writeMultiple(employees, Lease.FOREVER, UpdateModifiers.PARTIAL_UPDATE);</pre>
</div></div></li>
		</ul>
		</li>
	</ul>
	</li>
</ul>
</div></div>
<hr 
 size="1" 
 color="C9C9C9" 
 >
<p><img src="download/attachments/19890517/referto.gif" align="absmiddle" border="0"/> <b>Next subchapter:</b> <a href="POJO Metadata.html" title="POJO Metadata">POJO Metadata</a> - This section deals with the annotations and gs.xml mapping file, troubleshooting procedures, considerations, UID generation and usage, as well as frequently used code snippets.</p>

                     </td>
</tr>
</table>
<table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr>
<td height="12" background="http://www.gigaspaces.com/wiki/images/border/border_bottom.gif"><img src="images/border/spacer.gif" width="1" height="1" border="0"/></td>
</tr>
<tr>
<td align="center"><font color="grey"><a href="http://www.gigaspaces.com">GigaSpaces.com</a> -
		<a href="http://www.gigaspaces.com/wiki/x/xwBmAg" class="smalltext">Legal Notice</a> -
		<a href="http://www.gigaspaces.com/wiki/x/xgBmAg" class="smalltext">3rd Party Licenses</a> -
		<a href="http://www.gigaspaces.com/wiki/x/BQFmAg" class="smalltext">Site Map</a> -
		<a href="http://www.gigaspaces.com/wiki/display/API/API+Documentation+Portal" class="version-link">API Docs</a> -
		<a href="http://forum.openspaces.org/forum.jspa?forumID=175" class="version-link">Forum</a> -
		<a href="http://www.gigaspaces.com/LatestProductVersion" class="version-link">Downloads</a> -
		<a href="http://blog.gigaspaces.com/" class="version-link">Blog</a> -
		<a href="http://www.gigaspaces.com/os_papers.html" class="version-link">White Papers</a> -
		<a href="mailto:techw@gigaspaces.com">Contact Tech Writing</a> -
		<i><a href="http://www.atlassian.com/software/confluence">Gen. by Atlassian Confluence</a></i></font></td>
</tr>
</table>
     </body>
</html>
