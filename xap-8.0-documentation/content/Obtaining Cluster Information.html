<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
     <head>
         <title>XAP 8.0 Documentation : Obtaining Cluster Information</title>
<link rel="stylesheet" href="styles/site.css" type="text/css" />
         <META http-equiv="Content-Type" content="text/html; charset=UTF-8">
		 <style>
.back-to {
	color: #666666;
	font-weight: bold;
}	 
a.back-to:link, a.back-to:visited, a.back-to:hover, a.back-to:active  {
	color: #666666;
}	 
		 </style>
     </head>

     <body>
<table class="pagecontent" border="0" cellpadding="0" cellspacing="0" width="100%" bgcolor="#ffffff">
<tr>
<td valign="top" class="pagebody">
<div class="pageheader">
<span class="back-to">XAP 8.0 Documentation > <a href="index.html">Back to Table of Contents</a></span><br>
<h1>Obtaining Cluster Information</h1>
</div>
<br>



<div style="border-style:solid; border-color:#3C78B5; border-width:thin; padding-left:20px; padding-bottom:20px; padding-top:20px; padding-right:20px; background-color:#D8E4F1"> 

<p><b>Section Summary:</b>  Obtaining information about the clustering topology, member id and other cluster related information can be useful in many cases. Cluster information can be provided to the processing unit instances at deployment time via the class <tt>org.openspaces.core.cluster.ClusterInfo</tt>, which can be injected into the processing unit components </p>
</div>

<h1><a name="ObtainingClusterInformation-Overview"></a>Overview</h1>

<p>One of the core concepts of GigaSpaces processing units is the fact that the clustering topology of the processing unit is determined at deployment time. Therefore, when building a processing unit, there is almost no need to be aware of the actual clustering topology with which the processing unit is deployed.<br/>
However, in some cases you may want your processing unit to be aware of it. <br/>
This mechanism is also used internally by the platform to maintain the clustering information when deploying a space for example. </p>

<h1><a name="ObtainingClusterInformation-AvailableClusterInformation"></a>Available Cluster Information </h1>

<p>As mentioned above the cluster information is passed to the components of each processing unit instance via an instance of the <tt>org.openspaces.core.cluster.ClusterInfo</tt> class, which holds the following information:</p>

<table class='confluenceTable'><tbody>
<tr>
<th class='confluenceTh'> Attribute Name </th>
<th class='confluenceTh'> Description </th>
<th class='confluenceTh'> Method </th>
</tr>
<tr>
<td class='confluenceTd'> Cluster schema </td>
<td class='confluenceTd'> If the processing unit contains an embedded space, the cluster schema of that space </td>
<td class='confluenceTd'> <tt>ClusterInfo#getSchema</tt></td>
</tr>
<tr>
<td class='confluenceTd'> Number of instances </td>
<td class='confluenceTd'> The number of instances of the processing unit. If the processing unit contains an embedded space, denotes the number of primary instances </td>
<td class='confluenceTd'> <tt>ClusterInfo#getNumberOfInstances</tt> </td>
</tr>
<tr>
<td class='confluenceTd'> Number of backups </td>
<td class='confluenceTd'>If the processing unit contains an embedded space with backups, denotes the number of backups per primary instance </td>
<td class='confluenceTd'> <tt>ClusterInfo#getNumberOfBackups</tt> </td>
</tr>
<tr>
<td class='confluenceTd'> Instance ID </td>
<td class='confluenceTd'> A value between 1 to <tt>numberOfInstances</tt>, denoting the instance ID of the processing unit instance </td>
<td class='confluenceTd'> <tt>ClusterInfo#getInstanceId</tt> </td>
</tr>
<tr>
<td class='confluenceTd'> Backup ID </td>
<td class='confluenceTd'> If the processing unit contains an embedded space with backups, a value between on 1 to <tt>numberOfBackups</tt>, denoting the backup ID of the processing instance. The primary instance ID which the processing unit instance is backing up is denoted by <tt>instanceId</tt>. If the processing unit instance is not a backup instance, <tt>null</tt> is returned </td>
<td class='confluenceTd'> <tt>ClusterInfo#getBackupId</tt> </td>
</tr>
<tr>
<td class='confluenceTd'> Running number </td>
<td class='confluenceTd'> A running number of the processing unit instance instance. Takes into account different topologies and provides a unique identifier (starting from <tt>0</tt>) of the processing unit instance within the cluster </td>
<td class='confluenceTd'> <tt>ClusterInfo#getRunningNumber</tt> </td>
</tr>
</tbody></table>


<p><img class="emoticon" src="images/icons/emoticons/information.gif" height="16" width="16" align="absmiddle" alt="" border="0"/> <tt>null</tt> value for one of these properties means that they are not applicable for the processing unit instance at hand or the used deployment topology.</p>

<h1><a name="ObtainingClusterInformation-ObtainingtheClusterInformation"></a>Obtaining the Cluster Information </h1>

<p>A <tt>ClusterInfo</tt> instance can be injected to the processing unit instances upon their creation. <br/>
There are several ways to enable the injection:</p>
<ul>
	<li>Implementing the <tt>ClusterInfoAware</tt> interface. Any component (a bean in the Spring configuration) within the processing unit that implements this interface will be automatically injected with the <tt>ClusterInfo</tt> instance</li>
	<li>Using the <tt>@ClusterInfoContext</tt> annotation. Fields of the processing unit components (beans in the Spring configuration) annotated with this annotation will be automatically injected with the <tt>ClusterInfo</tt> instance</li>
</ul>


<p>Once injected, the processing unit components can access all the information within the <tt>ClusterInfo</tt> instance and cache it locally for later usage (by saving it as an instance variable for example). </p>

<h1><a name="ObtainingClusterInformation-ClusterInfoAware"></a>ClusterInfoAware</h1>

<p>GigaSpaces provides the <tt>ClusterInfoAware</tt> interface, which allows beans to be injected with the <tt>ClusterInfo</tt> instance. This is similar to Spring's <tt>ApplicationContextAware</tt> interface, that allows beans to be injected with Spring's <tt>ApplicationContext</tt> by implementing the interface. <br/>
Here's the <tt>ClusterInfoAware</tt> interface:  </p>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java"><span class="code-keyword">public</span> <span class="code-keyword">interface</span> ClusterInfoAware {

    /**
     * Sets the cluster information.
     * 
     * &lt;p&gt;Note, the cluster information is obtained externally from the application context which means
     * that <span class="code-keyword">this</span> feature need to be supported by specific containers (and is not supported by plain
     * Spring application context). This means that beans that implement {@link ClusterInfoAware}
     * should take into account the fact that the cluster info provided might be <span class="code-keyword">null</span>.
     * 
     * @param clusterInfo
     *            The cluster information to be injected
     */
    void setClusterInfo(ClusterInfo clusterInfo);
}</pre>
</div></div>

<p>All of the processing unit <a href="Deploying and Running the Processing Unit.html" title="Deploying and Running the Processing Unit">runtime modes</a> provide support for the <tt>ClusterInfo</tt> and <tt>ClusterInfoAware</tt> interfaces by default. Built-in GigaSpaces components make use of this feature. User-defined beans can make use of this information as well (for example, to connect to a specific database based on the ID of the processing unit instance).</p>

<p><a name="ObtainingClusterInformation-ClusterInfoContext"></a></p>
<h1><a name="ObtainingClusterInformation-@ClusterInfoContext"></a>@ClusterInfoContext</h1>
<p>Similar to the the <tt>ClusterInfoAware</tt> interface, this field level annotation allows beans to be injected with the <tt>ClusterInfo</tt> instance. Here's an example: </p>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java"><span class="code-keyword">public</span> class MyBean {

    @ClusterInfoContext
    <span class="code-keyword">private</span> ClusterInfo clusterInfo;

    ...
}</pre>
</div></div>

<h1><a name="ObtainingClusterInformation-SpaceConstructionandClusterInfo"></a>Space Construction and ClusterInfo</h1>

<p>The Space component implements the <tt>ClusterInfoAware</tt>, and uses it in order to construct an embedded space by mapping <tt>ClusterInfo</tt> properties to Space URL properties (if provided). Here is a mapping from <tt>ClusterInfo</tt> to Space URL properties:</p>

<table class='confluenceTable'><tbody>
<tr>
<th class='confluenceTh'>ClusterInfo</th>
<th class='confluenceTh'>Space URL</th>
</tr>
<tr>
<td class='confluenceTd'> <tt>ClusterInfo#getSchema</tt> </td>
<td class='confluenceTd'> <tt>cluster_schema</tt> </td>
</tr>
<tr>
<td class='confluenceTd'> <tt>ClusterInfo#getNumberOfInstances</tt> </td>
<td class='confluenceTd'> <tt>total_members</tt> first value (before the comma) </td>
</tr>
<tr>
<td class='confluenceTd'> <tt>ClusterInfo#getNumberOfBackups</tt> </td>
<td class='confluenceTd'> <tt>total_members</tt> second value (after the comma) </td>
</tr>
<tr>
<td class='confluenceTd'> <tt>ClusterInfo#getInstanceId</tt> </td>
<td class='confluenceTd'> <tt>id</tt> </td>
</tr>
<tr>
<td class='confluenceTd'> <tt>ClusterInfo#getBackupId</tt> </td>
<td class='confluenceTd'> <tt>backup_id</tt> </td>
</tr>
</tbody></table>

<h1><a name="ObtainingClusterInformation-ClusterInfoXMLInjection"></a>ClusterInfo XML Injection</h1>

<p>When running the processing unit in any of the <a href="Deploying and Running the Processing Unit.html" title="Deploying and Running the Processing Unit">runtime modes</a>, <tt>ClusterInfo</tt> can also be used directly within the Spring XML configuration. In a similar manner, properties can be injected. Here is an example of how this can be used:</p>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-xml"><span class="code-tag">&lt;bean id=<span class="code-quote">"myBean"</span> class=<span class="code-quote">"MyBean"</span>&gt;</span>
    <span class="code-tag">&lt;property name=<span class="code-quote">"connectionUrl"</span> value=<span class="code-quote">"testconnection_${clusterInfo.runnimgNumber}"</span> /&gt;</span>
<span class="code-tag">&lt;/bean&gt;</span></pre>
</div></div> 

<p>In the above example, the value of the <tt>connectionUrl</tt> property of <tt>myBean</tt> is  built based on the <tt>runningNumber</tt> provided by the <tt>ClusterInfo</tt> instance. Here is a list mapping the <tt>ClusterInfo</tt> properties to their equivalent <tt>${clusterInfo.*</tt>} syntax:</p>

<table class='confluenceTable'><tbody>
<tr>
<th class='confluenceTh'>ClusterInfo</th>
<th class='confluenceTh'>Space URL</th>
</tr>
<tr>
<td class='confluenceTd'> <tt>ClusterInfo#getSchema</tt> </td>
<td class='confluenceTd'> <tt>clusterInfo.schema</tt> </td>
</tr>
<tr>
<td class='confluenceTd'> <tt>ClusterInfo#getNumberOfInstances</tt> </td>
<td class='confluenceTd'> <tt>clusterInfo.numberOfInstances</tt> </td>
</tr>
<tr>
<td class='confluenceTd'> <tt>ClusterInfo#getNumberOfBackups</tt> </td>
<td class='confluenceTd'> <tt>clusterInfo.numberOfBackups</tt> </td>
</tr>
<tr>
<td class='confluenceTd'> <tt>ClusterInfo#getInstanceId</tt> </td>
<td class='confluenceTd'> <tt>clusterInfo.instanceId</tt> </td>
</tr>
<tr>
<td class='confluenceTd'> <tt>ClusterInfo#getBackupId</tt> </td>
<td class='confluenceTd'> <tt>clusterInfo.backupId</tt> </td>
</tr>
<tr>
<td class='confluenceTd'> <tt>ClusterInfo#getRunningNumber</tt> </td>
<td class='confluenceTd'> <tt>clusterInfo.runningNumber</tt> </td>
</tr>
<tr>
<td class='confluenceTd'> <tt>ClusterInfo#getRunningNumberOffest1</tt> </td>
<td class='confluenceTd'> <tt>clusterInfo.runningNumberOffest1</tt> </td>
</tr>
</tbody></table>

<h1><a name="ObtainingClusterInformation-ProcessingUnitContainerInjection"></a>Processing Unit Container Injection</h1>

<p>Each of the <a href="Deploying and Running the Processing Unit.html" title="Deploying and Running the Processing Unit">runtime modes</a> supports the injection of <tt>ClusterInfo</tt>. However, when running in <a href="Running in Standalone Mode.html" title="Running in Standalone Mode">standalone mode</a> or <a href="Running and Debugging Within Your IDE.html" title="Running and Debugging Within Your IDE">within your IDE</a>, the <tt>-cluster</tt> parameter controls the clustering aspects of the processing unit instance(s). Below is a list of the parameters you can specify for the standalone and IDE runtime modes, and how they are mapped the <tt>ClusterInfo</tt> properties: </p>

<ul>
	<li><tt>schema clusterSchemaName</tt>: Maps to <tt>ClusterInfo#setSchema</tt>.</li>
	<li><tt>total_members numberOfInstances[,numberOfBackups]</tt>: Maps to <tt>ClusterInfo#setNumberOfInstances</tt>, and optionally <tt>ClusterInfo#setNumberOfBackups</tt>.</li>
	<li><tt>id instanceId</tt>: Maps to <tt>ClusterInfo#setInstanceId</tt>.</li>
	<li><tt>backup_id backupId</tt>: Maps to <tt>ClusterInfo#setBackupId</tt>.</li>
</ul>


<p><img src="download/attachments/19890517/referto.gif" align="absmiddle" border="0"/> For more details on how to use the <tt>-cluster</tt> option, see the <a href="Deploying and Running the Processing Unit.html" title="Deploying and Running the Processing Unit">processing unit runtime modes section</a></p>


                     </td>
</tr>
</table>
<table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr>
<td height="12" background="http://www.gigaspaces.com/wiki/images/border/border_bottom.gif"><img src="images/border/spacer.gif" width="1" height="1" border="0"/></td>
</tr>
<tr>
<td align="center"><font color="grey"><a href="http://www.gigaspaces.com">GigaSpaces.com</a> -
		<a href="http://www.gigaspaces.com/wiki/x/xwBmAg" class="smalltext">Legal Notice</a> -
		<a href="http://www.gigaspaces.com/wiki/x/xgBmAg" class="smalltext">3rd Party Licenses</a> -
		<a href="http://www.gigaspaces.com/wiki/x/BQFmAg" class="smalltext">Site Map</a> -
		<a href="http://www.gigaspaces.com/wiki/display/API/API+Documentation+Portal" class="version-link">API Docs</a> -
		<a href="http://forum.openspaces.org/forum.jspa?forumID=175" class="version-link">Forum</a> -
		<a href="http://www.gigaspaces.com/LatestProductVersion" class="version-link">Downloads</a> -
		<a href="http://blog.gigaspaces.com/" class="version-link">Blog</a> -
		<a href="http://www.gigaspaces.com/os_papers.html" class="version-link">White Papers</a> -
		<a href="mailto:techw@gigaspaces.com">Contact Tech Writing</a> -
		<i><a href="http://www.atlassian.com/software/confluence">Gen. by Atlassian Confluence</a></i></font></td>
</tr>
</table>
     </body>
</html>
