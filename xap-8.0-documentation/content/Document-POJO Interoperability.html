<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
     <head>
         <title>XAP 8.0 Documentation : Document-POJO Interoperability</title>
<link rel="stylesheet" href="styles/site.css" type="text/css" />
         <META http-equiv="Content-Type" content="text/html; charset=UTF-8">
		 <style>
.back-to {
	color: #666666;
	font-weight: bold;
}	 
a.back-to:link, a.back-to:visited, a.back-to:hover, a.back-to:active  {
	color: #666666;
}	 
		 </style>
     </head>

     <body>
<table class="pagecontent" border="0" cellpadding="0" cellspacing="0" width="100%" bgcolor="#ffffff">
<tr>
<td valign="top" class="pagebody">
<div class="pageheader">
<span class="back-to">XAP 8.0 Documentation > <a href="index.html">Back to Table of Contents</a></span><br>
<h1>Document-POJO Interoperability</h1>
</div>
<br>



<div style="border-style:solid; border-color:#3C78B5; border-width:thin; padding-left:20px; padding-bottom:20px; padding-top:20px; padding-right:20px; background-color:#D8E4F1"> 

<p><b>Section Summary:</b>  Interoperability between POJO and Document space entries </p>
</div>

<h1><a name="Document-POJOInteroperability-Overview"></a>Overview</h1>

<p>GigaSpaces offers interoperability between documents and POJOs via space - it is possible to write POJOs an read them as documents, and vice versa. This is usually useful in scenarios requiring reading and/or manipulating POJO objects without loading the concrete java classes. This page describes how to do it.<br/>
<a href='http://www.gigaspaces.com/wiki/download/attachments/48235229/document_arch.jpg' target='document_arch.jpg' onClick='window.open("http://www.gigaspaces.com/wiki/download/attachments/48235229/document_arch.jpg", "document_arch.jpg", "height=470,width=580,menubar=no,status=no,toolbar=no"); return false;'><img src="download/thumbnails/48235229/document_arch.jpg" align="absmiddle" border="0"/></a><br/>
<img class="emoticon" src="images/icons/emoticons/add.gif" height="16" width="16" align="absmiddle" alt="" border="0"/> In previous releases the <tt>ExternalEntry</tt> class was used to achieve this functionality. Starting 8.0, the <tt>SpaceDocument</tt> class should be used to accomplish these needs in a simpler and safer manner, whereas <tt>ExternalEntry</tt> has been deprecated and should no longer be used.</p>

<h1><a name="Document-POJOInteroperability-Requirements"></a>Requirements</h1>

<p>When working with documents the user is in charge of creating and registering the space type descriptor manually before writing/reading documents. When working with POJOs the system implicitly generates a space type descriptor for the POJO's class using annotations or <tt>gs.xml</tt> files when the class is used for the first time. In order to inter-operate, the same type descriptor should be used for both POJOs and documents.</p>

<p>If the POJO's class is in the application's classpath, or the POJO is already registered in the space, there's no need to register it again - the application will retrieve it automatically when it's used for the first time. For example:</p>
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java"><span class="code-comment">// Create a document template using the POJO class name:
</span>SpaceDocument template = <span class="code-keyword">new</span> SpaceDocument(MyPojo.class.getName());
<span class="code-comment">// Count all entries matching the template:
</span><span class="code-object">int</span> count = gigaSpace.count(template);</pre>
</div></div>

<p>If the POJO's class is not available in the classpath or server, the application will throw an exception indicating there's no type descriptor registered for the specified type. In that case, it is possible to manually create a matching type descriptor using the <tt>SpaceTypeDescriptorBuilder</tt> and register it in the space. However, that's not recommended since it essentially requires you to duplicate all the POJO settings and maintain them if the POJO changes.</p>

<h1><a name="Document-POJOInteroperability-QueryResultType"></a>Query Result Type</h1>

<p>When no interoperability is involved this is a trivial matter - Querying a POJO type returns POJOs, querying a document type returns documents.<br/>
When we want to mix and match, we need semantics to determine to query result type - POJO or document.</p>

<h2><a name="Document-POJOInteroperability-TemplateQuery"></a>Template Query</h2>

<p>Template query result types are determined by the template class - if the template is an instance of a <tt>SpaceDocumnet</tt> the result(s) will be document(s), otherwise it will be POJO(s).</p>

<h2><a name="Document-POJOInteroperability-SQLQuery"></a>SQL Query</h2>

<p>The <tt>SQLQuery</tt> class has been enhanced with a <tt>QueryResultType</tt> settings which can be set at construction. The following options are available:</p>
<ul>
	<li><tt>OBJECT</tt> - Return java Object(s) (POJO).</li>
	<li><tt>DOCUMENT</tt> - Return space document(s).</li>
	<li><tt>NOT_SET</tt> - If the type is registered with a concrete java class, return an Object. Otherwise, return a document. This is the default behavior.</li>
</ul>


<p>This strategy both preserves backwards compatibility and simplifies non-interoperability scenarios, which are more common.</p>

<h2><a name="Document-POJOInteroperability-IDBasedQuery"></a>ID Based Query</h2>

<p>In order to support ID queries for documents, the <tt>IdQuery</tt> class has been introduced, which encapsulates the type, id, routing and a <tt>QueryResultType</tt>. New <tt>GigaSpace</tt> overload methods have been added to <tt>readById</tt>, <tt>readIfExistsById</tt>, <tt>takeById</tt>, <tt>takeIfExistsById</tt>. The result type is determined by the <tt>QueryResultType</tt>, similar to <tt>SQLQuery</tt>.</p>

<p>Respectively, to support multiple ids queries, <tt>IdsQuery</tt> was also introduced, with new overloads for <tt>readByIds</tt> and <tt>takeByIds</tt>.</p>

<p>The original <tt>readById</tt> (and related methods) overloads are not suited for document types, since they require a concrete java class. They always return POJO(s).</p>

<h1><a name="Document-POJOInteroperability-DynamicProperties"></a>Dynamic Properties</h1>

<p>By default, type descriptors created from POJO classes do not support dynamic properties. If a document of such a type with a property that is not defined in the POJO will be written to the space, an exception will be thrown indicating the property is not defined in the type and the type does not support dynamic properties.<br/>
It is possible to manually create a <tt>SpaceTypeDescriptor</tt> of the POJO using the <tt>SpaceTypeDescriptorBuilder</tt> and enable dynamic properties. Note, however, that in that case if client A writes a document with a dynamic property and client B reads it as a POJO, the dynamic property will be ignored, and if client B will proceed to update the entry the dynamic property will be deleted from the space.</p>

<h1><a name="Document-POJOInteroperability-LocalCache%2FLocalView"></a>Local Cache / Local View</h1>

<p><a href="Local View and Local Cache.html" title="Local View and Local Cache">Local View and Local Cache</a> supports both POJOs and Documents. Unlike an embedded space, the entry is stored in the cache as a user object (either POJO or document), which speeds up query performance since the result entries do not have to be transformed.</p>

<p>When working with POJOs only or Documents only, this is not an issue. However, when working in a mixed POJO-document environment and querying the cache for documents, reading a POJO will return the reference to the POJO stored in the cache, whereas reading a document will require transforming the POJO to a document before returning the result.</p>

<p><img class="emoticon" src="images/icons/emoticons/warning.gif" height="16" width="16" align="absmiddle" alt="" border="0"/> The above assumes the Local Cache / Local View running in default <a href="Local View and Local Cache.html#LocalViewandLocalCache-ObjectReferenceStorageMode">Object Reference Storage Mode</a>. If <tt>shallowCopy</tt> is configured this is irrelevant.</p>

<h1><a name="Document-POJOInteroperability-SpaceFiltersandSpaceReplicationFilters"></a>Space Filters and Space Replication Filters</h1>

<p>Space Filters are supported for space documents. If the space type descriptor that is registered in the space contains the POJO class, the entry will be passed to the filter as a POJO. Otherwise, it will be passed to the filter as a document.</p>

                     </td>
</tr>
</table>
<table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr>
<td height="12" background="http://www.gigaspaces.com/wiki/images/border/border_bottom.gif"><img src="images/border/spacer.gif" width="1" height="1" border="0"/></td>
</tr>
<tr>
<td align="center"><font color="grey"><a href="http://www.gigaspaces.com">GigaSpaces.com</a> -
		<a href="http://www.gigaspaces.com/wiki/x/xwBmAg" class="smalltext">Legal Notice</a> -
		<a href="http://www.gigaspaces.com/wiki/x/xgBmAg" class="smalltext">3rd Party Licenses</a> -
		<a href="http://www.gigaspaces.com/wiki/x/BQFmAg" class="smalltext">Site Map</a> -
		<a href="http://www.gigaspaces.com/wiki/display/API/API+Documentation+Portal" class="version-link">API Docs</a> -
		<a href="http://forum.openspaces.org/forum.jspa?forumID=175" class="version-link">Forum</a> -
		<a href="http://www.gigaspaces.com/LatestProductVersion" class="version-link">Downloads</a> -
		<a href="http://blog.gigaspaces.com/" class="version-link">Blog</a> -
		<a href="http://www.gigaspaces.com/os_papers.html" class="version-link">White Papers</a> -
		<a href="mailto:techw@gigaspaces.com">Contact Tech Writing</a> -
		<i><a href="http://www.atlassian.com/software/confluence">Gen. by Atlassian Confluence</a></i></font></td>
</tr>
</table>
     </body>
</html>
