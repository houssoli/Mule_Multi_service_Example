<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
     <head>
         <title>XAP 8.0 Documentation : Step 3 - Scaling the Data Access Layer</title>
<link rel="stylesheet" href="styles/site.css" type="text/css" />
         <META http-equiv="Content-Type" content="text/html; charset=UTF-8">
		 <style>
.back-to {
	color: #666666;
	font-weight: bold;
}	 
a.back-to:link, a.back-to:visited, a.back-to:hover, a.back-to:active  {
	color: #666666;
}	 
		 </style>
     </head>

     <body>
<table class="pagecontent" border="0" cellpadding="0" cellspacing="0" width="100%" bgcolor="#ffffff">
<tr>
<td valign="top" class="pagebody">
<div class="pageheader">
<span class="back-to">XAP 8.0 Documentation > <a href="index.html">Back to Table of Contents</a></span><br>
<h1>Step 3 - Scaling the Data Access Layer</h1>
</div>
<br>

<script type='text/javascript'>//<![CDATA[
function debug() { }
// ]]></script><script type='text/javascript' src='/wiki/download/resources/net.customware.confluence.plugin.composition:composition-setup/js/browser.js'>//<![CDATA[
// ]]></script><script type='text/javascript' src='/wiki/download/resources/net.customware.confluence.plugin.composition:composition-setup/js/behaviour.js'>//<![CDATA[
// ]]></script><script type='text/javascript' src='/wiki/download/resources/net.customware.confluence.plugin.composition:composition-setup/js/memory.js'>//<![CDATA[
// ]]></script><script type='text/javascript' src='/wiki/download/resources/net.customware.confluence.plugin.composition:composition-setup/js/cloak.js'>//<![CDATA[
// ]]></script><script type='text/javascript'>//<![CDATA[
Cloak.closeHTML = "<img src=\'/wiki/download/resources/net.customware.confluence.plugin.composition:toggle-cloak/img/navigate_down_10.gif\'/>";
Cloak.openHTML = "<img src=\'/wiki/download/resources/net.customware.confluence.plugin.composition:toggle-cloak/img/navigate_right_10.gif\'/>";
Cloak.toggleZone = true;
Cloak.memoryDuration = 0;
Cloak.memoryPrefix = "contentId:53903786";
Cloak.memoryPath = "/wiki/";
// ]]></script><style type='text/css'>
.cloakToggle { /* Definition for state toggling image */
cursor:hand;
cursor:pointer;
}
</style><script type='text/javascript' src='/wiki/download/resources/net.customware.confluence.plugin.composition:composition-setup/js/transitions.js'>//<![CDATA[
// ]]></script><script type='text/javascript' src='/wiki/download/resources/net.customware.confluence.plugin.composition:composition-setup/js/deck.js'>//<![CDATA[
// ]]></script><link rel='stylesheet' type='text/css'  href='/wiki/styles/main-action.css?pluginCompleteKey=net.customware.confluence.plugin.composition:composition-setup&stylesheetName=deck&spaceKey=XAP8'/><script type='text/javascript'>//<![CDATA[
Deck.memoryDuration = 0;
Deck.memoryPrefix = "contentId:53903786";
Deck.memoryPath = "/wiki/";
// ]]></script>





<p><b>Step summary</b>: Learn how to <b>access the GigaSpaces in memory data grid</b> from within your web application, thus removing the database bottleneck from your data access layer</p>


<table class="sectionMacro" border="0" cellpadding="5" cellspacing="0" width="100%"><tbody><tr>
<h1><a name="Step3-ScalingtheDataAccessLayer-ExampleLocation%26CoveredTopics"></a>Example Location &amp; Covered Topics</h1>


<p><img class="emoticon" src="images/icons/emoticons/information.gif" height="16" width="16" align="absmiddle" alt="" border="0"/> The Sample application for this step is located under <tt>&lt;GigaSpaces Root&gt;/examples/web/space-access</tt>. </p>

<h5><a name="Step3-ScalingtheDataAccessLayer-FeaturesIntroduced"></a>Features Introduced</h5>
<p><img class="emoticon" src="images/icons/emoticons/check.gif" height="16" width="16" align="absmiddle" alt="" border="0"/> Connecting to the space from within your web application<br/>
<img class="emoticon" src="images/icons/emoticons/check.gif" height="16" width="16" align="absmiddle" alt="" border="0"/> Reading from and writing to the Space 
<br clear="all" /></p></tr></tbody></table>
<hr 
 size="1" 
 color="C9C9C9" 
 >


<table class="sectionMacro" border="0" cellpadding="5" cellspacing="0" width="100%"><tbody><tr>
<h4><a name="Step3-ScalingtheDataAccessLayer-Beforeyoubegin"></a>Before you begin</h4>

<p>We recommend that you go through the following steps before you begin this tutorial:</p>
<ul>
	<li><a href="Setting Up your IDE to work with GigaSpaces.html" title="Setting Up your IDE to work with GigaSpaces">Download GigaSpaces and set up your development environment</a>  - needed to run the sample application described in this tutorial.</li>
	<li><a href="Step 1 - Deploying Your Web Application to the GigaSpaces Environment.html" title="Step 1 - Deploying Your Web Application to the GigaSpaces Environment">Step 1 - Deploying Your Web Application to the GigaSpaces Environment</a> - needed to understand how your web application can be deployed to the GigaSpaces environment and benefit from it.</li>
	<li><a href="Step 2 - Enabling HTTP Session Failover and Fault Tolerance.html" title="Step 2 - Enabling HTTP Session Failover and Fault Tolerance">Step 2 - Enabling HTTP Session Failover &amp; Fault Tolerance</a> - If you're interested in transparent failover and fault tolerance for your HTTP session.
<br clear="all" /></li>
</ul>
</tr></tbody></table>
<hr 
 size="1" 
 color="C9C9C9" 
 >


<table class="sectionMacro" border="0" cellpadding="5" cellspacing="0" width="100%"><tbody><tr>
<h4><a name="Step3-ScalingtheDataAccessLayer-Goals"></a>Goals</h4>

<p>Solve the database bottle neck by accessing the in-memory data grid from within your web application. </p>



<h4><a name="Step3-ScalingtheDataAccessLayer-Contents"></a>Contents</h4>
<ol>
	<li><a href="#Step3-ScalingtheDataAccessLayer-ExampleOverview">Example Application Overview</a></li>
	<li><a href="#Step3-ScalingtheDataAccessLayer-BuildDirections">Building the Example</a></li>
	<li><a href="#Step3-ScalingtheDataAccessLayer-ConnectingToSpace">Connecting to the Space</a></li>
	<li><a href="#Step3-ScalingtheDataAccessLayer-InteractingWithSpace">Interacting with the Space</a></li>
	<li><a href="#Step3-ScalingtheDataAccessLayer-Considerations">Considerations - Direct Space Access vs. Indirect Access via HTTP Session Backed by the Space</a></li>
	<li><a href="#Step3-ScalingtheDataAccessLayer-PlainClient">Accessing the Space from A Standalone Web Container</a></li>
	<li><a href="#Step3-ScalingtheDataAccessLayer-AllTogehter">Putting It All Together - Running the Sample Application</a>
<br clear="all" />
<br clear="all" /></li>
</ol>
</tr></tbody></table>



<p><a name="Step3-ScalingtheDataAccessLayer-ExampleOverview"></a></p>
<h1><a name="Step3-ScalingtheDataAccessLayer-ExampleApplicationOverview"></a>Example Application Overview </h1>
<p>The example application is composed of a JSP page, a servlet which accesses the space and simple data object. It is very similar to the example introduced in the previous step, but rather accesses the space directly instead of accessing the HTTP session. The <tt>AccessSpaceServlet</tt> is responsible for retrieving request parameters, creating an instance of type <tt>UserData</tt> and writing it to the space. The <tt>SpaceContents.jsp</tt> displays the contents of all the <tt>UserData</tt> instances stored in the Space, and renders two input fields, <em>Name</em> and <em>Value</em> for the user to input new values.
<br clear="all" />
<br clear="all" />
<span id='tgl_content_Snippets' class='cloakToggle'></span> <b>Click here for code snippets and screenshot of the sample application...</b></p>


<p>Here's a snippet of the <tt>UserData</tt> class: </p>
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java"><span class="code-keyword">public</span> class UserData {		
	<span class="code-keyword">private</span> <span class="code-object">String</span> name; 
	<span class="code-keyword">private</span> <span class="code-object">String</span> value;
	<span class="code-keyword">private</span> <span class="code-object">String</span> userId; 
	
	...
	
	<span class="code-comment">//Marks the field that is used to identify the class
</span>	@SpaceId
	<span class="code-comment">//Marks the routing field, whose value is used by the space proxy to determine the partition to 
</span>	<span class="code-comment">//which the instance will be routed
</span>	@SpaceRouting
	<span class="code-keyword">public</span> <span class="code-object">String</span> getName() {
		<span class="code-keyword">return</span> name;
	}
	<span class="code-keyword">public</span> void setName(<span class="code-object">String</span> name) {
		<span class="code-keyword">this</span>.name = name;
	}
	
	<span class="code-comment">//other getters and setters
</span>	...</pre>
</div></div>

<p>Here's a snippet of the doPost method of the <tt>AccessSpaceServlet</tt> class (the details of the implementation are discussed later in this tutorial): </p>
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java"><span class="code-keyword">public</span> class UpdateSessionServlet <span class="code-keyword">extends</span> HttpServlet {       
	/**
	 * @see HttpServlet#doPost(HttpServletRequest request, HttpServletResponse response)
	 */
	<span class="code-keyword">protected</span> void doPost(HttpServletRequest request, HttpServletResponse response) 
                                                      <span class="code-keyword">throws</span> ServletException, IOException {
        <span class="code-object">System</span>.out.println(<span class="code-quote">"******* Got Request *******"</span>);
		<span class="code-object">String</span> userId = request.getSession().getId();
		<span class="code-object">String</span> dataName = request.getParameter(<span class="code-quote">"dataname"</span>);
        <span class="code-object">String</span> dataValue = request.getParameter(<span class="code-quote">"datavalue"</span>);
        <span class="code-keyword">if</span> (isStringNotEmpty(dataName) &amp;&amp; isStringNotEmpty(dataValue)) {            
            <span class="code-comment">//Create a <span class="code-keyword">new</span> UserData instance based on the request parameters and 
</span>            <span class="code-comment">//write it to the space
</span>            gigaSpace.write(<span class="code-keyword">new</span> UserData(dataName, dataValue, userId), 
                            Lease.FOREVER, 30000, UpdateModifiers.UPDATE_OR_WRITE);
        }     
        <span class="code-comment">//read all existing UserData instances from the space and put the in the request
</span>        <span class="code-comment">//so that the jsp page can render them 
</span>        UserData[] spaceEntries = gigaSpace.readMultiple(<span class="code-keyword">new</span> UserData(), <span class="code-object">Integer</span>.MAX_VALUE);
        request.setAttribute(<span class="code-quote">"spaceEntries"</span>, spaceEntries); 
        <span class="code-comment">//forward request to the jsp page 
</span>        request.getRequestDispatcher(<span class="code-quote">"SpaceContents.jsp"</span>).forward(request, response);
	}

	<span class="code-keyword">private</span> <span class="code-object">boolean</span> isStringNotEmpty(<span class="code-object">String</span> str) {
		<span class="code-keyword">return</span> (str != <span class="code-keyword">null</span> &amp;&amp; str.trim().length() &gt; 0);  
	}
	...
}</pre>
</div></div>
<p>Here's the code snippet from <tt>SpaceContents.jsp</tt>: </p>
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-html"><span class="code-tag">&lt;h3&gt;</span>Space Contents<span class="code-tag">&lt;/h3&gt;</span>
&lt;%	
	String hostName = request.getServerName(); 
	String sessionId = session.getId();
%&gt;
<span class="code-tag">&lt;br/&gt;</span>
<span class="code-tag">&lt;table&gt;</span>	
	<span class="code-tag">&lt;tr&gt;</span>
		<span class="code-tag">&lt;td&gt;</span>Servlet container host name:<span class="code-tag">&lt;/td&gt;</span>
		<span class="code-tag">&lt;td&gt;</span><span class="code-tag">&lt;%= hostName %&gt;</span><span class="code-tag">&lt;/td&gt;</span>
	<span class="code-tag">&lt;/tr&gt;</span>
	<span class="code-tag">&lt;tr&gt;</span>
		<span class="code-tag">&lt;td&gt;</span>Session id:<span class="code-tag">&lt;/td&gt;</span>
		<span class="code-tag">&lt;td&gt;</span><span class="code-tag">&lt;%= sessionId %&gt;</span><span class="code-tag">&lt;/td&gt;</span>
	<span class="code-tag">&lt;/tr&gt;</span>
<span class="code-tag">&lt;/table&gt;</span>
<span class="code-tag">&lt;h3&gt;</span>Space Contents:<span class="code-tag">&lt;/h3&gt;</span>
&lt;%
	UserData[] spaceEntries = (UserData[])request.getAttribute(<span class="code-quote">"spaceEntries"</span>);
	if (spaceEntries != null ) {
		for(UserData data : spaceEntries) { %&gt;
			<span class="code-tag">&lt;%= data.getName() %&gt;</span> = <span class="code-tag">&lt;%= data.getValue() %&gt;</span><span class="code-tag">&lt;br/&gt;</span>
<span class="code-tag">&lt;%		} %&gt;</span>
<span class="code-tag">&lt;%	} %&gt;</span>
<span class="code-tag">&lt;p/&gt;</span></pre>
</div></div>

<p>When opening this page in a web browser, it looks as follows: </p>
<div class="" align="center"><img src="download/attachments/53903786/space-screenshot.jpg" align="absmiddle" border="0"/></div>




<p><a name="Step3-ScalingtheDataAccessLayer-BuildDirections"></a></p>
<h1><a name="Step3-ScalingtheDataAccessLayer-BuildingtheExample"></a>Building the Example</h1>
<p><img src="download/attachments/17301573/Play arrow green.bmp" align="absmiddle" border="0"/> <b>Steps to build the application:</b><br/>
The first thing you need to do if you haven't already done so, is <a href="Setting Up your IDE to work with GigaSpaces.html" title="Setting Up your IDE to work with GigaSpaces">Download GigaSpaces and set up your development environment</a>. <br/>
Next, you should open a shell / command prompt window in the example directory, and type the following: <br/>
<tt>build.(sh/bat) dist</tt><br/>
You should an output similar to the following: </p>
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">C:\GS-Releases\gigaspaces-xap-premium-7.0.0-ga\examples\web\space-access&gt;build dist
Buildfile: build.xml

build:
    [mkdir] Created dir: C:\GS-Releases\gigaspaces-xap-premium-7.0.0-ga\examples\web\s
pace-access\out\common
    [javac] Compiling 1 source file to C:\GS-Releases\gigaspaces-xap-premium-7.0.0-ga\
examples\web\space-access\out\common
    [mkdir] Created dir: C:\GS-Releases\gigaspaces-xap-premium-7.0.0-ga\examples\web\s
pace-access\WebContent\WEB-INF\classes
    [javac] Compiling 1 source file to C:\GS-Releases\gigaspaces-xap-premium-7.0.0-ga\
examples\web\space-access\WebContent\WEB-INF\classes

dist:
      [jar] Building jar: C:\GS-Releases\gigaspaces-xap-premium-7.0.0-ga\examples\web\
space-access\WebContent\WEB-INF\shared-lib\common.jar
      [jar] Building jar: C:\GS-Releases\gigaspaces-xap-premium-7.0.0-ga\examples\web\
space-access\SpaceAccess.war

BUILD SUCCESSFUL
Total time: 4 seconds</pre>
</div></div>

<p><a name="Step3-ScalingtheDataAccessLayer-ConnectingToSpace"></a></p>
<h1><a name="Step3-ScalingtheDataAccessLayer-ConnectingtotheSpace"></a>Connecting to the Space</h1>
<p>In order to access the space from your application's code you need to get a reference to a <em>Space Proxy</em>. Similar to a database connection, the space proxy enables you to perform various operations on the space, such as writing to and reading from it, registering for notifications, etc. <br/>
The space proxy can reference an <b>embedded space</b>, which means that the space instance is running within the same memory space (JVM) as your application, or a <b>remote space</b>, which means that the space is running in separate JVM(s) from your application's JVM. Regardless, the space proxy's API remains the same and is manifested in the <a href="http://www.gigaspaces.com/docs/JavaDocOS7.0/org/openspaces/core/GigaSpace.html">GigaSpace interface</a>. <br/>
The example application in this tutorial references a remote space, but the techniques presented below are also applicable when accessing an embedded space. The main difference between an embedded and a remote space proxy configuration is the <a href="Space URL.html" title="Space URL">Space URL</a>. <br/>
There are several ways to access the Space from within your web application. <br/>
The most obvious one is to explicitly create a space proxy inside the web application's code. This is the approach we use in the sample application:</p>
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">IJSpace space = <span class="code-keyword">new</span> UrlSpaceConfigurer(<span class="code-quote">"jini:<span class="code-comment">//*/*/mySpace"</span>).space(); 
</span>GigaSpace gigaSpace = <span class="code-keyword">new</span> GigaSpaceConfigurer(space).gigaSpace();</pre>
</div></div>
<p>This code connects to a remote space named <tt>mySpace</tt> using the jini discovery protocol. <br/>
Typically this code will be included inside the web application's initialization sequence in a <tt>ServletContextListener</tt> implementation, or inside a servlet's <tt>init()</tt> method, storing the GigaSpace reference inside the <tt>ServletContext</tt> or as an instance variable in the serlvet class. <br/>
Note that the space proxy is thread-safe, so you can freely share it across threads (in fact, you only need one proxy for the entire application). <br clear="all" />
Another way to initialize the Space, is to configure it inside the <tt>pu.xml</tt> file in your .war file (located either at the root or under <tt>META-INF/spring</tt> in your .war file). This file is used to configure various GigaSpaces-specific elements, most notably the Space proxy. <br/>
To initialize a Space proxy you should include the following XML elements in your file: </p>
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-xml">&lt;!--
    A bean representing a space (an IJSpace implementation).
    Note, we perform a lookup on the space since we are working against a remote space.
--&gt;
<span class="code-tag">&lt;os-core:space id=<span class="code-quote">"space"</span> url=<span class="code-quote">"jini://*/*/mySpace"</span> lookup-timeout=<span class="code-quote">"20000"</span>/&gt;</span>
&lt;!--
    OpenSpaces simplified space API built on top of IJSpace/JavaSpace.
--&gt;
<span class="code-tag">&lt;os-core:giga-space id=<span class="code-quote">"gigaSpace"</span> space=<span class="code-quote">"space"</span>/&gt;</span></pre>
</div></div>
<p>The above snippet creates a space proxy connecting to a remote space named <tt>mySpace</tt> using the jini discovery protocol, exactly like the previous code example. The created proxy will be stored as a <tt>ServletContext</tt> attribute, and the attribute name will be the id of the gigaSpace element, in our case <tt>gigaSpace</tt> (in fact, this is a standard Spring configuration file, and any element defined in it will be bound to the <tt>ServletContext</tt> automatically).<br/>
To obtain the space proxy reference, all your application needs to do is retrieve it from the <tt>ServletContext</tt>. Here's the relevant snippet that should be included in the servlet's <tt>doPost()</tt> or <tt>doGet()</tt> methods: </p>
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">GigaSpace gigaSpace = (GigaSpace) getServletContext().getAttribute(<span class="code-quote">"gigaSpace"</span>);</pre>
</div></div>
<div class='panelMacro'><table class='infoMacro'><colgroup><col width='24'><col></colgroup><tr><td valign='top'><img src="images/icons/emoticons/information.gif" width="16" height="16" align="absmiddle" alt="" border="0"></td><td><b>Spring-Based Web Applications</b><br /><br/>
If you're application is Spring based and uses the Spring MVC framework, you can avoid any coding to get the space reference and use dependency injection to wire the space proxy into your application components.</td></tr></table></div>

<p><a name="Step3-ScalingtheDataAccessLayer-InteractingWithSpace"></a></p>
<h1><a name="Step3-ScalingtheDataAccessLayer-InteractingwiththeSpace"></a>Interacting with the Space</h1>
<p>The Space API is very straightforward. In general, it has the following operations: </p>
<ul>
	<li><tt>read</tt> - Enables you to read objects from the space. You can use the <tt>readMultiple</tt> methods if you're expecting more than one result. Read criteria is specified via a template (which is an example object whose non-null fields will be matched against existing objects in the space), or via a <a href="SQLQuery.html" title="SQLQuery">query</a> with a SQL syntax.</li>
	<li><tt>write</tt> - Enables you to write objects to the space. In general you can write any instance to the remote space so long that each of its non-transient fields can be serialized over the wire (i.e. implement <tt>Serializable</tt> or <tt>Externalizable</tt>). You can determine various characteristics of the objects written to the space, such as indexing, partitioning, etc. by <a href="POJO Support.html" title="POJO Support">annotating the object's class or by using XML</a>. The <tt>write</tt> operation also allows you to batch the writing of multiple objects to the space for optimized performance via the <tt>writeMultiple</tt> methods.</li>
	<li><tt>take</tt> - Enables you to remove objects from the space (similar to the <tt>Map#remove</tt> method). As with the read operation, the criteria are specified via a template or a query.</li>
	<li><tt>notify</tt> - Enables you to register for notifications on changes made to the space (objects written, taken or updated). Upon registration, you can specify a filter using a template or a query.</li>
	<li><tt>execute</tt> - Enables you to send tasks for execution on the data grid, utilizing the collocation with the data. Tasks can be sent to one, a few, or all members of the data grid. Results received from the task can then be reduced and returned back to the calling code (this pattern is known as Map/Reduce).<br/>
The following snippet from the <tt>AccessSpaceServlet</tt> demonstrates a write operation, followed by a readMultiple operation using a template of type <tt>UserData</tt>. This means that all instances of the <tt>UserData</tt> class currently stored in the space will be returned: 
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java"><span class="code-keyword">if</span> (isStringNotEmpty(dataName) &amp;&amp; isStringNotEmpty(dataValue)) {            
    gigaSpace.write(<span class="code-keyword">new</span> UserData(dataName, dataValue, userId), Lease.FOREVER, 30000, 
                    UpdateModifiers.UPDATE_OR_WRITE);
}            
UserData[] spaceEntries = gigaSpace.readMultiple(<span class="code-keyword">new</span> UserData(), <span class="code-object">Integer</span>.MAX_VALUE);</pre>
</div></div>        </li>
</ul>


<p><a name="Step3-ScalingtheDataAccessLayer-Considerations"></a> </p>
<h1><a name="Step3-ScalingtheDataAccessLayer-ConsiderationsSpaceorHTTPSession%3F"></a>Considerations - Space or HTTP Session?</h1>
<table class="sectionMacro" border="0" cellpadding="5" cellspacing="0" width="100%"><tbody><tr>
<p>In the <a href="Step 2 - Enabling HTTP Session Failover and Fault Tolerance.html" title="Step 2 - Enabling HTTP Session Failover and Fault Tolerance">previous step</a> we demonstrated how to back your HTTP session with the space. So in effect, the application actually wrote object to space without using the space API explicitly. So you're probably wondering when you should use each of the approaches. <br/>
Generally speaking the HTTP session API is completely portable and is designed to store session-specific information in a flat structure (key-value). The benefits here are quite obvious: </p>
<ul>
	<li>You don't use any GigaSpaces-specific API, and therefore your application is 100% portable</li>
	<li>You don't need to learn a new API, you can use the plain old <tt>HttpSession</tt></li>
	<li>Session life cycle is managed for you automatically, so when a session expires you don't have to explicitly clean up the session data stored in the session.</li>
</ul>
</tr></tbody></table>
<table class="sectionMacro" border="0" cellpadding="5" cellspacing="0" width="100%"><tbody><tr>
<p>The space, on the other hand, is a full-fledged data grid with sophisticated querying capabilities and other unique features. It is primarily good for storing data that:</p>
<ul>
	<li>Needs to be queried in a more sophisticated manner</li>
	<li>Will outlive the user's session</li>
	<li>Is global and relevant for the entire application.</li>
</ul>
</tr></tbody></table>
<table class="sectionMacro" border="0" cellpadding="5" cellspacing="0" width="100%"><tbody><tr></tr></tbody></table>
<p>By using the space, you gain the following benefits:</p>
<ul>
	<li>You have a much richer API at your disposal. You can write filter data based on sophisticated criteria, much the same way you would with a database. You can also use the <tt>take</tt>, <tt>notify</tt> and <tt>execute</tt> operations to take full advantage of the Space's capabilities</li>
	<li>You have a more fine-grained control over what gets propagated to the Space and when (with <tt>HttpSession</tt> this is all done behind the scenes for you)</li>
	<li>You can store information that outlives the user session</li>
	<li>You can share information between all user sessions</li>
</ul>


<div class='panelMacro'><table class='infoMacro'><colgroup><col width='24'><col></colgroup><tr><td valign='top'><img src="images/icons/emoticons/information.gif" width="16" height="16" align="absmiddle" alt="" border="0"></td><td><b>Mixing Space and HTTP Session Approaches</b><br /><br/>
Note that incase needed, you can use both approaches in the same application, and decide on a case by case basis.</td></tr></table></div>

<p><a name="Step3-ScalingtheDataAccessLayer-PlainClient"></a></p>
<h1><a name="Step3-ScalingtheDataAccessLayer-AccessingtheSpacefromaStandaloneWebContainer"></a>Accessing the Space from a Standalone Web Container</h1>
<p>In some cases, you may want to access the space from an external web application, or another external client, which is not running on the GigaSpaces containers (Note that this means that application/standalone client is not managed by GigaSpaces and cannot benefit from the convenient deployment and self-healing capabilities of this environment). In such case, you need to make sure to include all the <tt>jar</tt> files under the <tt>&lt;GigaSpaces Root&gt;/lib/required</tt> directory in your classpath (typically by placing them in the <tt>WEB-INF/lib</tt> directory):</p>

<ul>
	<li><tt>gs-runtime.jar</tt></li>
	<li><tt>gs-openspaces.jar</tt></li>
	<li><tt>commons-logging.jar</tt></li>
	<li>Spring framework jars (all start with <tt>com.spring*</tt>)</li>
</ul>


<p><a name="Step3-ScalingtheDataAccessLayer-AllTogehter"></a></p>
<h1><a name="Step3-ScalingtheDataAccessLayer-PuttingItAllTogether"></a>Putting It All Together </h1>
<p>Now that we've gone over all the details, let's see everything in action. In this section we will start a partitioned space with 2 primaries and 2 backups. We will deploy 3 web application instances to the GigaSpaces environment. We will then start Apache HTTP server and the Apache load balancer agent (see <a href="Step 1 - Deploying Your Web Application to the GigaSpaces Environment.html" title="Step 1 - Deploying Your Web Application to the GigaSpaces Environment">Step 1</a> of this tutorial for more details), and connect to the application from the load balancer. We will write some objects into the space and verify that they are indeed there. Finally, we will terminate one of the running containers (the one which handled our requests) and watch the failover and self-healing process in action, verifying that information stored in the space was not lost. Let's start: </p>
<ol>
	<li>Build the application <a href="#Step3-ScalingtheDataAccessLayer-BuildDirections">as described earlier in this tutorial</a></li>
	<li>Start one GSM by calling <tt>&lt;gs root&gt;/bin/gsm.(sh/bat)</tt></li>
	<li>Start four GSCs by calling <tt>&lt;gs root&gt;/bin/gsc.(sh/bat)</tt> four times</li>
	<li>Start the GigaSpaces user interface by calling <tt>&lt;gs root&gt;/bin/gs-ui.(sh/bat)</tt>. When the user interface is started, you should see the three GSCs presented in it.<br/>
<span id='tgl_content_empty-gsui' class='cloakToggle'></span> <b>Click to view screenshot...</b>


<p><img src="download/attachments/53903786/empty-gsui4.jpg" align="absmiddle" border="0"/></p>

</li>
	<li>Deploy the application using the provided build script, by calling <tt>build.(sh.bat) deploy</tt>. This will start a partitioned Space with 2 primaries and 2 backups, and then three instances of the web application which will connect to the Space. Once deployment is successful, you should see in the UI the Space's two primary and two backup partitions, and 3 instances of the web application.<br/>
<span id='tgl_content_after-deploy' class='cloakToggle'></span> <b>Click to view screenshot...</b>


<p><img src="download/attachments/53903786/after-deploy3.jpg" align="absmiddle" border="0"/></p>

</li>
	<li>If you haven't already done so, start the Apache HTTP server on port 80 (the default).</li>
	<li>Start the load balancer agent by calling the script <tt>&lt;gs root&gt;/tools/apache/apache-lb-agent.(sh/bat) -apache &lt;Apache home&gt;</tt>. <tt>Apache home</tt> is the location of the Apache installation on your disk.<br/>
<span id='tgl_content_lbagent-output' class='cloakToggle'></span> <b>Click to show expected output...</b>


<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">Starting apache-lb-agent with line:
<span class="code-quote">"c:\Java\jdk1.6.0_11\bin\java"</span>  -server -XX:+AggressiveOpts -showversion -Xmx512m -Xbootclasspath/p:.;
<span class="code-quote">"c:\GS-Releases\gigaspaces-xap-premium-7.0.0-ga\bin\\..\lib\platform\xml\serializer.jar"</span>;
<span class="code-quote">"c:\GS-Releases\gigaspaces-xap-premium-7.0.0-ga\bin\\..\lib\platform\xml\xalan.jar"</span>;
<span class="code-quote">"c:\GS-Releases\gigaspaces-xap-premium-7.0.0-ga\bin\\..\lib\platform\xml\xercesImpl.jar"</span>;
<span class="code-quote">"c:\GS-Releases\gigaspaces-xap-premium-7.0.0-ga\bin\\..\lib\platform\xml\xml-apis.jar"</span> 
-Dlb.vmDir=<span class="code-quote">"c:\GS-Releases\gigaspaces-xap-premium-7.0.0-ga\bin\\../tools/apache"</span> -Dcom.gs.jini_lus.locators= 
-Dcom.gs.jini_lus.groups=myGroup -Dsun.rmi.dgc.client.gcInterval=36000000 -Dsun.rmi.dgc.server.gcInterval=36000000 
-Djava.rmi.server.hostname=<span class="code-quote">""HOST01"</span>" -Djava.rmi.server.RMIClassLoaderSpi=<span class="code-keyword">default</span> -Djava.rmi.server.logCalls=<span class="code-keyword">false</span> 
<span class="code-quote">"-Dcom.gs.home=c:\GS-Releases\gigaspaces-xap-premium-7.0.0-ga\bin\\.."</span> 
-Djava.security.policy=<span class="code-quote">"c:\GS-Releases\gigaspaces-xap-premium-7.0.0-ga\bin\\..\policy\policy.all"</span> -classpath 
;.;<span class="code-quote">"c:\GS-Releases\gigaspaces-xap-premium-7.0.0-ga\bin\\.."</span>;.;
<span class="code-quote">"c:\GS-Releases\gigaspaces-xap-premium-7.0.0-ga\bin\\..\lib\required\commons-logging.jar"</span>;
<span class="code-quote">"c:\GS-Releases\gigaspaces-xap-premium-7.0.0-ga\bin\\..\lib\required\gs-openspaces.jar"</span>;
<span class="code-quote">"c:\GS-Releases\gigaspaces-xap-premium-7.0.0-ga\bin\\..\lib\required\gs-runtime.jar"</span>;
<span class="code-quote">"c:\GS-Releases\gigaspaces-xap-premium-7.0.0-ga\bin\\..\lib\required\spring.jar"</span>;.;.;
<span class="code-quote">"c:\GS-Releases\gigaspaces-xap-premium-7.0.0-ga\bin\\..\lib\optional\spring\cglib-nodep-2.1_3.jar"</span>;
<span class="code-quote">"c:\GS-Releases\gigaspaces-xap-premium-7.0.0-ga\bin\\..\lib\optional\spring\common-annotations.jar"</span>;.;
<span class="code-quote">"c:\GS-Releases\gigaspaces-xap-premium-7.0.0-ga\bin\\..\lib\platform\jdbc\h2.jar"</span>;
<span class="code-quote">"c:\GS-Releases\gigaspaces-xap-premium-7.0.0-ga\bin\\..\lib\platform\jdbc\hsqldb.jar"</span>;.;
<span class="code-quote">"c:\GS-Releases\gigaspaces-xap-premium-7.0.0-ga\bin\\..\lib\platform\velocity\velocity-dep-1.5.jar"</span>; 
org.openspaces.pu.container.jee.lb.apache.ApacheLoadBalancerAgent -apache c:\Apache2.2

java version <span class="code-quote">"1.6.0_11"</span>
Java(TM) SE <span class="code-object">Runtime</span> Environment (build 1.6.0_11-b03)
Java HotSpot(TM) Server VM (build 11.0-b16, mixed mode)

Log file: c:\GS-Releases\gigaspaces-xap-premium-7.0.0-ga\bin\..\logs\2009-06-10~18.28-gigaspaces-service-host01-2860.log
Starting Apache Load Balancer Agent...

groups [myGroup], locators [<span class="code-keyword">null</span>]
apachectl Location [c:\Apache2.2/bin/httpd.exe]
config directory [c:\Apache2.2/conf/gigaspaces]
update config interval [10000ms]

Detecting existing config files...
Done detecting existing config files

LUS Discovered [com.sun.jini.reggie.RegistrarProxy[registrar=fa303c3a-efab-419c-9d33-9fba6013ce3d 
DynamicSmartStub [ImplObjClass: com.sun.jini.reggie.GigaRegistrar, ConnectionURL: 
NIO:<span class="code-comment">//HOST01:2083/pid[6796]/33919865548192_1_-2399564307679509764, MaxConnPool: 1024 ]]]
</span>
Started Apache Load Balancer Agent successfully
Make sure Apache is configured with [Include c:\Apache2.2\conf\gigaspaces/*.conf]

[SpaceAccess]: Adding [dfba8f76-b7b8-4bd6-8405-65fc0f715d52] [192.168.10.67:8081/SpaceAccess]
[SpaceAccess]: Adding [8277ac76-ece7-4df0-8813-f5b9dc7c0d74] [192.168.10.67:8082/SpaceAccess]
[SpaceAccess]: Adding [fc3e580a-df90-4a1f-942b-676453603b6d] [192.168.10.67:8080/SpaceAccess]
[SpaceAccess]: Detected as dirty, updating config file...
[SpaceAccess]: Using balancer template [c:\GS-Releases\gigaspaces-xap-premium-7.0.0-ga\bin\..\tools\apache\balancer-template.vm]
Jun 10, 2009 6:28:48 PM org.apache.velocity.runtime.log.JdkLogChute log
INFO: FileResourceLoader : adding path '.'
[SpaceAccess]: Updated config file
Executing [<span class="code-quote">"c:\Apache2.2/bin/httpd.exe"</span> -k restart]...
Executed [<span class="code-quote">"c:\Apache2.2/bin/httpd.exe"</span> -k restart], exit code [0]</pre>
</div></div>

</li>
	<li>Now let's verify that the application works as expected. Assuming Apache runs on your local machine on port 80, open you web browser and point it to <tt><a href="http://localhost/SpaceAccess/">http://localhost/SpaceAccess/</a></tt>. You should see the application's welcome page. Another way to verify this is point your web browser to <tt><a href="http://localhost/balancer">http://localhost/balancer</a></tt>. You should see the summary screen of Apache's load balancing module. In this screen you should see listed the two running web containers.<br/>
<span id='tgl_content_lb-welcome' class='cloakToggle'></span> <b>Click to view screenshots...</b>


<p><img src="download/attachments/53903786/space-screenshot.jpg" align="absmiddle" border="0" hspace="20"/> <img src="download/attachments/53903786/lb-summary3.jpg" align="absmiddle" border="0"/></p>

</li>
	<li>Type in values once or twice by filling the "Field" and "Value" text boxes and clicking submit. You should see them now above the text boxes, which means they were inserted to the space. You can also see that they are stored in the space using the GUI. Click the "Space Browser" tab on the left, and then expand and click the following node on the "Grid Tree" pane on the right: Clusters --&gt; mySpace --&gt; Operations --&gt; Classes. You will notice that the number of instances of type <tt>UserData</tt> is more than 0.<br/>
<span id='tgl_content_space-browser' class='cloakToggle'></span> <b>Click to view screenshots...</b>


<p><img src="download/attachments/53903786/space-browser.jpg" align="absmiddle" border="0"/></p>

</li>
</ol>


<h2><a name="Step3-ScalingtheDataAccessLayer-DemonstratingFailover%26SelfHealing"></a>Demonstrating Failover &amp; Self Healing </h2>
<p>Now let's deliberately terminate one of the GSCs on which the application is deployed: </p>
<ol>
	<li>Locate one of the GSCs on which a request was received. To do that, check the console of the running GSCs and find the one that has shows the following output once or more at the bottom:
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">********** Got Request **********</pre>
</div></div></li>
	<li>Next, <b>terminate the process of the GSC you located</b>. Quickly switch to the GigaSpaces user interface - you will see that this GSC has disappeared. You will also see that the application and space instances which ran on the terminated GSC are re-instantiated on one of the existing GSCs. So in effect, <b>the application self-healed itself</b> so that all components are still running!</li>
	<li>The load balancer agent will pick up the change in runtime state, and will update the apache load balancer (this may take a few seconds). You can now refresh the page in your web browser and see the space content you entered before still appears on the screen, and <b>everything still works as before.</b></li>
</ol>


<h1><a name="Step3-ScalingtheDataAccessLayer-What%27sNext%3F"></a>What's Next?</h1>
<p><img src="download/attachments/17301573/Jump arrow green.bmp" align="absmiddle" border="0"/> You have completed the web application scaling tutorial. <br/>
Click here to view <a href="Quick Start Guide.html" title="Quick Start Guide">other tutorials</a> or go directly to the <a href="Programmer's Guide.html" title="Programmer's Guide">GigaSpaces XAP programmer's guide</a>. </p>


                     </td>
</tr>
</table>
<table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr>
<td height="12" background="http://www.gigaspaces.com/wiki/images/border/border_bottom.gif"><img src="images/border/spacer.gif" width="1" height="1" border="0"/></td>
</tr>
<tr>
<td align="center"><font color="grey"><a href="http://www.gigaspaces.com">GigaSpaces.com</a> -
		<a href="http://www.gigaspaces.com/wiki/x/xwBmAg" class="smalltext">Legal Notice</a> -
		<a href="http://www.gigaspaces.com/wiki/x/xgBmAg" class="smalltext">3rd Party Licenses</a> -
		<a href="http://www.gigaspaces.com/wiki/x/BQFmAg" class="smalltext">Site Map</a> -
		<a href="http://www.gigaspaces.com/wiki/display/API/API+Documentation+Portal" class="version-link">API Docs</a> -
		<a href="http://forum.openspaces.org/forum.jspa?forumID=175" class="version-link">Forum</a> -
		<a href="http://www.gigaspaces.com/LatestProductVersion" class="version-link">Downloads</a> -
		<a href="http://blog.gigaspaces.com/" class="version-link">Blog</a> -
		<a href="http://www.gigaspaces.com/os_papers.html" class="version-link">White Papers</a> -
		<a href="mailto:techw@gigaspaces.com">Contact Tech Writing</a> -
		<i><a href="http://www.atlassian.com/software/confluence">Gen. by Atlassian Confluence</a></i></font></td>
</tr>
</table>
     </body>
</html>
