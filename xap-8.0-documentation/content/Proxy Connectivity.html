<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
     <head>
         <title>XAP 8.0 Documentation : Proxy Connectivity</title>
<link rel="stylesheet" href="styles/site.css" type="text/css" />
         <META http-equiv="Content-Type" content="text/html; charset=UTF-8">
		 <style>
.back-to {
	color: #666666;
	font-weight: bold;
}	 
a.back-to:link, a.back-to:visited, a.back-to:hover, a.back-to:active  {
	color: #666666;
}	 
		 </style>
     </head>

     <body>
<table class="pagecontent" border="0" cellpadding="0" cellspacing="0" width="100%" bgcolor="#ffffff">
<tr>
<td valign="top" class="pagebody">
<div class="pageheader">
<span class="back-to">XAP 8.0 Documentation > <a href="index.html">Back to Table of Contents</a></span><br>
<h1>Proxy Connectivity</h1>
</div>
<br>



<div style="border-style:solid; border-color:#3C78B5; border-width:thin; padding-left:20px; padding-bottom:20px; padding-top:20px; padding-right:20px; background-color:#D8E4F1"> 

<p><b>Section Summary:</b>  Client Proxy Connectivity and reconnection options </p>
</div>
<h1><a name="ProxyConnectivity-Overview"></a>Overview</h1>
<p>Each space operation on a cluster is routed to a single member or multiple cluster members. The routing done based on the operation type and <a href="Data-Partitioning.html" title="Data-Partitioning">data partitioning</a> policy. To make this routing possible and efficient, the client proxy holds a set of <a href="http://download.oracle.com/javase/1.5.0/docs/guide/rmi/spec/rmi-stubs22.html">remote stubs</a> to the relevant cluster members. The proxy connectivity policy determines which remote proxy members should be constructed at client startup, and how to monitor them to control the failover response time and reconnection behavior. The client proxy monitors the cluster members in two ways: checking existing stubs and locating members that does not have stubs created for yet.</p>

<h1><a name="ProxyConnectivity-ClientProxyConnectivityConfiguration"></a>Client Proxy Connectivity Configuration</h1>
<p>The proxy Connectivity settings should be specified as part of the <b>space configuration</b> (server side). You may specify these as part of the <a href="The Space Component.html#TheSpaceComponent-Reconnection">Space Component</a> or via API.  The settings are loaded into the client side once it connects to the space. Client proxy connectivity settings controlled via the following settings:</p>
<table class='confluenceTable'><tbody>
<tr>
<th class='confluenceTh'>Property</th>
<th class='confluenceTh'>Description</th>
<th class='confluenceTh'>Default</th>
<th class='confluenceTh'>Unit</th>
</tr>
<tr>
<td class='confluenceTd'>space-config.proxy-settings.connection-monitor</td>
<td class='confluenceTd'>Determine the proxy monitoring policy for space cluster members .Options:<br clear="all" />all - Full monitoring. The client proxy establishes a connection with all cluster members immediately at startup, and all the cluster members are monitored as long as the client proxy is alive. This policy should be used when failover time is important, and needs to be minimal.<br clear="all" />on_demand - Monitoring on demand. All the connections to remote spaces are established on demand only, and once the connection is established, the connected space and its backups are monitored by the clustered proxy. This policy should be used when only part of the cluster is used, for example a scenario when all client operations go to the same partition.<br clear="all" />none - No monitoring. All the connections to remote spaces are established on demand only, and no monitoring is done. This policy eliminates the monitoring overhead completely - no unnecessary lookups or pings, but it can also increase the failover time.</td>
<td class='confluenceTd'>all</td>
<td class='confluenceTd'>&nbsp;</td>
</tr>
<tr>
<td class='confluenceTd'>space-config.proxy-settings.ping-frequency</td>
<td class='confluenceTd'>Specify the ping frequency for cluster members that were already found by the proxy. Replacing the previous <tt>liveness-monitor-frequency</tt> system property used with old versions.</td>
<td class='confluenceTd'>10000 </td>
<td class='confluenceTd'>ms</td>
</tr>
<tr>
<td class='confluenceTd'>space-config.proxy-settings.lookup-frequency</td>
<td class='confluenceTd'>Specify the lookup frequency for cluster members that were never looked up by the proxy, or never joined the cluster. Replacing the previous <tt>liveness-detector-frequency</tt> system property used with old versions.</td>
<td class='confluenceTd'>5000 </td>
<td class='confluenceTd'>ms</td>
</tr>
<tr>
<td class='confluenceTd'>space-config.proxy-settings.connection-retries</td>
<td class='confluenceTd'>Specify the retry count for establishing a connection with unavailable cluster member before failing the operation. </td>
<td class='confluenceTd'>10 for PUs, and 20 for Elastic PUs</td>
<td class='confluenceTd'>&nbsp;</td>
</tr>
<tr>
<td class='confluenceTd'>cluster-config.groups.group.fail-over-policy.fail-over-find-timeout</td>
<td class='confluenceTd'>Specify the wait time between each retry. </td>
<td class='confluenceTd'>2000</td>
<td class='confluenceTd'>ms</td>
</tr>
</tbody></table>

<p>An optimization was applied to the monitoring algorithm, to not check the available spaces if they are constantly in use, i.e. constantly handling user operations.</p>

<h1><a name="ProxyConnectivity-ClientProxyReconnection"></a>Client Proxy Reconnection</h1>
<p>To allow a space client performing the different space operation (read,write,take,execute) to reconnect to a space cluster that has been <b>completely shutdown</b> and restarted, make sure you increase the <tt>space-config.proxy-settings.connection-retries</tt> parameter to have a higher value than the default. A value of <tt>100</tt> will provide you several minutes to restart the space cluster before the client will fail with <tt>com.j_spaces.core.client.FinderException</tt>. </p>

<h2><a name="ProxyConnectivity-ReconnectionwithNotifyRegistration"></a>Reconnection with Notify Registration</h2>
<p>To allow a client using notifications (using the <a href="Session Based Messaging API.html" title="Session Based Messaging API">Session Based Messaging API</a> or the <a href="Notify Container.html" title="Notify Container">Notify Container</a>) to reconnect and also re-register for notifications, use the <tt>LeaseListener</tt>. See the <a href="Notify Container.html#NotifyContainer-ReRegisteraftercompletespaceshutdownandrestart">Re-Register after complete space shutdown and restart</a> section for details.</p>

<div class='panelMacro'><table class='tipMacro'><colgroup><col width='24'><col></colgroup><tr><td valign='top'><img src="images/icons/emoticons/check.gif" width="16" height="16" align="absmiddle" alt="" border="0"></td><td>See the <a href="Notify Container.html#NotifyContainer-ResendingNotificationsafteraSpaceClientDisconnection">Resending Notifications after a Space-Client Disconnection</a> section for space-client disconnection behavior.</td></tr></table></div>

<h2><a name="ProxyConnectivity-ReconnectionwithBlockedOperations"></a>Reconnection with Blocked Operations</h2>
<p>When using blocked operations such as read operation with a timeout&gt;0, take operation timeout&gt;0 or <a href="Polling Container.html" title="Polling Container">Polling Container</a>, GigaSpaces can't guaranty the read/take timeout will match the specified timeout once a client reconnects to a space that was shutdown and restarted (or failed and client routed to the backup instance). </p>

<p>Once the client reconnects, the entire read operation is reinitiated, ignoring the amount of time the client already spent waiting for a matching object before the client was disconnected. </p>

<h2><a name="ProxyConnectivity-ReconnectionwithLocalCache%2FView"></a>Reconnection with Local Cache/View</h2>
<p>A client using a <a href="Local View and Local Cache.html" title="Local View and Local Cache">local view or a local cache</a> will try to reconnect once the space is terminated/un-deployed.<br/>
The client will have <tt>space-config.proxy-settings.connection-retries</tt> attempts to reconnect and later will have another <tt>space-config.dist-cache.retry-connections</tt> attempts to reconnect with 5 seconds (configurable) delay in between each attempt.</p>

<p><img class="emoticon" src="images/icons/emoticons/forbidden.gif" height="16" width="16" align="absmiddle" alt="" border="0"/> Please note that a local view/cache that is working against a secured space will lose its credentials after the space-config.proxy-settings.connection-retries are exhausted.</p>

<p>In case the client will fail to reconnect, <tt>com.j_spaces.core.client.CacheException</tt> wrapped with <tt>org.openspaces.core.UncategorizedSpaceException:</tt> will be thrown. During this retry duration time, the client will be able to read data from its local cache/view. </p>

<p>Local cache/view that exhausts their <tt>space-config.dist-cache.retry-connections</tt> retry count are unusable and cannot be re-initialized. You should have a high value for the <tt>space-config.dist-cache.retry-connections</tt> to allow the client to continue and look for its master space in case of a long disconnection time:</p>
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">GigaSpace gigaview = <span class="code-keyword">new</span> GigaSpaceConfigurer(<span class="code-keyword">new</span> LocalViewSpaceConfigurer(gigaspace.getSpace()).
	addView(<span class="code-keyword">new</span> View&lt;MySpaceClass&gt;(MySpaceClass.class , "")).
	addProperty(<span class="code-quote">"space-config.dist-cache.retry-connections"</span>, <span class="code-quote">"100"</span>).
	localView()).gigaSpace();</pre>
</div></div>

<p>See the <a href="Local View and Local Cache.html#LocalViewandLocalCache-LocalCache%2FLocalViewDisconnection">Local View and Local Cache</a> for additional details.</p>

<p>See below example setting the <tt>space-config.proxy-settings.connection-retries</tt> parameter with a pu.xml encapsulating an embedded space:</p>
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">&lt;os-core:space id=<span class="code-quote">"space"</span> url=<span class="code-quote">"/./space"</span>&gt;
    &lt;os-core:properties&gt;
        &lt;props&gt;
            &lt;prop key=<span class="code-quote">"space-config.proxy-settings.connection-retries"</span>&gt;100&lt;/prop&gt;
        &lt;/props&gt;
    &lt;/os-core:properties&gt;
&lt;/os-core:space&gt;</pre>
</div></div>

<p>See below example how you should set the <tt>space-config.proxy-settings.connection-retries</tt> property when deploying a Data-Grid:</p>
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">&gt;gs deploy-space -cluster schema=partitioned-sync2backup total_members=20,1 -properties
 <span class="code-quote">"embed:<span class="code-comment">//space-config.proxy-settings.connection-retries=100"</span> myIMDG</span></pre>
</div></div>

<h1><a name="ProxyConnectivity-UnicastLookupServiceDiscovery"></a>Unicast Lookup Service Discovery</h1>
<p>If you are using <a href="How to Configure Unicast Discovery.html" title="How to Configure Unicast Discovery">Unicast lookup service discovery</a> you should set the <tt>com.gigaspaces.unicast.interval</tt> system property to allow the client to keep searching for the lookup service in case it was terminated and later restarted while the client was running. See the <a href="How to Configure Unicast Discovery.html#HowtoConfigureUnicastDiscovery-Configuringlookupdiscoveryintervals">How to Configure Unicast Discovery</a> for details.</p>

                     </td>
</tr>
</table>
<table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr>
<td height="12" background="http://www.gigaspaces.com/wiki/images/border/border_bottom.gif"><img src="images/border/spacer.gif" width="1" height="1" border="0"/></td>
</tr>
<tr>
<td align="center"><font color="grey"><a href="http://www.gigaspaces.com">GigaSpaces.com</a> -
		<a href="http://www.gigaspaces.com/wiki/x/xwBmAg" class="smalltext">Legal Notice</a> -
		<a href="http://www.gigaspaces.com/wiki/x/xgBmAg" class="smalltext">3rd Party Licenses</a> -
		<a href="http://www.gigaspaces.com/wiki/x/BQFmAg" class="smalltext">Site Map</a> -
		<a href="http://www.gigaspaces.com/wiki/display/API/API+Documentation+Portal" class="version-link">API Docs</a> -
		<a href="http://forum.openspaces.org/forum.jspa?forumID=175" class="version-link">Forum</a> -
		<a href="http://www.gigaspaces.com/LatestProductVersion" class="version-link">Downloads</a> -
		<a href="http://blog.gigaspaces.com/" class="version-link">Blog</a> -
		<a href="http://www.gigaspaces.com/os_papers.html" class="version-link">White Papers</a> -
		<a href="mailto:techw@gigaspaces.com">Contact Tech Writing</a> -
		<i><a href="http://www.atlassian.com/software/confluence">Gen. by Atlassian Confluence</a></i></font></td>
</tr>
</table>
     </body>
</html>
