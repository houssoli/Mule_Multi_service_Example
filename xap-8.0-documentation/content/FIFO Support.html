<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
     <head>
         <title>XAP 8.0 Documentation : FIFO Support</title>
<link rel="stylesheet" href="styles/site.css" type="text/css" />
         <META http-equiv="Content-Type" content="text/html; charset=UTF-8">
		 <style>
.back-to {
	color: #666666;
	font-weight: bold;
}	 
a.back-to:link, a.back-to:visited, a.back-to:hover, a.back-to:active  {
	color: #666666;
}	 
		 </style>
     </head>

     <body>
<table class="pagecontent" border="0" cellpadding="0" cellspacing="0" width="100%" bgcolor="#ffffff">
<tr>
<td valign="top" class="pagebody">
<div class="pageheader">
<span class="back-to">XAP 8.0 Documentation > <a href="index.html">Back to Table of Contents</a></span><br>
<h1>FIFO Support</h1>
</div>
<br>



<div style="border-style:solid; border-color:#3C78B5; border-width:thin; padding-left:20px; padding-bottom:20px; padding-top:20px; padding-right:20px; background-color:#D8E4F1"> 

<p><b>Section Summary:</b>  How to get entries in the same order in which they were written to the space. </p>
</div>

<h1><a name="FIFOSupport-Overview"></a>Overview</h1>

<p>Supporting FIFO (First In, First Out) behavior for Entries is a critical requirement when building messaging systems or implementing master-worker patterns. Users should be able to get Entries in the same order in which they were written. GigaSpaces supports both non-ordered Entries and FIFO ordered Entries when performing space operations. </p>

<h1><a name="FIFOSupport-EnablingFIFO"></a>Enabling FIFO</h1>

<p>The default space behavior is non-FIFO. The reason is that FIFO support comes at a cost: the space needs to organize and maintain the entries internally in a more complex fashion to support FIFO queries, thus slowing down concurrent write operations. To enable FIFO operations users need to turn on FIFO support for classes which will participate in such operations. If a FIFO operation is performed on an entry whose class does not support FIFO, an <tt>InvalidFifoTemplateException</tt> will be thrown.</p>

<p>Setting FIFO support for a class can be done via the <tt>fifoSupport</tt> attribute on the <tt>@SpaceClass</tt> annotation:</p>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">@SpaceClass(fifoSupport=FifoSupport.OPERATION)
<span class="code-keyword">public</span> class Person
{
    ...
}</pre>
</div></div>

<p>or when using gs.xml via the <tt>fifo-support</tt> attribute on the <tt>class</tt> element:</p>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-xml"><span class="code-tag">&lt;gigaspaces-mapping&gt;</span>
    <span class="code-tag">&lt;class name=<span class="code-quote">"com.gigaspaces.examples.Person"</span> fifo-support=<span class="code-quote">"operation"</span>&gt;</span>
        ...
    <span class="code-tag">&lt;/class&gt;</span>
<span class="code-tag">&lt;/gigaspaces-mapping&gt;</span></pre>
</div></div>

<p>There are four <tt>FifoSupport</tt> modes:</p>

<ol>
	<li><tt>OFF</tt> - This class does not support FIFO. Attempting to execute FIFO operations will throw an exception.</li>
	<li><tt>OPERATION</tt> - FIFO support is enabled. An operation's FIFO behavior is determined by its modifiers or settings.</li>
	<li><tt>ALL</tt> - FIFO support is enabled. Any operation will be FIFO, overriding its other modifier or settings.</li>
	<li><tt>NOT_SET</tt> - FIFO support is determined by the deprecated <tt>fifo</tt> attribute. This setting is for backwards compatibility only.</li>
</ol>


<h1><a name="FIFOSupport-SpaceOperationswithFIFO"></a>Space Operations with FIFO</h1>

<h2><a name="FIFOSupport-QueryOperationswithFIFO"></a>Query Operations with FIFO</h2>
<p>To execute read/take operations with FIFO, use the <tt>ReadModifiers.FIFO</tt> modifier. For example:</p>
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">Person result = space.take(<span class="code-keyword">new</span> Person(), timeout, ReadModifiers.FIFO);</pre>
</div></div>
<p>If class <tt>Person</tt> is not set to support FIFO, an <tt>InvalidFifoTemplateException</tt> will be thrown.</p>

<h2><a name="FIFOSupport-ReadwithFIFO"></a>Read with FIFO</h2>
<p>Reading without FIFO looks for a matching entry in the space and returns the first one found (if any), but not necessarily the one that was written first. Reading with FIFO guarantees that if there is more than one matching entry, the one that was written first will be returned (the write time is determined based on a timestamp that ensures that a client receives Entries in FIFO order). Executing read with FIFO again with the same template will return the same result, assuming the entry hasn't been changed or deleted.</p>

<h2><a name="FIFOSupport-TakewithFIFO"></a>Take with FIFO</h2>
<p>Similar to read, executing take with FIFO guarantees that if there is more than one matching entry, the one that was written first will be taken. Executing take with FIFO again with the same template will return the next matching entry by order, and so on. </p>

<p>A take operation using FIFO might be critical when building a Point-to-Point (P2P) messaging system which needs to have message senders and receivers, where the receivers must get the sent messages in the exact order these have been sent by the senders.</p>

<h2><a name="FIFOSupport-BatchoperationswithFIFO"></a>Batch operations with FIFO</h2>
<p>When using the <tt>readMultiple</tt> or <tt>takeMultiple</tt> with FIFO, the returned array will be ordered according to the time the entries were written to the space.</p>

<h2><a name="FIFOSupport-TransactionsandFIFO"></a>Transactions and FIFO</h2>
<p>FIFO Space operations can be performed using transactions. When transaction is rolled back, data is written back to the top of the FIFO queue and will be made available for next operation.</p>

<p>For e.g., if a transactional polling container consumes data and throws an exception which results into a rollback of transaction, same data will be processed by the polling container in the next attempt.</p>

<h1><a name="FIFOSupport-EventswithFIFO"></a>Events with FIFO</h1>
<p>When registering for events, use <tt>EventSessionConfig.setFifo(true)</tt> to instruct the space that events should be sent to the client in FIFO order. For example:</p>
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java"><span class="code-comment">// Create an event session configuration with FIFO:
</span>EventSessionConfig sessionConfig = <span class="code-keyword">new</span> EventSessionConfig();
sessionConfig.setFifo(<span class="code-keyword">true</span>);
<span class="code-comment">// Create a data event session using the configuration:
</span>EventSessionFactory sessionFactory = EventSessionFactory.getFactory(space.getSpace());
DataEventSession session = sessionFactory.newDataEventSession(sessionConfig, <span class="code-keyword">null</span>);
<span class="code-comment">// Subscribe to an event:
</span>session.addListener(<span class="code-keyword">new</span> Person(), listener);</pre>
</div></div>
<p><img class="emoticon" src="images/icons/emoticons/information.gif" height="16" width="16" align="absmiddle" alt="" border="0"/> When using FIFO the client will use a single thread to invoke the listener callback method, so the events are both received and processed in FIFO order (i.e. if the client receives an event but the callback method haven't finished processing the previous event, the new event will be blocked until the previous one finishes). This is contrary to non-FIFO events, which are forwarded to the callback method as soon as they arrive, and thus might invoke the callback methods in parallel via multiple threads.</p>

<h1><a name="FIFOSupport-PersistentSpaceinFIFOMode"></a>Persistent Space in FIFO Mode</h1>
<p>When a space includes FIFO-enabled classes and is defined as persistent, the persistent store (RDBMS) includes the relevant information that ensures FIFO. This might impact the performance, since an additional index is created for each table storing the Entry Class instances.</p>

<h1><a name="FIFOSupport-Limitations"></a>Limitations</h1>

<p>FIFO ordering is maintained per class per space. Therefore the following limitations should be observed:</p>
<ul>
	<li>Order across class inheritance is not supported - When executing a FIFO operation which involves entries of different classes, the result set is not guaranteed to be in FIFO order (however, each subset of a specific class will maintain order).</li>
	<li>Order across cluster partitions is not supported - When executing a FIFO operation which involves more than one partition, the<br/>
result set is not guaranteed to be in FIFO order (however, each subset of a specific partition will maintain order). </li>
</ul>


                     </td>
</tr>
</table>
<table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr>
<td height="12" background="http://www.gigaspaces.com/wiki/images/border/border_bottom.gif"><img src="images/border/spacer.gif" width="1" height="1" border="0"/></td>
</tr>
<tr>
<td align="center"><font color="grey"><a href="http://www.gigaspaces.com">GigaSpaces.com</a> -
		<a href="http://www.gigaspaces.com/wiki/x/xwBmAg" class="smalltext">Legal Notice</a> -
		<a href="http://www.gigaspaces.com/wiki/x/xgBmAg" class="smalltext">3rd Party Licenses</a> -
		<a href="http://www.gigaspaces.com/wiki/x/BQFmAg" class="smalltext">Site Map</a> -
		<a href="http://www.gigaspaces.com/wiki/display/API/API+Documentation+Portal" class="version-link">API Docs</a> -
		<a href="http://forum.openspaces.org/forum.jspa?forumID=175" class="version-link">Forum</a> -
		<a href="http://www.gigaspaces.com/LatestProductVersion" class="version-link">Downloads</a> -
		<a href="http://blog.gigaspaces.com/" class="version-link">Blog</a> -
		<a href="http://www.gigaspaces.com/os_papers.html" class="version-link">White Papers</a> -
		<a href="mailto:techw@gigaspaces.com">Contact Tech Writing</a> -
		<i><a href="http://www.atlassian.com/software/confluence">Gen. by Atlassian Confluence</a></i></font></td>
</tr>
</table>
     </body>
</html>
