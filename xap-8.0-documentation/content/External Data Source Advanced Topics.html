<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
     <head>
         <title>XAP 8.0 Documentation : External Data Source Advanced Topics</title>
<link rel="stylesheet" href="styles/site.css" type="text/css" />
         <META http-equiv="Content-Type" content="text/html; charset=UTF-8">
		 <style>
.back-to {
	color: #666666;
	font-weight: bold;
}	 
a.back-to:link, a.back-to:visited, a.back-to:hover, a.back-to:active  {
	color: #666666;
}	 
		 </style>
     </head>

     <body>
<table class="pagecontent" border="0" cellpadding="0" cellspacing="0" width="100%" bgcolor="#ffffff">
<tr>
<td valign="top" class="pagebody">
<div class="pageheader">
<span class="back-to">XAP 8.0 Documentation > <a href="index.html">Back to Table of Contents</a></span><br>
<h1>External Data Source Advanced Topics</h1>
</div>
<br>

<script type='text/javascript'>//<![CDATA[
function debug() { }
// ]]></script><script type='text/javascript' src='/wiki/download/resources/net.customware.confluence.plugin.composition:composition-setup/js/browser.js'>//<![CDATA[
// ]]></script><script type='text/javascript' src='/wiki/download/resources/net.customware.confluence.plugin.composition:composition-setup/js/behaviour.js'>//<![CDATA[
// ]]></script><script type='text/javascript' src='/wiki/download/resources/net.customware.confluence.plugin.composition:composition-setup/js/memory.js'>//<![CDATA[
// ]]></script><script type='text/javascript' src='/wiki/download/resources/net.customware.confluence.plugin.composition:composition-setup/js/cloak.js'>//<![CDATA[
// ]]></script><script type='text/javascript'>//<![CDATA[
Cloak.closeHTML = "<img src=\'/wiki/download/resources/net.customware.confluence.plugin.composition:toggle-cloak/img/navigate_down_10.gif\'/>";
Cloak.openHTML = "<img src=\'/wiki/download/resources/net.customware.confluence.plugin.composition:toggle-cloak/img/navigate_right_10.gif\'/>";
Cloak.toggleZone = true;
Cloak.memoryDuration = 0;
Cloak.memoryPrefix = "contentId:53903701";
Cloak.memoryPath = "/wiki/";
// ]]></script><style type='text/css'>
.cloakToggle { /* Definition for state toggling image */
cursor:hand;
cursor:pointer;
}
</style><script type='text/javascript' src='/wiki/download/resources/net.customware.confluence.plugin.composition:composition-setup/js/transitions.js'>//<![CDATA[
// ]]></script><script type='text/javascript' src='/wiki/download/resources/net.customware.confluence.plugin.composition:composition-setup/js/deck.js'>//<![CDATA[
// ]]></script><link rel='stylesheet' type='text/css'  href='/wiki/styles/main-action.css?pluginCompleteKey=net.customware.confluence.plugin.composition:composition-setup&stylesheetName=deck&spaceKey=XAP8'/><script type='text/javascript'>//<![CDATA[
Deck.memoryDuration = 0;
Deck.memoryPrefix = "contentId:53903701";
Deck.memoryPath = "/wiki/";
// ]]></script>


<div style="border-style:solid; border-color:#3C78B5; border-width:thin; padding-left:20px; padding-bottom:20px; padding-top:20px; padding-right:20px; background-color:#D8E4F1"> 

<p><b>Section Summary:</b>  External Data Source advanced topics such as advanced operations, tuning, troubleshooting, and limitations. </p>
</div>

<h1><a name="ExternalDataSourceAdvancedTopics-Overview"></a>Overview</h1>
<p>This sections covers advanced options related to the External Data Source.</p>

<h1><a name="ExternalDataSourceAdvancedTopics-Properties"></a>Properties</h1>
<p>Here are the External Data Source Properties:</p>
<table class='confluenceTable'><tbody>
<tr>
<th class='confluenceTh'> Property </th>
<th class='confluenceTh'> Description </th>
<th class='confluenceTh'> Default </th>
</tr>
<tr>
<td class='confluenceTd'>space-config.external-data-source.data-source-class</td>
<td class='confluenceTd'> Data Source interfaces require an implementing class. GigaSpaces provides an implementation that works seamlessly with Hibernate, which is defined using this property. The class name is <tt>com.gigaspaces.datasource.hibernate.HibernateDataSource</tt></td>
<td class='confluenceTd'>&nbsp;</td>
</tr>
<tr>
<td class='confluenceTd'>space-config.external-data-source.data-class</td>
<td class='confluenceTd'> This defines the class of the objects that are passed to the data source. Usually, this attribute shouldn't be changed unless the data source requires that the data objects won't be converted to their original format. </td>
<td class='confluenceTd'>java.lang.Object</td>
</tr>
<tr>
<td class='confluenceTd'>space-config.external-data-source.supports-inheritance</td>
<td class='confluenceTd'> This attribute indicates whether the data source supports hierarchical queries. If the underlying data source supports sub-class queries (like Hibernate), the <tt>External Data Source</tt> is invoked only once for the queried class. Otherwise, it is called for the super class, and for each of its sub-classes. </td>
<td class='confluenceTd'>true</td>
</tr>
<tr>
<td class='confluenceTd'>space-config.external-data-source.usage</td>
<td class='confluenceTd'> This attribute specifies how the data source should be used:<br/>
Read operations only (<tt>read-only</tt>), or read and write (<tt>read-write</tt>). If set to <tt>read-only</tt>, destructive operations are not delegated to the data source. </td>
<td class='confluenceTd'>read-write</td>
</tr>
<tr>
<td class='confluenceTd'>space-config.external-data-source.shared-iterator.enabled</td>
<td class='confluenceTd'> This attribute enables shared iterator mode which tries to optimize data source access by sharing the same iterator for the same query operations when possible. </td>
<td class='confluenceTd'>true</td>
</tr>
<tr>
<td class='confluenceTd'>space-config.external-data-source.shared-iterator.time-to-live</td>
<td class='confluenceTd'> This attribute specify for how long in miliseconds an iterator can be shared in shared iterator mode. If two equivalent queries are done concurrently, but the time that elapsed between the first query and the second query exceeds the time to live, the second query will open a new iterator on the data source and will not share the first one.</td>
<td class='confluenceTd'>10000</td>
</tr>
<tr>
<td class='confluenceTd'>space-config.external-data-source.init-properties-file</td>
<td class='confluenceTd'> This properties file content is passed directly to the data source implementation in the <tt>init()</tt> method. This file can be used to pass any custom parameters to the data source. </td>
<td class='confluenceTd'>&nbsp;</td>
</tr>
<tr>
<td class='confluenceTd'>cluster-config.cache-loader.external-data-source</td>
<td class='confluenceTd'> Provides cluster-wide support. </td>
<td class='confluenceTd'>true</td>
</tr>
<tr>
<td class='confluenceTd'>cluster-config.cache-loader.central-data-source</td>
<td class='confluenceTd'> Provides cluster-wide support. </td>
<td class='confluenceTd'>true</td>
</tr>
</tbody></table>

<p><a name="ExternalDataSourceAdvancedTopics-TR"></a></p>
<h1><a name="ExternalDataSourceAdvancedTopics-Troubleshooting"></a>Troubleshooting</h1>
<p>To enable logging for <tt>ExternalDataSource</tt>, edit the <tt>&lt;GigaSpaces Root&gt;\config\gs_logging.properties</tt> file, and set the persistent level to <tt>CONFIG</tt> or <tt>FINER</tt>.</p>

<ul>
	<li><tt>CONFIG</tt> messages are intended to provide a variety of static configuration information, and to assist in debugging problems that may be associated with particular configurations.
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">com.gigaspaces.persistent.level = CONFIG</pre>
</div></div></li>
	<li><tt>FINER</tt> messages log calls for entering, returning, or throwing an exception to and from the cache interface implementations.
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">com.gigaspaces.persistent.level = FINER</pre>
</div></div></li>
</ul>


<p><a name="ExternalDataSourceAdvancedTopics-ISL"></a></p>
<h1><a name="ExternalDataSourceAdvancedTopics-InitialSpaceLoad"></a>Initial Space Load</h1>
<p>When the space is started, restarted, or cleaned, the system can initially fill the space with space objects that are likely to be required by the application. You can specify the data to loaded using the <tt>ExternalDataSource.initialLoad</tt> method that is called once the space is started. See the <a href="External Data Source Initial Load.html" title="External Data Source Initial Load">External Data Source Initial Load</a> for details. The space is not available for clients, until the data load process has been completed.</p>
<div class='panelMacro'><table class='tipMacro'><colgroup><col width='24'><col></colgroup><tr><td valign='top'><img src="images/icons/emoticons/check.gif" width="16" height="16" align="absmiddle" alt="" border="0"></td><td>The Initial Load is supported with the <tt>partitioned-sync2backup</tt> cluster schema. If you would like to pre-load a clustered space using the Initial-Load without running backups you can use the <tt>partitioned-sync2backup</tt> and have ZERO as the amount of backups.</td></tr></table></div>

<h1><a name="ExternalDataSourceAdvancedTopics-RefreshingSpaceObjectwhenusingEDS"></a>Refreshing Space Object when using EDS</h1>
<p>In order to refresh a space object , you should remove it from the space using the <tt>take</tt>, <tt>takeById</tt> , <tt>write</tt> with short lease or <tt>clear</tt> operations and read it back using the <tt>read</tt> or <tt>readById</tt> operations. This in turn will load the latest version of the object from the external data source (i.e. database) via the EDS implementation back into the space. When having such a scenario you should be aware of the <b>recent deletes mechanism</b>.</p>

<p>The recent deletes mechanism running within the space ensures that there will not be a race condition, if  an object is removed from the space and loaded by two or more different threads at the same time. This mechanism <b>prevents the EDS implementation from loading an object that has been removed from the space and after a short time been loaded again (with the same ID) to happen</b>. </p>

<p>In order to allow an object that has been removed to be loaded again into the space you should use one the following options:</p>
<ul class="alternate" type="square">
	<li>Implement only the <tt>DataProvider</tt> or the <tt>SQLDataProvider</tt> interface as part of the EDS implementation. The existence of the <tt>DataPersister</tt> or the <tt>BulkDataPersister</tt> turn on the recent deletes mechanism.</li>
	<li>Run in <tt>read-only</tt> External Data source mode. This will turn off the recent deletes mechanism. This means you should change space configuration to have:
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">&lt;prop key=<span class="code-quote">"space-config.external-data-source.usage"</span>&gt;read-only&lt;/prop&gt;</pre>
</div></div></li>
	<li>Perform the read operation several times (with short sleeps in between) until the object will be loaded into the space (you will not get a null back).</li>
</ul>


<h1><a name="ExternalDataSourceAdvancedTopics-EliminatingResonanceAffectwhenUsingMirrorService"></a>Eliminating Resonance Affect when Using Mirror Service</h1>
<p>When using the <a href="Asynchronous Persistency with the Mirror.html" title="Asynchronous Persistency with the Mirror">Mirror Service</a>, and the <tt>ExternalDataSource</tt> is enabled for the space, all data loaded into the space using <tt>ExternalDataSource.initialLoad</tt> while it is being started, <b>is not replicated back to the Mirror Service</b>.</p>

<h1><a name="ExternalDataSourceAdvancedTopics-CountOperation"></a>Count Operation</h1>
<p>The scope of <tt>IJSpace.count()</tt> or <tt>GigaSpace.count()</tt> and <tt>IMap.Size()</tt> is the data stored within the space. These methods do not take into account the data stored within the underlying data source.</p>

<p>When using the Map API with a local cache, the value of <tt>IMap.Size()</tt> is the amount of objects in the local cache (it might be less than what actually exists in the space).</p>

<h1><a name="ExternalDataSourceAdvancedTopics-RecursiveCalls"></a>Recursive Calls</h1>
<p>The <tt>ExternalDataSource</tt> implementation should avoid performing space operations to prevent deadlocks and recursive behavior.</p>

<p><a name="ExternalDataSourceAdvancedTopics-UIDG"></a></p>
<h1><a name="ExternalDataSourceAdvancedTopics-UIDGeneration"></a>UID Generation</h1>
<p>The space embeds a unique identifier into each space Object. This ID is used implicitly when performing update operations, and read/take operations based on ID.</p>

<p>When using the <tt>External Data Source</tt> mechanism, to ensure the consistency of the system, you should construct the Object UID based on some unique value, when writing the object into the space and when loading it from the underlying External Data Source. The UID should be based on some unique value stored within the object, such as the primary key. This unique value is used when generating the UID. If you write an object into the space, or load an object that has a UID that already exists within the space, the operation will be rejected with the exception:<tt>com.j_spaces.core.client.EntryAlreadyInSpaceException</tt>.</p>

<p>When specifing the SpaceIf field make sure the <tt>auto-generate</tt> attribute should be set to <tt>false</tt>.</p>

<p><a name="ExternalDataSourceAdvancedTopics-HibernateID"></a></p>
<h1><a name="ExternalDataSourceAdvancedTopics-HibernateIDGeneration"></a>Hibernate ID Generation</h1>
<p>Hibernate supports multiple ID generators as detailed in <a href="http://docs.jboss.org/hibernate/core/3.3/reference/en/html/mapping.html#mapping-declaration-id">Hibernate documentation</a>. Your hibernate mapping file should use algorithm that is appropriate for your use case. </p>

<p>Some generators increase the number of database operations and result into overall adverse performance. You need to watch out for generators + database combinations that automatically disable the batch insert mode transparently as mentioned <a href="http://docs.jboss.org/hibernate/core/3.3/reference/en/html/batch.html">here</a>.</p>

<p><em>"Hibernate disables insert batching at the JDBC level transparently if you use an identity identifier generator."</em></p>
<div class='panelMacro'><table class='tipMacro'><colgroup><col width='24'><col></colgroup><tr><td valign='top'><img src="images/icons/emoticons/check.gif" width="16" height="16" align="absmiddle" alt="" border="0"></td><td>Using a sequence number increases the database reads on some databases, because Hibernate reads the next sequence number before each new <tt>INSERT</tt> in the batch. This also disables batch persistence used by GigaSpaces HibernateExternalDataSource.

<p>A better strategy would be to use a dummy generator like "increment" in hibernate mapping file, on the database side define a INSERT trigger on this table to generate a new id using a sequence. You will see orders of magnitude performance improvement in the database operations making this simple change.</p></td></tr></table></div>

<p><a name="ExternalDataSourceAdvancedTopics-limits"></a></p>
<h1><a name="ExternalDataSourceAdvancedTopics-Considerations"></a>Considerations</h1>
<ul>
	<li>When a space is configured using <tt>External Data Source</tt>, and a <tt>POJO</tt> is used as the Space Domain class, it must use the <tt>SpaceId(autogenerate=false)</tt> decoration.</li>
	<li>When running in LRU Cache policy the <tt>GigaSpace.Count</tt> operation using the data within the space only and does not access the External Data Source (database) to return the object count (different than Storage Adapter).</li>
	<li>When a space is configured using <tt>External Data Source</tt> only Native serialization mode should be used.</li>
	<li><tt>RegExQuery</tt> is not supported by the <tt>DataProvider</tt> or the <tt>SQLDataProvider</tt>. Use the <tt>SQLQuery</tt> instead.</li>
	<li>Objects loaded via the <tt>ManagedDataSource.initialLoad</tt> can be expired using the <tt>@SpaceLeaseExpiration</tt> annotation. See the <a href="POJO Metadata.html#POJOMetadata-SpaceLeaseExpiration">POJO Support - Advanced</a> page for more details.</li>
	<li>When using the Map API, the key must be <tt>Serializable</tt>.</li>
	<li>The <tt>ExternalDataSource.initialLoad()</tt> loads data into partitioned spaces, by reading all the data into the space and filtering it at the space side. To tune this behavior, you should execute the relevant query from the database on the partition ID, to fetch the relevant result set to load into the space. See the <a href="External Data Source Initial Load.html" title="External Data Source Initial Load">External Data Source Initial Load</a> for more details.</li>
	<li><a href="http://www.hibernate.org/162.html">Hibernate Lazy load</a> is not supported when using the <tt>HibernateDataSource</tt> as an External Data Source implementation. See <a href="http://www.gigaspaces.com/wiki/display/SBP/Space+Object+Modeling" title="Space Object Modeling">Space Object Modeling</a> for more details.</li>
	<li>When running in <tt>ALL_IN_CACHE</tt> cache policy mode, optimistic locking is supported - i.e. updates in optimistic locking mode will be rejected, in case the client performs an update with the non-latest version of the entry. The loaded object from the database should include the latest version or the value 1.</li>
	<li>When running a local cache, the client cache will be updated using an optimistic locking mode - i.e. updates will include the correct version of the entry.</li>
	<li>Optimistic locking is not supported when running in <tt>LRU</tt> cache policy mode, in case the loaded object does not include data within the <tt>SpaceVersion</tt> field.</li>
	<li>When running in LRU Cache policy the <tt>engine.initial_load</tt> property should be configured with a small number, to avoid memory shortage in persistent spaces with large data.</li>
</ul>


                     </td>
</tr>
</table>
<table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr>
<td height="12" background="http://www.gigaspaces.com/wiki/images/border/border_bottom.gif"><img src="images/border/spacer.gif" width="1" height="1" border="0"/></td>
</tr>
<tr>
<td align="center"><font color="grey"><a href="http://www.gigaspaces.com">GigaSpaces.com</a> -
		<a href="http://www.gigaspaces.com/wiki/x/xwBmAg" class="smalltext">Legal Notice</a> -
		<a href="http://www.gigaspaces.com/wiki/x/xgBmAg" class="smalltext">3rd Party Licenses</a> -
		<a href="http://www.gigaspaces.com/wiki/x/BQFmAg" class="smalltext">Site Map</a> -
		<a href="http://www.gigaspaces.com/wiki/display/API/API+Documentation+Portal" class="version-link">API Docs</a> -
		<a href="http://forum.openspaces.org/forum.jspa?forumID=175" class="version-link">Forum</a> -
		<a href="http://www.gigaspaces.com/LatestProductVersion" class="version-link">Downloads</a> -
		<a href="http://blog.gigaspaces.com/" class="version-link">Blog</a> -
		<a href="http://www.gigaspaces.com/os_papers.html" class="version-link">White Papers</a> -
		<a href="mailto:techw@gigaspaces.com">Contact Tech Writing</a> -
		<i><a href="http://www.atlassian.com/software/confluence">Gen. by Atlassian Confluence</a></i></font></td>
</tr>
</table>
     </body>
</html>
