<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
     <head>
         <title>XAP 8.0 Documentation : Logging API</title>
<link rel="stylesheet" href="styles/site.css" type="text/css" />
         <META http-equiv="Content-Type" content="text/html; charset=UTF-8">
		 <style>
.back-to {
	color: #666666;
	font-weight: bold;
}	 
a.back-to:link, a.back-to:visited, a.back-to:hover, a.back-to:active  {
	color: #666666;
}	 
		 </style>
     </head>

     <body>
<table class="pagecontent" border="0" cellpadding="0" cellspacing="0" width="100%" bgcolor="#ffffff">
<tr>
<td valign="top" class="pagebody">
<div class="pageheader">
<span class="back-to">XAP 8.0 Documentation > <a href="index.html">Back to Table of Contents</a></span><br>
<h1>Logging API</h1>
</div>
<br>

<script type='text/javascript'>//<![CDATA[
function debug() { }
// ]]></script><script type='text/javascript' src='/wiki/download/resources/net.customware.confluence.plugin.composition:composition-setup/js/browser.js'>//<![CDATA[
// ]]></script><script type='text/javascript' src='/wiki/download/resources/net.customware.confluence.plugin.composition:composition-setup/js/behaviour.js'>//<![CDATA[
// ]]></script><script type='text/javascript' src='/wiki/download/resources/net.customware.confluence.plugin.composition:composition-setup/js/memory.js'>//<![CDATA[
// ]]></script><script type='text/javascript' src='/wiki/download/resources/net.customware.confluence.plugin.composition:composition-setup/js/cloak.js'>//<![CDATA[
// ]]></script><script type='text/javascript'>//<![CDATA[
Cloak.closeHTML = "<img src=\'/wiki/download/resources/net.customware.confluence.plugin.composition:toggle-cloak/img/navigate_down_10.gif\'/>";
Cloak.openHTML = "<img src=\'/wiki/download/resources/net.customware.confluence.plugin.composition:toggle-cloak/img/navigate_right_10.gif\'/>";
Cloak.toggleZone = true;
Cloak.memoryDuration = 0;
Cloak.memoryPrefix = "contentId:53903513";
Cloak.memoryPath = "/wiki/";
// ]]></script><style type='text/css'>
.cloakToggle { /* Definition for state toggling image */
cursor:hand;
cursor:pointer;
}
</style><script type='text/javascript' src='/wiki/download/resources/net.customware.confluence.plugin.composition:composition-setup/js/transitions.js'>//<![CDATA[
// ]]></script><script type='text/javascript' src='/wiki/download/resources/net.customware.confluence.plugin.composition:composition-setup/js/deck.js'>//<![CDATA[
// ]]></script><link rel='stylesheet' type='text/css'  href='/wiki/styles/main-action.css?pluginCompleteKey=net.customware.confluence.plugin.composition:composition-setup&stylesheetName=deck&spaceKey=XAP8'/><script type='text/javascript'>//<![CDATA[
Deck.memoryDuration = 0;
Deck.memoryPrefix = "contentId:53903513";
Deck.memoryPath = "/wiki/";
// ]]></script>


<div style="border-style:solid; border-color:#3C78B5; border-width:thin; padding-left:20px; padding-bottom:20px; padding-top:20px; padding-right:20px; background-color:#D8E4F1"> 

<p><b>Section Summary:</b>  Simple API extract and filter out logging information of GigaSpaces runtime. </p>
</div>

<h1><a name="LoggingAPI-Overview"></a>Overview</h1>

<p>As part of the Administration API is an extensive logging extraction and filtering from different runtime components of GigaSpaces. Here is a very simple example:</p>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java"><span class="code-keyword">import</span> <span class="code-keyword">static</span> com.gigaspaces.log.LogEntryMatchers.*;

Admin admin = <span class="code-keyword">new</span> AdminFactory().addGroup(<span class="code-quote">"myGroup"</span>).createAdmin();
<span class="code-comment">// ...
</span>admin.getGridServiceContainers().waitFor(1);
GridServiceContainer container = admin.getGridServiceContainers().getContainers()[0];

<span class="code-comment">// get all the logs of the chosen container between 8 AM and 9 AM on November 15.
</span>LogEntryMatcher matcher = afterTime(<span class="code-quote">"2009-11-15 8:00:00"</span>, beforeTime(<span class="code-quote">"2009-11-15 9:00:00"</span>));
LogEntries logEntries = container.logEntries(matcher);
<span class="code-keyword">for</span> (LogEntry logEntry : logEntries.logEntries()) {
    <span class="code-object">System</span>.out.println(logEntry.getText());
}</pre>
</div></div> 

<p>The above example uses the Admin API in order to get the GridServiceContainer we wish to extract the logs from, and then extracts all the log entries ("log lines") between 8 AM and 9 AM on November 15.</p>

<h1><a name="LoggingAPI-OnLogEntry%2CLogEntries%2CandMatchers"></a>On Log Entry, Log Entries, and Matchers</h1>

<p>At the base of the logging support is the <tt>LogEntry</tt> class. <tt>LogEntry</tt> represents an entry or a "row" in the results that are returned as part of the logging API call. </p>

<p>The <tt>LogEntry</tt> comes in two types, the first, is a <tt>LOG</tt> type. This type represents a single "log line" within the traversed log file(s) (A log line holder all the information in logger.log(...), including the exception). The <tt>LogEntry</tt> allows to access the actual text of the log line, and the timestamp of when it was taken.</p>

<p>The second type of a <tt>LogEntry</tt> is a <tt>FILE_MARKER</tt>. This represents the file at which the following <tt>LogEntry</tt> were extracted from. Most times, this should not care API users.</p>

<p><tt>LogEntries</tt> represent a collection of <tt>LogEntry</tt> with additional meta data. <tt>LogEntries</tt> provide the host address and name, the process id, and process type (GSA, GSC, LUS, GSM) that the <tt>LogEntries</tt> were extracted from. Since most times an iteration over just the <tt>LOG</tt> type entries is required, a simple <tt>LogEntries#logEntries()</tt> method is provided that returns a list of only the <tt>LOG</tt> type entries.</p>

<p><tt>CompoundLogEntries</tt> are a list of <tt>LogEntries</tt>. They exists in order to support extraction of logging information from several runtime components with a single API call. We will see an example of that later on when we see how we can get logging information from the GridServiceAgent.</p>

<p>The extraction of logging information is performed on the server side and filtering which logging information to extract is done using <tt>LogEntryMatcher</tt>. There are several built in <tt>LogEntryMatcher</tt>, all accessible through the static factory method class <tt>LogEntryMatchers</tt>.</p>

<p><tt>LogEntryMatcher</tt> is responsible for both accumulating the log entries to return, as well as filtering them. The accumulating type matchers are very simple, with the <tt>LogEntryMatchers.all</tt> which is widely used which simply accumulates all the log entries that end up at it.</p>

<p>A <tt>LogEntryMatcherFilter</tt> is a special type (base class) of <tt>LogEntryMatcher</tt> which accepts a delegating <tt>LogEntryMatcher</tt> and controls if <tt>LogEntry</tt> will be passed to the delegating matcher or not (thus, filtering out certain log entries). Some examples of filtering log entry matchers include <tt>AfterTime</tt>, <tt>BeforeTime</tt>, <tt>Regex</tt> and so on. By default, most filtering matchers default to the <tt>all</tt> matcher as the delegating matchers if not explicitly defined.</p>

<p>A <tt>StreamLogEntryMatcher</tt> is a special type of matchers that can be reused between invocations and contains state that is stored on the calling side. They are very handy to perform operations such a "tail -f" of log files or iterating over large log files using chunking.</p>

<p>Here is an example of iterating over all the log file(s) of a specific container in chunks of 100 log entries with each call:</p>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">LogEntryMatcher matcher = forwardChunk(size(100));
<span class="code-keyword">while</span> (<span class="code-keyword">true</span>) {
	LogEntries logEntries = container.logEntries(matcher);
	<span class="code-keyword">for</span> (LogEntry logEntry : logEntries.logEntries()) {
	    <span class="code-object">System</span>.out.println(logEntry.getText());
	}
}</pre>
</div></div>

<p>And here is an example of implementing a "tail -f" type logic over the container logging (start with latest 100 log entries, and print new ones as they come):</p>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java"><span class="code-keyword">new</span> <span class="code-object">Thread</span>(<span class="code-keyword">new</span> <span class="code-object">Runnable</span>() {

    <span class="code-keyword">private</span> LogEntryMatcher matcher = continuous(lastN(100));

    <span class="code-keyword">public</span> void run() {
        <span class="code-keyword">while</span> (<span class="code-keyword">true</span>) {
            <span class="code-keyword">final</span> LogEntries logs = container.logEntries(matcher);
            <span class="code-keyword">for</span> (LogEntry log : logs.logEntries()) {
                <span class="code-object">System</span>.out.println(log.getText());
            }
            <span class="code-keyword">try</span> {
                <span class="code-object">Thread</span>.sleep(1000);
            } <span class="code-keyword">catch</span> (InterruptedException e) {
                <span class="code-keyword">return</span>;
            }
        }
    }
}).start();</pre>
</div></div>

<h1><a name="LoggingAPI-LoggingExtractionProcess"></a>Logging Extraction Process</h1>

<p>Logging are extracted by running the provided matchers on the server side on the machine where the process is running. This can, potentially, be a heavy operation. For that reason, when using the Admin API, logging for runtime components will be automatically extracted by the Grid Service Agent if there is a Grid Service Agent that started the runtime component. If there isn't a Grid Service Agent that started the runtime component, then the logging extraction will be executed on the actual runtime component.</p>

<p>All logging extraction enabled runtime components implement the <tt>LogProviderGridComponent</tt> interface. The default <tt>logEntries</tt> method automatically uses the above mentioned logic. The <tt>logEntriesDirect</tt> method will always execute on the runtime component, without trying to go to the agent if the runtime component was started by one.</p>

<h1><a name="LoggingAPI-GridServiceAgent"></a>Grid Service Agent</h1>

<p>The Agent is just another component that its log files can be extracted by the above mentioned ways. It also provide additional ways to extract logs for runtime components it is managing. For example, extracting all the log information of all the different runtime components that are currently executed by the agent. Here is an example:</p>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java"><span class="code-keyword">new</span> <span class="code-object">Thread</span>(<span class="code-keyword">new</span> <span class="code-object">Runnable</span>() {

    <span class="code-keyword">private</span> LogEntryMatcher matcher = continuous(regex(<span class="code-quote">".*INFO.*"</span>, lastN(100)), regex(<span class="code-quote">".*INFO.*"</span>));

    <span class="code-keyword">public</span> void run() {
        <span class="code-keyword">while</span> (<span class="code-keyword">true</span>) {
            CompoundLogEntries entries = agent.liveLogEntries(matcher);
            <span class="code-keyword">if</span> (entries.isEmpty()) {
                <span class="code-object">System</span>.out.println(<span class="code-quote">"**** EXIT"</span>);
                <span class="code-keyword">break</span>;
            }
            <span class="code-keyword">for</span> (LogEntries logEntries : entries.getSafeEntries()) {
                <span class="code-keyword">for</span> (LogEntry log : logEntries.logEntries()) {
                    <span class="code-object">System</span>.out.println(logEntries.getProcessType() + <span class="code-quote">"/"</span> + logEntries.getPid() + <span class="code-quote">": "</span> + log.getText());
                }
            }
            <span class="code-keyword">try</span> {
                <span class="code-object">Thread</span>.sleep(1000);
            } <span class="code-keyword">catch</span> (InterruptedException e) {
                <span class="code-keyword">return</span>;
            }
        }
    }
}).start();</pre>
</div></div>

<p>The above example will continuously (tail like) extract logs from all the "live" (existing running runtime components) that this agent manages. The first regex matcher is the one that the continuous matcher will use for the initial matching (the first call), and the second parameter is a regex matcher that will be applied to new log entries.</p>

<p>The <tt>CompoundLogEntries</tt> allows to iterate over all the <tt>LogEntries</tt> of each process sampled.</p>

                     </td>
</tr>
</table>
<table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr>
<td height="12" background="http://www.gigaspaces.com/wiki/images/border/border_bottom.gif"><img src="images/border/spacer.gif" width="1" height="1" border="0"/></td>
</tr>
<tr>
<td align="center"><font color="grey"><a href="http://www.gigaspaces.com">GigaSpaces.com</a> -
		<a href="http://www.gigaspaces.com/wiki/x/xwBmAg" class="smalltext">Legal Notice</a> -
		<a href="http://www.gigaspaces.com/wiki/x/xgBmAg" class="smalltext">3rd Party Licenses</a> -
		<a href="http://www.gigaspaces.com/wiki/x/BQFmAg" class="smalltext">Site Map</a> -
		<a href="http://www.gigaspaces.com/wiki/display/API/API+Documentation+Portal" class="version-link">API Docs</a> -
		<a href="http://forum.openspaces.org/forum.jspa?forumID=175" class="version-link">Forum</a> -
		<a href="http://www.gigaspaces.com/LatestProductVersion" class="version-link">Downloads</a> -
		<a href="http://blog.gigaspaces.com/" class="version-link">Blog</a> -
		<a href="http://www.gigaspaces.com/os_papers.html" class="version-link">White Papers</a> -
		<a href="mailto:techw@gigaspaces.com">Contact Tech Writing</a> -
		<i><a href="http://www.atlassian.com/software/confluence">Gen. by Atlassian Confluence</a></i></font></td>
</tr>
</table>
     </body>
</html>
