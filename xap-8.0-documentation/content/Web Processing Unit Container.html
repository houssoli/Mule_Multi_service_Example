<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
     <head>
         <title>XAP 8.0 Documentation : Web Processing Unit Container</title>
<link rel="stylesheet" href="styles/site.css" type="text/css" />
         <META http-equiv="Content-Type" content="text/html; charset=UTF-8">
		 <style>
.back-to {
	color: #666666;
	font-weight: bold;
}	 
a.back-to:link, a.back-to:visited, a.back-to:hover, a.back-to:active  {
	color: #666666;
}	 
		 </style>
     </head>

     <body>
<table class="pagecontent" border="0" cellpadding="0" cellspacing="0" width="100%" bgcolor="#ffffff">
<tr>
<td valign="top" class="pagebody">
<div class="pageheader">
<span class="back-to">XAP 8.0 Documentation > <a href="index.html">Back to Table of Contents</a></span><br>
<h1>Web Processing Unit Container</h1>
</div>
<br>

<script type='text/javascript'>//<![CDATA[
function debug() { }
// ]]></script><script type='text/javascript' src='/wiki/download/resources/net.customware.confluence.plugin.composition:composition-setup/js/browser.js'>//<![CDATA[
// ]]></script><script type='text/javascript' src='/wiki/download/resources/net.customware.confluence.plugin.composition:composition-setup/js/behaviour.js'>//<![CDATA[
// ]]></script><script type='text/javascript' src='/wiki/download/resources/net.customware.confluence.plugin.composition:composition-setup/js/memory.js'>//<![CDATA[
// ]]></script><script type='text/javascript' src='/wiki/download/resources/net.customware.confluence.plugin.composition:composition-setup/js/cloak.js'>//<![CDATA[
// ]]></script><script type='text/javascript'>//<![CDATA[
Cloak.closeHTML = "<img src=\'/wiki/download/resources/net.customware.confluence.plugin.composition:toggle-cloak/img/navigate_down_10.gif\'/>";
Cloak.openHTML = "<img src=\'/wiki/download/resources/net.customware.confluence.plugin.composition:toggle-cloak/img/navigate_right_10.gif\'/>";
Cloak.toggleZone = true;
Cloak.memoryDuration = 0;
Cloak.memoryPrefix = "contentId:53903638";
Cloak.memoryPath = "/wiki/";
// ]]></script><style type='text/css'>
.cloakToggle { /* Definition for state toggling image */
cursor:hand;
cursor:pointer;
}
</style><script type='text/javascript' src='/wiki/download/resources/net.customware.confluence.plugin.composition:composition-setup/js/transitions.js'>//<![CDATA[
// ]]></script><script type='text/javascript' src='/wiki/download/resources/net.customware.confluence.plugin.composition:composition-setup/js/deck.js'>//<![CDATA[
// ]]></script><link rel='stylesheet' type='text/css'  href='/wiki/styles/main-action.css?pluginCompleteKey=net.customware.confluence.plugin.composition:composition-setup&stylesheetName=deck&spaceKey=XAP8'/><script type='text/javascript'>//<![CDATA[
Deck.memoryDuration = 0;
Deck.memoryPrefix = "contentId:53903638";
Deck.memoryPath = "/wiki/";
// ]]></script>


<div style="border-style:solid; border-color:#3C78B5; border-width:thin; padding-left:20px; padding-bottom:20px; padding-top:20px; padding-right:20px; background-color:#D8E4F1"> 

<p><b>Section Summary:</b>  Allows you to deploy a web application (WAR) into the Service Grid. </p>
</div>

<h1><a name="WebProcessingUnitContainer-Overview"></a>Overview</h1>

<p>OpenSpaces integration with the Service Grid allows you to deploy web applications (packaged as a WAR file) onto the Service Grid. The integration is built on top of the <a href="Deploying onto the Service Grid.html" title="Deploying onto the Service Grid">Service Grid Processing Unit Container</a>.</p>

<p>The integration allows you to make use of the following Service Grid features: </p>

<ul>
	<li>dynamic allocation of several instances of a web application (probably fronted by a load balancer).</li>
	<li>management of the instances running (if a GSC fails, the web application instances running on it will be instantiated on a different GSC).</li>
	<li>SLA monitor based dynamic allocation and de-allocation of web application instances.</li>
</ul>


<p>The web application itself is a pure, JEE based, web application. The application can be the most generic web application, and automatically make use of the Service Grid features. The web application can define a Space (either embedded or remote) very easily (either using Spring or not).</p>

<p>The web container used behind the scenes is <a href="http://www.mortbay.org">Jetty</a> (with other containers coming in the near future). This page will list the common usage and configuration of web containers. Jetty specific configuration and usage can be found <a href="Web Jetty Processing Unit Container.html" title="Web Jetty Processing Unit Container">here</a>.</p>

<h1><a name="WebProcessingUnitContainer-Deployment"></a>Deployment</h1>

<p>The integration can either deploy a packaged WAR file or an exploded WAR file. In order to deploy packaged WAR file, it can be specified using one of the deployment mechanisms (UI/CLI/Programmatic, see more <a href="Deploying onto the Service Grid.html#DeployingontotheServiceGrid-deployDirections">here</a>). When deploying a WAR file, it goes through the following steps until it gets to the GSC: </p>

<p><img class="emoticon" src="images/icons/emoticons/information.gif" height="16" width="16" align="absmiddle" alt="" border="0"/> Note that the deploy client, the GSMs, and the GSCs can run on different machines.</p>

<ol>
	<li>Point the deployment tool to the WAR file (UI/CLI/Programmatic).</li>
	<li>The WAR file itself is uploaded to the chosen GSM (which will act as the primary GSM of the deployment).</li>
	<li>The WAR is extracted under the GSM deploy directory with the provided processing unit name. The default directory location is <tt>GSRoot/deploy/[processing unit name]</tt>.</li>
	<li>The GSM decides (based on the SLA) how many instances of the web application need to be deployed, and deploys them to the available GSCs.</li>
	<li>Each GSC that is supposed to run an instance of the web application, downloads the web application into its own local file system. By default, it downloads it into <tt>GSRoot/work/deployed-processing-units/[processing unit name]&#95;[unique identifier]</tt>.</li>
	<li>The appropriate web container is configured to run the web application using the local file system location.</li>
</ol>


<p>Deploying an exploded WAR is similar to deploying a packaged WAR. Here are the steps:</p>

<ol>
	<li>The exploded WAR file should be copied (manually) over to all the GSMs deploy directory. The default location is <tt>GSRoot/deploy</tt>.</li>
	<li>A deploy command is issued with the processing unit name (the name of the directory under the deploy directory).</li>
	<li>The GSM decides (based on the SLA) how many instances of the web application needs to be deployed, and deploys them to the available GSCs.</li>
	<li>Each GSC that is supposed to run an instance of the web application, downloads the web application into its own local file system. By default, it downloads it into <tt>GSRoot/work/deployed-processing-units/[processing unit name]&#95;[unique identifier]</tt>.</li>
	<li>The appropriate web container is configured to run the web application using the local file system location.</li>
</ol>


<p><img class="emoticon" src="images/icons/emoticons/lightbulb_on.gif" height="16" width="16" align="absmiddle" alt="" border="0"/> The directory where the web applications are extracted (up to the <tt>work</tt> directory) on the GSC side can be controlled using the <b><tt>com.gs.work</tt></b> system property.</p>

<p><img class="emoticon" src="images/icons/emoticons/lightbulb_on.gif" height="16" width="16" align="absmiddle" alt="" border="0"/> The deploy directory location (up to the <tt>deploy</tt> directory) used on the GSM side can be controlled using the <b><tt>com.gs.deploy</tt></b> system property.</p>

<h1><a name="WebProcessingUnitContainer-WebApplicationStructure"></a>Web Application Structure</h1>

<p>A Web Application deployed into the Service Grid is, at the end of the day, just another type of a processing unit. This means that it inherits all the options that a processing unit has, among which is that it can follow the <a href="The Processing Unit Structure and Configuration.html" title="The Processing Unit Structure and Configuration">Processing Unit Directory Structure</a>.</p>

<p>A pure web application is also supported, meaning that web application is a special case of a processing unit, and adds additional features on top of it. The most important one is supporting the web application format (actually inherited from the web container used). Naturally, this means that <tt>WEB-INF/classes</tt> and <tt>WEB-INF/lib</tt> are supported.</p>

<div class='panelMacro'><table class='noteMacro'><colgroup><col width='24'><col></colgroup><tr><td valign='top'><img src="images/icons/emoticons/warning.gif" width="16" height="16" align="absmiddle" alt="" border="0"></td><td>In 6.x, the <tt>shared-lib</tt> directory was used to store Space entry class definitions. In version 7.0 you no longer have to use it, and can locate all jar files and classes (including space entry classes) in the standard <tt>WEB-INF/classes</tt> or <tt>WEB-INF/lib</tt> directories.</td></tr></table></div>

<h1><a name="WebProcessingUnitContainer-ClassLoaders"></a>Class Loaders</h1>

<p>Here is the structure of the class loaders when several web applications are deployed on the Service Grid:</p>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">Bootstrap (Java)
                  |
               <span class="code-object">System</span> (Java)
                  |
               Common (Service Grid)
                  |
            JEE Container
             /        \
        WebApp1     WebApp2</pre>
</div></div>

<p>The following table shows which user controlled locations end up in which class loader, and the important JAR files that exist within each one:</p>

<table class='confluenceTable'><tbody>
<tr>
<th class='confluenceTh'>Class Loader</th>
<th class='confluenceTh'>User Locations</th>
<th class='confluenceTh'>Built in Jar Files</th>
</tr>
<tr>
<td class='confluenceTd'>Common</td>
<td class='confluenceTd'>[GSRoot]/lib/platform/ext/&#42;.jar</td>
<td class='confluenceTd'>gs-rungime.jar</td>
</tr>
<tr>
<td class='confluenceTd'>JEE Container</td>
<td class='confluenceTd'>JEE container specific jars</td>
<td class='confluenceTd'>[GSRoot]/lib/platform/jetty/&#42;.jar</td>
</tr>
<tr>
<td class='confluenceTd'>Webapp</td>
<td class='confluenceTd'>[PU]/WEB-INF/classes, [PU]/WEB-INF/lib/&#42;.jar</td>
<td class='confluenceTd'>gs-openspaces.jar, spring/&#42;.jar</td>
</tr>
</tbody></table>

<p>The idea behind the class loaders is to create a completely self sufficient web application. All relevant jar files or classes should exists within the web application (as if running it standalone) and then deploying it into the Service Grid will be a seamless experience.</p>

<p>A special case happen with <tt>gs-rumtime.jar</tt> which is automatically removed from <tt>WEB-INF/lib</tt> if it exists there since it has already been defined in the common class loader.</p>

<p>In terms of class loader delegation model, the web application class loader uses a parent last delegation mode. This means that the web application will first try and load classes from its own class loader, and only if they are not found, will delegate up to the parent class loader. This is the recommended way to work with this class loader model.</p>

<div class='panelMacro'><table class='noteMacro'><colgroup><col width='24'><col></colgroup><tr><td valign='top'><img src="images/icons/emoticons/warning.gif" width="16" height="16" align="absmiddle" alt="" border="0"></td><td>Where has the Service Class Loader gone? The Service Class Loader is still used in order to load the JEE container, but it is hidden from the user. The web application class loader is created with its parent class loader being the JEE container specific class loader and not the Service Class loader. Users should not worry in this case about the Service Class Loader and how it is used, as the above class loader model provides exactly the same semantics as a plain web container class loader model.</td></tr></table></div>

<div class='panelMacro'><table class='noteMacro'><colgroup><col width='24'><col></colgroup><tr><td valign='top'><img src="images/icons/emoticons/warning.gif" width="16" height="16" align="absmiddle" alt="" border="0"></td><td>The JEE Class Loader is created lazily when the first web application deployed into the GSC. This allows not to incur the overhead of creating it when using non web processing units. There can also be several JEE class loaders per web container type, allowing to support both jetty and tomcat (for example) in the future quite easily.</td></tr></table></div>

<h1><a name="WebProcessingUnitContainer-BootstrapContextListener"></a>Bootstrap Context Listener</h1>

<p>When deploying a web application onto GigaSpaces Service Grid the <tt>web.xml</tt> of the web application will be automatically changed to include a <tt>BootstrapWebApplicationContextListener</tt>. The Bootstrap Context Listener provides the following services:</p>

<ul>
	<li>It will automatically put the <tt>ClusterInfo</tt> and <tt>BeanLevelProperties</tt> that the system was deployed with into the web application <tt>ServletContext</tt>. The <tt>ClusterInfo</tt> class will be put under a context attribute <tt>clusterInfo</tt>, and the <tt>BeanLevelProperties</tt> will be put under a context attribute named <tt>beanLevelProperties</tt>.</li>
</ul>


<ul>
	<li>If there is a <tt>META-INF/spring/pu.xml</tt>, it will load it using Spring (that is why the spring and openspaces jars are automatically added to the web application class loader). The <tt>ApplicationContext</tt> created is put in the Servlet Context under an attribute named <tt>applicationContext</tt>. All the beans defined within the <tt>META-INF/spring/pu.xml</tt> will be put in the Servlet Context as well. Each bean name will be the attribute name, and each bean will be the attribute context value.</li>
</ul>


<ul>
	<li>If there is a <tt>org.springframework.web.context.ContextLoaderListener</tt> it will automatically be replaced with <tt>ProcessingUnitContextLoaderListener</tt>. The <tt>ProcessingUnitContextLoaderListener</tt> is exactly the same as the Spring one, except for the fact that it uses the (optional) Application Context loaded from the <tt>META-INF/spring/pu.xml</tt> as the parent of the created Application Context. It will also add the <tt>ClusterInfo</tt> and <tt>BeanLevelProperties</tt> post processors to the created Application Context so they can be injected to any bean requiring it (such as the embedded Space bean).</li>
</ul>


<h1><a name="WebProcessingUnitContainer-UsingaSpace"></a>Using a Space</h1>

<p>There are several ways that a Space (and other components) can be used, and configured within a web application. Some common scenarios are listed below.</p>

<h2><a name="WebProcessingUnitContainer-PureRemoteSpace"></a>Pure Remote Space</h2>

<p>A typical usage pattern is connecting remotely to a Space. Here is an example (either using Spring within the web application Spring context file, or using pure Java code):</p>


<div class="panel" style="background-color: #FFFFFF;border-color: #3C78B5;border-style: solid;border-width: 1px;"><div class="panelContent" style="background-color: #FFFFFF;">
<h5><a name="WebProcessingUnitContainer-SpringNamespace"></a>Spring Namespace</h5>
<hr 
 size="1" 
 color="#3C78B5" 
 >

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-xml"><span class="code-tag">&lt;os-core:space id=<span class="code-quote">"space"</span> url=<span class="code-quote">"jini://*/*/space"</span> /&gt;</span>
<span class="code-tag">&lt;os-core:giga-space id=<span class="code-quote">"gigaSpace"</span> space=<span class="code-quote">"space"</span>/&gt;</span></pre>
</div></div> 


<h5><a name="WebProcessingUnitContainer-SpringPlainXML"></a>Spring Plain XML</h5>
<hr 
 size="1" 
 color="#3C78B5" 
 >

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-xml"><span class="code-tag">&lt;bean id=<span class="code-quote">"space"</span> class=<span class="code-quote">"org.openspaces.core.space.UrlSpaceFactoryBean"</span>&gt;</span>
    <span class="code-tag">&lt;property name=<span class="code-quote">"url"</span> value=<span class="code-quote">"jini://*/*/space"</span> /&gt;</span>
<span class="code-tag">&lt;/bean&gt;</span>
<span class="code-tag">&lt;bean id=<span class="code-quote">"gigaSpace"</span> class=<span class="code-quote">"org.openspaces.core.GigaSpaceFactoryBean"</span>&gt;</span>
	<span class="code-tag">&lt;property name=<span class="code-quote">"space"</span> ref=<span class="code-quote">"space"</span> /&gt;</span>
<span class="code-tag">&lt;/bean&gt;</span></pre>
</div></div> 


<h5><a name="WebProcessingUnitContainer-Code"></a>Code</h5>
<hr 
 size="1" 
 color="#3C78B5" 
 >

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">UrlSpaceConfigurer spaceConfigurer = <span class="code-keyword">new</span> UrlSpaceConfigurer(<span class="code-quote">"/./space"</span>);

GigaSpace gigaSpace = <span class="code-keyword">new</span> GigaSpaceConfigurer(spaceConfigurer).gigaSpace();

<span class="code-comment">// ...
</span>
<span class="code-comment">// shutting down / closing the Space
</span>spaceConfigurer.destroy();</pre>
</div></div>
</div></div>

<h2><a name="WebProcessingUnitContainer-Usingpu.xml"></a>Using pu.xml</h2>

<p>A web application is still just a processing unit. This means that a <b>META-INF/spring/pu.xml</b> can be added, which can be used to define a <a href="The Space Component.html" title="The Space Component">Space</a> and <a href="The GigaSpace Interface.html" title="The GigaSpace Interface">GigaSpace</a>. Accessing the beans is relatively simple as they are automatically added to the web application context and can be accessed from there. The key they are stored under is the bean id that each bean corresponds to.</p>

<p>Here is an example that starts an embedded Space as part of the web application within the <tt>pu.xml</tt>. The following is the content of the <tt>pu.xml</tt></p>


<div class="panel" style="background-color: #FFFFFF;border-color: #3C78B5;border-style: solid;border-width: 1px;"><div class="panelContent" style="background-color: #FFFFFF;">
<h5><a name="WebProcessingUnitContainer-SpringNamespace"></a>Spring Namespace</h5>
<hr 
 size="1" 
 color="#3C78B5" 
 >

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-xml"><span class="code-tag">&lt;os-core:space id=<span class="code-quote">"space"</span> url=<span class="code-quote">"/./space"</span> /&gt;</span>
<span class="code-tag">&lt;os-core:giga-space id=<span class="code-quote">"gigaSpace"</span> space=<span class="code-quote">"space"</span>/&gt;</span>
<span class="code-tag">&lt;os-core:giga-space id=<span class="code-quote">"clusteredGigaSpace"</span> space=<span class="code-quote">"space"</span> clustered=<span class="code-quote">"true"</span>/&gt;</span></pre>
</div></div> 


<h5><a name="WebProcessingUnitContainer-SpringPlainXML"></a>Spring Plain XML</h5>
<hr 
 size="1" 
 color="#3C78B5" 
 >

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-xml"><span class="code-tag">&lt;bean id=<span class="code-quote">"space"</span> class=<span class="code-quote">"org.openspaces.core.space.UrlSpaceFactoryBean"</span>&gt;</span>
    <span class="code-tag">&lt;property name=<span class="code-quote">"url"</span> value=<span class="code-quote">"/./space"</span> /&gt;</span>
<span class="code-tag">&lt;/bean&gt;</span>
<span class="code-tag">&lt;bean id=<span class="code-quote">"gigaSpace"</span> class=<span class="code-quote">"org.openspaces.core.GigaSpaceFactoryBean"</span>&gt;</span>
	<span class="code-tag">&lt;property name=<span class="code-quote">"space"</span> ref=<span class="code-quote">"space"</span> /&gt;</span>
<span class="code-tag">&lt;/bean&gt;</span>
<span class="code-tag">&lt;bean id=<span class="code-quote">"clusteredGigaSpace"</span> class=<span class="code-quote">"org.openspaces.core.GigaSpaceFactoryBean"</span>&gt;</span>
	<span class="code-tag">&lt;property name=<span class="code-quote">"space"</span> ref=<span class="code-quote">"space"</span> /&gt;</span>
	<span class="code-tag">&lt;property name=<span class="code-quote">"clustered"</span> ref=<span class="code-quote">"true"</span> /&gt;</span>
<span class="code-tag">&lt;/bean&gt;</span></pre>
</div></div>
</div></div>

<p>Here is an example of a simple JSP that uses it:</p>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">GigaSpace gigaSpace = (GigaSpace) getServletContext().getAttribute(<span class="code-quote">"clusteredGigaSpace"</span>);</pre>
</div></div>

<h1><a name="WebProcessingUnitContainer-EmbeddedSpace"></a>Embedded Space</h1>

<p>The previous section described several options of how to start an embedded Space within the web application. The recommended way to work with embedded Space, is to work with its clustered proxy (the <tt>clustered</tt> flag in GigaSpace set to <tt>true</tt>) for interactions that originate from a web request. This is mainly since the load balancer does not know about routing specific classes to each cluster member.</p>

<p>Note, event driven operations should still work with non clustered embedded Space (usually). For example, a web request that results in writing an Order (using the clustered proxy) to the Space, and a polling container that picks it up and processes it asynchronously. The polling container should work with the non clustered, collocated, proxy of the cluster member space.</p>

<h1><a name="WebProcessingUnitContainer-LoadBalancer"></a>Load Balancer</h1>

<p>When deploying a highly available web site, usually a load balancer is used to load balance requests between at least two instances of a web container that actually runs the web application. When using GigaSpaces in order to deploy a web application, running more than one instance of a web application becomes a snap, as well as the manageability and virtualized nature of running web applications.</p>

<p>In order to create a single point of view, in terms of clients connecting to a server, a load balancer is usually used. While there are many different types of load balancers (both hardware and software), solving the load balancing problem is not new (i.e. it is not something that is introduced because the web application is deployed on GigaSpaces). Examples of how to configure load balancers can be found in specific web container sections.</p>

<p>GigaSpaces also comes with a built in integration with Apache httpd load balancer as described in the <a href="Apache Load Balancer Agent.html" title="Apache Load Balancer Agent">Apache Load Balancer Agent</a> section.</p>

                     </td>
</tr>
</table>
<table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr>
<td height="12" background="http://www.gigaspaces.com/wiki/images/border/border_bottom.gif"><img src="images/border/spacer.gif" width="1" height="1" border="0"/></td>
</tr>
<tr>
<td align="center"><font color="grey"><a href="http://www.gigaspaces.com">GigaSpaces.com</a> -
		<a href="http://www.gigaspaces.com/wiki/x/xwBmAg" class="smalltext">Legal Notice</a> -
		<a href="http://www.gigaspaces.com/wiki/x/xgBmAg" class="smalltext">3rd Party Licenses</a> -
		<a href="http://www.gigaspaces.com/wiki/x/BQFmAg" class="smalltext">Site Map</a> -
		<a href="http://www.gigaspaces.com/wiki/display/API/API+Documentation+Portal" class="version-link">API Docs</a> -
		<a href="http://forum.openspaces.org/forum.jspa?forumID=175" class="version-link">Forum</a> -
		<a href="http://www.gigaspaces.com/LatestProductVersion" class="version-link">Downloads</a> -
		<a href="http://blog.gigaspaces.com/" class="version-link">Blog</a> -
		<a href="http://www.gigaspaces.com/os_papers.html" class="version-link">White Papers</a> -
		<a href="mailto:techw@gigaspaces.com">Contact Tech Writing</a> -
		<i><a href="http://www.atlassian.com/software/confluence">Gen. by Atlassian Confluence</a></i></font></td>
</tr>
</table>
     </body>
</html>
