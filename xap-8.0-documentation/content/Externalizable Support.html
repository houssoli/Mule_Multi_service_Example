<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
     <head>
         <title>XAP 8.0 Documentation : Externalizable Support</title>
<link rel="stylesheet" href="styles/site.css" type="text/css" />
         <META http-equiv="Content-Type" content="text/html; charset=UTF-8">
		 <style>
.back-to {
	color: #666666;
	font-weight: bold;
}	 
a.back-to:link, a.back-to:visited, a.back-to:hover, a.back-to:active  {
	color: #666666;
}	 
		 </style>
     </head>

     <body>
<table class="pagecontent" border="0" cellpadding="0" cellspacing="0" width="100%" bgcolor="#ffffff">
<tr>
<td valign="top" class="pagebody">
<div class="pageheader">
<span class="back-to">XAP 8.0 Documentation > <a href="index.html">Back to Table of Contents</a></span><br>
<h1>Externalizable Support</h1>
</div>
<br>



<div style="border-style:solid; border-color:#3C78B5; border-width:thin; padding-left:20px; padding-bottom:20px; padding-top:20px; padding-right:20px; background-color:#D8E4F1"> 

<p><b>Section Summary:</b>  Using Externalizable to boost remote space performance operations. </p>
</div>

<h1><a name="ExternalizableSupport-Overview"></a>Overview</h1>

<p>To solve the performance problems associated with a class serialization, the <tt>serialization</tt> mechanism allows you to declare that a class is <a href="http://java.sun.com/j2se/1.5.0/docs/api/index.html?java/io/Externalizable.html" target="_blank">Externalizable</a>. When the <tt>ObjectOutputStream writeObject()</tt> method is called, it performs the following sequence of actions:</p>
<ul>
	<li>Tests to see if the object is an instance of Externalizable. If so, it uses externalization to marshall the object.</li>
	<li>If the object isn't an instance of Externalizable, it tests to see whether the object is an instance of Serializable. If so, it uses serialization to marshall the object.  If neither of these two cases apply, an exception is thrown.</li>
</ul>


<p>Externalizable is an interface that consists of two methods:</p>
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java"><span class="code-keyword">public</span> void readExternal(ObjectInput in);
<span class="code-keyword">public</span> void writeExternal(ObjectOutput out);</pre>
</div></div>

<p>The Externalization mechanism writes out the identity of the class (which boils down to the name of the class and the appropriate <tt>serialVersionUID</tt>). It also stores the superclass structure and all the information about the class hierarchy. But instead of visiting each superclass and using it to store some of the state information, it simply calls <tt>writeExternal()</tt> on the local class definition. <br/>
The Externalization mechanism stores all the metadata, but writes out only the local instance information.</p>

<p>When using a POJO class with the space API, you may implement the Externalizable  mechanism. This can be done to control serialization and deserialization when the Object is sent to the space (e.g. write, update and execute Operations) and when it is sent back to the client (e.g. read and take operations). This will optimize the remote call when using Remote Space configuration for single, partitioned, and replicated space topologies <a href="Concepts.html#Concepts-ConceptsClusteringandTopologies">Space Runtime Modes</a>. </p>
<div class="indent20 inline" style="margin-left: 20px;"><style type="text/css">div.inline p:first-child { display: inline; }</style><p><img src="download/attachments/48235229/serialization2.jpg" align="absmiddle" border="0"/></p></div>

<div class='panelMacro'><table class='tipMacro'><colgroup><col width='24'><col></colgroup><tr><td valign='top'><img src="images/icons/emoticons/check.gif" width="16" height="16" align="absmiddle" alt="" border="0"></td><td>Externalizable is supported with the Native <a href="Controlling Serialization.html" title="Controlling Serialization">Serialization mode</a>.</td></tr></table></div>

<div class='panelMacro'><table class='tipMacro'><colgroup><col width='24'><col></colgroup><tr><td valign='top'><img src="images/icons/emoticons/check.gif" width="16" height="16" align="absmiddle" alt="" border="0"></td><td>For more details on serialization, refer to:
<ul>
	<li><a href="http://java.sys-con.com/read/44199.htm">JDJ - Java Serialization</a></li>
	<li><a href="http://www.mactech.com/articles/mactech/Vol.14/14.04/JavaSerialization/index.html">MachTech - Java Serialization</a></li>
	<li><a href="http://www.onjava.com/pub/a/onjava/excerpt/JavaRMI_10/index.html?page=1">OnJava.com - Java RMI: Serialization</a></li>
</ul>
</td></tr></table></div> 

<h1><a name="ExternalizableSupport-Example"></a>Example</h1>
<h2><a name="ExternalizableSupport-SpaceDomainPOJOMessageClass"></a>Space Domain POJO Message Class </h2>
<p>Here is a simple POJO class:</p>
<div class="code panel" style="border-width: 1px;"><div class="codeHeader panelHeader" style="border-bottom-width: 1px;"><b>Message</b></div><div class="codeContent panelContent">
<pre class="code-java"><span class="code-keyword">package</span> com.j_spaces.examples.benchmark;

<span class="code-keyword">import</span> java.io.Externalizable;
<span class="code-keyword">import</span> java.io.IOException;
<span class="code-keyword">import</span> java.io.ObjectInput;
<span class="code-keyword">import</span> java.io.ObjectOutput;
<span class="code-keyword">import</span> java.util.ArrayList;
<span class="code-keyword">import</span> java.util.Calendar;
<span class="code-keyword">import</span> java.util.GregorianCalendar;
<span class="code-keyword">import</span> com.gigaspaces.annotation.pojo.*;


@SpaceClass
<span class="code-keyword">public</span> class Message {
	<span class="code-keyword">private</span> <span class="code-keyword">static</span> <span class="code-keyword">final</span> <span class="code-object">long</span> serialVersionUID = 1L;
	
	<span class="code-keyword">private</span> <span class="code-object">byte</span>[] content;
	<span class="code-keyword">private</span> <span class="code-object">Long</span> counter;
	<span class="code-keyword">private</span> ArrayList&lt;GregorianCalendar&gt; list;

	<span class="code-keyword">public</span> <span class="code-object">byte</span>[] getContent()
	{
		<span class="code-keyword">return</span> content;
	}
	
	<span class="code-keyword">public</span> void setContent(<span class="code-object">byte</span>[] content)
	{
		<span class="code-keyword">this</span>.content = content;
		generateData(10);
	}

	@SpaceIndex (type=SpaceIndexType.BASIC)
	<span class="code-object">Long</span> getCounter()
	{
		<span class="code-keyword">return</span> counter;
	}
	
	<span class="code-keyword">public</span> void setCounter(<span class="code-object">Long</span> counter)
	{
		<span class="code-keyword">this</span>.counter = counter;
	}
	
	<span class="code-keyword">public</span> ArrayList&lt;GregorianCalendar&gt; getList()
	{
		<span class="code-keyword">return</span> list;
	}
	<span class="code-keyword">public</span> void setList(ArrayList&lt;GregorianCalendar&gt; list)
	{
		<span class="code-keyword">this</span>.list = list;
	}

	<span class="code-keyword">public</span> Message () {
	}

	<span class="code-keyword">public</span> Message (<span class="code-object">long</span> initVal, <span class="code-object">byte</span>[] content) {
		content = content;
		counter = initVal;
		<span class="code-keyword">if</span> (content !=<span class="code-keyword">null</span>)
			generateData(10);
	}

	<span class="code-keyword">public</span> void generateData(<span class="code-object">int</span> capacity) {
		<span class="code-keyword">if</span> (capacity &gt; 0) {
			list = <span class="code-keyword">new</span> ArrayList&lt;GregorianCalendar&gt;(capacity);
			<span class="code-keyword">for</span> (<span class="code-object">int</span> i = 0; i &lt; capacity; i++) {
				<span class="code-object">int</span> year = (<span class="code-object">int</span>) (<span class="code-object">Math</span>.random() * 2000);
				<span class="code-object">int</span> month = (<span class="code-object">int</span>) (<span class="code-object">Math</span>.random() * 12);
				<span class="code-object">int</span> day = (<span class="code-object">int</span>) (<span class="code-object">Math</span>.random() * 31);
				list.add(i, <span class="code-keyword">new</span> GregorianCalendar(year, month, day));
			}
		}
	}



	@Override
	<span class="code-keyword">public</span> <span class="code-object">String</span> toString() {
		<span class="code-keyword">return</span> getClass() + <span class="code-quote">"_"</span> + counter + <span class="code-quote">"_"</span> + content;
	}

}</pre>
</div></div>

<h2><a name="ExternalizableSupport-SpaceDomainPOJOMessageClassImplementsExternalizable"></a>Space Domain POJO Message Class Implements Externalizable</h2>
<p>Here is the same class with the Externalizable interface implemented.<br/>
See how the <tt>list</tt> field that is <tt>ArrayList&lt;GregorianCalendar&gt;</tt> is serialized and deserialized:</p>

<div class="code panel" style="border-width: 1px;"><div class="codeHeader panelHeader" style="border-bottom-width: 1px;"><b>Message</b></div><div class="codeContent panelContent">
<pre class="code-java"><span class="code-keyword">package</span> com.j_spaces.examples.benchmark;

<span class="code-keyword">import</span> java.io.Externalizable;
<span class="code-keyword">import</span> java.io.IOException;
<span class="code-keyword">import</span> java.io.ObjectInput;
<span class="code-keyword">import</span> java.io.ObjectOutput;
<span class="code-keyword">import</span> java.util.ArrayList;
<span class="code-keyword">import</span> java.util.Calendar;
<span class="code-keyword">import</span> java.util.GregorianCalendar;
<span class="code-keyword">import</span> com.gigaspaces.annotation.pojo.*;

@SpaceClass
<span class="code-keyword">public</span> class Message <span class="code-keyword">implements</span> Externalizable {
	<span class="code-keyword">private</span> <span class="code-keyword">static</span> <span class="code-keyword">final</span> <span class="code-object">long</span> serialVersionUID = 1L;

	<span class="code-keyword">private</span> <span class="code-object">byte</span>[] content;
	<span class="code-keyword">private</span> <span class="code-object">Long</span> counter;
	<span class="code-keyword">private</span> ArrayList&lt;GregorianCalendar&gt; list;

	<span class="code-keyword">public</span> <span class="code-object">byte</span>[] getContent()
	{
		<span class="code-keyword">return</span> content;
	}
	
	<span class="code-keyword">public</span> void setContent(<span class="code-object">byte</span>[] content)
	{
		<span class="code-keyword">this</span>.content = content;
		generateData(10);
	}


	@SpaceIndex (type=SpaceIndexType.BASIC)
	<span class="code-object">Long</span> getCounter()
	{
		<span class="code-keyword">return</span> counter;
	}
	
	<span class="code-keyword">public</span> void setCounter(<span class="code-object">Long</span> counter)
	{
		<span class="code-keyword">this</span>.counter = counter;
	}
	
	<span class="code-keyword">public</span> ArrayList&lt;GregorianCalendar&gt; getList()
	{
		<span class="code-keyword">return</span> list;
	}
	<span class="code-keyword">public</span> void setList(ArrayList&lt;GregorianCalendar&gt; list)
	{
		<span class="code-keyword">this</span>.list = list;
	}
	
	<span class="code-keyword">public</span> Message() {
	}

	<span class="code-keyword">public</span> Message(<span class="code-object">long</span> initVal, <span class="code-object">byte</span>[] content) {
		content = content;
		counter = initVal;
		<span class="code-keyword">if</span> (content !=<span class="code-keyword">null</span>)
			generateData(10);
	}

	<span class="code-keyword">public</span> void writeExternal(ObjectOutput out) <span class="code-keyword">throws</span> IOException {
		<span class="code-keyword">if</span> (counter == <span class="code-keyword">null</span>)
			out.writeLong(0);
		<span class="code-keyword">else</span>
			out.writeLong(counter);
		
		<span class="code-keyword">if</span> (content != <span class="code-keyword">null</span> )
		{
			out.writeInt(content.length);
			out.write(content ,0, content.length);
		}
		<span class="code-keyword">else</span>
		{
			out.writeInt(0);
		}
			
		<span class="code-keyword">if</span> (list != <span class="code-keyword">null</span>) {
			out.writeBoolean(<span class="code-keyword">true</span>);
			out.writeInt(list.size());
			<span class="code-keyword">for</span> (GregorianCalendar date : list) {
				out.writeInt(date.get(Calendar.YEAR));
				out.writeInt(date.get(Calendar.MONTH));
				out.writeInt(date.get(Calendar.DAY_OF_MONTH));
			}
		} <span class="code-keyword">else</span> {
			out.writeBoolean(<span class="code-keyword">false</span>);
		}
	}

	<span class="code-keyword">public</span> void readExternal(ObjectInput in) <span class="code-keyword">throws</span> IOException,
			ClassNotFoundException {
		counter = (<span class="code-object">Long</span>) in.readLong();
		<span class="code-object">Integer</span> content_length =in.readInt(); 
		<span class="code-keyword">if</span> (content_length &gt;0) 
		{

			content = <span class="code-keyword">new</span> <span class="code-object">byte</span>[content_length.intValue()];
			in.read(content, 0 , content_length.intValue());
		}
		<span class="code-object">boolean</span> islist = in.readBoolean();
		<span class="code-keyword">if</span> (islist )
		{
			<span class="code-object">int</span> capacity = (<span class="code-object">Integer</span>) in.readInt();
			list = <span class="code-keyword">new</span> ArrayList&lt;GregorianCalendar&gt;(capacity);
			<span class="code-keyword">for</span> (<span class="code-object">int</span> i = 0; i &lt; capacity; i++) {
				<span class="code-object">int</span> year = in.readInt();
				<span class="code-object">int</span> month = in.readInt();
				<span class="code-object">int</span> day = in.readInt();
				list.add(i, <span class="code-keyword">new</span> GregorianCalendar(year, month, day));
			}
		}
	}

	<span class="code-keyword">public</span> void generateData(<span class="code-object">int</span> capacity) {
		<span class="code-keyword">if</span> (capacity &gt; 0) {
			list = <span class="code-keyword">new</span> ArrayList&lt;GregorianCalendar&gt;(capacity);
			<span class="code-keyword">for</span> (<span class="code-object">int</span> i = 0; i &lt; capacity; i++) {
				<span class="code-object">int</span> year = (<span class="code-object">int</span>) (<span class="code-object">Math</span>.random() * 2000);
				<span class="code-object">int</span> month = (<span class="code-object">int</span>) (<span class="code-object">Math</span>.random() * 12);
				<span class="code-object">int</span> day = (<span class="code-object">int</span>) (<span class="code-object">Math</span>.random() * 31);
				list.add(i, <span class="code-keyword">new</span> GregorianCalendar(year, month, day));
			}
		}
	}


	@Override
	<span class="code-keyword">public</span> <span class="code-object">String</span> toString() {
		<span class="code-keyword">return</span> getClass() + <span class="code-quote">"_"</span> + counter + <span class="code-quote">"_"</span> + content;
	}
}</pre>
</div></div>

<h1><a name="ExternalizableSupport-PerformanceTestsResults"></a>Performance Tests Results</h1>

<p><img src="download/attachments/48235229/externa1.bmp" align="absmiddle" border="0"/></p>

<p><img src="download/attachments/48235229/externa2.bmp" align="absmiddle" border="0"/></p>

                     </td>
</tr>
</table>
<table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr>
<td height="12" background="http://www.gigaspaces.com/wiki/images/border/border_bottom.gif"><img src="images/border/spacer.gif" width="1" height="1" border="0"/></td>
</tr>
<tr>
<td align="center"><font color="grey"><a href="http://www.gigaspaces.com">GigaSpaces.com</a> -
		<a href="http://www.gigaspaces.com/wiki/x/xwBmAg" class="smalltext">Legal Notice</a> -
		<a href="http://www.gigaspaces.com/wiki/x/xgBmAg" class="smalltext">3rd Party Licenses</a> -
		<a href="http://www.gigaspaces.com/wiki/x/BQFmAg" class="smalltext">Site Map</a> -
		<a href="http://www.gigaspaces.com/wiki/display/API/API+Documentation+Portal" class="version-link">API Docs</a> -
		<a href="http://forum.openspaces.org/forum.jspa?forumID=175" class="version-link">Forum</a> -
		<a href="http://www.gigaspaces.com/LatestProductVersion" class="version-link">Downloads</a> -
		<a href="http://blog.gigaspaces.com/" class="version-link">Blog</a> -
		<a href="http://www.gigaspaces.com/os_papers.html" class="version-link">White Papers</a> -
		<a href="mailto:techw@gigaspaces.com">Contact Tech Writing</a> -
		<i><a href="http://www.atlassian.com/software/confluence">Gen. by Atlassian Confluence</a></i></font></td>
</tr>
</table>
     </body>
</html>
