<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
     <head>
         <title>XAP 8.0 Documentation : Mule Queue Provider</title>
<link rel="stylesheet" href="styles/site.css" type="text/css" />
         <META http-equiv="Content-Type" content="text/html; charset=UTF-8">
		 <style>
.back-to {
	color: #666666;
	font-weight: bold;
}	 
a.back-to:link, a.back-to:visited, a.back-to:hover, a.back-to:active  {
	color: #666666;
}	 
		 </style>
     </head>

     <body>
<table class="pagecontent" border="0" cellpadding="0" cellspacing="0" width="100%" bgcolor="#ffffff">
<tr>
<td valign="top" class="pagebody">
<div class="pageheader">
<span class="back-to">XAP 8.0 Documentation > <a href="index.html">Back to Table of Contents</a></span><br>
<h1>Mule Queue Provider</h1>
</div>
<br>

<script type='text/javascript'>//<![CDATA[
function debug() { }
// ]]></script><script type='text/javascript' src='/wiki/download/resources/net.customware.confluence.plugin.composition:composition-setup/js/browser.js'>//<![CDATA[
// ]]></script><script type='text/javascript' src='/wiki/download/resources/net.customware.confluence.plugin.composition:composition-setup/js/behaviour.js'>//<![CDATA[
// ]]></script><script type='text/javascript' src='/wiki/download/resources/net.customware.confluence.plugin.composition:composition-setup/js/memory.js'>//<![CDATA[
// ]]></script><script type='text/javascript' src='/wiki/download/resources/net.customware.confluence.plugin.composition:composition-setup/js/cloak.js'>//<![CDATA[
// ]]></script><script type='text/javascript'>//<![CDATA[
Cloak.closeHTML = "<img src=\'/wiki/download/resources/net.customware.confluence.plugin.composition:toggle-cloak/img/navigate_down_10.gif\'/>";
Cloak.openHTML = "<img src=\'/wiki/download/resources/net.customware.confluence.plugin.composition:toggle-cloak/img/navigate_right_10.gif\'/>";
Cloak.toggleZone = true;
Cloak.memoryDuration = 0;
Cloak.memoryPrefix = "contentId:53903812";
Cloak.memoryPath = "/wiki/";
// ]]></script><style type='text/css'>
.cloakToggle { /* Definition for state toggling image */
cursor:hand;
cursor:pointer;
}
</style><script type='text/javascript' src='/wiki/download/resources/net.customware.confluence.plugin.composition:composition-setup/js/transitions.js'>//<![CDATA[
// ]]></script><script type='text/javascript' src='/wiki/download/resources/net.customware.confluence.plugin.composition:composition-setup/js/deck.js'>//<![CDATA[
// ]]></script><link rel='stylesheet' type='text/css'  href='/wiki/styles/main-action.css?pluginCompleteKey=net.customware.confluence.plugin.composition:composition-setup&stylesheetName=deck&spaceKey=XAP8'/><script type='text/javascript'>//<![CDATA[
Deck.memoryDuration = 0;
Deck.memoryPrefix = "contentId:53903812";
Deck.memoryPath = "/wiki/";
// ]]></script>


<div style="border-style:solid; border-color:#3C78B5; border-width:thin; padding-left:20px; padding-bottom:20px; padding-top:20px; padding-right:20px; background-color:#D8E4F1"> 

<p><b>Section Summary:</b>  The OpenSpaces queue provider is used for internal space-based communication between services managed by Mule. </p>
</div>

<h1><a name="MuleQueueProvider-Overview"></a>Overview</h1>

<p>The OpenSpaces queue provider is equivalent to the Mule VM provider&#42;**  and is used for internal communication between services managed by Mule based on the Space. By storing internal Mule messages in the Space using a virtualized queue, inter-service communication becomes highly available and fault-tolerant (in a primary-backup topology).</p>

<p>When working with Mule and the OpenSpaces Mule integration, each Mule instance can participate in a Space cluster by starting an embedded Space which is a cluster member within the cluster. In this scenario, the queues are actually stored only in the relevant cluster member. In a primary-backup topology, this means that the queue content (the relevant messages that are passed between services) are backed up to the relevant cluster backup member.</p>

<p>In this case, when the primary instance fails, the backup takes over and become primary, allowing services to continue and process messages without losing any data.</p>

<p><img class="emoticon" src="images/icons/emoticons/warning.gif" height="16" width="16" align="absmiddle" alt="" border="0"/> In such a scenario, the backup services probably shouldn't run at all and should start processing only in case of failover. In order to configure the SEDA services to be aware of the current space state of the cluster member they are working against, see the <a href="Mule SEDA Model.html" title="Mule SEDA Model">Mule SEDA Model</a> section.</p>

<p>In order to use the OpenSpaces queue provider, the following namespaces should be defined:</p>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-xml">&lt;mule xmlns="
...
<span class="code-keyword">xmlns:os-queue</span>=http://www.openspaces.org/schema/mule/os-queue

xsi:schemaLocation="...
http://www.openspaces.org/schema/mule/os-queue http://www.openspaces.org/schema/mule/mule-os-queue.xsd"&gt;</pre>
</div></div>

<h1><a name="MuleQueueProvider-Connector"></a>Connector</h1>

<p>The OpenSpaces queue connector is used to define the Space this queue transport works against. It uses OpenSpaces <tt>GigaSpace</tt> bean in order to interact with the Space. Here is an example of how it can be defined:</p>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-xml"><span class="code-tag">&lt;spring:beans&gt;</span>
    <span class="code-tag">&lt;os-core:space id=<span class="code-quote">"space"</span> url=<span class="code-quote">"/./space"</span> /&gt;</span>

    <span class="code-tag">&lt;os-core:giga-space id=<span class="code-quote">"gigaSpace"</span> space=<span class="code-quote">"space"</span> /&gt;</span>
<span class="code-tag">&lt;/spring:beans&gt;</span>
<span class="code-tag">&lt;os-queue:connector name=<span class="code-quote">"queueConnector"</span> giga-space=<span class="code-quote">"gigaSpace"</span>  fifo=<span class="code-quote">"false"</span>  persistent=<span class="code-quote">"false"</span> /&gt;</span></pre>
</div></div>

<p>The <tt>giga-space</tt> attribute is optional and is used if only one <tt>GigaSpace</tt> bean is defined in the Spring application context. The <tt>fifo</tt> flag defines whether the messages works in a FIFO mode or not. The <tt>persistent</tt> flag defines whether the messages are backed up to an external data source (if configured) using the Space.</p>

<div class='panelMacro'><table class='tipMacro'><colgroup><col width='24'><col></colgroup><tr><td valign='top'><img src="images/icons/emoticons/check.gif" width="16" height="16" align="absmiddle" alt="" border="0"></td><td><b>All objects that end up being written to the space must be Serializable objects</b><br/>
For any adapters that wraps a non-Serializable object such as JMS , EMail, Servlet and anything that uses Streams make sure you use inbound transformer before serialization.</td></tr></table></div> 

<h1><a name="MuleQueueProvider-InboundComponent"></a>Inbound Component</h1>

<p>The OpenSpaces queue inbound component is very simple once the queue connector is set. Here is an example:</p>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-xml"><span class="code-tag">&lt;model&gt;</span>
    <span class="code-tag">&lt;service name=<span class="code-quote">"Appender1"</span>&gt;</span>

        <span class="code-tag">&lt;inbound-router&gt;</span>
            <span class="code-tag">&lt;os-queue:inbound-endpoint path=<span class="code-quote">"test1"</span>/&gt;</span>
        <span class="code-tag">&lt;/inbound-router&gt;</span>
        
        <span class="code-tag"><span class="code-comment">&lt;!-- outbound transport ... --&gt;</span></span>
    <span class="code-tag">&lt;/service&gt;</span>
<span class="code-tag">&lt;/model&gt;</span></pre>
</div></div>

<h1><a name="MuleQueueProvider-OutboundComponent"></a>Outbound Component</h1>

<p>The OpenSpaces queue outbound component is very simple to configure once the queue connector is set. Here is an example:</p>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-xml"><span class="code-tag">&lt;model&gt;</span>
    <span class="code-tag">&lt;service name=<span class="code-quote">"Appender1"</span>&gt;</span>

        <span class="code-tag"><span class="code-comment">&lt;!-- inbound transport ... --&gt;</span></span>

        <span class="code-tag">&lt;outbound-router&gt;</span>
        	<span class="code-tag">&lt;outbound-pass-through-router&gt;</span>
            	<span class="code-tag">&lt;os-queue:outbound-endpoint path=<span class="code-quote">"test2"</span>/&gt;</span>
            <span class="code-tag">&lt;/outbound-pass-through-router&gt;</span>
        <span class="code-tag">&lt;/outbound-router&gt;</span>
    <span class="code-tag">&lt;/service&gt;</span>
<span class="code-tag">&lt;/model&gt;</span></pre>
</div></div>

<h1><a name="MuleQueueProvider-TransactionSupport"></a>Transaction Support</h1>

<p>Operations performed on the Space when working with a virtualized queue are all performed using the <tt>GigaSpace</tt> bean. The <tt>GigaSpace</tt> bean supports <a href="The GigaSpace Interface.html#TheGigaSpaceInterface-penSpacesCoreComponentGigaSpaceDeclarativeTra...">declarative transactions</a> when working with Spring transaction managers. Mule can be configured to work with Spring transaction managers as due to its built-in transaction management strategy, which allows you to use OpenSpaces with <a href="Transaction Management.html" title="Transaction Management">different transaction managers</a>, including XA.</p>

<p>Here is an example of how to configure working with queues using the Space Local Transaction Manager:</p>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-xml"><span class="code-tag">&lt;spring:beans&gt;</span>
    <span class="code-tag">&lt;os-core:space id=<span class="code-quote">"space"</span> url=<span class="code-quote">"/./space"</span>/&gt;</span>

    <span class="code-tag">&lt;os-core:local-tx-manager id=<span class="code-quote">"transactionManager"</span> space=<span class="code-quote">"space"</span>/&gt;</span>

    <span class="code-tag">&lt;os-core:giga-space id=<span class="code-quote">"gigaSpace"</span> space=<span class="code-quote">"space"</span> tx-manager=<span class="code-quote">"transactionManager"</span>/&gt;</span>
    
    &lt;spring:bean id=<span class="code-quote">"transactionFactory"</span>
                 class=<span class="code-quote">"org.mule.extras.spring.transaction.SpringTransactionFactory"</span>&gt;
        <span class="code-tag">&lt;spring:property name=<span class="code-quote">"manager"</span>&gt;</span>
            <span class="code-tag">&lt;spring:ref bean=<span class="code-quote">"transactionManager"</span>/&gt;</span>
        <span class="code-tag">&lt;/spring:property&gt;</span>
    <span class="code-tag">&lt;/spring:bean&gt;</span>

<span class="code-tag">&lt;/spring:beans&gt;</span>

<span class="code-tag">&lt;model&gt;</span>
    <span class="code-tag">&lt;service name=<span class="code-quote">"Appender1"</span>&gt;</span>

        <span class="code-tag"><span class="code-comment">&lt;!-- inbound transport ... --&gt;</span></span>

        <span class="code-tag">&lt;outbound-router&gt;</span>
        	<span class="code-tag">&lt;outbound-pass-through-router&gt;</span>
            	<span class="code-tag">&lt;os-queue:outbound-endpoint path=<span class="code-quote">"test2"</span>/&gt;</span>
            <span class="code-tag">&lt;/outbound-pass-through-router&gt;</span>
        <span class="code-tag">&lt;/outbound-router&gt;</span>
    <span class="code-tag">&lt;/service&gt;</span>
<span class="code-tag">&lt;/model&gt;</span></pre>
</div></div>

<p>The above example defines a Mule <tt>transactionFactory</tt>, which is used to handle transactions within Mule. Since the <tt>giga-space</tt> bean is aware of it, any operations performed on it using the <tt>os-queue</tt> result in joining an existing transaction if one is in progress.</p>

<h1><a name="MuleQueueProvider-FullExample"></a>Full Example</h1>

<p>The example below will uses two components: <tt>Appender1</tt> and <tt>Appender2</tt>. The 2 services that wrap the components use the OpenSpaces queue transport as both the inbound and outbound transports.</p>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-xml"><span class="code-tag">&lt;?xml version=<span class="code-quote">"1.0"</span> encoding=<span class="code-quote">"UTF-8"</span>?&gt;</span>
&lt;mule xmlns=<span class="code-quote">"http://www.mulesource.org/schema/mule/core/2.0"</span>
      <span class="code-keyword">xmlns:os-events</span>=<span class="code-quote">"http://www.openspaces.org/schema/events"</span>
      <span class="code-keyword">xmlns:os-core</span>=<span class="code-quote">"http://www.openspaces.org/schema/core"</span>
      <span class="code-keyword">xmlns:xsi</span>=<span class="code-quote">"http://www.w3.org/2001/XMLSchema-instance"</span>
      <span class="code-keyword">xmlns:spring</span>=<span class="code-quote">"http://www.springframework.org/schema/beans"</span>
      <span class="code-keyword">xmlns:os-queue</span>=<span class="code-quote">"http://www.openspaces.org/schema/mule/os-queue"</span>
      <span class="code-keyword">xmlns:stdio</span>=<span class="code-quote">"http://www.mulesource.org/schema/mule/stdio/2.0"</span>

      xsi:schemaLocation="http://www.openspaces.org/schema/core http://www.openspaces.org/schema/core/openspaces-core.xsd
       http://www.openspaces.org/schema/events http://www.openspaces.org/schema/events/openspaces-events.xsd
       http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-2.0.xsd
       http://www.mulesource.org/schema/mule/core/2.0 http://www.mulesource.org/schema/mule/core/2.0/mule.xsd
       http://www.mulesource.org/schema/mule/stdio/2.0 http://www.mulesource.org/schema/mule/stdio/2.0/mule-stdio.xsd
       http://www.openspaces.org/schema/mule/os-queue http://www.openspaces.org/schema/mule/mule-os-queue.xsd"&gt;

    <span class="code-tag">&lt;spring:beans&gt;</span>
        <span class="code-tag">&lt;os-core:space id=<span class="code-quote">"space"</span> url=<span class="code-quote">"/./space"</span> lookup-groups=<span class="code-quote">"${user.name}"</span>/&gt;</span>

        <span class="code-tag">&lt;os-core:giga-space id=<span class="code-quote">"gigaSpace"</span> space=<span class="code-quote">"space"</span> /&gt;</span>
    <span class="code-tag">&lt;/spring:beans&gt;</span>

    <span class="code-tag"><span class="code-comment">&lt;!-- this connector must be declared ,in order to inject the  Spring appliction context --&gt;</span></span>
    <span class="code-tag">&lt;os-queue:connector name=<span class="code-quote">"queueConnector"</span> giga-space=<span class="code-quote">"gigaSpace"</span>   /&gt;</span>

    <span class="code-tag">&lt;model name=<span class="code-quote">"helloSample"</span>&gt;</span>

        <span class="code-tag">&lt;service name=<span class="code-quote">"Appender1"</span>&gt;</span>

            <span class="code-tag">&lt;inbound-router&gt;</span>
                <span class="code-tag">&lt;os-queue:inbound-endpoint path=<span class="code-quote">"test1"</span>/&gt;</span>
            <span class="code-tag">&lt;/inbound-router&gt;</span>

            <span class="code-tag">&lt;component class=<span class="code-quote">"test.EchoeComponentAppender"</span>/&gt;</span>

            <span class="code-tag">&lt;outbound-router&gt;</span>
                <span class="code-tag">&lt;outbound-pass-through-router&gt;</span>
                    <span class="code-tag">&lt;os-queue:outbound-endpoint path=<span class="code-quote">"test2"</span>/&gt;</span>
                <span class="code-tag">&lt;/outbound-pass-through-router&gt;</span>
            <span class="code-tag">&lt;/outbound-router&gt;</span>

        <span class="code-tag">&lt;/service&gt;</span>

        <span class="code-tag">&lt;service name=<span class="code-quote">"Appender2"</span>&gt;</span>
            <span class="code-tag">&lt;inbound-router&gt;</span>
                <span class="code-tag">&lt;os-queue:inbound-endpoint path=<span class="code-quote">"test2"</span>/&gt;</span>
            <span class="code-tag">&lt;/inbound-router&gt;</span>

            <span class="code-tag">&lt;component class=<span class="code-quote">"test.EchoeComponentAppender"</span>/&gt;</span>

            <span class="code-tag">&lt;outbound-router&gt;</span>
                <span class="code-tag">&lt;outbound-pass-through-router&gt;</span>
                    <span class="code-tag">&lt;os-queue:outbound-endpoint path=<span class="code-quote">"test3"</span>/&gt;</span>
                <span class="code-tag">&lt;/outbound-pass-through-router&gt;</span>
            <span class="code-tag">&lt;/outbound-router&gt;</span>
        <span class="code-tag">&lt;/service&gt;</span>
    <span class="code-tag">&lt;/model&gt;</span>
<span class="code-tag">&lt;/mule&gt;</span></pre>
</div></div>

<p>In order to complete the example, the <tt>MuleClient</tt> can be used to interact with the services.</p>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">muleClient.dispatch(<span class="code-quote">"os-queue:<span class="code-comment">//test1"</span>, <span class="code-quote">"testme"</span>, <span class="code-keyword">null</span>);
</span>
MuleMessage message = muleClient.request(<span class="code-quote">"os-queue:<span class="code-comment">//test3"</span>, 5000);</span></pre>
</div></div>

<p>The above code dispatches a message to a virtualized queue named <tt>test1</tt>. As a result, the <tt>Appender1</tt> service receives the message, processes it, and passes it to a virtualized queue named <tt>test2</tt>. In turn, the <tt>Appender2</tt> service receives the message, processes it, and sends it to a virtualized queue named <tt>test3</tt>. <tt>muleClient</tt> is used to receive a message from <tt>test3</tt> with a timeout of 5 seconds. This results in any receiving processed messages <tt>Appender2</tt> produces.</p>

<p>***Link required</p>

                     </td>
</tr>
</table>
<table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr>
<td height="12" background="http://www.gigaspaces.com/wiki/images/border/border_bottom.gif"><img src="images/border/spacer.gif" width="1" height="1" border="0"/></td>
</tr>
<tr>
<td align="center"><font color="grey"><a href="http://www.gigaspaces.com">GigaSpaces.com</a> -
		<a href="http://www.gigaspaces.com/wiki/x/xwBmAg" class="smalltext">Legal Notice</a> -
		<a href="http://www.gigaspaces.com/wiki/x/xgBmAg" class="smalltext">3rd Party Licenses</a> -
		<a href="http://www.gigaspaces.com/wiki/x/BQFmAg" class="smalltext">Site Map</a> -
		<a href="http://www.gigaspaces.com/wiki/display/API/API+Documentation+Portal" class="version-link">API Docs</a> -
		<a href="http://forum.openspaces.org/forum.jspa?forumID=175" class="version-link">Forum</a> -
		<a href="http://www.gigaspaces.com/LatestProductVersion" class="version-link">Downloads</a> -
		<a href="http://blog.gigaspaces.com/" class="version-link">Blog</a> -
		<a href="http://www.gigaspaces.com/os_papers.html" class="version-link">White Papers</a> -
		<a href="mailto:techw@gigaspaces.com">Contact Tech Writing</a> -
		<i><a href="http://www.atlassian.com/software/confluence">Gen. by Atlassian Confluence</a></i></font></td>
</tr>
</table>
     </body>
</html>
