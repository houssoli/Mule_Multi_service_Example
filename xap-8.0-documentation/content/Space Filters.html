<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
     <head>
         <title>XAP 8.0 Documentation : Space Filters</title>
<link rel="stylesheet" href="styles/site.css" type="text/css" />
         <META http-equiv="Content-Type" content="text/html; charset=UTF-8">
		 <style>
.back-to {
	color: #666666;
	font-weight: bold;
}	 
a.back-to:link, a.back-to:visited, a.back-to:hover, a.back-to:active  {
	color: #666666;
}	 
		 </style>
     </head>

     <body>
<table class="pagecontent" border="0" cellpadding="0" cellspacing="0" width="100%" bgcolor="#ffffff">
<tr>
<td valign="top" class="pagebody">
<div class="pageheader">
<span class="back-to">XAP 8.0 Documentation > <a href="index.html">Back to Table of Contents</a></span><br>
<h1>Space Filters</h1>
</div>
<br>

<script type='text/javascript'>//<![CDATA[
function debug() { }
// ]]></script><script type='text/javascript' src='/wiki/download/resources/net.customware.confluence.plugin.composition:composition-setup/js/browser.js'>//<![CDATA[
// ]]></script><script type='text/javascript' src='/wiki/download/resources/net.customware.confluence.plugin.composition:composition-setup/js/behaviour.js'>//<![CDATA[
// ]]></script><script type='text/javascript' src='/wiki/download/resources/net.customware.confluence.plugin.composition:composition-setup/js/memory.js'>//<![CDATA[
// ]]></script><script type='text/javascript' src='/wiki/download/resources/net.customware.confluence.plugin.composition:composition-setup/js/cloak.js'>//<![CDATA[
// ]]></script><script type='text/javascript'>//<![CDATA[
Cloak.closeHTML = "<img src=\'/wiki/download/resources/net.customware.confluence.plugin.composition:toggle-cloak/img/navigate_down_10.gif\'/>";
Cloak.openHTML = "<img src=\'/wiki/download/resources/net.customware.confluence.plugin.composition:toggle-cloak/img/navigate_right_10.gif\'/>";
Cloak.toggleZone = true;
Cloak.memoryDuration = 0;
Cloak.memoryPrefix = "contentId:53903509";
Cloak.memoryPath = "/wiki/";
// ]]></script><style type='text/css'>
.cloakToggle { /* Definition for state toggling image */
cursor:hand;
cursor:pointer;
}
</style><script type='text/javascript' src='/wiki/download/resources/net.customware.confluence.plugin.composition:composition-setup/js/transitions.js'>//<![CDATA[
// ]]></script><script type='text/javascript' src='/wiki/download/resources/net.customware.confluence.plugin.composition:composition-setup/js/deck.js'>//<![CDATA[
// ]]></script><link rel='stylesheet' type='text/css'  href='/wiki/styles/main-action.css?pluginCompleteKey=net.customware.confluence.plugin.composition:composition-setup&stylesheetName=deck&spaceKey=XAP8'/><script type='text/javascript'>//<![CDATA[
Deck.memoryDuration = 0;
Deck.memoryPrefix = "contentId:53903509";
Deck.memoryPath = "/wiki/";
// ]]></script>


<div style="border-style:solid; border-color:#3C78B5; border-width:thin; padding-left:20px; padding-bottom:20px; padding-top:20px; padding-right:20px; background-color:#D8E4F1"> 

<p><b>Section Summary:</b>  Space Filters are interceptors inside the GigaSpaces space engine. </p>
</div>

<h1><a name="SpaceFilters-Overview"></a>Overview</h1>

<p>Space Filters are interceptors inside the GigaSpaces space engine that enable integration with external systems and/or implementation of user-defined logic based once space operations are executed.</p>

<p><img src="download/attachments/17301573/Space Filter.JPG" align="absmiddle" border="0"/></p>

<p>The space filter business logic impacts the space responsiveness to client requests - please make sure your filter implementation will not involve heavy business logic. With concurrent access into the space all clients share the <b>same filter instance</b> object where the space engine access the same filter object on behalf of each client. Every non thread safe attributes you use as part of the filter implementation will be thread-safe protected.</p>

<h1><a name="SpaceFilters-Example"></a>Example</h1>
<p>The following example illustrates a space Filter POJO and a Bean that performs some space operations:</p>

<div class="panel" style="background-color: #FFFFFF;border-color: #3C78B5;border-style: solid;border-width: 1px;"><div class="panelContent" style="background-color: #FFFFFF;">
<h5><a name="SpaceFilters-TheSpaceFilterPOJO"></a>The Space Filter POJO</h5>
<hr 
 size="1" 
 color="#3C78B5" 
 >

<div class="code panel" style="border-width: 1px;"><div class="codeHeader panelHeader" style="border-bottom-width: 1px;"><b>The Space Filter POJO</b></div><div class="codeContent panelContent">
<pre class="code-java"><span class="code-keyword">package</span> com.test;

<span class="code-keyword">import</span> org.openspaces.core.GigaSpace;
<span class="code-keyword">import</span> org.openspaces.core.context.GigaSpaceContext;
<span class="code-keyword">import</span> org.openspaces.core.space.filter.AfterAllNotifyTrigger;
<span class="code-keyword">import</span> org.openspaces.core.space.filter.AfterNotifyTrigger;
<span class="code-keyword">import</span> org.openspaces.core.space.filter.AfterReadMultiple;
<span class="code-keyword">import</span> org.openspaces.core.space.filter.AfterRemoveByLease;
<span class="code-keyword">import</span> org.openspaces.core.space.filter.AfterTakeMultiple;
<span class="code-keyword">import</span> org.openspaces.core.space.filter.AfterWrite;
<span class="code-keyword">import</span> org.openspaces.core.space.filter.BeforeAllNotifyTrigger;
<span class="code-keyword">import</span> org.openspaces.core.space.filter.BeforeExecute;
<span class="code-keyword">import</span> org.openspaces.core.space.filter.BeforeNotify;
<span class="code-keyword">import</span> org.openspaces.core.space.filter.BeforeNotifyTrigger;
<span class="code-keyword">import</span> org.openspaces.core.space.filter.BeforeRead;
<span class="code-keyword">import</span> org.openspaces.core.space.filter.BeforeReadMultiple;
<span class="code-keyword">import</span> org.openspaces.core.space.filter.BeforeTake;
<span class="code-keyword">import</span> org.openspaces.core.space.filter.BeforeTakeMultiple;
<span class="code-keyword">import</span> org.openspaces.core.space.filter.BeforeWrite;
<span class="code-keyword">import</span> org.openspaces.core.space.filter.OnFilterClose;
<span class="code-keyword">import</span> org.openspaces.core.space.filter.OnFilterInit;
<span class="code-keyword">import</span> org.springframework.beans.factory.InitializingBean;

<span class="code-keyword">public</span> class MySpaceFilter <span class="code-keyword">implements</span> InitializingBean{

	@GigaSpaceContext
	GigaSpace space;
	
    @OnFilterInit
    void init() {
    	<span class="code-object">System</span>.out.println(<span class="code-quote">"MySpaceFilter Space Filter initialized"</span>);
    }

    @OnFilterClose
    void close() {
    	<span class="code-object">System</span>.out.println(<span class="code-quote">"Closing Space Filter"</span>);
    }

    @BeforeWrite
    <span class="code-keyword">public</span> void beforeWrite(<span class="code-object">Object</span> spaceObject) {
    	<span class="code-object">System</span>.out.println(<span class="code-quote">"beforeWrite called"</span> + spaceObject);
    }

    @AfterWrite
    <span class="code-keyword">public</span> void afterWrite(<span class="code-object">Object</span> echo) {
    	<span class="code-object">System</span>.out.println(<span class="code-quote">"afterWrite called"</span> + echo);
    }

    @BeforeRead
    <span class="code-keyword">public</span> void beforeRead(<span class="code-object">Object</span> spaceTemplate) {
    	<span class="code-object">System</span>.out.println(<span class="code-quote">"beforeRead called"</span> + spaceTemplate);
    }

    @AfterRemoveByLease
    <span class="code-keyword">public</span> void afterRemoveByLease(<span class="code-object">Object</span> spaceObject) {
    	<span class="code-object">System</span>.out.println(<span class="code-quote">"afterRemoveByLease called"</span> + spaceObject);
    }	

    @BeforeTake
    <span class="code-keyword">public</span> void beforeTake(<span class="code-object">Object</span> spaceTemplate) {
    	<span class="code-object">System</span>.out.println(<span class="code-quote">"beforeTake called"</span> + spaceTemplate);
    }	

    @AfterTakeMultiple
    <span class="code-keyword">public</span> void afterTakeMultiple(<span class="code-object">Object</span> spaceTemplate) {
    	<span class="code-object">System</span>.out.println(<span class="code-quote">"afterTakeMultiple called"</span> + spaceTemplate);
    }	

    @BeforeReadMultiple
    <span class="code-keyword">public</span> void beforeReadMultiple(<span class="code-object">Object</span> spaceTemplate) {
    	<span class="code-object">System</span>.out.println(<span class="code-quote">"beforeReadMultiple called"</span> + spaceTemplate);
    }	

    @BeforeTakeMultiple
    <span class="code-keyword">public</span> void beforeTakeMultiple(<span class="code-object">Object</span> spaceTemplate) {
    	<span class="code-object">System</span>.out.println(<span class="code-quote">"beforeTakeMultiple called"</span> + spaceTemplate);
    }	

    @AfterReadMultiple
    <span class="code-keyword">public</span> void afterReadMultiple(<span class="code-object">Object</span> spaceTemplate) {
    	<span class="code-object">System</span>.out.println(<span class="code-quote">"afterReadMultiple called"</span> + spaceTemplate);
    }	

    @BeforeExecute
    <span class="code-keyword">public</span> void beforeExecute(<span class="code-object">Object</span> task) {
    	<span class="code-object">System</span>.out.println(<span class="code-quote">"beforeExecute called "</span> + task);
    }	
    
    @BeforeNotify
    <span class="code-keyword">public</span> void beforeNotify(<span class="code-object">Object</span> spaceObject) {
    	<span class="code-object">System</span>.out.println(<span class="code-quote">"beforeNotify called "</span> + spaceObject);
    }	

    @AfterAllNotifyTrigger
    <span class="code-keyword">public</span> void afterAllNotifyTrigger(<span class="code-object">Object</span> spaceObject) {
    	<span class="code-object">System</span>.out.println(<span class="code-quote">"afterAllNotifyTrigger called "</span> + spaceObject);
    }	
 
    @BeforeAllNotifyTrigger
    <span class="code-keyword">public</span> void beforeAllNotifyTrigger(<span class="code-object">Object</span> spaceObject) {
    	<span class="code-object">System</span>.out.println(<span class="code-quote">"beforeAllNotifyTrigger called "</span> + spaceObject);
    }	
     
    @AfterNotifyTrigger
    <span class="code-keyword">public</span> void AfterNotifyTrigger(<span class="code-object">Object</span> spaceTemplate) {
    	<span class="code-object">System</span>.out.println(<span class="code-quote">"afterNotifyTrigger called "</span> + spaceTemplate);
    }	

    @BeforeNotifyTrigger
    <span class="code-keyword">public</span> void beforeNotifyTrigger(<span class="code-object">Object</span> spaceTemplate) {
    	<span class="code-object">System</span>.out.println(<span class="code-quote">"beforeNotifyTrigger called "</span> + spaceTemplate);
    }

	@Override
	<span class="code-keyword">public</span> void afterPropertiesSet() <span class="code-keyword">throws</span> Exception {
		<span class="code-object">System</span>.out.println(<span class="code-quote">"space "</span>+space);
	}	
}</pre>
</div></div>


<h5><a name="SpaceFilters-TheBean"></a>The Bean</h5>
<hr 
 size="1" 
 color="#3C78B5" 
 >

<div class="code panel" style="border-width: 1px;"><div class="codeHeader panelHeader" style="border-bottom-width: 1px;"><b>The Bean</b></div><div class="codeContent panelContent">
<pre class="code-java"><span class="code-keyword">package</span> com.test;

<span class="code-keyword">import</span> org.openspaces.core.GigaSpace;
<span class="code-keyword">import</span> org.openspaces.core.context.GigaSpaceContext;
<span class="code-keyword">import</span> org.openspaces.events.adapter.SpaceDataEvent;
<span class="code-keyword">import</span> org.openspaces.events.notify.SimpleNotifyContainerConfigurer;
<span class="code-keyword">import</span> org.openspaces.events.notify.SimpleNotifyEventListenerContainer;
<span class="code-keyword">import</span> org.springframework.beans.factory.InitializingBean;
<span class="code-keyword">import</span> com.j_spaces.core.LeaseContext;

<span class="code-keyword">public</span> class MyBean <span class="code-keyword">implements</span> InitializingBean{
	@GigaSpaceContext
	GigaSpace space;

	@Override
	<span class="code-keyword">public</span> void afterPropertiesSet() <span class="code-keyword">throws</span> Exception {
		Message m = <span class="code-keyword">new</span> Message();
		m.setId(<span class="code-quote">"1"</span>);
		m.setData(<span class="code-quote">"AAAA"</span>);
		
		<span class="code-object">System</span>.out.println(<span class="code-quote">"Calling write"</span>);
		LeaseContext&lt;Message&gt; lc = space.write(m);
		line();				
		<span class="code-object">System</span>.out.println(<span class="code-quote">"Calling read"</span>);
		Message m1 = space.read(<span class="code-keyword">new</span> Message());
		line();
		<span class="code-object">System</span>.out.println(<span class="code-quote">"Calling lease cancel"</span>);
		lc.cancel();
		line();
		<span class="code-object">System</span>.out.println(<span class="code-quote">"Calling write"</span>);
		space.write(m);
		line();
		<span class="code-object">System</span>.out.println(<span class="code-quote">"Calling readMultiple"</span>);
		Message m1Array[] =space.readMultiple(<span class="code-keyword">new</span> Message(), <span class="code-object">Integer</span>.MAX_VALUE);
		line();
		<span class="code-object">System</span>.out.println(<span class="code-quote">"Calling take"</span>);
		Message m2 = space.take(<span class="code-keyword">new</span> Message());
		line();
		<span class="code-object">System</span>.out.println(<span class="code-quote">"Calling write"</span>);
		space.write(m);
		line();
		<span class="code-object">System</span>.out.println(<span class="code-quote">"Calling takeMultiple"</span>);
		Message m2Array[] =space.takeMultiple(<span class="code-keyword">new</span> Message(), <span class="code-object">Integer</span>.MAX_VALUE);
		line();
		<span class="code-object">System</span>.out.println(<span class="code-quote">"Calling execute"</span>);
		space.execute(<span class="code-keyword">new</span> MyTask());

		<span class="code-object">Thread</span>.sleep(1000);

		line();
		<span class="code-object">System</span>.out.println(<span class="code-quote">"Calling Notify Registration"</span>);		
		SimpleNotifyEventListenerContainer notifyEventListenerContainer = 
			<span class="code-keyword">new</span> SimpleNotifyContainerConfigurer(space)
	        .template(<span class="code-keyword">new</span> Message())
	        .notifyWrite(<span class="code-keyword">true</span>)
	        .eventListenerAnnotation(<span class="code-keyword">new</span> <span class="code-object">Object</span>() {
	            @SpaceDataEvent
	            <span class="code-keyword">public</span> void eventHappened() {
	                <span class="code-object">System</span>.out.println(<span class="code-quote">"SpaceDataEvent event called"</span>);
	            }
	        }).notifyContainer();

		notifyEventListenerContainer.start();
		<span class="code-object">Thread</span>.sleep(1000);
		line();
		<span class="code-object">System</span>.out.println(<span class="code-quote">"Calling write"</span>);
		space.write(m);
		<span class="code-object">Thread</span>.sleep(2000);

	}
	
	<span class="code-keyword">static</span> void line()
	{
		<span class="code-object">System</span>.out.println(<span class="code-quote">"-------------------------"</span>);
	}
	
}</pre>
</div></div>


<h5><a name="SpaceFilters-TheBeansDefinitions"></a>The Beans Definitions</h5>
<hr 
 size="1" 
 color="#3C78B5" 
 >

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-xml"><span class="code-tag">&lt;bean id=<span class="code-quote">"mySpaceFilter"</span> class=<span class="code-quote">"com.test.MySpaceFilter"</span> /&gt;</span>	
<span class="code-tag">&lt;bean id=<span class="code-quote">"myBean"</span> class=<span class="code-quote">"com.test.MyBean"</span> /&gt;</span>

<span class="code-tag">&lt;os-core:space id=<span class="code-quote">"space"</span> url=<span class="code-quote">"/./space"</span> &gt;</span>
	<span class="code-tag">&lt;os-core:annotation-adapter-filter priority=<span class="code-quote">"2"</span>&gt;</span>
		<span class="code-tag">&lt;os-core:filter ref=<span class="code-quote">"mySpaceFilter"</span> /&gt;</span>
	<span class="code-tag">&lt;/os-core:annotation-adapter-filter&gt;</span>	
<span class="code-tag">&lt;/os-core:space&gt;</span>    

<span class="code-tag">&lt;os-core:giga-space id=<span class="code-quote">"gigaSpace"</span> space=<span class="code-quote">"space"</span>/&gt;</span>	
<span class="code-tag">&lt;os-core:giga-space-context/&gt;</span></pre>
</div></div>


<h5><a name="SpaceFilters-TheSpaceClass"></a>The Space Class</h5>
<hr 
 size="1" 
 color="#3C78B5" 
 >

<div class="code panel" style="border-width: 1px;"><div class="codeHeader panelHeader" style="border-bottom-width: 1px;"><b>The Space Class</b></div><div class="codeContent panelContent">
<pre class="code-java"><span class="code-keyword">package</span> com.test;

<span class="code-keyword">import</span> com.gigaspaces.annotation.pojo.SpaceClass;
<span class="code-keyword">import</span> com.gigaspaces.annotation.pojo.SpaceId;

@SpaceClass
<span class="code-keyword">public</span> class Message {
	<span class="code-object">String</span> id;
	<span class="code-object">String</span> data;
	
	<span class="code-keyword">public</span> Message (){}
	
	@SpaceId
	<span class="code-keyword">public</span> <span class="code-object">String</span> getId() {
		<span class="code-keyword">return</span> id;
	}
	<span class="code-keyword">public</span> void setId(<span class="code-object">String</span> id) {
		<span class="code-keyword">this</span>.id = id;
	}
	<span class="code-keyword">public</span> <span class="code-object">String</span> getData() {
		<span class="code-keyword">return</span> data;
	}
	<span class="code-keyword">public</span> void setData(<span class="code-object">String</span> data) {
		<span class="code-keyword">this</span>.data = data;
	}

	<span class="code-keyword">public</span> <span class="code-object">String</span> toString() {
		<span class="code-keyword">return</span> <span class="code-quote">" <span class="code-object">Class</span> Message - <span class="code-object">Object</span> ID:"</span> + id + <span class="code-quote">" data:"</span> + data;
	}
}</pre>
</div></div>


<h5><a name="SpaceFilters-TheSpaceTask"></a>The Space Task</h5>
<hr 
 size="1" 
 color="#3C78B5" 
 >

<div class="code panel" style="border-width: 1px;"><div class="codeHeader panelHeader" style="border-bottom-width: 1px;"><b>The Space Task</b></div><div class="codeContent panelContent">
<pre class="code-java"><span class="code-keyword">package</span> com.test;

<span class="code-keyword">import</span> java.io.Serializable;
<span class="code-keyword">import</span> org.openspaces.core.executor.Task;

<span class="code-keyword">public</span> class MyTask <span class="code-keyword">implements</span> Task&lt;Serializable&gt;{

	@Override
	<span class="code-keyword">public</span> Serializable execute() <span class="code-keyword">throws</span> Exception {
		<span class="code-keyword">return</span> <span class="code-keyword">null</span>;
	}
}</pre>
</div></div>
</div></div>

<h2><a name="SpaceFilters-Theexpectedoutput"></a>The expected output</h2>
<p>Here is how the expected output should look like:</p>
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">MySpaceFilter Space Filter initialized
INFO [com.gigaspaces.core.common] - Space [space_container:space] with url
 [/./space?schema=<span class="code-keyword">default</span>&amp;groups=gigaspaces-7.1.0-XAPPremium-rc&amp;state=started] started successfully
space space_container:space
Calling write
beforeWrite called <span class="code-object">Class</span> Message - <span class="code-object">Object</span> ID:1 data:AAAA
afterWrite called <span class="code-object">Class</span> Message - <span class="code-object">Object</span> ID:1 data:AAAA
-------------------------
Calling read
beforeRead called <span class="code-object">Class</span> Message - <span class="code-object">Object</span> ID:<span class="code-keyword">null</span> data:<span class="code-keyword">null</span>
-------------------------
Calling lease cancel
afterRemoveByLease called <span class="code-object">Class</span> Message - <span class="code-object">Object</span> ID:1 data:AAAA
-------------------------
Calling write
beforeWrite called <span class="code-object">Class</span> Message - <span class="code-object">Object</span> ID:1 data:AAAA
afterWrite called <span class="code-object">Class</span> Message - <span class="code-object">Object</span> ID:1 data:AAAA
-------------------------
Calling readMultiple
beforeReadMultiple called <span class="code-object">Class</span> Message - <span class="code-object">Object</span> ID:<span class="code-keyword">null</span> data:<span class="code-keyword">null</span>
afterReadMultiple called <span class="code-object">Class</span> Message - <span class="code-object">Object</span> ID:1 data:AAAA
-------------------------
Calling take
beforeTake called <span class="code-object">Class</span> Message - <span class="code-object">Object</span> ID:<span class="code-keyword">null</span> data:<span class="code-keyword">null</span>
afterRemoveByLease called <span class="code-object">Class</span> Message - <span class="code-object">Object</span> ID:1 data:AAAA
-------------------------
Calling write
beforeWrite called <span class="code-object">Class</span> Message - <span class="code-object">Object</span> ID:1 data:AAAA
afterWrite called <span class="code-object">Class</span> Message - <span class="code-object">Object</span> ID:1 data:AAAA
-------------------------
Calling takeMultiple
beforeTakeMultiple called <span class="code-object">Class</span> Message - <span class="code-object">Object</span> ID:<span class="code-keyword">null</span> data:<span class="code-keyword">null</span>
afterRemoveByLease called <span class="code-object">Class</span> Message - <span class="code-object">Object</span> ID:1 data:AAAA
afterTakeMultiple called <span class="code-object">Class</span> Message - <span class="code-object">Object</span> ID:1 data:AAAA
-------------------------
Calling execute
beforeExecute called com.test.MyTask@9e4585
-------------------------
Calling Notify Registration
beforeNotify called  <span class="code-object">Class</span> Message - <span class="code-object">Object</span> ID:<span class="code-keyword">null</span> data:<span class="code-keyword">null</span>
-------------------------
Calling write
beforeWrite called <span class="code-object">Class</span> Message - <span class="code-object">Object</span> ID:1 data:AAAA
afterWrite called <span class="code-object">Class</span> Message - <span class="code-object">Object</span> ID:1 data:AAAA
beforeAllNotifyTrigger called  <span class="code-object">Class</span> Message - <span class="code-object">Object</span> ID:1 data:AAAA
beforeNotifyTrigger called  <span class="code-object">Class</span> Message - <span class="code-object">Object</span> ID:1 data:AAAA
SpaceDataEvent event called
afterNotifyTrigger called  <span class="code-object">Class</span> Message - <span class="code-object">Object</span> ID:1 data:AAAA
afterAllNotifyTrigger called  <span class="code-object">Class</span> Message - <span class="code-object">Object</span> ID:1 data:AAAA</pre>
</div></div>

<h1><a name="SpaceFilters-AdvancedOptions"></a>Advanced Options</h1>
<p>A filter is an instance of a class that implements the <tt>ISpaceFilter</tt> interface (<tt>com.j_spaces.core.filters.ISpaceFilter</tt>; see <a href="http://www.gigaspaces.com/docs/JavaDoc8.0/index.html?com/j_spaces/core/filters/ISpaceFilter.html" target="_blank">Javadoc</a>).</p>

<div class='panelMacro'><table class='tipMacro'><colgroup><col width='24'><col></colgroup><tr><td valign='top'><img src="images/icons/emoticons/check.gif" width="16" height="16" align="absmiddle" alt="" border="0"></td><td>When performing operations using transactions (write, update, or take with a transaction object), the space filter callbacks are called when the operation is called, and not when the transaction commit/rollback is called.</td></tr></table></div>

<h2><a name="SpaceFilters-com.jspaces.core.filters.ISpaceFilterInterface"></a>com.j_spaces.core.filters.ISpaceFilter Interface</h2>

<table class='confluenceTable'><tbody>
<tr>
<th class='confluenceTh'> Return value </th>
<th class='confluenceTh'> method </th>
</tr>
<tr>
<td class='confluenceTd'> <tt>void</tt> </td>
<td class='confluenceTd'> <tt>close()</tt><br clear="all" />
 when the space is closed gracefully, all active filters close method is called to allow cleaning any open resources. </td>
</tr>
<tr>
<td class='confluenceTd'> <tt>void</tt> </td>
<td class='confluenceTd'> <tt>init</tt> (<a href="http://www.gigaspaces.com/docs/JavaDoc8.0/index.html?com/j_spaces/core/IJSpace.html" target="_blank">IJSpace</a> <tt>space</tt>, <a href="http://java.sun.com/j2se/1.5.0/docs/api/index.html?java/lang/String.html" target="_blank">String</a> <tt>filterId</tt>, <a href="http://java.sun.com/j2se/1.5.0/docs/api/index.html?java/lang/String.html" target="_blank">String</a> <tt>url, int priority</tt>)<br clear="all" />
 When a space initializes, it instantiates all the filters defined as part of its schema file and calls the <tt>init</tt> method on each one. The <tt>init</tt> method provides an opportunity for the filter to initialize itself. The arguments of the <tt>init</tt> method are:
<ul>
	<li><tt>space</tt> &#8211; a reference to a collocated space proxy. This reference can be used later to operate on the space, although this should be done with extreme care.</li>
	<li><tt>url</tt> &#8211; The free string defined as part of the filter definition at the space schema file. This allows passing any data into the filter from external source.<br clear="all" />
 <tt>priority</tt> &#8211; a number between 0 and 4. Filters with higher priorities will be executed first, i.e., the filters will be executed in ascending order of priority. For example, a <tt>BEFORE_WRITE</tt> filter with priority 4 will be executed before an <tt>AFTER_WRITE</tt> filter with priority 3. If a <tt>RuntimeException</tt> is thrown from the into method during filter initialization, it is discarded for the lifetime of the current engine run. </li>
</ul>
</td>
</tr>
<tr>
<td class='confluenceTd'> <tt>void</tt> </td>
<td class='confluenceTd'> process (<a href="http://www.gigaspaces.com/docs/JavaDoc8.0/index.html?com/j_spaces/core/SpaceContext.html" target="_blank">SpaceContext</a> context, <a href="http://www.gigaspaces.com/docs/JavaDoc8.0/index.html?com/j_spaces/core/filters/entry/ISpaceFilterEntry.html" target="_blank">ISpaceFilterEntry</a> Entry, <tt>int operationCode</tt>) <br clear="all" />
 This method is called by the engine when an event matching this filter's operation code occurs in the engine. When an operation inside the space triggers a filter, the filter's process method is called with the following arguments:
<ul>
	<li><tt>context</tt> is passed as the first parameter to process. It may be null for a non-secured space. <tt>SpaceContext</tt> has a <tt>SecurityContext</tt> object as one of its public fields. The proxy passes the <tt>SpaceContext</tt> object to a space method in each call, (except for replication and recovery) . For operation codes <tt>ON_INIT</tt>, <tt>BEFORE_REMOVE</tt> and <tt>AFTER_REMOVE</tt>, the <tt>SpaceContext</tt> is always <tt>null</tt>.</li>
	<li><tt>entry</tt> &#8211; a representation of the Entry that caused the space event is passed to the process method as an argument. The Entry is the object or the template object used at the relevant space operation, represented by the<br/>
<a href="http://www.gigaspaces.com/docs/JavaDoc8.0/index.html?com/j_spaces/core/filters/entry/ISpaceFilterEntry.html" target="_blank">ISpaceFilterEntry</a>. This argument may be <tt>null</tt> (e.g., in <tt>ON_INIT</tt> filters). The <tt>ISpaceFilterEntry</tt> contains Entry class name, field types and values. It is important to note that if a <tt>RuntimeException</tt> occurs in <tt>BEFORE</tt> operations, the space engine aborts the operation. For example, if a <tt>BEFORE_WRITE</tt> filter throws a <tt>RuntimeException</tt>, the Entry will not be inserted to the space, and the client will receive this exception. Therefore, the filter developer is responsible for catching any exceptions that will not abort the operation.</li>
	<li><tt>operationCode</tt> &#8211; any one of the
<a href="http://www.gigaspaces.com/docs/JavaDoc8.0/index.html?com/j_spaces/core/filters/FilterOperationCodes.html" target="_blank">FilterOperationCodes</a>
<p>or <a href="http://www.gigaspaces.com/docs/JavaDoc6/constant-values.html#com.j_spaces.core.filters.FilterOperationCodes.AFTER_ALL_NOTIFY_TRIGGER">FilterOperationCodes</a> that triggers the process method. The optional values are the ones defined as part of the filter definition as part of the space schema file. <div class='panelMacro'><table class='tipMacro'><colgroup><col width='24'><col></colgroup><tr><td valign='top'><img src="images/icons/emoticons/check.gif" width="16" height="16" align="absmiddle" alt="" border="0"></td><td><tt>BEFORE_WRITE/AFTER_WRITE</tt> and <tt>BEFORE_UPDATE/AFTER_UPDATE</tt> codes are used when calling the <tt>writeMultiple()/updateMultiple()</tt> respectively. The <tt>readMultiple</tt> and <tt>takeMultiple</tt> have their own set of codes. </td></tr></table></div><div class='panelMacro'><table class='tipMacro'><colgroup><col width='24'><col></colgroup><tr><td valign='top'><img src="images/icons/emoticons/check.gif" width="16" height="16" align="absmiddle" alt="" border="0"></td><td><tt>FilterOperationCodes</tt> with the prefix <tt>AFTER</tt> (which indicate operations to be performed after a certain space operation) do not work for space operations that use timeouts. For example, if you use the code <tt>AFTER_WRITE</tt>, and a specific write operation is performed with a timeout, the operation that was supposed to happen after the write is not executed. </td></tr></table></div>The <tt>ON_INIT</tt>, <tt>BEFORE_REMOVE</tt> and <tt>AFTER_REMOVE</tt> operation codes can be used only in non-security filters, i.e., they receive a <tt>null</tt> context. For example, a filter with operation code <tt>BEFORE_WRITE</tt> will be called (its process method will be called) on every Entry that enters the space immediately before it is inserted into the space engine. A filter can be defined to handle several operation codes, for example <tt>&lt;operation-code&gt;1,3&lt;operation-code&gt;</tt>, if the filter definition activates it in <tt>AFTER_WRITE (1) and BEFORE_TAKE (3)</tt> trigger-points. </p></li>
</ul>
</td>
</tr>
<tr>
<td class='confluenceTd'> <tt>void</tt> </td>
<td class='confluenceTd'> process (<a href="http://www.gigaspaces.com/docs/JavaDoc8.0/index.html?com/j_spaces/core/SpaceContext.html" target="_blank">SpaceContext</a> context, <a href="http://www.gigaspaces.com/docs/JavaDoc8.0/index.html?com/j_spaces/core/filters/entry/ISpaceFilterEntry.html" target="_blank">ISpaceFilterEntry</a>[] entries, <tt>int operationCode</tt>).<br clear="all" />
 This method is called when the <tt>IJSpace.replace()</tt> is called for the <tt>BEFORE_UPDATE</tt> and <tt>AFTER_UPDATE</tt>. The passed Entries array size is 2 and includes the template Entry at the first position at the array and the new entry at the second position at the array. This method is also called for the <tt>AFTER_UPDATE</tt> event of the <tt>IJSpace.update()</tt>. The passed Entries array size is 2 and includes the original Entry at the first position at the array and the updated Entry at the second position at the array. </td>
</tr>
</tbody></table>

<h2><a name="SpaceFilters-com.jspaces.core.filters.FilterOperationCodes"></a>com.j_spaces.core.filters.FilterOperationCodes</h2>

<p>The <a href="http://www.gigaspaces.com/docs/JavaDoc8.0/index.html?com/j_spaces/core/filters/FilterOperationCodes.html" target="_blank">FilterOperationCodes</a> class includes the following operations:</p>
<table class='confluenceTable'><tbody>
<tr>
<th class='confluenceTh'> Operation </th>
<th class='confluenceTh'> Code </th>
<th class='confluenceTh'> Desription </th>
</tr>
<tr>
<td class='confluenceTd'> <tt>BEFORE_WRITE</tt> </td>
<td class='confluenceTd'> 0 </td>
<td class='confluenceTd'> Called before write, writeMultiple operations</td>
</tr>
<tr>
<td class='confluenceTd'> <tt>AFTER_WRITE</tt> </td>
<td class='confluenceTd'> 1 </td>
<td class='confluenceTd'> Called after write,writeMultiple operations</td>
</tr>
<tr>
<td class='confluenceTd'> <tt>BEFORE_READ</tt> </td>
<td class='confluenceTd'> 2 </td>
<td class='confluenceTd'> Called before read, count operations</td>
</tr>
<tr>
<td class='confluenceTd'> <tt>BEFORE_TAKE</tt> </td>
<td class='confluenceTd'> 3 </td>
<td class='confluenceTd'> Called before take  operation</td>
</tr>
<tr>
<td class='confluenceTd'> <tt>BEFORE_NOTIFY</tt> </td>
<td class='confluenceTd'> 4 </td>
<td class='confluenceTd'> Called before notify registration operation</td>
</tr>
<tr>
<td class='confluenceTd'> <tt>BEFORE_GETADMIN</tt> </td>
<td class='confluenceTd'> 5 </td>
<td class='confluenceTd'> Called before admin operation operations</td>
</tr>
<tr>
<td class='confluenceTd'> <tt>BEFORE_AUTHENTICATION</tt> </td>
<td class='confluenceTd'> 6 </td>
<td class='confluenceTd'> Called before authentication is perform on a secured space</td>
</tr>
<tr>
<td class='confluenceTd'> <tt>BEFORE_CLEAN_SPACE</tt> </td>
<td class='confluenceTd'> 8 </td>
<td class='confluenceTd'>Called before clean operation</td>
</tr>
<tr>
<td class='confluenceTd'> <tt>BEFORE_UPDATE</tt> </td>
<td class='confluenceTd'> 9 </td>
<td class='confluenceTd'>Called before update and updateMultiple operations</td>
</tr>
<tr>
<td class='confluenceTd'> <tt>AFTER_UPDATE</tt> </td>
<td class='confluenceTd'> 10 </td>
<td class='confluenceTd'>Called after update and updateMultiple operations</td>
</tr>
<tr>
<td class='confluenceTd'> <tt>BEFORE_READ_MULTIPLE</tt> </td>
<td class='confluenceTd'> 11 </td>
<td class='confluenceTd'> Called before readMultiple operation</td>
</tr>
<tr>
<td class='confluenceTd'> <tt>AFTER_READ_MULTIPLE</tt> </td>
<td class='confluenceTd'> 12 </td>
<td class='confluenceTd'> Called after readMultiple operation</td>
</tr>
<tr>
<td class='confluenceTd'> <tt>BEFORE_TAKE_MULTIPLE</tt> </td>
<td class='confluenceTd'> 13 </td>
<td class='confluenceTd'> Called before takeMultiple operation</td>
</tr>
<tr>
<td class='confluenceTd'> <tt>AFTER_TAKE_MULTIPLE</tt> </td>
<td class='confluenceTd'> 14 </td>
<td class='confluenceTd'> Called after takeMultiple operation</td>
</tr>
<tr>
<td class='confluenceTd'> <tt>BEFORE_NOTIFY_TRIGGER</tt> </td>
<td class='confluenceTd'> 15 </td>
<td class='confluenceTd'> Called before sending notification operation</td>
</tr>
<tr>
<td class='confluenceTd'> <tt>AFTER_NOTIFY_TRIGGER</tt> </td>
<td class='confluenceTd'> 16 </td>
<td class='confluenceTd'> Called after sending notification operation</td>
</tr>
<tr>
<td class='confluenceTd'> <tt>BEFORE_ALL_NOTIFY_TRIGGER</tt> </td>
<td class='confluenceTd'> 17 </td>
<td class='confluenceTd'> Called before sending notification operation</td>
</tr>
<tr>
<td class='confluenceTd'> <tt>AFTER_ALL_NOTIFY_TRIGGER</tt> </td>
<td class='confluenceTd'> 18 </td>
<td class='confluenceTd'> Called after sending notification operation</td>
</tr>
<tr>
<td class='confluenceTd'> <tt>ON_INIT</tt> &#8211; <b>deprecated</b> (see warning below) </td>
<td class='confluenceTd'> 51 </td>
<td class='confluenceTd'>Called when space started</td>
</tr>
<tr>
<td class='confluenceTd'> <tt>BEFORE_REMOVE</tt> </td>
<td class='confluenceTd'> 52 </td>
<td class='confluenceTd'> Called before entry expires or canceled</td>
</tr>
<tr>
<td class='confluenceTd'> <tt>AFTER_REMOVE</tt> </td>
<td class='confluenceTd'> 53 </td>
<td class='confluenceTd'> Called after entry expire or canceled</td>
</tr>
<tr>
<td class='confluenceTd'> <tt>BEFORE_EXECUTE</tt> </td>
<td class='confluenceTd'> 20 </td>
<td class='confluenceTd'> Called before service or task invocation</td>
</tr>
</tbody></table>

<p><img class="emoticon" src="images/icons/emoticons/warning.gif" height="16" width="16" align="absmiddle" alt="" border="0"/> You do not need to use the <tt>ON_INIT</tt> event. Instead, just implement the logic in the <tt>init()</tt> method. The result is the same, since the <tt>init()</tt> method is called at the same time as <tt>ON_INIT</tt> &#8211; before the space starts.</p>

<p><img class="emoticon" src="images/icons/emoticons/warning.gif" height="16" width="16" align="absmiddle" alt="" border="0"/> <tt>FilterOperationCodes</tt> with the prefix <tt>AFTER</tt> (which indicate operations to be performed after a certain space operation) do not work for space operations that use timeouts. For example, if you use the code <tt>AFTER_WRITE</tt>, and a specific write operation is performed with a timeout, the operation that was supposed to happen after the Write is not executed.</p>

<p>The <tt>BEFORE_NOTIFY_TRIGGER</tt>, <tt>AFTER_NOTIFY_TRIGGER</tt>, <tt>BEFORE_ALL_NOTIFY_TRIGGER</tt>, and <tt>AFTER_ALL_NOTIFY_TRIGGER</tt> <tt>FilterOperationCodes</tt> events provide:</p>
<ul>
	<li>Notification statistics infrastructure</li>
	<li>Durable notifications infrastructure</li>
	<li>Notification recovery infrastructure</li>
</ul>


<ul>
	<li><tt>BEFORE_NOTIFY_TRIGGER</tt> &#8211; before a notify trigger operation, indicates that a matched notify template was found for the current Entry event.</li>
	<li><tt>AFTER_NOTIFY_TRIGGER</tt> &#8211; after a notify trigger operation, indicates that a notify trigger was successful.</li>
	<li><tt>BEFORE_ALL_NOTIFY_TRIGGER</tt> &#8211; before all notify trigger operations, indicates that a notify trigger was successful.</li>
	<li><tt>AFTER_ALL_NOTIFY_TRIGGER</tt> &#8211; after all notify trigger operations, indicates that all notify templates that are matched to the current Entry event were triggered, and returned or failed.</li>
</ul>


<p><img class="emoticon" src="images/icons/emoticons/information.gif" height="16" width="16" align="absmiddle" alt="" border="0"/> <tt>init()</tt> method guarantees that no one else can access the space before <tt>init()</tt> is finished.</p>

<h2><a name="SpaceFilters-SpaceFilterinvocationwithbackup%2FreplicaSpace"></a>Space Filter invocation with backup/replica Space</h2>
<p>&#8211; The space filter context is <tt>null</tt> for a filter called as a result of a replication event. For secured space, you can use this as indication to know if this operation originated by a client call or replication event. <br/>
&#8211; Update filter operations are not called on a replica space. This will fixed in future versions.</p>

<h2><a name="SpaceFilters-com.jspaces.core.filters.entry.ISpaceFilterEntryInterface"></a>com.j_spaces.core.filters.entry.ISpaceFilterEntry Interface</h2>

<p>The <a href="http://www.gigaspaces.com/docs/JavaDoc8.0/index.html?com/j_spaces/core/filters/entry/ISpaceFilterEntry.html" target="_blank">ISpaceFilterEntry</a> represents an Entry instance passed to the <tt>ISpaceFilter</tt> process method implementation. The <tt>ISpaceFilterEntry</tt> class extends the <a href="http://www.gigaspaces.com/docs/JavaDoc8.0/index.html?com/j_spaces/core/filters/entry/IFilterEntry.html" target="_blank">IFilterEntry</a> that extends the <a href="http://www.gigaspaces.com/docs/JavaDoc8.0/index.html?com/j_spaces/core/IGSEntry.html" target="_blank">IGSEntry</a> which includes methods that allow you to access the Entry values, class name and other Entry object properties. The <tt>ISpaceFilterEntry</tt> class does not include the <tt>Entry Class</tt> methods. To convert the <tt>ISpaceFilterEntry</tt> class to your Entry object, you should call the <tt>ISpaceFilterEntry.getEntry(IJSpace space)</tt> method or the <tt>ISpaceFilterEntry.getExternalEntry(IJSpace space)</tt> method.</p>

<h2><a name="SpaceFilters-ModifyingWrittenSpaceObjectorTemplate"></a>Modifying Written Space Object or Template</h2>

<p>You may modify the written Entry field values before the Entry is stored in the space, using the <tt>BEFORE_WRITE</tt> event, or you can modify the template field values used when performing a search for a matching Entry, using the <tt>BEFORE_READ</tt> event.</p>

<p>This allows you to truncate an unnecessary Entry field value, or replace it with some enriched data.</p>

<p>When modifying the template field values, you can construct a different search than the original one constructed by the client. For example, you can aggregate data from multiple Entries as part of a <tt>BEFORE_READ</tt> event, write the aggregated data into the space, and modify the template to return the aggregated data. This will return the aggregated Entry data to the client, and not the Entry that matches the original template constructed by the client. To modify the written Entry or the template, you should use the <tt>IFilterEntry.setFieldValue</tt> method.</p>

                     </td>
</tr>
</table>
<table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr>
<td height="12" background="http://www.gigaspaces.com/wiki/images/border/border_bottom.gif"><img src="images/border/spacer.gif" width="1" height="1" border="0"/></td>
</tr>
<tr>
<td align="center"><font color="grey"><a href="http://www.gigaspaces.com">GigaSpaces.com</a> -
		<a href="http://www.gigaspaces.com/wiki/x/xwBmAg" class="smalltext">Legal Notice</a> -
		<a href="http://www.gigaspaces.com/wiki/x/xgBmAg" class="smalltext">3rd Party Licenses</a> -
		<a href="http://www.gigaspaces.com/wiki/x/BQFmAg" class="smalltext">Site Map</a> -
		<a href="http://www.gigaspaces.com/wiki/display/API/API+Documentation+Portal" class="version-link">API Docs</a> -
		<a href="http://forum.openspaces.org/forum.jspa?forumID=175" class="version-link">Forum</a> -
		<a href="http://www.gigaspaces.com/LatestProductVersion" class="version-link">Downloads</a> -
		<a href="http://blog.gigaspaces.com/" class="version-link">Blog</a> -
		<a href="http://www.gigaspaces.com/os_papers.html" class="version-link">White Papers</a> -
		<a href="mailto:techw@gigaspaces.com">Contact Tech Writing</a> -
		<i><a href="http://www.atlassian.com/software/confluence">Gen. by Atlassian Confluence</a></i></font></td>
</tr>
</table>
     </body>
</html>
