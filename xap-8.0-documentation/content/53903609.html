<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
     <head>
         <title>XAP 8.0 Documentation : GigaSpaces C++ Type Converter</title>
<link rel="stylesheet" href="styles/site.css" type="text/css" />
         <META http-equiv="Content-Type" content="text/html; charset=UTF-8">
		 <style>
.back-to {
	color: #666666;
	font-weight: bold;
}	 
a.back-to:link, a.back-to:visited, a.back-to:hover, a.back-to:active  {
	color: #666666;
}	 
		 </style>
     </head>

     <body>
<table class="pagecontent" border="0" cellpadding="0" cellspacing="0" width="100%" bgcolor="#ffffff">
<tr>
<td valign="top" class="pagebody">
<div class="pageheader">
<span class="back-to">XAP 8.0 Documentation > <a href="index.html">Back to Table of Contents</a></span><br>
<h1>GigaSpaces C++ Type Converter</h1>
</div>
<br>

<p>

<div style="border-style:solid; border-color:#3C78B5; border-width:thin; padding-left:20px; padding-bottom:20px; padding-top:20px; padding-right:20px; background-color:#D8E4F1"> 

<p><b>Section Summary:</b>  How to implement unsupported data types by creating user-defined packaging code. </p>
</div><br clear="all" /></p>

<h1><a name="GigaSpacesC%2B%2BTypeConverter-Overview"></a>Overview</h1>

<p>This example demonstrates serialization of data types that do not have built-in support in GigaSpaces C+&#43; API. It shows you how to add your own code to convert your data type to the supported type, and vice versa.</p>

<p><img class="emoticon" src="images/icons/emoticons/information.gif" height="16" width="16" align="absmiddle" alt="" border="0"/> Supported types are stated in the <tt>gs.xml</tt> file. For more details, refer to the <a href="CPP API Mapping File.html#CPPAPIMappingFile-typeSupportedTypes">C++ Mapping File</a> section.<br/>
<p><img src="download/attachments/19890517/referto.gif" align="absmiddle" border="0"/> It is assumed that you have read the Writing Existing C\+\+ Class to Space example which serves as a starting point for this example.</p><br clear="all" /></p>

<p>The code for this example is located at <tt>&lt;GigaSpaces Root&gt;\cpp\examples\PocoUserPackaging</tt>. This path will be referred to as <tt>&lt;Example Root&gt;</tt> in this page.</p>

<p><img class="emoticon" src="images/icons/emoticons/warning.gif" height="16" width="16" align="absmiddle" alt="" border="0"/> This example can be built and run on <b>Windows OS</b> only. If you use <b>Visual Studio</b> open the solution <tt>PocoUserPackaging.sln</tt> located in <tt>&lt;GigaSpaces Root&gt;\cpp\examples\PocoUserPackaging</tt>. It is recommended to set your solution configuration to <tt>Release</tt> and do a rebuild that will generate all related files.</p>

<p>In this example, we translate an object of type <tt>std::map</tt> (which is not supported by GigaSpaces C+&#43; API) into two buffers of type <tt>std::vector</tt> (which is a supported type).<br/>
By implementing this conversion code, we are able to read and write the original object type to and from the space just like any other supported type. In other words, we "teach" the space how to deal with our object, and as a result, we don't need to worry about conversion in the future.</p>

<p>To write and implement your conversion code:</p>
<ol>
	<li>Add the attribute <tt>[custom-serialization="true"]</tt> to the <tt>class</tt> element in the <tt>gs.xml</tt> file:<br/>
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-xml"><span class="code-tag">&lt;class name=<span class="code-quote">"UserMessage"</span> custom-serialization=<span class="code-quote">"true"</span> persist=<span class="code-quote">"false"</span> replicate=<span class="code-quote">"false"</span> fifo=<span class="code-quote">"false"</span> &gt;</span></pre>
</div></div><br clear="all" /></li>
	<li>Write the type conversion code (use <tt>&lt;Example Root&gt;\UserMessageSerializerPackaging.cpp</tt> as an example):<br/>
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">#define DONT_INCLUDE_SERIALIZER_EXPORTS

#include <span class="code-quote">"UserMessageSerializer.cpp"</span>

void	UserMessageSerializer::PreSerialize(<span class="code-keyword">const</span> IEntry* ptr,bool isTemplate)
{
	<span class="code-keyword">if</span>(!isTemplate)
	{
		UserMessage* p = (UserMessage*)ptr;

		p-&gt;buffer1.clear();
		p-&gt;buffer2.clear();
		std::map&lt;std::string,std::string&gt;::iterator iter = p-&gt;userMap.begin();
		<span class="code-keyword">for</span>( ;iter!=p-&gt;userMap.end();iter++)
		{
			p-&gt;buffer1.push_back(iter-&gt;first); <span class="code-comment">// push the key
</span>			p-&gt;buffer2.push_back(iter-&gt;second);<span class="code-comment">// push the data
</span>		}

	}
};
void	UserMessageSerializer::PostDeserialize(IEntry* pNewObject)
{
	UserMessage* p = (UserMessage*)pNewObject;

	p-&gt;userMap.clear();
	<span class="code-keyword">for</span>(<span class="code-object">int</span> i=0;i&lt;p-&gt;buffer1.size();i++)
	{
		p-&gt;userMap[p-&gt;buffer1[i]] = p-&gt;buffer2[i];<span class="code-comment">// extract the data into the map
</span>	}
	p-&gt;buffer1.clear();
	p-&gt;buffer2.clear();

};</pre>
</div></div><br clear="all" /> <br clear="all" />
<img class="emoticon" src="images/icons/emoticons/information.gif" height="16" width="16" align="absmiddle" alt="" border="0"/> These functions extend the functionality of the generated serializer (<tt>UserMessageSerializer.cpp</tt>). The first function <tt>PreSerialize</tt> converts the map field to two vectors before the serialization. The second function <tt>PostDeserialize</tt> converts the two vectors back to a map field after the desrealization.</li>
	<li>Handle the C+&#43; serializer code generation, build the shared library (DLL) from your extension code, and place the library in the appropriate directory.
<br clear="all" />
<br clear="all" />  <img class="emoticon" src="images/icons/emoticons/information.gif" height="16" width="16" align="absmiddle" alt="" border="0"/> As shown in the <a href="Writing Existing CPP Class to Space.html" title="Writing Existing CPP Class to Space">previous example</a>, you can use a custom build with the supplied makefile (at <tt>&lt;Example Root&gt;/makefileSerializer.mk</tt>).
<br clear="all" />
<br clear="all" /></li>
	<li><b>Rebuild</b> and run your code.<br/>
The console will have the following output:<br/>
<div class="preformatted panel" style="border-style: solid;border-width: 1px;"><div class="preformattedContent panelContent">
<pre>Retrieved a space proxy
Did snapshot for UserMessage class

Wrote a UserMessage to space.
Content of the UserMessage's map (the unsupported field):
map[key1] = ALPHA
map[key2] = BETA
Wrote another UserMessage to space.
Content of the UserMessage's map (the unsupported field):
map[key1] = ALPHA
map[key2] = BETA
map[key3] = GAMMA
Took a UserMessage from the space.
Content of the UserMessage's map (the unsupported field):
map[key1] = ALPHA
map[key2] = BETA
map[key3] = GAMMA
Read a UserMessage from the space.
Content of the UserMessage's map (the unsupported field):
map[key1] = ALPHA
map[key2] = BETA
Press Enter to end this example...
</pre>
</div></div><br clear="all" /></li>
</ol>


                     </td>
</tr>
</table>
<table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr>
<td height="12" background="http://www.gigaspaces.com/wiki/images/border/border_bottom.gif"><img src="images/border/spacer.gif" width="1" height="1" border="0"/></td>
</tr>
<tr>
<td align="center"><font color="grey"><a href="http://www.gigaspaces.com">GigaSpaces.com</a> -
		<a href="http://www.gigaspaces.com/wiki/x/xwBmAg" class="smalltext">Legal Notice</a> -
		<a href="http://www.gigaspaces.com/wiki/x/xgBmAg" class="smalltext">3rd Party Licenses</a> -
		<a href="http://www.gigaspaces.com/wiki/x/BQFmAg" class="smalltext">Site Map</a> -
		<a href="http://www.gigaspaces.com/wiki/display/API/API+Documentation+Portal" class="version-link">API Docs</a> -
		<a href="http://forum.openspaces.org/forum.jspa?forumID=175" class="version-link">Forum</a> -
		<a href="http://www.gigaspaces.com/LatestProductVersion" class="version-link">Downloads</a> -
		<a href="http://blog.gigaspaces.com/" class="version-link">Blog</a> -
		<a href="http://www.gigaspaces.com/os_papers.html" class="version-link">White Papers</a> -
		<a href="mailto:techw@gigaspaces.com">Contact Tech Writing</a> -
		<i><a href="http://www.atlassian.com/software/confluence">Gen. by Atlassian Confluence</a></i></font></td>
</tr>
</table>
     </body>
</html>
