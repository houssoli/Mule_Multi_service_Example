<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
     <head>
         <title>XAP 8.0 Documentation : ALL IN CACHE-Cache Policy</title>
<link rel="stylesheet" href="styles/site.css" type="text/css" />
         <META http-equiv="Content-Type" content="text/html; charset=UTF-8">
		 <style>
.back-to {
	color: #666666;
	font-weight: bold;
}	 
a.back-to:link, a.back-to:visited, a.back-to:hover, a.back-to:active  {
	color: #666666;
}	 
		 </style>
     </head>

     <body>
<table class="pagecontent" border="0" cellpadding="0" cellspacing="0" width="100%" bgcolor="#ffffff">
<tr>
<td valign="top" class="pagebody">
<div class="pageheader">
<span class="back-to">XAP 8.0 Documentation > <a href="index.html">Back to Table of Contents</a></span><br>
<h1>ALL IN CACHE-Cache Policy</h1>
</div>
<br>



<div style="border-style:solid; border-color:#3C78B5; border-width:thin; padding-left:20px; padding-bottom:20px; padding-top:20px; padding-right:20px; background-color:#D8E4F1"> 

<p><b>Section Summary:</b>  The ALL-In-Cache Cache policy </p>
</div>
<h1><a name="ALLINCACHE-CachePolicy-Overview"></a>Overview</h1>
<p>When running in <tt>ALL_IN_CACHE</tt> cache policy mode, the space uses only the available physical memory. When running in a persistent space mode and having the <a href="External Data Source.html" title="External Data Source">External Data Source</a> defined, the space data is backed with the underlying database, but the overall capacity of the space does not exceed the capacity of the available physical memory.</p>
<div class='panelMacro'><table class='tipMacro'><colgroup><col width='24'><col></colgroup><tr><td valign='top'><img src="images/icons/emoticons/check.gif" width="16" height="16" align="absmiddle" alt="" border="0"></td><td>When using the All IN CACHE, the <b>cache size</b> parameter is ignored.</td></tr></table></div>

<h1><a name="ALLINCACHE-CachePolicy-SpaceMemoryShortageException"></a>SpaceMemoryShortageException</h1>
<p>The <tt>org.openspaces.core.SpaceMemoryShortageException</tt> (which wraps the <tt>com.j_spaces.core.MemoryShortageException</tt>) is thrown when:</p>
<ul>
	<li>The utilized memory is above the <tt>space-config.engine.memory_usage.high_watermark_percentage</tt> threshold.</li>
	<li>The utilized memory is above the <tt>space-config.engine.memory_usage.write_only_block_percentage</tt> threshold and a <b>write-type</b> operation has been called.
<div class="indent20 inline" style="margin-left: 20px;"><style type="text/css">div.inline p:first-child { display: inline; }</style><p><img src="download/attachments/48235229/ALL_IN_CACHE_SpaceMemoryShortageException.jpg" align="absmiddle" border="0"/></p></div>
<p>The <tt>org.openspaces.core.SpaceMemoryShortageException</tt> or <tt>com.j_spaces.core.MemoryShortageException</tt> includes information about:</p></li>
</ul>
<ul class="alternate" type="square">
	<li>The space host name</li>
	<li>The space container name</li>
	<li>The space name</li>
	<li>The total available memory</li>
	<li>The total used memory</li>
</ul>


<p>Here is an example of the <tt>org.openspaces.core.SpaceMemoryShortageException</tt> message:</p>
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">org.openspaces.core.SpaceMemoryShortageException at: host: MachineHostName, container: mySpace_container1_1, space mySpace, 
total memory: 1820 mb, used memory: 1283 mb</pre>
</div></div>

<p>Getting <tt>SpaceMemoryShortageException</tt> when running in <tt>ALL-IN_CACHE</tt> policy mode points that the heap size allocated for the JVM is too low, or the garbage collection settings are not tuned correctly. You should consider increasing the JVM heap size or move into more advanced garbage collector such as CMS or iCMS. Here is an example for CMS garbage collector settings you may use:</p>
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">-server -Xms8g -Xmx8g -Xmn300m -XX:+UseConcMarkSweepGC -XX:+UseParNewGC
-XX:CMSInitiatingOccupancyFraction=60 -XX:+UseCMSInitiatingOccupancyOnly 
-XX:MaxPermSize=256m -XX:+ExplicitGCInvokesConcurrent -XX:+UseCompressedOops</pre>
</div></div>

<p>When running with large heap size you should tune the memory manager settings. This will avoid throwing <tt>SpaceMemoryShortageException</tt> too early. See the <a href="Memory Management Facilities.html#MemoryManagementFacilities-HandlingLargeJVMHeapSize">Handling Large JVM Heap Size</a> section for details.</p>

                     </td>
</tr>
</table>
<table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr>
<td height="12" background="http://www.gigaspaces.com/wiki/images/border/border_bottom.gif"><img src="images/border/spacer.gif" width="1" height="1" border="0"/></td>
</tr>
<tr>
<td align="center"><font color="grey"><a href="http://www.gigaspaces.com">GigaSpaces.com</a> -
		<a href="http://www.gigaspaces.com/wiki/x/xwBmAg" class="smalltext">Legal Notice</a> -
		<a href="http://www.gigaspaces.com/wiki/x/xgBmAg" class="smalltext">3rd Party Licenses</a> -
		<a href="http://www.gigaspaces.com/wiki/x/BQFmAg" class="smalltext">Site Map</a> -
		<a href="http://www.gigaspaces.com/wiki/display/API/API+Documentation+Portal" class="version-link">API Docs</a> -
		<a href="http://forum.openspaces.org/forum.jspa?forumID=175" class="version-link">Forum</a> -
		<a href="http://www.gigaspaces.com/LatestProductVersion" class="version-link">Downloads</a> -
		<a href="http://blog.gigaspaces.com/" class="version-link">Blog</a> -
		<a href="http://www.gigaspaces.com/os_papers.html" class="version-link">White Papers</a> -
		<a href="mailto:techw@gigaspaces.com">Contact Tech Writing</a> -
		<i><a href="http://www.atlassian.com/software/confluence">Gen. by Atlassian Confluence</a></i></font></td>
</tr>
</table>
     </body>
</html>
