<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
     <head>
         <title>XAP 8.0 Documentation : Maven Plugin - Advanced</title>
<link rel="stylesheet" href="styles/site.css" type="text/css" />
         <META http-equiv="Content-Type" content="text/html; charset=UTF-8">
		 <style>
.back-to {
	color: #666666;
	font-weight: bold;
}	 
a.back-to:link, a.back-to:visited, a.back-to:hover, a.back-to:active  {
	color: #666666;
}	 
		 </style>
     </head>

     <body>
<table class="pagecontent" border="0" cellpadding="0" cellspacing="0" width="100%" bgcolor="#ffffff">
<tr>
<td valign="top" class="pagebody">
<div class="pageheader">
<span class="back-to">XAP 8.0 Documentation > <a href="index.html">Back to Table of Contents</a></span><br>
<h1>Maven Plugin - Advanced</h1>
</div>
<br>

<p>

<div style="border-style:solid; border-color:#3C78B5; border-width:thin; padding-left:20px; padding-bottom:20px; padding-top:20px; padding-right:20px; background-color:#D8E4F1"> 

<p><b>Section Summary:</b>  Processing unit assembly definition. </p>
</div><br clear="all" /></p>
<h1><a name="MavenPlugin-Advanced-Description"></a>Description</h1>

<p>This page contains information beyond the basics. It was created for those who want to know a little bit more about how OpenSpaces and Maven integrate. Basically, the information given in <a href="http://www.gigaspaces.com/wiki/display/XAP8/OpenSpaces+Maven+Plugin">OpenSpaces Maven Plugin</a> should be sufficient for the common user.</p>

<h1><a name="MavenPlugin-Advanced-ProcessingUnitAssemblyDefinition"></a>Processing Unit Assembly Definition</h1>

<p>The OpenSpaces maven plugin uses the maven assembly plugin to generate the processing unit directory structure. Each PU module has the file &lt;module-name&gt;/src/main/assembly/assembly.xml that defines the assembly structure. One of its tasks is to determine which of the dependency JARS go into the lib directory and which go into the shared-lib directory.</p>

<p><b>assembly.xml</b></p>
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">&lt;assembly&gt;
  &lt;id&gt;assemble-pu&lt;/id&gt;
  &lt;formats&gt;
    &lt;format&gt;jar&lt;/format&gt;
    &lt;format&gt;dir&lt;/format&gt;
  &lt;/formats&gt;
  &lt;includeBaseDirectory&gt;<span class="code-keyword">false</span>&lt;/includeBaseDirectory&gt;
  &lt;fileSets&gt;
    &lt;fileSet&gt;
      &lt;directory&gt;target/classes&lt;/directory&gt;
      &lt;lineEnding&gt;keep&lt;/lineEnding&gt;
      &lt;outputDirectory&gt;/&lt;/outputDirectory&gt;
      &lt;includes&gt;
        &lt;include&gt;**/**&lt;/include&gt;
      &lt;/includes&gt;
    &lt;/fileSet&gt;
  &lt;/fileSets&gt;
  &lt;dependencySets&gt;
    &lt;dependencySet&gt;
      &lt;useProjectArtifact&gt;<span class="code-keyword">false</span>&lt;/useProjectArtifact&gt;
      &lt;useTransitiveDependencies&gt;<span class="code-keyword">false</span>&lt;/useTransitiveDependencies&gt;
      &lt;outputDirectory&gt;lib&lt;/outputDirectory&gt;
      &lt;excludes&gt;
        &lt;exclude&gt;com.mycompany.app:common&lt;/exclude&gt;
      &lt;/excludes&gt;
    &lt;/dependencySet&gt;
    &lt;dependencySet&gt;
      &lt;useProjectArtifact&gt;<span class="code-keyword">false</span>&lt;/useProjectArtifact&gt;
      &lt;useTransitiveDependencies&gt;<span class="code-keyword">true</span>&lt;/useTransitiveDependencies&gt;
      &lt;useTransitiveFiltering&gt;<span class="code-keyword">true</span>&lt;/useTransitiveFiltering&gt;
      &lt;outputDirectory&gt;shared-lib&lt;/outputDirectory&gt;
      &lt;includes&gt;
        &lt;include&gt;com.mycompany.app:common&lt;/include&gt;
      &lt;/includes&gt;
    &lt;/dependencySet&gt;
  &lt;/dependencySets&gt;
&lt;/assembly&gt;</pre>
</div></div>

<h2><a name="MavenPlugin-Advanced-DependenciesTargetLocations"></a>Dependencies Target Locations</h2>

<p>Inside assembly.xml we have a dependencySets element that contains two dependencySet elements.<br/>
The first dependencySet (where its outputDirectory=lib) defines which JARS go into the lib directory in the PU structure. It excludes the dependency in the common module and its transitive dependencies. In other words, all dependencies that are not related to the commons module go into the lib directory.</p>

<p>The second dependencySet (where its outputDirectory=shared-lib) defines which JARS go into the shared-lib directory in the PU structure. It includes the dependency in common module and its transitive dependencies, leaving other dependencies out. In other words, all dependencies that are related to the commons module go into the shared-lib directory.</p>

<h2><a name="MavenPlugin-Advanced-DependencyScopes"></a>Dependency Scopes</h2>

<p>When defining a dependency for an artifact (module), you can specify the dependency's scope. Scope determines which dependencies participate in the build lifecycle.</p>

<p>Maven defines the following scopes:</p>
<table class='confluenceTable'><tbody>
<tr>
<th class='confluenceTh'> Scope </th>
<th class='confluenceTh'> Description </th>
</tr>
<tr>
<td class='confluenceTd'> <b>compile</b> </td>
<td class='confluenceTd'> Indicates that the dependency is available for the classpaths of all phases. <b>This is the default scope</b>. </td>
</tr>
<tr>
<td class='confluenceTd'> <b>provided</b> </td>
<td class='confluenceTd'> Indicates that the dependency is available on the compile classpath, but in the production environment you expect the JDK or a container to provide it. It is not transitive. </td>
</tr>
<tr>
<td class='confluenceTd'> <b>test</b> </td>
<td class='confluenceTd'> Indicates that the dependency is only available for the test compilation and execution phases. </td>
</tr>
<tr>
<td class='confluenceTd'> <b>runtime</b> </td>
<td class='confluenceTd'> Indicates that the dependency is available for the runtime and test classpaths, but not for the compile classpath. </td>
</tr>
<tr>
<td class='confluenceTd'> <b>system</b> </td>
<td class='confluenceTd'> This scope is similar to provided, except that you have to provide the JAR location explicitly. The artifact is not looked up in a repository. Using this scope is not advised due to portability issues. </td>
</tr>
</tbody></table>
<p><img class="emoticon" src="images/icons/emoticons/information.gif" height="16" width="16" align="absmiddle" alt="" border="0"/> During processing unit packaging only dependencies declared with the scopes <b>compile</b> and <b>runtime</b> are added to the PU distributable.</p>

<p>For more information go to <a href="http://maven.apache.org/guides/introduction/introduction-to-dependency-mechanism.html">Introduction to the Dependency Mechanism</a></p>

<h2><a name="MavenPlugin-Advanced-ConfiguringMaventousetheAssemblyDescriptor"></a>Configuring Maven to use the Assembly Descriptor</h2>

<p>To instruct Maven to use this assembly descriptor to generate the processing units, we configure the assembly plugin by adding the following xml snippet to the module's pom.xml file.</p>

<p><b>pom.xml</b></p>
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">&lt;build&gt;
  ...
  &lt;finalName&gt;testing-feeder&lt;/finalName&gt;
  &lt;plugins&gt;
    &lt;plugin&gt;
      &lt;artifactId&gt;maven-assembly-plugin&lt;/artifactId&gt;
      &lt;configuration&gt;
        &lt;appendAssemblyId&gt;<span class="code-keyword">false</span>&lt;/appendAssemblyId&gt;
        &lt;attach&gt;<span class="code-keyword">false</span>&lt;/attach&gt;
        &lt;ignoreDirFormatExtensions&gt;<span class="code-keyword">true</span>&lt;/ignoreDirFormatExtensions&gt;
        &lt;descriptors&gt;
          &lt;descriptor&gt;src/main/assembly/assembly.xml&lt;/descriptor&gt;
        &lt;/descriptors&gt;
      &lt;/configuration&gt;
      &lt;executions&gt;
        &lt;execution&gt;
          &lt;id&gt;assembly&lt;/id&gt;
          &lt;phase&gt;<span class="code-keyword">package</span>&lt;/phase&gt;
          &lt;goals&gt;
            &lt;goal&gt;single&lt;/goal&gt;
          &lt;/goals&gt;
        &lt;/execution&gt;
      &lt;/executions&gt;
    &lt;/plugin&gt;
  &lt;/plugins&gt;
  ...
&lt;/build&gt;</pre>
</div></div>

<h2><a name="MavenPlugin-Advanced-FurtherInformation"></a>Further Information</h2>

<p>For further information about the assembly plugin options, go to:</p>
<ul>
	<li><a href="http://maven.apache.org/plugins/maven-assembly-plugin/">Assembly plugin documentation</a></li>
	<li><a href="http://maven.apache.org/plugins/maven-assembly-plugin/assembly.html">Assembly descriptor reference</a></li>
	<li><a href="http://maven.apache.org/plugins/maven-assembly-plugin/single-mojo.html">Assembly plugin 'single' mojo documentation</a></li>
</ul>


                     </td>
</tr>
</table>
<table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr>
<td height="12" background="http://www.gigaspaces.com/wiki/images/border/border_bottom.gif"><img src="images/border/spacer.gif" width="1" height="1" border="0"/></td>
</tr>
<tr>
<td align="center"><font color="grey"><a href="http://www.gigaspaces.com">GigaSpaces.com</a> -
		<a href="http://www.gigaspaces.com/wiki/x/xwBmAg" class="smalltext">Legal Notice</a> -
		<a href="http://www.gigaspaces.com/wiki/x/xgBmAg" class="smalltext">3rd Party Licenses</a> -
		<a href="http://www.gigaspaces.com/wiki/x/BQFmAg" class="smalltext">Site Map</a> -
		<a href="http://www.gigaspaces.com/wiki/display/API/API+Documentation+Portal" class="version-link">API Docs</a> -
		<a href="http://forum.openspaces.org/forum.jspa?forumID=175" class="version-link">Forum</a> -
		<a href="http://www.gigaspaces.com/LatestProductVersion" class="version-link">Downloads</a> -
		<a href="http://blog.gigaspaces.com/" class="version-link">Blog</a> -
		<a href="http://www.gigaspaces.com/os_papers.html" class="version-link">White Papers</a> -
		<a href="mailto:techw@gigaspaces.com">Contact Tech Writing</a> -
		<i><a href="http://www.atlassian.com/software/confluence">Gen. by Atlassian Confluence</a></i></font></td>
</tr>
</table>
     </body>
</html>
