<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
     <head>
         <title>XAP 8.0 Documentation : Optimistic Locking</title>
<link rel="stylesheet" href="styles/site.css" type="text/css" />
         <META http-equiv="Content-Type" content="text/html; charset=UTF-8">
		 <style>
.back-to {
	color: #666666;
	font-weight: bold;
}	 
a.back-to:link, a.back-to:visited, a.back-to:hover, a.back-to:active  {
	color: #666666;
}	 
		 </style>
     </head>

     <body>
<table class="pagecontent" border="0" cellpadding="0" cellspacing="0" width="100%" bgcolor="#ffffff">
<tr>
<td valign="top" class="pagebody">
<div class="pageheader">
<span class="back-to">XAP 8.0 Documentation > <a href="index.html">Back to Table of Contents</a></span><br>
<h1>Optimistic Locking</h1>
</div>
<br>

<script type='text/javascript'>//<![CDATA[
function debug() { }
// ]]></script><script type='text/javascript' src='/wiki/download/resources/net.customware.confluence.plugin.composition:composition-setup/js/browser.js'>//<![CDATA[
// ]]></script><script type='text/javascript' src='/wiki/download/resources/net.customware.confluence.plugin.composition:composition-setup/js/behaviour.js'>//<![CDATA[
// ]]></script><script type='text/javascript' src='/wiki/download/resources/net.customware.confluence.plugin.composition:composition-setup/js/memory.js'>//<![CDATA[
// ]]></script><script type='text/javascript' src='/wiki/download/resources/net.customware.confluence.plugin.composition:composition-setup/js/cloak.js'>//<![CDATA[
// ]]></script><script type='text/javascript'>//<![CDATA[
Cloak.closeHTML = "<img src=\'/wiki/download/resources/net.customware.confluence.plugin.composition:toggle-cloak/img/navigate_down_10.gif\'/>";
Cloak.openHTML = "<img src=\'/wiki/download/resources/net.customware.confluence.plugin.composition:toggle-cloak/img/navigate_right_10.gif\'/>";
Cloak.toggleZone = true;
Cloak.memoryDuration = 0;
Cloak.memoryPrefix = "contentId:53903675";
Cloak.memoryPath = "/wiki/";
// ]]></script><style type='text/css'>
.cloakToggle { /* Definition for state toggling image */
cursor:hand;
cursor:pointer;
}
</style><script type='text/javascript' src='/wiki/download/resources/net.customware.confluence.plugin.composition:composition-setup/js/transitions.js'>//<![CDATA[
// ]]></script><script type='text/javascript' src='/wiki/download/resources/net.customware.confluence.plugin.composition:composition-setup/js/deck.js'>//<![CDATA[
// ]]></script><link rel='stylesheet' type='text/css'  href='/wiki/styles/main-action.css?pluginCompleteKey=net.customware.confluence.plugin.composition:composition-setup&stylesheetName=deck&spaceKey=XAP8'/><script type='text/javascript'>//<![CDATA[
Deck.memoryDuration = 0;
Deck.memoryPrefix = "contentId:53903675";
Deck.memoryPath = "/wiki/";
// ]]></script>


<div style="border-style:solid; border-color:#3C78B5; border-width:thin; padding-left:20px; padding-bottom:20px; padding-top:20px; padding-right:20px; background-color:#D8E4F1"> 

<p><b>Section Summary:</b>  The optimistic locking protocol provides better performance and scalability when having concurrent access to the same data. Optimistic locking offers higher concurrency and better performance than pessimistic locking. It also avoids deadlocks.</p>

</div>

<h1><a name="OptimisticLocking-Overview"></a>Overview</h1>
<p>With optimistic locking, you write your business logic allowing multiple users to read the same object at the same time, but allow only one user to update the object successfully. The assumption is that there will be a relatively large number of users trying to read the same object, but a low probability of having a small number of users trying to update the same object at the same time. </p>

<p>In the case of multiple users trying to update the same object at the same time, the one(s) that try to update a non-recent object version fail.  </p>

<p>Optimistic locking relies on the idea that data remains unmodified while it is away from the server. As a simple example, consider how you update a customer details object. The customer details are stored within an object, and if a client application needs to update them, it first needs to get the object from the space. The data is not locked, and other client applications can have access to it simultaneously, thus ensuring a scalable system.</p>

<p>The problem is that while the customer details object is away from the space server, it may become stale. For example, a second client application can request the same customer details, update them, and commit them back to the space. The first client, unaware that it is dealing with a stale copy of the data, modifies and commits the data. Obviously, with no version checking mechanism to detect this conflict, the first client's application changes, which commit last, are made permanent, thus overwriting the changes made by the second client application.</p>

<p>For optimistic locking to work effectively, you must be able to detect these update-update conflicts, and to make the client aware of them, so they can be dealt with appropriately. </p>

<p>GigaSpaces optimistic locking protocol:</p>
<ul class="alternate" type="square">
	<li>Is best suited for environments with many read-only transactions, few read-update transactions, and a relatively low volume of objects that are changed.</li>
	<li>Is more suitable for real-time systems than pessimistic locking, because the space runs best with short term transactions.</li>
	<li>Has a big advantage when you want to read a large number of objects, but update only a few of them - or when it is unlikely that objects you want to work with are updated by other users.</li>
	<li>Ensures that updated objects are the most recent ones, while improving the coherency of system behavior.</li>
</ul>


<h1><a name="OptimisticLocking-UsingtheOptimisticLockingProtocol"></a>Using the Optimistic Locking Protocol</h1>
<p>Here are the steps you should execute to update data, using the optimistic locking protocol:</p>

<div class="error"><span class="error">Error formatting macro: toc-zone: java.lang.NullPointerException</span> 

<h2><a name="OptimisticLocking-Step1GetaSpaceProxyinVersionedMode"></a>Step 1 &#8211; Get a Space Proxy in Versioned Mode</h2>
<p>Get a space proxy in <tt>versioned</tt> mode. This can be done using one of the options listed below. You may get remote or embedded space proxies. Make sure the proxy is in optimistic locking mode using the (<tt>versioned</tt>) option. This can be done using one of the options listed below:</p>
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">GigaSpace space = <span class="code-keyword">new</span> GigaSpaceConfigurer(<span class="code-keyword">new</span> UrlSpaceConfigurer(<span class="code-quote">"jini:<span class="code-comment">//*/*/space"</span>).versioned(<span class="code-keyword">true</span>)).gigaSpace();</span></pre>
</div></div>
<p>or</p>
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">&lt;os-core:space id=<span class="code-quote">"space"</span> url=<span class="code-quote">"jini:<span class="code-comment">//*/*/mySpace"</span>  versioned=<span class="code-quote">"<span class="code-keyword">true</span>"</span> /&gt;</span></pre>
</div></div>

<h2><a name="OptimisticLocking-Step2EnabletheSpaceClasstoSupportOptimisticLocking"></a>Step 2 &#8211; Enable the Space Class to Support Optimistic Locking</h2>
<p>You should enable the Space class to support the optimistic locking protocol, by including the <tt>@SpaceVersion</tt> decoration on an <tt>int</tt> getter field. This field stores the current object version and is maintained by GigaSpaces. See below for an example:</p>
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">@SpaceClass
<span class="code-keyword">public</span> class Employee
{
	<span class="code-keyword">private</span> <span class="code-object">int</span> versionID;
	@SpaceVersion
	<span class="code-keyword">public</span> <span class="code-object">int</span> getVersionID(){<span class="code-keyword">return</span> versionID;	}
	<span class="code-keyword">public</span> void setVersionID(<span class="code-object">int</span> versionID)	{<span class="code-keyword">this</span>.versionID=versionID;}</pre>
</div></div>

<h2><a name="OptimisticLocking-Step3ReadObjectswithoutusingaTransaction"></a>Step 3 &#8211; Read Objects without using a Transaction</h2>
<p>Read objects from the space without using a transaction. You may use the <tt>readMultiple</tt> method to get several objects in one call. Reading objects without using a transaction, allows multiple users to get the same objects at the same time, and allows them to be updated using the optimistic locking protocol. If objects are read using a transaction, no other user can update the objects until the object is committed or rolled back. </p>

<h2><a name="OptimisticLocking-Step4ModifyandUpdatetheObjects"></a>Step 4 &#8211; Modify and Update the Objects</h2>
<p>Modify the objects you read from the space and call a <tt>write</tt> space operation to update the object within the space. <br/>
Use a transactional with your write operation. You <b>must</b> use a transaction when you update multiple space objects in the same context. When the write operation is called to update the object, the space does the following:</p>
<ul>
	<li>for each updated object, the Version ID in the updated object is compared with the Version ID of the corresponding object within the space. This is done at the space side.</li>
	<li>if the Version ID of the updated object is the same as the Version ID of the corresponding object within the space, it is incremented by 1, and the object is updated within the space successfully.</li>
	<li>if the Version ID of the updated object is different than the Version ID of the corresponding object within the space, the object is not updated within the space - i.e. the operation fails. In this case, a <tt>SpaceOptimisticLockingFailureException</tt> is thrown.
<div class='panelMacro'><table class='tipMacro'><colgroup><col width='24'><col></colgroup><tr><td valign='top'><img src="images/icons/emoticons/check.gif" width="16" height="16" align="absmiddle" alt="" border="0"></td><td>It is recommended that you call the update operation just before the commit operation. This minimizes the time the object is locked under a transaction.</td></tr></table></div>
<div class="indent20 inline" style="margin-left: 20px;"><style type="text/css">div.inline p:first-child { display: inline; }</style><p><img src="download/attachments/48235229/optimistick_lock2.jpg" align="absmiddle" border="0"/></p></div></li>
</ul>


<h2><a name="OptimisticLocking-Step5UpdateFailure"></a>Step 5 &#8211; Update Failure</h2>
<p>If you use optimistic locking and your update operation fails, an <tt>org.openspaces.core.SpaceOptimisticLockingFailureException</tt> is thrown. This exception is thrown when you try to write an object whose version ID value does not match the version of the existing object within the space - i.e. you are not using the latest version of the object. You can either roll back or refresh the failed object and try updating it again. This means you should repeat step 4 - refreshing the failed object reads the latest committed object from the space, back to the client side. For a fast refresh, you may read the object using the <tt>readByID</tt> method. Make sure you also provide the <tt>SpaceRouting</tt> value.</p>

<h2><a name="OptimisticLocking-Step6CommitorRollbackChanges"></a>Step 6 &#8211; Commit or Rollback Changes</h2>
<p>At any time, you can commit or rollback the transaction. If you are using Spring automatic transaction demarcation, the commit is called implicitly once the method that started the transaction is completed.</p>

<p>By following the above procedure, you get a shorter locking duration, that improves performance and concurrency of access among multiple users to the space object. The object version ID validation that is performed on <tt>update</tt>, <tt>take</tt>, and <tt>updateMultiple</tt> requests, keeps the data within the space consistent.</p></div>

<h1><a name="OptimisticLocking-Examples"></a>Examples</h1>
<p>We use the following Space Class with our examples:</p>
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java"><span class="code-keyword">import</span> com.gigaspaces.annotation.pojo.*;

@SpaceClass
<span class="code-keyword">public</span> class Employee
{
	<span class="code-keyword">private</span> <span class="code-object">Integer</span>	employeeID;
	<span class="code-keyword">private</span> <span class="code-object">String</span>	lastName;
	<span class="code-keyword">private</span> <span class="code-object">String</span>	firstName;
	<span class="code-keyword">private</span> <span class="code-object">int</span> versionID;
	
	<span class="code-keyword">public</span> Employee(){}
	<span class="code-keyword">public</span> Employee(<span class="code-object">Integer</span> employeeID){<span class="code-keyword">this</span>.employeeID = employeeID;}
	<span class="code-keyword">public</span> Employee(<span class="code-object">String</span> lastName, <span class="code-object">Integer</span> employeeID)
	{
		<span class="code-keyword">this</span>.employeeID = employeeID;
		setLastName(lastName);
	}

	<span class="code-keyword">public</span> Employee(<span class="code-object">String</span> lastName,<span class="code-object">String</span> firstName ,<span class="code-object">Integer</span> employeeID)
	{
		<span class="code-keyword">this</span>.employeeID = employeeID;
		setFirstName(firstName);
		setLastName(lastName);
	}
	
	@SpaceId
	@SpaceRouting
	<span class="code-keyword">public</span> <span class="code-object">Integer</span> getEmployeeID(){	<span class="code-keyword">return</span> employeeID;}
	<span class="code-keyword">public</span>  void setEmployeeID(<span class="code-object">Integer</span> employeeID){	<span class="code-keyword">this</span>.employeeID = employeeID;}
	
	@SpaceIndex (type=SpaceIndexType.BASIC)
	<span class="code-keyword">private</span> <span class="code-object">String</span> getFirstName(){<span class="code-keyword">return</span> firstName;}
	<span class="code-keyword">public</span> void setFirstName(<span class="code-object">String</span> firstName)	{<span class="code-keyword">this</span>.firstName = firstName;	}
	
	<span class="code-keyword">private</span> <span class="code-object">String</span> getLastName(){<span class="code-keyword">return</span> lastName;}
	<span class="code-keyword">public</span> void setLastName(<span class="code-object">String</span> name){	<span class="code-keyword">this</span>.lastName = name;}

	@SpaceVersion
	<span class="code-keyword">public</span> <span class="code-object">int</span> getVersionID(){<span class="code-keyword">return</span> versionID;	}
	<span class="code-keyword">public</span> void setVersionID(<span class="code-object">int</span> versionID)	{<span class="code-keyword">this</span>.versionID= versionID;}

}</pre>
</div></div>

<div class="panel" style="background-color: #FFFFFF;border-color: #3C78B5;border-style: solid;border-width: 1px;"><div class="panelContent" style="background-color: #FFFFFF;">
<h5><a name="OptimisticLocking-NonTransactionalUpdate"></a>Non-Transactional Update</h5>
<hr 
 size="1" 
 color="#3C78B5" 
 >

<p>This example illustrates optimistic locking usage without using a transactional update:</p>
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">@GigaSpaceContext (name=<span class="code-quote">"gigaspace"</span>)
GigaSpace gigaspace;

@Transactional(propagation=Propagation.NEVER)
<span class="code-keyword">public</span> void simpleOL() <span class="code-keyword">throws</span> Exception{
	Employee employ= <span class="code-keyword">new</span> Employee(<span class="code-quote">"Last Name1"</span> , <span class="code-quote">"First name1"</span> , <span class="code-keyword">new</span> <span class="code-object">Integer</span>(1));
	gigaspace.write(employ);
	
	<span class="code-keyword">try</span>
	{
		<span class="code-comment">//Read should not use a transaction!
</span>		Employee v1Employee = gigaspace.readById(Employee.class,<span class="code-keyword">new</span> <span class="code-object">Integer</span>(1),<span class="code-keyword">new</span> <span class="code-object">Integer</span>(1));
		Employee v2Employee= gigaspace.readById(Employee.class,<span class="code-keyword">new</span> <span class="code-object">Integer</span>(1),<span class="code-keyword">new</span> <span class="code-object">Integer</span>(1));
		<span class="code-object">System</span>.out.println(<span class="code-quote">"About to Write Version:"</span>  + v1Employee.getVersionID());
		gigaspace .write(v1Employee);
		<span class="code-object">System</span>.out.println(<span class="code-quote">"Employee ID "</span>  + v1Employee.getEmployeeID() + <span class="code-quote">" - <span class="code-object">Object</span> version in Space:"</span>  + 
			v2Employee.getVersionID());
		<span class="code-object">System</span>.out.println(<span class="code-quote">"About to Write Version:"</span>  + v2Employee.getVersionID());
		gigaspace .write(v2Employee);
	}
	<span class="code-keyword">catch</span> (SpaceOptimisticLockingFailureException solfe)
	{
		<span class="code-object">System</span>.out.println(<span class="code-quote">"Got  "</span> + solfe);
		<span class="code-object">System</span>.out.println(<span class="code-quote">"re-read Employee <span class="code-object">Object</span> again"</span>);
		Employee v3Employee= gigaspace .readById(Employee.class,<span class="code-keyword">new</span> <span class="code-object">Integer</span>(1),<span class="code-keyword">new</span> <span class="code-object">Integer</span>(1));
		<span class="code-object">System</span>.out.println(<span class="code-quote">"Perform update again. Client <span class="code-object">Object</span> version:"</span> + v3Employee.getVersionID());
		LeaseContext&lt;Employee&gt; leaseContext= gigaspace .write(v3Employee);
		<span class="code-keyword">if</span> (leaseContext.getObject()!= <span class="code-keyword">null</span>)
			<span class="code-object">System</span>.out.println(<span class="code-quote">"Update Successful! <span class="code-object">Object</span> version in Space:"</span>  
				+ v3Employee.getVersionID());
	}
}</pre>
</div></div>

<p>Here is the expected output:</p>
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">About to Write Version:1
Employee ID 1 - <span class="code-object">Object</span> version in Space:1
About to Write Version:1
Got org.openspaces.core.SpaceOptimisticLockingFailureException: Entry Version ID conflict, Operation rejected. 
Operation=Update UID=2012775165^17^1^0^0 space entry version=2 client version=1; 
nested exception is com.j_spaces.core.client.EntryVersionConflictException: 
Entry Version ID conflict, Operation rejected. 
Operation=Update UID=2012775165^17^1^0^0 space entry version=2 client version=1
re-read <span class="code-object">Object</span> again
perform Update again.. Client <span class="code-object">Object</span> version:2
Update Successful! <span class="code-object">Object</span> version in Space:3</pre>
</div></div>


<h5><a name="OptimisticLocking-TransactionalUpdate"></a>Transactional Update</h5>
<hr 
 size="1" 
 color="#3C78B5" 
 >

<p>The read and the transactional update methods:</p>
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java"><span class="code-keyword">public</span> class MyApp {	
	@GigaSpaceContext (name=<span class="code-quote">"gigaspace"</span>)
	GigaSpace gigaspace;
	
	@Transactional(propagation=Propagation.NEVER)
	<span class="code-keyword">public</span> void init() <span class="code-keyword">throws</span> Exception{
		gigaspace.clear(<span class="code-keyword">null</span>);
		Employee employ= <span class="code-keyword">new</span> Employee(<span class="code-quote">"Last Name1"</span> , <span class="code-quote">"First name1"</span> , <span class="code-keyword">new</span> <span class="code-object">Integer</span>(1));
		gigaspace.write(employ);
	}

	@Transactional(propagation=Propagation.NEVER)
	<span class="code-keyword">public</span> Employee readEmployee(<span class="code-object">Object</span> id , <span class="code-object">Object</span> routing)
	{
		<span class="code-keyword">return</span> gigaspace.readById(Employee.class,id ,routing);
	}

	@Transactional(propagation=Propagation.REQUIRES_NEW)
	<span class="code-keyword">public</span> LeaseContext&lt;Employee&gt; writeEmployee (Employee employee)
	{
		<span class="code-keyword">return</span> gigaspace.write(employee);
	}
}</pre>
</div></div>
<p>The calling method:</p>
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java"><span class="code-keyword">public</span> void myBizzLogic() <span class="code-keyword">throws</span> Exception {
	myapp.init();
	Employee v1Employee = myapp.readEmployee(<span class="code-keyword">new</span> <span class="code-object">Integer</span>(1),<span class="code-keyword">new</span> <span class="code-object">Integer</span>(1));
	Employee v2Employee = myapp.readEmployee(<span class="code-keyword">new</span> <span class="code-object">Integer</span>(1),<span class="code-keyword">new</span> <span class="code-object">Integer</span>(1));
	<span class="code-object">System</span>.out.println(<span class="code-quote">"About to Write Version:"</span>  + v1Employee.getVersionID());
	myapp.writeEmployee (v1Employee);
	<span class="code-object">System</span>.out.println(<span class="code-quote">"Write Employee version "</span> + v1Employee.getVersionID()+<span class="code-quote">" OK!"</span>);
	<span class="code-object">System</span>.out.println(<span class="code-quote">"About to Write Version:"</span>  + v2Employee.getVersionID());
	<span class="code-keyword">try</span>
	{
		myapp.writeEmployee (v2Employee );
	}
	<span class="code-keyword">catch</span> (SpaceOptimisticLockingFailureException solfe)
	{
		<span class="code-object">System</span>.out.println(<span class="code-quote">"Got  "</span> + solfe);
		<span class="code-object">System</span>.out.println(<span class="code-quote">"re-read Employee <span class="code-object">Object</span> again!"</span>);
		Employee v3Employee = myapp.readEmployee(<span class="code-keyword">new</span> <span class="code-object">Integer</span>(1),<span class="code-keyword">new</span> <span class="code-object">Integer</span>(1));
		<span class="code-object">System</span>.out.println(<span class="code-quote">"Perform update again. Client <span class="code-object">Object</span> version:"</span> + v3Employee.getVersionID());
		LeaseContext&lt;Employee&gt; leaseContext=myapp.writeEmployee(v3Employee);
		<span class="code-keyword">if</span> (leaseContext.getObject()!= <span class="code-keyword">null</span>)
			<span class="code-object">System</span>.out.println(<span class="code-quote">"Update Successful! <span class="code-object">Object</span> version in Space:"</span>  + v3Employee.getVersionID());
	}
	<span class="code-object">System</span>.out.println(<span class="code-quote">"Done!"</span>);
}</pre>
</div></div>
<p>Here is the expected output:</p>
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">About to Write Version:1
Employee ID 1 - <span class="code-object">Object</span> version in Space:1
About to Write Version:1
Got org.openspaces.core.SpaceOptimisticLockingFailureException: Entry Version ID conflict, Operation rejected.
Operation=Update UID=2012775165^17^1^0^0 space entry version=2 client version=1; 
nested exception is com.j_spaces.core.client.EntryVersionConflictException: 
Entry Version ID conflict, Operation rejected. Operation=Update UID=2012775165^17^1^0^0 space entry version=2 client version=1
re-read <span class="code-object">Object</span> again
perform Update again.. Client <span class="code-object">Object</span> version:2
Update Successful! <span class="code-object">Object</span> version in Space:3</pre>
</div></div>



<h5><a name="OptimisticLocking-MultipleObjectsUpdate"></a>Multiple Objects Update</h5>
<hr 
 size="1" 
 color="#3C78B5" 
 >

<p>In general, when calling the <tt>updateMultiple()</tt> you should check every returned object from the returned array.</p>

<p>If one of the returned objects is a <tt>SpaceOptimisticLockingFailureException</tt>, this indicates that the update failed. In this case you should re-read the relevant object, and call the update operation again. </p>

<p>The read and update methods:</p>
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">@Transactional(propagation=Propagation.NEVER)
<span class="code-keyword">public</span> Employee[] readEmployees(Employee template)
{
	<span class="code-keyword">return</span> gigaspace.readMultiple(template, <span class="code-object">Integer</span>.MAX_VALUE);
}

@Transactional(propagation=Propagation.REQUIRES_NEW)
<span class="code-keyword">public</span> <span class="code-object">Object</span>[] writeEmployees (Employee employee[])
{
	<span class="code-keyword">return</span> gigaspace.updateMultiple(employee,<span class="code-keyword">new</span> <span class="code-object">long</span> [employee.length]);
}</pre>
</div></div>

<p>This method checks if the returned result includes a <tt>SpaceOptimisticLockingFailureException</tt>:</p>
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java"><span class="code-keyword">static</span> <span class="code-object">boolean</span> checkResult(<span class="code-object">Object</span> results[])
{
	<span class="code-keyword">for</span> (<span class="code-object">Object</span> result : results) {
		<span class="code-keyword">if</span> (result  <span class="code-keyword">instanceof</span> SpaceOptimisticLockingFailureException) {
			<span class="code-keyword">return</span> <span class="code-keyword">false</span>;
		}
	}
	<span class="code-keyword">return</span> <span class="code-keyword">true</span>;
}</pre>
</div></div>

<p>The application read and update logic:</p>
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">Employee employees1 [] = app.readEmployees(<span class="code-keyword">new</span> Employee());
Employee employees2 [] = app.readEmployees(<span class="code-keyword">new</span> Employee());
<span class="code-object">Object</span> res1[] = app.writeEmployees(employees1);
<span class="code-keyword">if</span> (!checkResult(res1))
{
	<span class="code-object">System</span>.out.println(<span class="code-quote">"Error Updating objects"</span>);
}
<span class="code-keyword">while</span> (<span class="code-keyword">true</span>)
{
	<span class="code-object">Object</span> res2[] = app.writeEmployees(employees2);
	<span class="code-keyword">if</span> (!checkResult(res2))
	{
		<span class="code-object">System</span>.out.println(<span class="code-quote">"Error Updating objects"</span>);
		employees2 = app.readEmployees(<span class="code-keyword">new</span> Employee());
	}
	<span class="code-keyword">else</span>
	{
		<span class="code-keyword">break</span>;
	}
}</pre>
</div></div>
</div></div>

<div class='panelMacro'><table class='tipMacro'><colgroup><col width='24'><col></colgroup><tr><td valign='top'><img src="images/icons/emoticons/check.gif" width="16" height="16" align="absmiddle" alt="" border="0"></td><td>When there are more than 2 clients (or 2 threads within the same client) that might update space objects at the same time, before re-reading the space objects, you should have a short sleep with a random duration. This allows one of the threads to complete the update successfully. Without such a sleep, you might have a contention with the update activity.</td></tr></table></div>



<h1><a name="OptimisticLocking-ScenarioExample"></a>Scenario Example</h1>

<p>Suppose that you have two applications, Application_1 and Application_2, which are both working with the same Object A. The following sequence of events describes a simple optimistic locking scenario.</p>
<table class='confluenceTable'><tbody>
<tr>
<th class='confluenceTh'> Time </th>
<th class='confluenceTh'> Action </th>
<th class='confluenceTh'> Application_1 </th>
<th class='confluenceTh'> Application_2 </th>
</tr>
<tr>
<td class='confluenceTd'> <tt>T=1</tt> </td>
<td class='confluenceTd'> Initial conditions: both applications read the object from the space. </td>
<td class='confluenceTd'> Object A <tt>VersionID=1</tt><br clear="all" />
 <tt>Value1=X</tt><br clear="all" />
 <tt>Value2=Y</tt> </td>
<td class='confluenceTd'> Object A<br clear="all" />
 <tt>VersionID=1</tt><br clear="all" />
 <tt>Value1=X</tt><br clear="all" />
 <tt>Value2=Y</tt> </td>
</tr>
<tr>
<td class='confluenceTd'> <tt>T=2</tt> </td>
<td class='confluenceTd'> Both modify the same objects. </td>
<td class='confluenceTd'> Object A <tt>VersionID=1</tt><br clear="all" />
 <tt>value1=X</tt><br clear="all" />
 <tt>Value2=Y_1</tt> </td>
<td class='confluenceTd'> Object A<br clear="all" />
 <tt>VersionID=1</tt><br clear="all" />
 <tt>value1=X_2</tt><br clear="all" />
 <tt>Value2=Y</tt> </td>
</tr>
<tr>
<td class='confluenceTd'> <tt>T=3</tt> </td>
<td class='confluenceTd'> Application_2 updates object A and commits - commit is successful. </td>
<td class='confluenceTd'> Object A<br clear="all" />
 <tt>VersionID=1</tt><br clear="all" />
 <tt>Value1=X</tt><br clear="all" />
 <tt>Value2=Y_1</tt> </td>
<td class='confluenceTd'> Object A<br clear="all" />
 <tt>VersionID=2</tt><br clear="all" />
 <tt>Value1=X_2</tt><br clear="all" />
 <tt>Value2=Y</tt> </td>
</tr>
<tr>
<td class='confluenceTd'> <tt>T=4</tt> </td>
<td class='confluenceTd'> Application_1 tries to update object A, but fails due to invalid Version ID. </td>
<td class='confluenceTd'> Object A <tt>VersionID=1</tt><br clear="all" />
 <tt>Value1=X</tt><br clear="all" />
 <tt>Value2=Y_1</tt> </td>
<td class='confluenceTd'>&nbsp;</td>
</tr>
<tr>
<td class='confluenceTd'> <tt>T=5</tt> </td>
<td class='confluenceTd'> Application_1 refreshes object A (re-reads it). </td>
<td class='confluenceTd'> Object A <br clear="all" />
 <tt>VersionID=2</tt><br clear="all" />
 <tt>Value1=X_2</tt><br clear="all" />
 <tt>Value2=Y</tt> </td>
<td class='confluenceTd'>&nbsp;</td>
</tr>
<tr>
<td class='confluenceTd'> <tt>T=6</tt> </td>
<td class='confluenceTd'> Application_1 updates object A again and commits - commit is successful. </td>
<td class='confluenceTd'> Object A <tt>VersionID=3</tt><br clear="all" />
 <tt>value1=X_2</tt><br clear="all" />
 <tt>Value2=Y_1</tt> </td>
<td class='confluenceTd'>&nbsp;</td>
</tr>
</tbody></table>


                     </td>
</tr>
</table>
<table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr>
<td height="12" background="http://www.gigaspaces.com/wiki/images/border/border_bottom.gif"><img src="images/border/spacer.gif" width="1" height="1" border="0"/></td>
</tr>
<tr>
<td align="center"><font color="grey"><a href="http://www.gigaspaces.com">GigaSpaces.com</a> -
		<a href="http://www.gigaspaces.com/wiki/x/xwBmAg" class="smalltext">Legal Notice</a> -
		<a href="http://www.gigaspaces.com/wiki/x/xgBmAg" class="smalltext">3rd Party Licenses</a> -
		<a href="http://www.gigaspaces.com/wiki/x/BQFmAg" class="smalltext">Site Map</a> -
		<a href="http://www.gigaspaces.com/wiki/display/API/API+Documentation+Portal" class="version-link">API Docs</a> -
		<a href="http://forum.openspaces.org/forum.jspa?forumID=175" class="version-link">Forum</a> -
		<a href="http://www.gigaspaces.com/LatestProductVersion" class="version-link">Downloads</a> -
		<a href="http://blog.gigaspaces.com/" class="version-link">Blog</a> -
		<a href="http://www.gigaspaces.com/os_papers.html" class="version-link">White Papers</a> -
		<a href="mailto:techw@gigaspaces.com">Contact Tech Writing</a> -
		<i><a href="http://www.atlassian.com/software/confluence">Gen. by Atlassian Confluence</a></i></font></td>
</tr>
</table>
     </body>
</html>
