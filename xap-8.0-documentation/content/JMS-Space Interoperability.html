<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
     <head>
         <title>XAP 8.0 Documentation : JMS-Space Interoperability</title>
<link rel="stylesheet" href="styles/site.css" type="text/css" />
         <META http-equiv="Content-Type" content="text/html; charset=UTF-8">
		 <style>
.back-to {
	color: #666666;
	font-weight: bold;
}	 
a.back-to:link, a.back-to:visited, a.back-to:hover, a.back-to:active  {
	color: #666666;
}	 
		 </style>
     </head>

     <body>
<table class="pagecontent" border="0" cellpadding="0" cellspacing="0" width="100%" bgcolor="#ffffff">
<tr>
<td valign="top" class="pagebody">
<div class="pageheader">
<span class="back-to">XAP 8.0 Documentation > <a href="index.html">Back to Table of Contents</a></span><br>
<h1>JMS-Space Interoperability</h1>
</div>
<br>



<div style="border-style:solid; border-color:#3C78B5; border-width:thin; padding-left:20px; padding-bottom:20px; padding-top:20px; padding-right:20px; background-color:#D8E4F1"> 

<p><b>Section Summary:</b>  Creating JMS messages with the space API; reading/taking JMS messages with the space API; using JMS API with the <tt>MessageConverter</tt> to send custom POJOs to the space. </p>
</div>

<h1><a name="JMS-SpaceInteroperability-Overview"></a>Overview</h1>

<p>JMS-space interoperability allows JMS applications to communicate with non-JMS applications using the space, without having to know or deal with the space API.</p>

<p>Gigaspaces 6.0 introduced the ability for JMS applications to write messages to the space by implementing them as Externalizable <tt>MetaDataEntries</tt>, thus allowing non-JMS applications (usually space API applications) to read these <tt>MetaDataEntries</tt> using a template.</p>

<p>Furthermore, since GigaSpaces 6.0, an application using the space API can write JMS messages of any type to the space, using the space API (without knowing JMS). Therefore, it is possible to handle JMS messages the same way as any other Entry type.</p>

<p>In GigaSpaces 6.0.1, it is possible for the JMS application to control and decide exactly which type of object is written to the space, as long as the written object is valid for the receiving/reading application. This is done using the new <a href="#JMS-SpaceInteroperability-WritingPOJOs%2FEntriestoSpaceusingJMSAPIMessageConverter">MessageConverter</a> feature. A common use-case is writing a JMS message to the space, where the message is "stripped" on the space side, leaving only the message body, usually a POJO. The space application can then read the POJO using a template that includes only the POJO type.</p>

<p>To summarize, the table below shows which operations are supported, allowing interoperability between the JMS and space API.</p>

<table class='confluenceTable'><tbody>
<tr>
<th class='confluenceTh'> Operation </th>
<th class='confluenceTh'> JMS Application </th>
<th class='confluenceTh'> Space Application </th>
</tr>
<tr>
<td class='confluenceTd'> Write JMS messages to space </td>
<td class='confluenceTd'> <img class="emoticon" src="images/icons/emoticons/check.gif" height="16" width="16" align="absmiddle" alt="" border="0"/> </td>
<td class='confluenceTd'> <img class="emoticon" src="images/icons/emoticons/check.gif" height="16" width="16" align="absmiddle" alt="" border="0"/> &#8211; <b>new in 6.0</b> </td>
</tr>
<tr>
<td class='confluenceTd'> Write Entries to space </td>
<td class='confluenceTd'> <img class="emoticon" src="images/icons/emoticons/check.gif" height="16" width="16" align="absmiddle" alt="" border="0"/> &#8211; <b>new in 6.0</b> </td>
<td class='confluenceTd'> <img class="emoticon" src="images/icons/emoticons/check.gif" height="16" width="16" align="absmiddle" alt="" border="0"/> </td>
</tr>
<tr>
<td class='confluenceTd'> Write POJOs (or objects of any type) to space </td>
<td class='confluenceTd'> <img class="emoticon" src="images/icons/emoticons/check.gif" height="16" width="16" align="absmiddle" alt="" border="0"/> &#8211; <b>new in 6.0.1</b> </td>
<td class='confluenceTd'> <img class="emoticon" src="images/icons/emoticons/check.gif" height="16" width="16" align="absmiddle" alt="" border="0"/> </td>
</tr>
<tr>
<td class='confluenceTd'> Read JMS messages from space </td>
<td class='confluenceTd'> <img class="emoticon" src="images/icons/emoticons/check.gif" height="16" width="16" align="absmiddle" alt="" border="0"/> </td>
<td class='confluenceTd'> <img class="emoticon" src="images/icons/emoticons/check.gif" height="16" width="16" align="absmiddle" alt="" border="0"/> </td>
</tr>
<tr>
<td class='confluenceTd'> Read Entries/POJOs from space </td>
<td class='confluenceTd'> <img class="emoticon" src="images/icons/emoticons/error.gif" height="16" width="16" align="absmiddle" alt="" border="0"/> </td>
<td class='confluenceTd'> <img class="emoticon" src="images/icons/emoticons/check.gif" height="16" width="16" align="absmiddle" alt="" border="0"/> </td>
</tr>
</tbody></table>

<p><img class="emoticon" src="images/icons/emoticons/warning.gif" height="16" width="16" align="absmiddle" alt="" border="0"/> As shown above, a JMS application <b>cannot read POJOs/Entries</b> from the space, unless they are part of a JMS message. </p>

<p>The following sections will show you how to use the <tt>MessageConverter</tt> to write objects to the space using the JMS API; and how to write JMS messages and read/take those messages using the space API.</p>

<p><img src="download/attachments/19890517/referto.gif" align="absmiddle" border="0"/> To see how the <tt>MessageConverter</tt> is used with OpenSpaces, refer to the <b>Data Example</b>.</p>

<h1><a name="JMS-SpaceInteroperability-WritingPOJOs%2FEntriestoSpaceusingJMSAPIMessageConverter"></a>Writing POJOs/Entries to Space using JMS API &#8211; MessageConverter </h1>

<div class="error"><span class="error">Error formatting macro: toc-zone: java.lang.NullPointerException</span> 

<p>This feature allows clients to define the outcome of JMS writes. By implementing a <tt>MessageConverter</tt>, you can convert JMS messages to a POJO before they are written to the space. The result of using a converter is that what is written to the space is not necessarily the JMS message (with all the headers, properties etc.), but the result of the message conversion.</p>

<p>A basic use-case of this feature might be writing POJOs to the space using standard JMS API, and not the space API.</p>

<p>A simple implementation of this conversion is the <em><tt>ObjectMessage2ObjectConverter</tt></em> class. When the <tt>MessageConverter</tt> is invoked by passing an <tt>ObjectMessage</tt> to its <tt>toObject</tt> method, it returns the contained POJO (message's body). When using the <tt>MessageConverter</tt> to send <tt>ObjectMessages</tt>, what is actually written to the space is only the JMS message body, which contains the POJO. The <tt>ObjectMessage</tt> wrapper is not written.</p>

<p>You can create a custom implementation of the <tt>MessageConverter</tt>. The returned object can be an Entry, an object, an array of Entries, or an array of objects. The returned object can be the same JMS message passed as an argument, or a different one. Generally, the possibility of what can be returned from the conversion method are endless, however, the returned objects should be Entries or POJOs, valid for working with the space.</p>

<h2><a name="JMS-SpaceInteroperability-IMessageConverterInterface"></a>IMessageConverter Interface</h2>

<p>This interface defines an API for message conversion:</p>
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java"><span class="code-keyword">interface</span> IMessageConverter {
	<span class="code-object">Object</span> toObject(javax.jms.Message m);
}</pre>
</div></div>

<p>Implement the <tt>IMessageConverter</tt> interface to return the object required to be written to the space.</p>

<p>Following is the implementation code of <tt>ObjectMessage2ObjectConverter</tt>:</p>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">class ObjectMessage2ObjectConverter <span class="code-keyword">implements</span> IMessageConverter {
	<span class="code-object">Object</span> toObject(javax.jms.Message msg) {
		<span class="code-keyword">if</span> (msg != <span class="code-keyword">null</span> &amp;&amp; msg <span class="code-keyword">instanceof</span> javax.jms.ObjectMessage) {
			<span class="code-keyword">return</span> ((javax.jms.ObjectMessage)msg).getObject();
		{
		<span class="code-keyword">return</span> msg;
	}
}</pre>
</div></div>

<p>When passing an <tt>ObjectMessage</tt> to this converter, it returns the message body, which is actually the POJO.</p>

<h2><a name="JMS-SpaceInteroperability-SettingMessageConverterforConnectionFactory"></a>Setting MessageConverter for ConnectionFactory</h2>

<p>You can configure a <tt>ConnectionFactory</tt> to use a <tt>MessageConverter</tt>.</p>

<p>Any <tt>MessageProducer</tt> created under this <tt>ConnectionFactory</tt> uses the converter automatically when sending messages.</p>

<h3><a name="JMS-SpaceInteroperability-OfflineConfiguration"></a>Offline Configuration</h3>

<p>You can configure a <tt>ConnectionFactory</tt> to use a <tt>MessageConverter</tt> in the Open Spaces Spring configuration:</p>
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-xml"><span class="code-tag">&lt;bean id=<span class="code-quote">"messageConverter"</span> class=<span class="code-quote">"com.j_spaces.jms.utils.ObjectMessage2ObjectConverter"</span> /&gt;</span>

<span class="code-tag">&lt;os-jms:connection-factory id=<span class="code-quote">"connectionFactory"</span> giga-space=<span class="code-quote">"gigaSpace"</span> message-converter=<span class="code-quote">"messageConverter"</span> /&gt;</span></pre>
</div></div>

<p>In this example, a <tt>ConnectionFactory</tt> is configured, and an instance of <tt>ObjectMessage2ObjectConverter</tt> is injected into it.</p>

<h3><a name="JMS-SpaceInteroperability-ConfiguringMessageConvertersDuringRuntime"></a>Configuring MessageConverters During Runtime</h3>

<p>You can use the <tt>GSJMSAdmin</tt> helper class to get a <tt>ConnectionFactory</tt> with a <tt>MessageConverter</tt>, by using one its methods. For the list of methods, see <a href="http://www.gigaspaces.com/docs/JavaDoc8.0/index.html?com/j_spaces/jms/utils/GSJMSAdmin.html" target="_blank">Javadoc</a>.</p>

<p>Passing <tt>null</tt> as a <tt>MessageConverter</tt> means that the <tt>ConnectionFactory</tt> does not use a <tt>MessageConverter</tt>.</p>

<p>The following code uses the <tt>ObjectMessage2ObjectConverter</tt> to send instances of the <tt>MyPOJO</tt> class to the space:</p>
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">ObjectMessage2ObjectConverter converter = <span class="code-keyword">new</span> ObjectMessage2ObjectConverter();
ConnectionFactory connectionFactory = GSJMSAdmin.getInstance().getConnectionFactory(space, converter);
...
ObjectMessage msg = session.createObjectMessage(<span class="code-keyword">new</span> MyPOJO());
producer.send(msg);</pre>
</div></div>

<h2><a name="JMS-SpaceInteroperability-SettingMessageConverterperMessage"></a>Setting MessageConverter per Message</h2>

<p>It is possible to set a <tt>MessageConverter</tt> per sent message.</p>

<p>This is done by setting the <tt>JMS_GSMessageConverter</tt> property before calling <tt>MessageProducer.send()</tt>.</p>

<p>For example, to use the <tt>ObjectMessage2ObjectConvertor</tt> on a specific message:</p>
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">ObjectMessage2ObjectConverter converter = <span class="code-keyword">new</span> ObjectMessage2ObjectConverter();
ObjectMessage msg = ...
msg.setObjectProperty(<span class="code-quote">"JMS_GSMessageConverter"</span>, converter);
producer.send(msg);</pre>
</div></div>

<p><img class="emoticon" src="images/icons/emoticons/warning.gif" height="16" width="16" align="absmiddle" alt="" border="0"/> In this case, the <tt>MessageConverter</tt> is used even if another <tt>MessageConverter</tt> is set in the <tt>ConnectionFactory</tt>.</p>

<h2><a name="JMS-SpaceInteroperability-MessageConverterResolution"></a>MessageConverter Resolution</h2>

<p>In case a <tt>MessageConverter</tt> is set for a <tt>ConnectionFactory</tt>, and another <tt>MessageConverter</tt> is set in a message, GigaSpaces resolves this in the following order:</p>
<ol>
	<li>The <tt>MessageConverter</tt> is set in the message's <tt>JMS_GSMessageConverter</tt> property.</li>
	<li>The <tt>MessageConverter</tt> is set in the <tt>ConnectionFactory</tt>.</li>
</ol>


<p><img class="emoticon" src="images/icons/emoticons/information.gif" height="16" width="16" align="absmiddle" alt="" border="0"/> If no <tt>MessageConverter</tt> is set, the JMS message is written as-is.</p>

<p><img class="emoticon" src="images/icons/emoticons/warning.gif" height="16" width="16" align="absmiddle" alt="" border="0"/> Only one <tt>MessageConverter</tt> is used each time.</p>

<h2><a name="JMS-SpaceInteroperability-Considerations"></a>Considerations</h2>

<ul>
	<li>Message conversion is performed before the space write action. When using transactions, the messages are written to the space only after the transaction is committed. Therefore, changing a <tt>MessageConverter</tt> during a transaction affects all conversions performed by this converter in this specific transaction.<br/>
For example, a converter that returns an object of type <tt>A</tt> &#8211; during a transaction, a few messages are sent, and then the properties of the converter are changed to return an object of type <tt>B</tt>. When committing the transaction, all messages using this converter are converted to objects of type <tt>B</tt>.</li>
	<li>Setting the <tt>JMS_GSMessageConverter</tt> property to <tt>null</tt> is the same as disabling the <tt>MessageConverter</tt> set in the <tt>ConnectionFactory</tt>.<br/>
No conversion is performed and the JMS messages are written as-is.</li>
	<li><tt>TextMessage</tt> compression is still performed if the returned object is a <tt>TextMessage</tt>.</li>
	<li>Setting the <tt>JMS_GSMessageConverter</tt> property with an object that doesn't implement <tt>IMessageConverter</tt> throws a <tt>MessageFormatException</tt>.</li>
	<li>After calling <tt>MessageProducer.send()</tt>, the message instance behaves as if no conversion occurred. The <tt>JMS_GSMessageConverter</tt> property in the returned object is unset.</li>
	<li>A destination has to be created, even if it is not used in the converted object.</li>
</ul>

</div>

<h1><a name="JMS-SpaceInteroperability-WritingandReadingJMSMessagesusingSpaceAPI"></a>Writing and Reading JMS Messages using Space API</h1>

<div class="error"><span class="error">Error formatting macro: toc-zone: java.lang.NullPointerException</span> 

<h2><a name="JMS-SpaceInteroperability-WritingJMSmessages"></a>Writing JMS messages</h2>

<h3><a name="JMS-SpaceInteroperability-1.CreateJMSMessageInstance"></a>1. Create JMS Message Instance</h3>

<p>To create a JMS message, use the new operator as follows:</p>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">GSSimpleMessageImpl simpleMessage = <span class="code-keyword">new</span> GSSimpleMessageImpl(<span class="code-keyword">null</span>);
GSTextMessageImpl   textMessage   = <span class="code-keyword">new</span> GSTextMessageImpl  (<span class="code-keyword">null</span>);
GSObjectMessageImpl objectMessage = <span class="code-keyword">new</span> GSObjectMessageImpl(<span class="code-keyword">null</span>);
GSMapMessageImpl    mapMessage    = <span class="code-keyword">new</span> GSMapMessageImpl   (<span class="code-keyword">null</span>);
GSBytesMessageImpl  bytesMessage  = <span class="code-keyword">new</span> GSBytesMessageImpl (<span class="code-keyword">null</span>);</pre>
</div></div>

<ul>
	<li>Use <tt>null</tt> for the session argument.</li>
	<li>It is preferred not to use the default constructors, because they are meant to create <tt>null</tt> templates of the JMS messages.</li>
</ul>


<h3><a name="JMS-SpaceInteroperability-2.SetRequiredHeaders"></a>2. Set Required Headers</h3>

<p>Use the Message API to set the body, the header values, and the properties:</p>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java"><span class="code-comment">// create the message
</span>GSTextMessage textMessage = <span class="code-keyword">new</span> GSTextMessage(<span class="code-keyword">null</span>);

<span class="code-comment">// set the message's body
</span>textMessage.setText(<span class="code-quote">"This is my message."</span>);

<span class="code-comment">// set the message's headers
</span>textMessage.setJMSMessageID(<span class="code-quote">"message1"</span>);

<span class="code-comment">// set the message's properties
</span>textMessage.setBooleanProperty(<span class="code-quote">"processed"</span>, <span class="code-keyword">false</span>);</pre>
</div></div>

<h3><a name="JMS-SpaceInteroperability-3.WriteMessagetoSpace"></a>3. Write Message to Space</h3>

<p>Use the space API to write the message in an ordinary way:</p>
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">spaceProxy.write(textMessage, <span class="code-keyword">null</span>, Lease.Forever);</pre>
</div></div>

<p><img class="emoticon" src="images/icons/emoticons/information.gif" height="16" width="16" align="absmiddle" alt="" border="0"/> The <tt>SpaceWriter</tt> example that resides in <tt>&lt;GigaSpaces Root&gt;\examples\Basic\helloJMS</tt> uses this technique to write JMS messages to the space.</p>

<h2><a name="JMS-SpaceInteroperability-Reading%2FTakingJMSMessages"></a>Reading/Taking JMS Messages</h2>

<p>Like with any Entry/POJO type, to receive a JMS message from the space you need to create a template. The template is matched with the objects in the space, and matching objects are retrieved. All public members of the message class participate in the match process, including the properties map. Therefore, if you don't know the exact content of a message properties map, it is better to set it to <tt>null</tt> in the JMS message template.</p>

<h3><a name="JMS-SpaceInteroperability-1.CreateTemplateBasedonJMSMessageClasses"></a>1. Create Template Based on JMS Message Classes</h3>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">GSSimpleMessageImpl simpleMessageTemplate = <span class="code-keyword">new</span> GSSimpleMessageImpl();
GSTextMessageImpl   textMessageTemplate   = <span class="code-keyword">new</span> GSTextMessageImpl  ();
GSObjectMessageImpl objectMessageTemplate = <span class="code-keyword">new</span> GSObjectMessageImpl();
GSMapMessageImpl    mapMessageTemplate    = <span class="code-keyword">new</span> GSMapMessageImpl   ();
GSBytesMessageImpl  bytesMessageTemplate  = <span class="code-keyword">new</span> GSBytesMessageImpl ();</pre>
</div></div>

<p>To create a generic template for all kinds of JMS messages, create an instance of <tt>GSMessageImpl</tt> as follows:</p>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">GSMessageImpl genericMessageTemplate = <span class="code-keyword">new</span> GSMessageImpl();</pre>
</div></div>

<p>Using the default constructors creates a <tt>null</tt> template of the JMS message. This means that the properties map is also <tt>null</tt>. If you do not use the default constructor, you should set the properties map to <tt>null</tt> by invoking:</p>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">jsmMessageTemplate.setProperties(<span class="code-keyword">null</span>);</pre>
</div></div>

<h3><a name="JMS-SpaceInteroperability-2.Read%2FTakefromtheSpace"></a>2. Read/Take from the Space</h3>

<p>You can use the template to read or take messages from the space. The following example takes a text message from the space:</p>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">GSTextMessageImpl msg = (GSTextMessageImpl ) spaceProxy.take(textMessageTemplate, <span class="code-keyword">null</span>, 1000L);</pre>
</div></div>
</div>

                     </td>
</tr>
</table>
<table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr>
<td height="12" background="http://www.gigaspaces.com/wiki/images/border/border_bottom.gif"><img src="images/border/spacer.gif" width="1" height="1" border="0"/></td>
</tr>
<tr>
<td align="center"><font color="grey"><a href="http://www.gigaspaces.com">GigaSpaces.com</a> -
		<a href="http://www.gigaspaces.com/wiki/x/xwBmAg" class="smalltext">Legal Notice</a> -
		<a href="http://www.gigaspaces.com/wiki/x/xgBmAg" class="smalltext">3rd Party Licenses</a> -
		<a href="http://www.gigaspaces.com/wiki/x/BQFmAg" class="smalltext">Site Map</a> -
		<a href="http://www.gigaspaces.com/wiki/display/API/API+Documentation+Portal" class="version-link">API Docs</a> -
		<a href="http://forum.openspaces.org/forum.jspa?forumID=175" class="version-link">Forum</a> -
		<a href="http://www.gigaspaces.com/LatestProductVersion" class="version-link">Downloads</a> -
		<a href="http://blog.gigaspaces.com/" class="version-link">Blog</a> -
		<a href="http://www.gigaspaces.com/os_papers.html" class="version-link">White Papers</a> -
		<a href="mailto:techw@gigaspaces.com">Contact Tech Writing</a> -
		<i><a href="http://www.atlassian.com/software/confluence">Gen. by Atlassian Confluence</a></i></font></td>
</tr>
</table>
     </body>
</html>
