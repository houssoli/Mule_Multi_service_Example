<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
     <head>
         <title>XAP 8.0 Documentation : XAP Order Management Tutorial</title>
<link rel="stylesheet" href="styles/site.css" type="text/css" />
         <META http-equiv="Content-Type" content="text/html; charset=UTF-8">
		 <style>
.back-to {
	color: #666666;
	font-weight: bold;
}	 
a.back-to:link, a.back-to:visited, a.back-to:hover, a.back-to:active  {
	color: #666666;
}	 
		 </style>
     </head>

     <body>
<table class="pagecontent" border="0" cellpadding="0" cellspacing="0" width="100%" bgcolor="#ffffff">
<tr>
<td valign="top" class="pagebody">
<div class="pageheader">
<span class="back-to">XAP 8.0 Documentation > <a href="index.html">Back to Table of Contents</a></span><br>
<h1>XAP Order Management Tutorial</h1>
</div>
<br>

<script type="text/javascript" src="http://www.gigaspaces.com/wiki/download/attachments/4751448/overlib.js"><!-- overLIB (c) Erik Bosrup --></script>
<script type="text/javascript" src="http://www.gigaspaces.com/wiki/download/attachments/4751448/overlib_centerpopup.js"></script>
<script type="text/javascript" src="http://www.gigaspaces.com/wiki/download/attachments/4751448/overlib_anchor.js"></script>
<script type="text/javascript" src="http://www.gigaspaces.com/wiki/download/attachments/4751448/overlib_draggable.js"></script>
<script type='text/javascript'>//<![CDATA[
function debug() { }
// ]]></script><script type='text/javascript' src='/wiki/download/resources/net.customware.confluence.plugin.composition:composition-setup/js/browser.js'>//<![CDATA[
// ]]></script><script type='text/javascript' src='/wiki/download/resources/net.customware.confluence.plugin.composition:composition-setup/js/behaviour.js'>//<![CDATA[
// ]]></script><script type='text/javascript' src='/wiki/download/resources/net.customware.confluence.plugin.composition:composition-setup/js/memory.js'>//<![CDATA[
// ]]></script><script type='text/javascript' src='/wiki/download/resources/net.customware.confluence.plugin.composition:composition-setup/js/cloak.js'>//<![CDATA[
// ]]></script><script type='text/javascript'>//<![CDATA[
Cloak.closeHTML = "<img src=\'/wiki/download/resources/net.customware.confluence.plugin.composition:toggle-cloak/img/navigate_down_10.gif\'/>";
Cloak.openHTML = "<img src=\'/wiki/download/resources/net.customware.confluence.plugin.composition:toggle-cloak/img/navigate_right_10.gif\'/>";
Cloak.toggleZone = true;
Cloak.memoryDuration = 0;
Cloak.memoryPrefix = "contentId:53903808";
Cloak.memoryPath = "/wiki/";
// ]]></script><style type='text/css'>
.cloakToggle { /* Definition for state toggling image */
cursor:hand;
cursor:pointer;
}
</style><script type='text/javascript' src='/wiki/download/resources/net.customware.confluence.plugin.composition:composition-setup/js/transitions.js'>//<![CDATA[
// ]]></script><script type='text/javascript' src='/wiki/download/resources/net.customware.confluence.plugin.composition:composition-setup/js/deck.js'>//<![CDATA[
// ]]></script><link rel='stylesheet' type='text/css'  href='/wiki/styles/main-action.css?pluginCompleteKey=net.customware.confluence.plugin.composition:composition-setup&stylesheetName=deck&spaceKey=XAP8'/><script type='text/javascript'>//<![CDATA[
Deck.memoryDuration = 0;
Deck.memoryPrefix = "contentId:53903808";
Deck.memoryPath = "/wiki/";
// ]]></script>


<div style="border-style:solid; border-color:#3C78B5; border-width:thin; padding-left:20px; padding-bottom:20px; padding-top:20px; padding-right:20px; background-color:#D8E4F1"> 

<p><b>Section Summary:</b>  This tutorial shows how to develop and deploy a stateful application and then scale it out by using the Open Spaces framework. </p>
</div>

<p><a name="XAPOrderManagementTutorial-1"></a></p>
<h1><a name="XAPOrderManagementTutorial-Overview"></a>Overview</h1>
<div class="greybox" width="100%">
<table cellspacing="0" cellpadding="0"><tr>
<td valign="top"><img src="download/attachments/48760898/urhere.gif"/></td><td width="10px"></td><td><sub><img src="download/attachments/17301573/sstar.gif" align="absmiddle" border="0"/> <b><a href="#XAPOrderManagementTutorial-1">Overview</a></b> - <a href="#XAPOrderManagementTutorial-2">The Application Workflow</a> - <a href="#XAPOrderManagementTutorial-3">Implementation</a> - <a href="#XAPOrderManagementTutorial-4">POJO Domain Model</a> - <a href="#XAPOrderManagementTutorial-5">Writing POJO Services</a> - <a href="#XAPOrderManagementTutorial-6">Wiring with Spring (PU Configuration)</a> - <a href="#XAPOrderManagementTutorial-7">Building and Packaging</a> - <a href="#XAPOrderManagementTutorial-8">Deployment</a> - <a href="#XAPOrderManagementTutorial-9">What's Next?</a></sub></td></tr></table>
</div>

<p>The purpose of this tutorial is to introduce the full concept of SBA &#8211; Space Based Architecture, and the way to easily write stateful applications, deploy them and then scale them out in a linear way. In GigaSpaces, this is done with the help of Open Spaces, a framework built on top of GigaSpaces that greatly simplifies development, deployment and scaling, by relying on and using <a href="http://springframework.org">Spring</a> capabilities and configuration. Now, if you don't know Spring, don't worry, you don't have to know Spring to <b>get</b> Open Spaces, but if you do know Spring, you'll probably find yourself in a familiar territory.</p>

<h2><a name="XAPOrderManagementTutorial-AbouttheApplication"></a>About the Application</h2>

<p>The application here is, again, an order management system. It is compiled from a set of services that form the entire workflow. In a high-level, the main services are:</p>

<ul>
	<li>A <b>feeder</b> service that sends out order events (a buy or sell) with usernames and prices.</li>
	<li>A <b>validator</b> service that checks new orders by looking for the preloaded account for the specific username &#8211; if it doesn't find the account, the order is rejected.</li>
	<li>A <b>processor</b> service that takes validated orders, and updates the user account with the new balance (unless it is a buy order and there are insufficient funds for that account).</li>
</ul>


<p>When writing an application with Open Spaces, you will implement Processing Units (PU) that are later deployed to the GigaSpaces Service Grid.</p>

<p>In a nutshell, a processing unit is a container where a set of services run and interact. According to the SOA model, the services are loosely coupled, meaning they don't know about each other and are independent of one another, but as opposed to the known webservices model, services that run within the same processing unit basically run within the same process. This way, an SOA application can run with the lowest latency possible.</p>

<p>The different services interact and share data using a space (as defined in the <a href="http://www.sun.com/software/jini/specs/js2_0.pdf">Javaspaces specification</a>) that can run embedded within the same processing unit; and acts as the transport layer <b>and</b> the data layer, eliminating the need to use a database and a messaging solution.</p>

<p>In this tutorial you will implement 3 different processing units as shown below:</p>

<p><div align="center"><img src="download/attachments/17301573/XAP Open OMS tutorial Workflow.jpg" border="0"/></div></p>

<p>You can probably see that there are more services than we initially mentioned, so lets go over the entire contents of the diagram:</p>

<p>First, our domain model, these are the account and order objects that appear in the diagram inside the space. The space itself is embedded within the Runtime Processing Unit (naming the processing unit is up to you).</p>

<p>The application consists of 3 different processing units, each running its own services:</p>

<ul>
	<li>The <b>runtime</b> processing unit includes the embedded and only space in the application, as well as the validator and processor services.</li>
	<li>The <b>feeder</b> processing unit includes the feeder as well as the <tt>AccountDataLoader</tt> service that preloads the user accounts into the space &#8211; think of it as the initial service of the application that preloads data from the database into the cache. In real applications using GigaSpaces, the <tt>DataProvider</tt> loads the data from an external data source (that can be a database or any other external application) into the space.</li>
	<li>The <b>stats</b> processing unit takes care of the statistics of the application. It includes two services, each receives notifications from the space on different events. One service is notified about changes in the account objects, while the other service monitors the flow of orders.</li>
</ul>


<p><a name="XAPOrderManagementTutorial-2"></a></p>
<h1><a name="XAPOrderManagementTutorial-TheApplicationWorkflow"></a>The Application Workflow</h1>
<div class="greybox" width="100%">
<table cellspacing="0" cellpadding="0"><tr>
<td valign="top"><img src="download/attachments/48760898/urhere.gif"/></td><td width="10px"></td><td><sub><a href="#XAPOrderManagementTutorial-1">Overview</a> - <img src="download/attachments/17301573/sstar.gif" align="absmiddle" border="0"/> <b><a href="#XAPOrderManagementTutorial-2">The Application Workflow</a></b> - <a href="#XAPOrderManagementTutorial-3">Implementation</a> - <a href="#XAPOrderManagementTutorial-4">POJO Domain Model</a> - <a href="#XAPOrderManagementTutorial-5">Writing POJO Services</a> - <a href="#XAPOrderManagementTutorial-6">Wiring with Spring (PU Configuration)</a> - <a href="#XAPOrderManagementTutorial-7">Building and Packaging</a> - <a href="#XAPOrderManagementTutorial-8">Deployment</a> - <a href="#XAPOrderManagementTutorial-9">What's Next?</a></sub></td></tr></table>
</div>

<p>The workflow according to the diagram above is described here:</p>

<p>When the feeder PU is loaded, the preloader (from the feeder PU) loads 100 account objects into the space. Then the following cycle occurs:</p>
<ol>
	<li>The <tt>OrderFeeder</tt> (from the feeder PU) starts writing Orders with status <tt>New</tt>.</li>
	<li>The <tt>Validator</tt> (from the runtime PU) takes an order with the status <tt>New</tt>.</li>
	<li>The <tt>Validator</tt> then reads the account with the username of that order from the space.</li>
	<li>If the account with the same username is found, the <tt>Validator</tt> writes back the order to the space with status <tt>Pending</tt>, otherwise it writes it with status <tt>AccountNotFound</tt>.</li>
	<li>The <tt>Processor</tt> (from the runtime PU) takes an order with the status <tt>Pending</tt>.</li>
	<li>The <tt>Processor</tt> then reads the account with the same username as the order from the space, this time with an exclusive read lock, making the account invisible to other processor threads.</li>
	<li>The <tt>Processor</tt> updates the account object in the space with the new balance of that user, according to the order it processed (a <tt>Buy</tt> order will reduce the balance, a <tt>Sell</tt> order will increase it).</li>
	<li>In case of a <tt>Buy</tt> order with insufficient funds in the balance of the account, the <tt>Processor</tt> writes back to the space the order with status <tt>InsufficientFunds</tt>. Otherwise, the order is written with status <tt>Processed</tt>.</li>
	<li>The <tt>AccountCounter</tt> (from the statistics PU) receives a notification if an account object is written or updated in the space.</li>
	<li>The <tt>OrderCounter</tt> (from the statistics PU) receives a notification every time an order is written into the space.</li>
</ol>


<p><a name="XAPOrderManagementTutorial-3"></a></p>
<h1><a name="XAPOrderManagementTutorial-Implementation"></a>Implementation</h1>
<div class="greybox" width="100%">
<table cellspacing="0" cellpadding="0"><tr>
<td valign="top"><img src="download/attachments/48760898/urhere.gif"/></td><td width="10px"></td><td><sub><a href="#XAPOrderManagementTutorial-1">Overview</a> - <a href="#XAPOrderManagementTutorial-2">The Application Workflow</a> - <img src="download/attachments/17301573/sstar.gif" align="absmiddle" border="0"/> <b><a href="#XAPOrderManagementTutorial-3">Implementation</a></b> - <a href="#XAPOrderManagementTutorial-4">POJO Domain Model</a> - <a href="#XAPOrderManagementTutorial-5">Writing POJO Services</a> - <a href="#XAPOrderManagementTutorial-6">Wiring with Spring (PU Configuration)</a> - <a href="#XAPOrderManagementTutorial-7">Building and Packaging</a> - <a href="#XAPOrderManagementTutorial-8">Deployment</a> - <a href="#XAPOrderManagementTutorial-9">What's Next?</a></sub></td></tr></table>
</div>

<p>The process of implementing your application over Open Spaces is quite easy once you follow a few simple steps. One of the benefits of this approach is that you get to implement and test your code on a single machine, indifferent to the final topology, the number of nodes in your cluster and the remoteness of the machines. Once you're finished with the implementation, 90% of your work is done.</p>

<p>Let's review those steps:</p>

<ol>
	<li>Implement your <b>POJO domain model</b> &#8211; what data or event object does your application require? This tutorial, as shown in the diagram above has two domain model objects, the order which is an event object and account which is our data object.</li>
	<li>Implement the <b>POJO Services</b> &#8211; these are the business logic of your application. Those are the services that you later run on top of a processing unit. These objects are really simple POJOs, they do not implement any interface or have to comply with any standard. Instead, using annotations, which you define within your POJO services, you can mark the methods that are used to process events.</li>
	<li>Wire everything with the Spring configuration file. The core of the processing unit is its configuration XML file called <tt>pu.xml</tt>. In this file, you define your Spring beans (the services' objects are some of them), the event handling containers (polling or notify), the configuration of the space you want to access (the space can be embedded within that processing unit, or a remote space), and a few other things that we will show later, but quite a lot of the logic and workflow of your application is actually defined within that XML.</li>
	<li>Package and Deploy &#8211; there are several ways to deploy a processing unit, either as standalone or onto a Grid Service Container (GSC) which is part of our Service Grid. This tutorial will show you the latter approach, and you can find more information on the Open Spaces documentation in the <a href="http://www.gigaspaces.com/wiki/display/GS6/Open+Spaces" title="Open Spaces">Open Spaces</a> section.</li>
</ol>


<p>OK, let's code!</p>

<p><a name="XAPOrderManagementTutorial-4"></a></p>
<script type='text/javascript'>//<![CDATA[
function debug() { }
// ]]></script><script type='text/javascript' src='/wiki/download/resources/net.customware.confluence.plugin.composition:composition-setup/js/browser.js'>//<![CDATA[
// ]]></script><script type='text/javascript' src='/wiki/download/resources/net.customware.confluence.plugin.composition:composition-setup/js/behaviour.js'>//<![CDATA[
// ]]></script><script type='text/javascript' src='/wiki/download/resources/net.customware.confluence.plugin.composition:composition-setup/js/memory.js'>//<![CDATA[
// ]]></script><script type='text/javascript' src='/wiki/download/resources/net.customware.confluence.plugin.composition:composition-setup/js/cloak.js'>//<![CDATA[
// ]]></script><script type='text/javascript'>//<![CDATA[
Cloak.closeHTML = "<img src=\'/wiki/download/resources/net.customware.confluence.plugin.composition:toggle-cloak/img/navigate_down_10.gif\'/>";
Cloak.openHTML = "<img src=\'/wiki/download/resources/net.customware.confluence.plugin.composition:toggle-cloak/img/navigate_right_10.gif\'/>";
Cloak.toggleZone = true;
Cloak.memoryDuration = 0;
Cloak.memoryPrefix = "contentId:53903518";
Cloak.memoryPath = "/wiki/";
// ]]></script><style type='text/css'>
.cloakToggle { /* Definition for state toggling image */
cursor:hand;
cursor:pointer;
}
</style><script type='text/javascript' src='/wiki/download/resources/net.customware.confluence.plugin.composition:composition-setup/js/transitions.js'>//<![CDATA[
// ]]></script><script type='text/javascript' src='/wiki/download/resources/net.customware.confluence.plugin.composition:composition-setup/js/deck.js'>//<![CDATA[
// ]]></script><link rel='stylesheet' type='text/css'  href='/wiki/styles/main-action.css?pluginCompleteKey=net.customware.confluence.plugin.composition:composition-setup&stylesheetName=deck&spaceKey=XAP8'/><script type='text/javascript'>//<![CDATA[
Deck.memoryDuration = 0;
Deck.memoryPrefix = "contentId:53903518";
Deck.memoryPath = "/wiki/";
// ]]></script>

<h1><a name="XAPOrderManagementTutorial-POJODomainModel"></a>POJO Domain Model</h1>
<div class="greybox" width="100%">
<table cellspacing="0" cellpadding="0"><tr>
<td valign="top"><img src="download/attachments/48760898/urhere.gif"/></td><td width="10px"></td><td><sub><a href="#XAPOrderManagementTutorial-1">Overview</a> - <a href="#XAPOrderManagementTutorial-2">The Application Workflow</a> - <a href="#XAPOrderManagementTutorial-3">Implementation</a> - <img src="download/attachments/17301573/sstar.gif" align="absmiddle" border="0"/> <b><a href="#XAPOrderManagementTutorial-4">POJO Domain Model</a></b> - <a href="#XAPOrderManagementTutorial-5">Writing POJO Services</a> - <a href="#XAPOrderManagementTutorial-6">Wiring with Spring (PU Configuration)</a> - <a href="#XAPOrderManagementTutorial-7">Building and Packaging</a> - <a href="#XAPOrderManagementTutorial-8">Deployment</a> - <a href="#XAPOrderManagementTutorial-9">What's Next?</a></sub></td></tr></table>
</div>

<p>Because our domain model is used throughout the entire application by the different Processing Units, we should define it in a generic place, so we can then include it in each of the PUs.<br/>
<a name="XAPOrderManagementTutorial-deck1"></a></p>

<div class="panel" style="background-color: #FFFFFF;border-color: #3C78B5;border-style: solid;border-width: 1px;"><div class="panelContent" style="background-color: #FFFFFF;">
<h5><a name="XAPOrderManagementTutorial-OrderEvent"></a>OrderEvent</h5>
<hr 
 size="1" 
 color="#3C78B5" 
 >

<p>An <tt>OrderEvent</tt> has an ID, username, price and operation (buy or sell):</p>
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java"><span class="code-keyword">package</span> org.openspaces.example.oms.common;

<span class="code-keyword">import</span> com.gigaspaces.annotation.pojo.SpaceClass;
<span class="code-keyword">import</span> com.gigaspaces.annotation.pojo.SpaceId;
<span class="code-keyword">import</span> com.gigaspaces.annotation.pojo.SpaceRouting;

/**
 * OrderEvent object important properties include the orderID
 * of the object, userName (also used to perform routing when working with partitioned space),
 * price ,operation , and a status indicating <span class="code-keyword">if</span> <span class="code-keyword">this</span> OrderEvent object
 * was processed, or rejected <span class="code-keyword">for</span> a reason.
 * &lt;p&gt;
 * &lt;code&gt;@SpaceClass&lt;/code&gt; annotation in <span class="code-keyword">this</span> example is only to indicate that <span class="code-keyword">this</span> class is a space class.
 */ 
@SpaceClass
<span class="code-keyword">public</span> class OrderEvent {
	
	<span class="code-keyword">public</span> <span class="code-keyword">static</span> <span class="code-keyword">final</span> <span class="code-object">String</span> STATUS_NEW = <span class="code-quote">"New"</span>;	
	<span class="code-keyword">public</span> <span class="code-keyword">static</span> <span class="code-keyword">final</span> <span class="code-object">String</span> STATUS_PENDING = <span class="code-quote">"Pending"</span>;	
	<span class="code-keyword">public</span> <span class="code-keyword">static</span> <span class="code-keyword">final</span> <span class="code-object">String</span> STATUS_PROCESSED = <span class="code-quote">"Processed"</span>;
	<span class="code-keyword">public</span> <span class="code-keyword">static</span> <span class="code-keyword">final</span> <span class="code-object">String</span> STATUS_INSUFFICIENT_FUNDS = <span class="code-quote">"InsufficientFunds"</span>;
	<span class="code-keyword">public</span> <span class="code-keyword">static</span> <span class="code-keyword">final</span> <span class="code-object">String</span> STATUS_ACCOUNT_NOT_FOUND = <span class="code-quote">"AccountNotFound"</span>;
	
	<span class="code-keyword">public</span> <span class="code-keyword">static</span> <span class="code-keyword">final</span> <span class="code-object">int</span> BUY_OPERATION = 1;
	<span class="code-keyword">public</span> <span class="code-keyword">static</span> <span class="code-keyword">final</span> <span class="code-object">int</span> SELL_OPERATION = 2;
	
	/**
	 * Static values representing the differnet values the operation property can have.
	 * */
    <span class="code-keyword">public</span> <span class="code-keyword">static</span> <span class="code-object">short</span>[] OPERATIONS = {BUY_OPERATION, SELL_OPERATION};
    
    /**
     * Indicates <span class="code-keyword">if</span> <span class="code-keyword">this</span> is a buy or sell order.
     */
    <span class="code-keyword">private</span> <span class="code-object">Short</span> operation;
    
    /**
     * ID of the order.
     */
    <span class="code-keyword">private</span> <span class="code-object">String</span> orderID;
    
    /**
     * User name of the order.
     */
    <span class="code-keyword">private</span> <span class="code-object">String</span> userName;
    
    /**
     * Price of order.
     */
    <span class="code-keyword">private</span> <span class="code-object">Integer</span> price;
    
    /**
     * 	Possible values: New, Pending, Processed, InsufficientFunds, AccountNotFound
     * */
    <span class="code-keyword">private</span> <span class="code-object">String</span> status;		
    
    /**
     * Constructs a <span class="code-keyword">new</span> OrderEvent object. 
     * */
    <span class="code-keyword">public</span> OrderEvent() {
    }

    /** 
     * Constructs a <span class="code-keyword">new</span> OrderEvent object with the given userName, price
     * and operation.
     * @param userName
     * @param price
     * @param operation - Sell or buy operation.
     */
    <span class="code-keyword">public</span> OrderEvent(<span class="code-object">String</span> userName, <span class="code-object">Integer</span> price, <span class="code-object">short</span> operation) {
        <span class="code-keyword">this</span>.userName = userName;
    	<span class="code-keyword">this</span>.price = price;
        <span class="code-keyword">this</span>.operation = operation;
        <span class="code-keyword">this</span>.status = STATUS_NEW;
    }

    /** 
     * Gets the ID of the orderEvent.&lt;p&gt;
     * &lt;code&gt;@SpaceID&lt;/code&gt; annotation indicates that its value will be auto generated 
     * when it is written to the space. 
     */
    @SpaceId(autoGenerate = <span class="code-keyword">true</span>)
    <span class="code-keyword">public</span> <span class="code-object">String</span> getOrderID() {
        <span class="code-keyword">return</span> orderID;
    }

    /**
     * Sets the ID of the orderEvent.
     * @param account
     */
    <span class="code-keyword">public</span> void setOrderID(<span class="code-object">String</span> orderID) {
        <span class="code-keyword">this</span>.orderID = orderID;
    }

    /** 
     * @<span class="code-keyword">return</span> userName - Gets the user name of the orderEvent object.&lt;p&gt;
     * Used as the routing field when working with a partitioned space. 
     */
    @SpaceRouting
    <span class="code-keyword">public</span> <span class="code-object">String</span> getUserName() {
        <span class="code-keyword">return</span> userName;
    }

    /** 
     * @param userName - set the user name of the orderEvent object.
     */
    <span class="code-keyword">public</span> void setUserName(<span class="code-object">String</span> userName) {
        <span class="code-keyword">this</span>.userName = userName;
    }
    
    /**
     * Outputs the orderEvent object attributes.
     */
    <span class="code-keyword">public</span> <span class="code-object">String</span> toString() {
        <span class="code-keyword">return</span> <span class="code-quote">"userName["</span> + userName + <span class="code-quote">"] operation["</span> + operation + <span class="code-quote">"] price["</span> + price + <span class="code-quote">"] status["</span> + status + <span class="code-quote">"]"</span>;
    }

	/** 
	 * @<span class="code-keyword">return</span> the orderEvent operation (buy or sell).
	 */
	<span class="code-keyword">public</span> <span class="code-object">Short</span> getOperation() {
		<span class="code-keyword">return</span> operation;
	}

	/** 
	 * @param operation - Sets the orderEvent operation (<span class="code-quote">"Buy"</span> or <span class="code-quote">"Sell"</span>) 
	 */
	<span class="code-keyword">public</span> void setOperation(<span class="code-object">Short</span> operation) {
		<span class="code-keyword">this</span>.operation = operation;
	}

	/** 
	 * @<span class="code-keyword">return</span> price - Gets the orderEvent price. 
	 */
	<span class="code-keyword">public</span> <span class="code-object">Integer</span> getPrice() {
		<span class="code-keyword">return</span> price;
	}

	/** 
	 * @param price - Sets the orderEvent price. 
	 * */
	<span class="code-keyword">public</span> void setPrice(<span class="code-object">Integer</span> price) {
		<span class="code-keyword">this</span>.price = price;
	}

	/** 
	 * @<span class="code-keyword">return</span> status - the orderEvent status. 
	 */
	<span class="code-keyword">public</span> <span class="code-object">String</span> getStatus() {
		<span class="code-keyword">return</span> status;
	}

	/**
	 *  @param status - Sets the orderEvent status.
	 */
	<span class="code-keyword">public</span> void setStatus(<span class="code-object">String</span> status) {
		<span class="code-keyword">this</span>.status = status;
	}
}</pre>
</div></div>
<p><a href="#XAPOrderManagementTutorial-deck1">Choose another tab</a> (back to top)</p>


<h5><a name="XAPOrderManagementTutorial-AccountData"></a>AccountData</h5>
<hr 
 size="1" 
 color="#3C78B5" 
 >

<p>The <tt>AccountData</tt> objects represent the user accounts that are preloaded to the cache, and later referenced by the different services.</p>
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java"><span class="code-keyword">package</span> org.openspaces.example.oms.common;

<span class="code-keyword">import</span> com.gigaspaces.annotation.pojo.SpaceClass;
<span class="code-keyword">import</span> com.gigaspaces.annotation.pojo.SpaceId;
<span class="code-keyword">import</span> com.gigaspaces.annotation.pojo.SpaceRouting;

/**
 * AccountData represents an account data object that is preloaded to the runtime processing 
 * unit's embedded space by the feeder processing unit's AccountDataLoader bean.
 * In <span class="code-keyword">this</span> example the account data objects consist the in-memory data grid, and are used by
 * runtime processing unit's OrderEventValidator bean to validate the OrderEvents.
 * The account data object's balance is updated by the runtime processing unit's OrderEventProcessor
 * bean to reflect buy/sell operations. 
 * &lt;p&gt;
 * Properties include the account's userName(used as the Account unique ID, also used as a routing 
 * index to perform routing when working with partitioned space) and the balance.
 * &lt;p&gt;
 * &lt;code&gt;@SpaceClass&lt;/code&gt; annotation in <span class="code-keyword">this</span> example is only to Illustrate that <span class="code-keyword">this</span> class is a space class. 
 */
@SpaceClass
<span class="code-keyword">public</span> class AccountData {
	
	/**
	 * User name <span class="code-keyword">for</span> the Account (Serves also as the account unique ID, and routing index).
	 */
	<span class="code-keyword">private</span> <span class="code-object">String</span> userName;
	
	/**
	 * Balance <span class="code-keyword">for</span> the Account.
	 */
	<span class="code-keyword">private</span> <span class="code-object">Integer</span> balance;
	
	/**
	 * AccountData no-args constructor.
	 */
	<span class="code-keyword">public</span> AccountData() {
	}
	
	/**
	 * AccountData constructor.
	 * @param userName
	 * @param balance
	 */
	<span class="code-keyword">public</span> AccountData(<span class="code-object">String</span> userName, <span class="code-object">Integer</span> balance) {
		<span class="code-keyword">this</span>.userName = userName;
		<span class="code-keyword">this</span>.balance = balance;
	}

	/**
	 * @<span class="code-keyword">return</span> the balance of the account.
	 */
	<span class="code-keyword">public</span> <span class="code-object">Integer</span> getBalance() {
		<span class="code-keyword">return</span> balance;
	}

	/**
	 * @param balance - Sets the balance <span class="code-keyword">for</span> the account.
	 */
	<span class="code-keyword">public</span> void setBalance(<span class="code-object">Integer</span> balance) {
		<span class="code-keyword">this</span>.balance = balance;
	}

	/**
	 * @<span class="code-keyword">return</span> the user name of the account.
	 * &lt;p&gt;
	 * &lt;code&gt;SpaceId&lt;/code&gt; controls the unique identity of the account within
	 * the Space.
	 * &lt;p&gt;
	 * &lt;code&gt;SpaceRouting&lt;/code&gt; annotation controls which partition <span class="code-keyword">this</span>
	 * account will be written to when using a partitioned Space (using hash
	 * based routing).
	 */
	@SpaceId
	@SpaceRouting
	<span class="code-keyword">public</span> <span class="code-object">String</span> getUserName() {
		<span class="code-keyword">return</span> userName;
	}

	/**
	 * @param userName - Sets the user name <span class="code-keyword">for</span> the account.
	 */
	<span class="code-keyword">public</span> void setUserName(<span class="code-object">String</span> userName) {
		<span class="code-keyword">this</span>.userName = userName;
	}
	
	/**
	 * Outputs the account properties (userName, balance).
	 */
	<span class="code-keyword">public</span> <span class="code-object">String</span> toString() {
		<span class="code-keyword">return</span> <span class="code-quote">"userName["</span> + userName + <span class="code-quote">"] balance["</span> + balance + <span class="code-quote">"]"</span>;
	}

}</pre>
</div></div>
<p><a href="#XAPOrderManagementTutorial-deck1">Choose another tab</a> (back to top)</p>
</div></div>

<p>As you can see, the code is pretty straight forward, what's interesting though, are the annotations used in it:</p>

<ul>
	<li><b><tt>@SpaceClass</tt></b> &#8211; marks this class as an Entry that will be written to a space (and then probably read or taken from the space).</li>
	<li><b><tt>@SpaceId(autoGenerate = true)</tt></b> &#8211; marks the following method as the generator of the unique key for that object type. In this case, the <tt>orderID</tt> attribute is unique per instance and is automatically generated by the container.</li>
	<li><b><tt>@SpaceRouting</tt></b> &#8211; marks the attribute according to which routing to the correct space partitions will be done. This is only relevant when we deploy a cluster of spaces in partitioned mode, and objects written to the cluster need to be routed in a certain manner.</li>
</ul>


<p><a name="XAPOrderManagementTutorial-5"></a></p>
<script type='text/javascript'>//<![CDATA[
function debug() { }
// ]]></script><script type='text/javascript' src='/wiki/download/resources/net.customware.confluence.plugin.composition:composition-setup/js/browser.js'>//<![CDATA[
// ]]></script><script type='text/javascript' src='/wiki/download/resources/net.customware.confluence.plugin.composition:composition-setup/js/behaviour.js'>//<![CDATA[
// ]]></script><script type='text/javascript' src='/wiki/download/resources/net.customware.confluence.plugin.composition:composition-setup/js/memory.js'>//<![CDATA[
// ]]></script><script type='text/javascript' src='/wiki/download/resources/net.customware.confluence.plugin.composition:composition-setup/js/cloak.js'>//<![CDATA[
// ]]></script><script type='text/javascript'>//<![CDATA[
Cloak.closeHTML = "<img src=\'/wiki/download/resources/net.customware.confluence.plugin.composition:toggle-cloak/img/navigate_down_10.gif\'/>";
Cloak.openHTML = "<img src=\'/wiki/download/resources/net.customware.confluence.plugin.composition:toggle-cloak/img/navigate_right_10.gif\'/>";
Cloak.toggleZone = true;
Cloak.memoryDuration = 0;
Cloak.memoryPrefix = "contentId:53903721";
Cloak.memoryPath = "/wiki/";
// ]]></script><style type='text/css'>
.cloakToggle { /* Definition for state toggling image */
cursor:hand;
cursor:pointer;
}
</style><script type='text/javascript' src='/wiki/download/resources/net.customware.confluence.plugin.composition:composition-setup/js/transitions.js'>//<![CDATA[
// ]]></script><script type='text/javascript' src='/wiki/download/resources/net.customware.confluence.plugin.composition:composition-setup/js/deck.js'>//<![CDATA[
// ]]></script><link rel='stylesheet' type='text/css'  href='/wiki/styles/main-action.css?pluginCompleteKey=net.customware.confluence.plugin.composition:composition-setup&stylesheetName=deck&spaceKey=XAP8'/><script type='text/javascript'>//<![CDATA[
Deck.memoryDuration = 0;
Deck.memoryPrefix = "contentId:53903721";
Deck.memoryPath = "/wiki/";
// ]]></script>

<h1><a name="XAPOrderManagementTutorial-WritingPOJOServices"></a>Writing POJO Services</h1>
<div class="greybox" width="100%">
<table cellspacing="0" cellpadding="0"><tr>
<td valign="top"><img src="download/attachments/48760898/urhere.gif"/></td><td width="10px"></td><td><sub><a href="#XAPOrderManagementTutorial-1">Overview</a> - <a href="#XAPOrderManagementTutorial-2">The Application Workflow</a> - <a href="#XAPOrderManagementTutorial-3">Implementation</a> - <a href="#XAPOrderManagementTutorial-4">POJO Domain Model</a> - <img src="download/attachments/17301573/sstar.gif" align="absmiddle" border="0"/> <b><a href="#XAPOrderManagementTutorial-5">Writing POJO Services</a></b> - <a href="#XAPOrderManagementTutorial-6">Wiring with Spring (PU Configuration)</a> - <a href="#XAPOrderManagementTutorial-7">Building and Packaging</a> - <a href="#XAPOrderManagementTutorial-8">Deployment</a> - <a href="#XAPOrderManagementTutorial-9">What's Next?</a></sub></td></tr></table>
</div>

<p>Once we're done with the implementation of our domain model, it's time to implement each of the six services described in the above diagram. We will cover each one of them, but first, we want to make the code of the services oblivious to the underlying space so that our code will not be dependent on the GigaSpaces solution.</p>

<p>Solving the dependency issue for the event objects (<tt>OrderEvent</tt>) is easy, as Open Spaces takes care of the polling and notification operations behind the scenes since it's all configured in the <tt>pu.xml</tt> file of the Processing Unit. Doing the same with the <tt>AccountData</tt> objects is not possible as the services have to access those objects according to the application's specific business logic. To solve this, we'll implement a DAO (Data Access Object) that will take care of the space operations.</p>

<h2><a name="XAPOrderManagementTutorial-AccountDataDAO"></a>AccountDataDAO</h2>

<p><a name="XAPOrderManagementTutorial-deck2"></a></p>

<div class="panel" style="background-color: #FFFFFF;border-color: #3C78B5;border-style: solid;border-width: 1px;"><div class="panelContent" style="background-color: #FFFFFF;">
<h5><a name="XAPOrderManagementTutorial-Interface"></a>Interface</h5>
<hr 
 size="1" 
 color="#3C78B5" 
 >

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java"><span class="code-keyword">package</span> org.openspaces.example.oms.common;

/**
 * accountData data access object <span class="code-keyword">interface</span>.
 */ 
<span class="code-keyword">public</span> <span class="code-keyword">interface</span> IAccountDataDAO {
	
	/**
	 * Checks <span class="code-keyword">if</span> the accountData object <span class="code-keyword">for</span> a given userName is found. 
	 * @param userName
	 * @<span class="code-keyword">return</span> <span class="code-keyword">true</span> <span class="code-keyword">if</span> account found, otherwise returns <span class="code-keyword">false</span>.
	 */
	<span class="code-object">boolean</span> isAccountFound(<span class="code-object">String</span> userName);
	
	/**
	 * Updates the stored accountData object with the <span class="code-keyword">new</span> parameters. 
	 * @param accountData - accountData object containing the <span class="code-keyword">new</span> parameters to use <span class="code-keyword">for</span> updating,
	 * 		accountData.userName attribute is used as the unique accountData identifier.
	 */
	void updateAccountData(AccountData accountData);

	/**
	 * Gets the accountData object matching the userName, blocks until found.
	 * @param userName
	 * @<span class="code-keyword">return</span> AccountData
	 */
	AccountData getAccountData(<span class="code-object">String</span> userName);
	
	/**
	 * Saves the accountData object.
	 * @param accountData - accountData to be saved.
	 */
	void save(AccountData accountData);
}</pre>
</div></div>
<p><a href="#XAPOrderManagementTutorial-deck2">Choose another tab</a> (back to top)</p>


<h5><a name="XAPOrderManagementTutorial-Implementation"></a>Implementation</h5>
<hr 
 size="1" 
 color="#3C78B5" 
 >

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java"><span class="code-keyword">package</span> org.openspaces.example.oms.common;

<span class="code-keyword">import</span> net.jini.core.lease.Lease;

<span class="code-keyword">import</span> org.openspaces.core.GigaSpace;
<span class="code-keyword">import</span> org.openspaces.core.context.GigaSpaceContext;
<span class="code-keyword">import</span> org.openspaces.example.oms.common.AccountData;

<span class="code-keyword">import</span> com.j_spaces.core.client.ReadModifiers;
<span class="code-keyword">import</span> com.j_spaces.core.client.UpdateModifiers;

/**
 * A gigapsaces based implementation of the account data access abstraction.
 */
<span class="code-keyword">public</span> class AccountDataDAO <span class="code-keyword">implements</span> IAccountDataDAO {

	/**
	 *  gigaSpace is injected through the pu.xml using the setter. 
	 */
	@GigaSpaceContext(name = <span class="code-quote">"gigaSpace"</span>)
	<span class="code-keyword">private</span> GigaSpace gigaSpace;
	
	/**
	 * @param gigaSpace - Sets gigaSpace
	 */
	<span class="code-keyword">public</span> void setGigaSpace(GigaSpace gigaSpace) {
		<span class="code-keyword">this</span>.gigaSpace = gigaSpace;
	}
	
	/**
	 * isAccountFound&lt;p&gt;
	 * Checks <span class="code-keyword">if</span> account found in space, works even <span class="code-keyword">if</span> the account is blocked.
	 * 
	 * @param userName
	 * @<span class="code-keyword">return</span> <span class="code-keyword">true</span> <span class="code-keyword">if</span> account with the following userName is found in the space, otherwise returns <span class="code-keyword">false</span>.  
	 */
	<span class="code-keyword">public</span> <span class="code-object">boolean</span> isAccountFound(<span class="code-object">String</span> userName) {
		AccountData accountDataTemplate = <span class="code-keyword">new</span> AccountData();
		accountDataTemplate.setUserName(userName);
		<span class="code-comment">// read the accountData with dirty read making to read even blocked accounts.
</span>		AccountData accountData = gigaSpace.read(accountDataTemplate, 0/* nowait */, ReadModifiers.DIRTY_READ);
		<span class="code-keyword">if</span> (accountData != <span class="code-keyword">null</span>)
			<span class="code-keyword">return</span> <span class="code-keyword">true</span>;
		<span class="code-keyword">else</span>
			<span class="code-keyword">return</span> <span class="code-keyword">false</span>;
	}

	/**
	 * Reads the accountData with exclusive read, making it invisible to other
	 * processor threads, Blocks until found.
	 * 
	 * @param userName - user name of the account.
	 * @<span class="code-keyword">return</span> accountData - the accountData read.
	 */
	<span class="code-keyword">public</span> AccountData getAccountData(<span class="code-object">String</span> userName) {
		AccountData accountDataTemplate = <span class="code-keyword">new</span> AccountData();
		accountDataTemplate.setUserName(userName);
		<span class="code-comment">// read the accountData with exclusive read making it invisible to other
</span>		<span class="code-comment">// processor threads, block until found
</span>		AccountData accountData = gigaSpace.read(accountDataTemplate, <span class="code-object">Long</span>.MAX_VALUE, 
			ReadModifiers.EXCLUSIVE_READ_LOCK);
		<span class="code-keyword">return</span> accountData;
	}

	/**
	 * Updates the accountData object according to its userName unique
	 * attribute. Blocks until updates.
	 */
	<span class="code-keyword">public</span> void updateAccountData(AccountData accountData) {
		<span class="code-comment">// Writes the account data to the space, using &lt;code&gt;<span class="code-object">Long</span>.MAX_VALUE_VALUE&lt;/code&gt;
</span>		<span class="code-comment">// as the update timeout (which basically means forever).
</span>		gigaSpace.write(accountData, Lease.FOREVER, <span class="code-object">Long</span>.MAX_VALUE, UpdateModifiers.UPDATE_ONLY);
	}

	/**
	 * Writes the accountData object to the space.
	 * 
	 * @param accountData - accountData to be written.
	 */
	<span class="code-keyword">public</span> void save(AccountData accountData) {
		gigaSpace.write(accountData);
	}
}</pre>
</div></div>
<p><a href="#XAPOrderManagementTutorial-deck2">Choose another tab</a> (back to top)</p>
</div></div>

<p>Let's move on to the services, each described in its own tab below:<br/>
<a name="XAPOrderManagementTutorial-deck3"></a></p>

<div class="panel" style="background-color: #FFFFFF;border-color: #3C78B5;border-style: solid;border-width: 1px;"><div class="panelContent" style="background-color: #FFFFFF;">
<h5><a name="XAPOrderManagementTutorial-AccountPreloader"></a>Account Preloader</h5>
<hr 
 size="1" 
 color="#3C78B5" 
 >

<h2><a name="XAPOrderManagementTutorial-AccountPreloaderFeederProcessingUnit"></a>Account Preloader &#8211; Feeder Processing Unit</h2>

<p>The preloader simply loads 100 accounts into the space. You should note two things in the code below. First, it implements <tt>InitializingBean</tt>, which means its <tt>afterPropertiesSet</tt> method is called when the service is loaded for the first time. The second thing to note is the use of the DAO that we implemented earlier in order to write the 100 accounts. The DAO is not initialized in the class, instead it's injected by the container (the Processing Unit).</p>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java"><span class="code-keyword">package</span> org.openspaces.example.oms.feeder;

<span class="code-keyword">import</span> org.openspaces.example.oms.common.AccountData;
<span class="code-keyword">import</span> org.openspaces.example.oms.common.IAccountDataDAO;
<span class="code-keyword">import</span> org.springframework.beans.factory.InitializingBean;
<span class="code-keyword">import</span> org.springframework.beans.factory.annotation.Required;
<span class="code-keyword">import</span> org.springframework.util.Assert;

/**
 * A loader bean that writes AccountData objects with unique userNames to the
 * space. Since the write is executed directly in the afterPropertiesSet method
 * (and not in a <span class="code-keyword">new</span> thread), the processing unit waits until the loading is
 * finished before initializing the next bean.
 */
<span class="code-keyword">public</span> class AccountDataLoader <span class="code-keyword">implements</span> InitializingBean {

	/**
	 * <span class="code-object">Number</span> of accounts to be loaded by the loader, hardcoded to 100, can be overridden 
	 * in the pu.xml (by setting the prop key <span class="code-quote">"numberOfAccounts"</span>)
	 */
	<span class="code-keyword">private</span> <span class="code-object">int</span> numberOfAccounts = 100;

	/**
	 * DAO object used to access the AccountData objects implicitly. Will be
	 * injected from the pu.xml. Interface enables different DAO
	 * Implementations.
	 */
	<span class="code-keyword">private</span> IAccountDataDAO accountDataDAO;

	/**
	 * Sets the DAO object used to access the accountData objects.
	 * @param accountDataDAO&lt;p&gt;
	 * &lt;code&gt;@Required&lt;/code&gt; annotation provides the 'blow up <span class="code-keyword">if</span> <span class="code-keyword">this</span> 
	 * required property has not been set' logic. 
	 */
	@Required
	<span class="code-keyword">public</span> void setAccountDataDAO(IAccountDataDAO accountDataDAO) {
		<span class="code-keyword">this</span>.accountDataDAO = accountDataDAO;
	}

	/**
	 * Allows to control the number of accounts that will be initally
	 * loaded to the Space. Defaults to &lt;code&gt;100&lt;/code&gt;.
	 */
	<span class="code-keyword">public</span> void setNumberOfAccounts(<span class="code-object">int</span> numberOfAccounts) {
		<span class="code-keyword">this</span>.numberOfAccounts = numberOfAccounts;
	}

	/**
	 * The first method run upon bean Initialization when implementing InitializingBean.
	 * Writes &lt;numberOfAccounts&gt; AccountData through the accountDataDAO. 
	 */
	<span class="code-keyword">public</span> void afterPropertiesSet() <span class="code-keyword">throws</span> Exception {
		<span class="code-comment">// Checks and outputs <span class="code-keyword">if</span> accountDataDAO is <span class="code-keyword">null</span>.
</span>		Assert.notNull(accountDataDAO, <span class="code-quote">"accountDao is required property"</span>);
		<span class="code-object">System</span>.out.println(<span class="code-quote">"---[Start writing AccountData objects]---"</span>);
		<span class="code-comment">// Writing &lt;numberOfAccounts&gt; accountData objects to the space.
</span>		AccountData accountData = <span class="code-keyword">new</span> AccountData();
		<span class="code-keyword">for</span> (<span class="code-object">int</span> i = 1; i &lt;= numberOfAccounts; i++) {
			accountData.setUserName(<span class="code-quote">"USER"</span> + i);
			accountData.setBalance(1000);
			<span class="code-comment">// Saving the accountData
</span>			accountDataDAO.save(accountData);
		}

		<span class="code-object">System</span>.out.println(<span class="code-quote">"---[Wrote "</span> + numberOfAccounts + <span class="code-quote">" AccountData objects]---"</span>);
	}
}</pre>
</div></div>
<p><a href="#XAPOrderManagementTutorial-deck3">Choose another tab</a> (back to top)</p>


<h5><a name="XAPOrderManagementTutorial-EventFeeder"></a>Event Feeder</h5>
<hr 
 size="1" 
 color="#3C78B5" 
 >

<h2><a name="XAPOrderManagementTutorial-EventFeederFeederProcessingUnit"></a>Event Feeder &#8211; Feeder Processing Unit</h2>

<p>The Feeder writes <tt>OrderEvents</tt> to the space that trigger the process of the application. The service implements the <tt>InitializingBean</tt> interface, which means the <tt>afterPropertiesSet</tt> method is called when the service is loaded. Additionaly, it implements <tt>DisposableBean</tt>, which invokes the <tt>destroy</tt> method when the service is stopped.</p>

<p>The objects are written directly to the space (as defined in the <tt>OrderEventFeederTask</tt> inner class). The reference to the space proxy is received through injection from the Processing Unit by using the <b><tt>@GigaSpaceContext(name = "gigaSpace")</tt></b> annotation before the declaration of the <tt>GigaSpace</tt> member. This annotation marks the injection of a GigaSpace object that is defined with a certain name (e.g. <tt>gigaSpace</tt>) within the <tt>pu.xml</tt> file.</p>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java"><span class="code-keyword">package</span> org.openspaces.example.oms.feeder;

<span class="code-keyword">import</span> org.openspaces.core.GigaSpace;
<span class="code-keyword">import</span> org.openspaces.core.context.GigaSpaceContext;
<span class="code-keyword">import</span> org.openspaces.example.oms.common.OrderEvent;
<span class="code-keyword">import</span> org.springframework.beans.factory.DisposableBean;
<span class="code-keyword">import</span> org.springframework.beans.factory.InitializingBean;

<span class="code-keyword">import</span> java.util.Random;
<span class="code-keyword">import</span> java.util.concurrent.Executors;
<span class="code-keyword">import</span> java.util.concurrent.ScheduledExecutorService;
<span class="code-keyword">import</span> java.util.concurrent.ScheduledFuture;
<span class="code-keyword">import</span> java.util.concurrent.TimeUnit;

/**
 * A feeder bean that starts a scheduled task that writes a <span class="code-keyword">new</span> OrderEvent object to the space.
 *
 * &lt;p&gt;The space is injected into <span class="code-keyword">this</span> bean using OpenSpaces support <span class="code-keyword">for</span> @GigaSpaceContext
 * annoation.
 *
 * &lt;p&gt;The scheduled support uses the java.util.concurrent Scheduled Executor Service. It
 * is started and stopped based on Spring lifeceycle events.
 */
<span class="code-keyword">public</span> class OrderEventFeeder <span class="code-keyword">implements</span> InitializingBean, DisposableBean {

	<span class="code-keyword">private</span> Random randomGen = <span class="code-keyword">new</span> Random();

    <span class="code-keyword">private</span> ScheduledExecutorService executorService;

    <span class="code-comment">//	Delayed result bearing action
</span>    <span class="code-keyword">private</span> ScheduledFuture&lt;?&gt; sf;
    
    /**
     * Delay between scheduled tasks
     */
    <span class="code-keyword">private</span> <span class="code-object">long</span> defaultDelay = 1000;
    
	/**
	 * <span class="code-object">Number</span> of accounts loaded by the loader, injected from the pu.xml to calculate
	 * the number of non-matching (without matching accounts) orderEvents to feed.
	 */
    <span class="code-keyword">private</span> <span class="code-object">Integer</span> numberOfAccounts;
        
    /**
     * Percent of AccountData objects to be rejected due to missing account.
     * This is used artificially in <span class="code-keyword">this</span> example to create orderEvents that 
     * will not have any matching account.
     */	 
    <span class="code-keyword">private</span> <span class="code-object">Integer</span> dropOffPercent=20;
    
    /**
     * This number is used to create dropOffPercent rejected orderEvents
     */
    <span class="code-keyword">private</span> <span class="code-object">Integer</span> numberOfAccountsPlusAccountsToDrop;
    
    /**
     * The scheduled orderEvent feeding task.
     */ 
    <span class="code-keyword">private</span> OrderEventFeederTask orderEventFeederTask;
    
    @GigaSpaceContext(name = <span class="code-quote">"gigaSpace"</span>)
    <span class="code-keyword">private</span> GigaSpace gigaSpace;
    
    /**
     * @param defaultDelay - Sets <span class="code-keyword">default</span> delay between feeding tasks.
     */
    <span class="code-keyword">public</span> void setDefaultDelay(<span class="code-object">long</span> defaultDelay) {
        <span class="code-keyword">this</span>.defaultDelay = defaultDelay;
    }
    
    /**
     * @param numberOfAccounts - Sets number of accounts preloaded by the loader.
     */
    <span class="code-keyword">public</span> void setNumberOfAccounts(<span class="code-object">Integer</span> numberOfAccounts) {
		<span class="code-keyword">this</span>.numberOfAccounts = numberOfAccounts;
	}
    
	/**
	 * The first method run upon bean Initialization when implementing InitializingBean.
	 * Starts a scheduled orderEvent feeding task. 
	 */
	<span class="code-keyword">public</span> void afterPropertiesSet() <span class="code-keyword">throws</span> Exception {
        numberOfAccountsPlusAccountsToDrop = (100*numberOfAccounts)/(100-dropOffPercent);
    	<span class="code-object">System</span>.out.println(<span class="code-quote">"---[Starting feeder with cycle &lt;"</span> + defaultDelay + <span class="code-quote">"&gt; ]---"</span>);
        <span class="code-comment">//	Create a thread pool containing 1 thread capable of performing scheduled tasks
</span>        executorService = Executors.newScheduledThreadPool(1);
        orderEventFeederTask = <span class="code-keyword">new</span> OrderEventFeederTask();
        <span class="code-comment">//	Schedule the thread to execute the task at fixed rate with the <span class="code-keyword">default</span> delay defined 
</span>        sf = executorService.scheduleAtFixedRate(orderEventFeederTask, /* initialDelay */defaultDelay, defaultDelay,
                TimeUnit.MILLISECONDS);
    }

    <span class="code-keyword">public</span> void destroy() <span class="code-keyword">throws</span> Exception {
    	<span class="code-comment">//	Shuting down the thread pool upon bean disposal
</span>    	sf.cancel(<span class="code-keyword">true</span>);
        sf = <span class="code-keyword">null</span>;
        executorService.shutdown();
    }

    <span class="code-keyword">public</span> class OrderEventFeederTask <span class="code-keyword">implements</span> <span class="code-object">Runnable</span> {

        <span class="code-keyword">private</span> <span class="code-object">int</span> counter;
                 
        <span class="code-keyword">public</span> void run() {
            <span class="code-keyword">try</span> {       
            	<span class="code-comment">//	Create a <span class="code-keyword">new</span> orderEvent with randomized userName , price and 
</span>            	<span class="code-comment">//	operation divided between buy and sell values.
</span>            	OrderEvent orderEvent = <span class="code-keyword">new</span> OrderEvent
                	(<span class="code-quote">"USER"</span> +randomGen.nextInt(numberOfAccountsPlusAccountsToDrop+1), 100/*price*/, 
                	 OrderEvent.OPERATIONS[counter++ % OrderEvent.OPERATIONS.length]);
                gigaSpace.write(orderEvent);
                <span class="code-object">System</span>.out.println(<span class="code-quote">"---[Wrote orderEvent: "</span>+orderEvent+<span class="code-quote">" ]---"</span>);
            } 
            <span class="code-keyword">catch</span> (Exception e) {
                e.printStackTrace();
            }
        }

        <span class="code-keyword">public</span> <span class="code-object">int</span> getCounter() {
            <span class="code-keyword">return</span> counter;
        }
    }

    <span class="code-keyword">public</span> <span class="code-object">int</span> getFeedCount() {
        <span class="code-keyword">return</span> orderEventFeederTask.getCounter();
    }
}</pre>
</div></div>
<p><a href="#XAPOrderManagementTutorial-deck3">Choose another tab</a> (back to top)</p>


<h5><a name="XAPOrderManagementTutorial-EventValidator"></a>Event Validator</h5>
<hr 
 size="1" 
 color="#3C78B5" 
 >

<h2><a name="XAPOrderManagementTutorial-EventValidatorRuntimeProcessingUnit"></a>Event Validator &#8211; Runtime Processing Unit</h2>

<p>The <tt>OrderEventValidator</tt> takes <tt>OrderEvents</tt> with status <tt>New</tt> from the space, and checks if there's an account with a matching username. When you follow the code, you'll see there is no indication to the type of <tt>OrderEvents</tt> the validator is handling. All this logic is defined in the <tt>pu.xml</tt>, as well as the type of operation the validator performs on the space (by default a take operation of a single object that matches the defined template) and at which interval.</p>

<p>The service implementation does not need to implement any specific interface or to have any special code. The only thing necessary is the use of the <b><tt>@SpaceDataEvent</tt></b> annotation that marks the method that handles the event (in this case the event is a take of an <tt>OrderEvent</tt> from the space). Note that the same event-handling method (<tt>validatesOrderEvent</tt> in our case) has a return value. That returned object is written back to the space by the container. Again, we are using the DAO object to access the accounts within the space without writing any specific GigaSpaces code.</p>

<p>As you can see, the implementation has no use of propietary code. The <tt>OrderEvents</tt> are received and written to the space automatically by the container. Accessing the accounts is done through the DAO, so there is no code that gives any indication to the use of GigaSpaces as the underlying layer for data and messaging.</p>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java"><span class="code-keyword">package</span> org.openspaces.example.oms.runtime;

<span class="code-keyword">import</span> org.openspaces.events.adapter.SpaceDataEvent;
<span class="code-keyword">import</span> org.openspaces.example.oms.common.IAccountDataDAO;
<span class="code-keyword">import</span> org.openspaces.example.oms.common.OrderEvent;
<span class="code-keyword">import</span> org.springframework.beans.factory.annotation.Required;

<span class="code-keyword">public</span> class OrderEventValidator {

    <span class="code-keyword">private</span> <span class="code-object">long</span> workDuration = 100;
    
    /**
     *	DAO object used to access the AccountData objects implicitly. 
     *	Will be injected from the pu.xml.
     *	Interface enables different DAO Implementations.
     */
    <span class="code-keyword">private</span> IAccountDataDAO accountDataDAO;
    
    @Required
    <span class="code-keyword">public</span> void setAccountDataDAO(IAccountDataDAO accountDataDAO) {
		<span class="code-keyword">this</span>.accountDataDAO = accountDataDAO;
	}

	/**
     * Sets the simulated work duration (in milliseconds). Default to 100.
     */
    <span class="code-keyword">public</span> void setWorkDuration(<span class="code-object">long</span> workDuration) {
        <span class="code-keyword">this</span>.workDuration = workDuration;
    }

    /**
     * Validate the given OrderEvent object and returning the validated OrderEvent.
     *
     * Can be invoked using OpenSpaces Events when a matching event
     * occurs or using OpenSpaces Remoting.
     */
    @SpaceDataEvent	<span class="code-comment">//	This annotation marks the method as the event listener.
</span>    <span class="code-keyword">public</span> OrderEvent validatesOrderEvent(OrderEvent orderEvent) {
            	    	
    	<span class="code-comment">// sleep to simluate some work
</span>        <span class="code-keyword">try</span> {
            <span class="code-object">Thread</span>.sleep(workDuration);
        } <span class="code-keyword">catch</span> (InterruptedException e) {
            <span class="code-comment">// <span class="code-keyword">do</span> nothing
</span>        }
     
        <span class="code-object">System</span>.out.println(<span class="code-quote">"---[Validator: Validating orderEvent:"</span>+orderEvent+<span class="code-quote">" ]---"</span>);
        
        <span class="code-comment">//	Getting the AccountData object matching the orderEvent userName through the DAO
</span>        <span class="code-object">boolean</span> isAccountFound = accountDataDAO.isAccountFound(orderEvent.getUserName()); 
        <span class="code-keyword">if</span> (isAccountFound == <span class="code-keyword">true</span>){
        	<span class="code-comment">//	Matching accountData found - changing orderEvent status to pending.
</span>        	orderEvent.setStatus(<span class="code-quote">"Pending"</span>);
        	<span class="code-object">System</span>.out.println(<span class="code-quote">"---[Validator: OrderEvent approved, status set to PENDING]---"</span>);	
        }
        <span class="code-keyword">else</span> {
        	<span class="code-comment">//	No matching accountData found - changing orderEvent status to account not found.
</span>        	orderEvent.setStatus(<span class="code-quote">"AccountNotFound"</span>);
        	<span class="code-object">System</span>.out.println(<span class="code-quote">"---[Validator: OrderEvent rejected, ACCOUNT NOT FOUND]---"</span>);
        }
        
        <span class="code-comment">//  orderID is declared as primary key and as auto-generated. 
</span>    	<span class="code-comment">//	It must be <span class="code-keyword">null</span> before writing an operation.
</span>    	orderEvent.setOrderID(<span class="code-keyword">null</span>);
    	
        <span class="code-keyword">return</span> orderEvent;
    }

    /**
     * Prints out the OrderEvent object passed as a parameter. Usually invoked
     * when using OpenSpaces remoting.
     */
    <span class="code-keyword">public</span> void sayData(OrderEvent orderEvent) {
        <span class="code-object">System</span>.out.println(<span class="code-quote">"+++[Saying: "</span>+orderEvent+<span class="code-quote">"]+++"</span>);
    }
}</pre>
</div></div>
<p><a href="#XAPOrderManagementTutorial-deck3">Choose another tab</a> (back to top)</p>


<h5><a name="XAPOrderManagementTutorial-EventProcessor"></a>Event Processor</h5>
<hr 
 size="1" 
 color="#3C78B5" 
 >

<h2><a name="XAPOrderManagementTutorial-EventProcessorRuntimeProcessingUnit"></a>Event Processor &#8211; Runtime Processing Unit</h2>

<p>Very similiar to how we implemented the <tt>OrderEventValidator</tt>, the <tt>OrderEventProcessor</tt> has a method that is annotated with <b><tt>@SpaceDataEvent</tt></b> to mark it as the handler of events. Again, the events are taken as <tt>OrderEvents</tt> from the space, this time only orders with status <tt>Pending</tt> that were validated by the <tt>Validator</tt>.</p>

<p>With the help of the container that routes the events and the DAO to access the accounts, there is no reference to GigaSpaces' proprietary code.</p>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java"><span class="code-keyword">package</span> org.openspaces.example.oms.runtime;

<span class="code-keyword">import</span> org.openspaces.events.adapter.SpaceDataEvent;
<span class="code-keyword">import</span> org.openspaces.example.oms.common.AccountData;
<span class="code-keyword">import</span> org.openspaces.example.oms.common.IAccountDataDAO;
<span class="code-keyword">import</span> org.openspaces.example.oms.common.OrderEvent;


/**
 * An implementation of IOrderEventProcessor. Can set the simulated work done when
 * processOrderEvent is called by setting the work duration (defaults to 100 ms).
 *
 * &lt;p&gt;This implementaiton is used to demonstrate OpenSpaces Events, using simple Spring configuration to cause
 * processOrderEvent to be invoked when a matching event occurs. The processor uses
 * OpenSpaces support <span class="code-keyword">for</span> annotation markup allowing to use @SpaceDataEvent to
 * mark a method as an event listener. Note, processOrderEvent does not use any space
 * API on the OrderEvent object (though it can), receiving the OrderEvent object to be processed 
 * and returning the result that will be automatically written back to the space.
 *
 * &lt;p&gt;Note, changing the event container is just a matter of configuration (<span class="code-keyword">for</span> example,
 * switching from polling container to notify container) and does not affect <span class="code-keyword">this</span> class.
 *
 * &lt;p&gt;Also note, the deployment model or the Space topology does not affect <span class="code-keyword">this</span> orderEvent processor
 * as well. The data processor can run on a remote space, embedded within a space, and using
 * any Space cluster topology (partitioned, replicated, primary/backup). It is all just a
 * matter of configuraion.
 *
 */
<span class="code-keyword">public</span> class OrderEventProcessor {

    <span class="code-keyword">private</span> <span class="code-object">long</span> workDuration = 100;

    /**
     *	DAO object used to access the AccountData objects implicitly. 
     *	Will be injected from the pu.xml.
     *	Interface enables different DAO Implementations.
     */
    <span class="code-keyword">private</span> IAccountDataDAO accountDataDAO;
    
    <span class="code-keyword">public</span> void setAccountDataDAO(IAccountDataDAO accountDataDAO) {
		<span class="code-keyword">this</span>.accountDataDAO = accountDataDAO;
	}
    
    /** Sets the simulated work duration (in milliseconds). Defaut to 100. */
    <span class="code-keyword">public</span> void setWorkDuration(<span class="code-object">long</span> workDuration) {
        <span class="code-keyword">this</span>.workDuration = workDuration;
    }

    /**  <span class="code-object">Process</span> the given OrderEvent object and returning the processed OrderEvent.
         Can be invoked using OpenSpaces Events when a matching event
         occurs or using OpenSpaces Remoting. */
    @SpaceDataEvent
    <span class="code-keyword">public</span> OrderEvent processOrderEvent(OrderEvent orderEvent) {
        <span class="code-comment">// sleep to simluate some work
</span>        <span class="code-keyword">try</span> {
            <span class="code-object">Thread</span>.sleep(workDuration);
        } <span class="code-keyword">catch</span> (InterruptedException e) {
            <span class="code-comment">// <span class="code-keyword">do</span> nothing
</span>        }
        <span class="code-object">System</span>.out.println(<span class="code-quote">"---[Processor: Processing orderEvent:"</span>+orderEvent+<span class="code-quote">" ]---"</span>);
        
        <span class="code-comment">//	read the accountData with exclusive read making it invisible to other processor threads, block until found
</span>        AccountData accountData = accountDataDAO.getAccountData(orderEvent.getUserName());
            	
        <span class="code-keyword">if</span> (accountData != <span class="code-keyword">null</span>) {
        	<span class="code-object">System</span>.out.println(<span class="code-quote">"---[Processor: Found accountData matching the orderEvent: "</span>+accountData+ <span class="code-quote">"]---"</span>);	
        
        	<span class="code-keyword">if</span> (orderEvent.getOperation() == OrderEvent.BUY_OPERATION) { 
        		<span class="code-comment">//	orderEvent operation is buy
</span>        		
        		<span class="code-keyword">if</span> (accountData.getBalance() &gt;= orderEvent.getPrice()){	
        			<span class="code-comment">//	balance is enough to buy
</span>        			accountData.setBalance(accountData.getBalance()-orderEvent.getPrice());
        			orderEvent.setStatus(<span class="code-quote">"Processed"</span>);
        			<span class="code-object">System</span>.out.println(<span class="code-quote">"---[Processor: OrderEvent PROCESSED successfully!]---"</span>);
        			<span class="code-comment">//	update the accountData object with the <span class="code-keyword">new</span> balance 
</span>        			accountDataDAO.updateAccountData(accountData);
        		}
        		<span class="code-keyword">else</span> {
        			<span class="code-comment">//	balance insufficient
</span>        			orderEvent.setStatus(<span class="code-quote">"InsufficientFunds"</span>);
        			<span class="code-object">System</span>.out.println(<span class="code-quote">"---[Processor: OrderEvent rejected due to INSUFFICIENT FUNDS]---"</span>);
        		}
        	}
        	<span class="code-keyword">else</span> {
        		<span class="code-comment">//	orderEvent operation is sell
</span>        		accountData.setBalance(accountData.getBalance()+orderEvent.getPrice());
        		orderEvent.setStatus(<span class="code-quote">"Processed"</span>);
        		<span class="code-object">System</span>.out.println(<span class="code-quote">"---[Processor: OrderEvent PROCESSED successfully!]---"</span>);
        		<span class="code-comment">//	update the accountData object with the <span class="code-keyword">new</span> balance 
</span>        		accountDataDAO.updateAccountData(accountData);
        	}
        }

        <span class="code-comment">//  orderID is declared as primary key and as auto-generated. 
</span>    	<span class="code-comment">//	It must be <span class="code-keyword">null</span> before writing an operation.
</span>    	orderEvent.setOrderID(<span class="code-keyword">null</span>);       
        
    	<span class="code-keyword">return</span> orderEvent;
    }

    /** Prints out the OrderEvent object passed as a parameter. Usually invoked
        when using OpenSpaces remoting. */
    <span class="code-keyword">public</span> void sayData(OrderEvent orderEvent) {
        <span class="code-object">System</span>.out.println(<span class="code-quote">"+++[Saying: "</span>+orderEvent);
    }
}</pre>
</div></div>
<p><a href="#XAPOrderManagementTutorial-deck3">Choose another tab</a> (back to top)</p>


<h5><a name="XAPOrderManagementTutorial-AccountCounter"></a>Account Counter</h5>
<hr 
 size="1" 
 color="#3C78B5" 
 >

<h2><a name="XAPOrderManagementTutorial-AccountCounterStatisticsProcessingUnit"></a>Account Counter &#8211; Statistics Processing Unit</h2>

<p>The <tt>@SpaceDataEvent</tt> annotation marks the <tt>outputInfo(AccountData accountData)</tt> method to receive events and increment a counter. Note that as opposed to the <tt>Validator</tt> and <tt>Processor</tt>, the method here does not return any value, which means that nothing is written to the space when the method exits.</p>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java"><span class="code-keyword">package</span> org.openspaces.example.oms.stats;

<span class="code-keyword">import</span> org.openspaces.events.adapter.SpaceDataEvent;
<span class="code-keyword">import</span> org.openspaces.example.oms.common.AccountData;

<span class="code-keyword">import</span> java.util.concurrent.atomic.AtomicInteger;

/**
 * A simple bean outputting the accountData updated balance.
 *
 */
<span class="code-keyword">public</span> class OutputAccountData {

    <span class="code-keyword">private</span> AtomicInteger accountDataUpdatedCounter = <span class="code-keyword">new</span> AtomicInteger(0);

    @SpaceDataEvent	<span class="code-comment">//	Indicates that <span class="code-keyword">this</span> method should be invoked upon notification.
</span>    <span class="code-keyword">public</span> void outputInfo(AccountData accountData) {
        accountDataUpdatedCounter.incrementAndGet();
        <span class="code-object">System</span>.out.println(<span class="code-quote">"---{ AccountData balance <span class="code-keyword">for</span> ["</span>+accountData.getUserName()+<span class="code-quote">"] was updated to ["</span>
                           +accountData.getBalance()+<span class="code-quote">"] ,Total account updates ["</span> + accountDataUpdatedCounter + <span class="code-quote">"] }---"</span>);
    }

    <span class="code-keyword">public</span> <span class="code-object">int</span> getAccountDataUpdatedCount() {
        <span class="code-keyword">return</span> accountDataUpdatedCounter.intValue();
    }
}</pre>
</div></div>
<p><a href="#XAPOrderManagementTutorial-deck3">Choose another tab</a> (back to top)</p>


<h5><a name="XAPOrderManagementTutorial-EventCounter"></a>Event Counter</h5>
<hr 
 size="1" 
 color="#3C78B5" 
 >

<h2><a name="XAPOrderManagementTutorial-EventCounterStatisticsProcessingUnit"></a>Event Counter &#8211; Statistics Processing Unit</h2>

<p>This service receives notifications about <tt>OrderEvents</tt> that are written to the space with different states. Since it implements the <tt>InitializingBean</tt> interface, when the service is loaded, the <tt>afterPropertiesSet()</tt> method is called and several count operations are performed on the space (each for an <tt>OrderEvent</tt> with a different state). After this initialization, the counters are updated on each event that is received by the service.</p>

<p>Later we'll show how these counters are used as monitors that are displayed in the GigaSpaces Management Center.</p>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java"><span class="code-keyword">package</span> org.openspaces.example.oms.stats;

<span class="code-keyword">import</span> org.openspaces.core.GigaSpace;
<span class="code-keyword">import</span> org.openspaces.core.context.GigaSpaceContext;
<span class="code-keyword">import</span> org.openspaces.events.adapter.SpaceDataEvent;
<span class="code-keyword">import</span> org.openspaces.example.oms.common.OrderEvent;
<span class="code-keyword">import</span> org.springframework.beans.factory.InitializingBean;

<span class="code-keyword">import</span> java.util.concurrent.atomic.AtomicInteger;

/**
 * A simple bean counting the number of orderEvent writes , processes and rejection due to
 * account not found. 
 * Holds a 3 simple counters that are incremented each time a matching event occurs.
 * Outputting the orderEvent updated status.
 *
 * &lt;p&gt;Also note, the orderEvent that will be counted depends on the
 * configuration. For example, <span class="code-keyword">this</span> example uses the <span class="code-quote">"non clustered"</span> view
 * of the space <span class="code-keyword">while</span> running within an embedded space. This means <span class="code-keyword">this</span>
 * coutner will count only the relevant partition processed data. It is
 * just a matter of configuration to count the number of processed data
 * across a cluster.
 *
 */
<span class="code-keyword">public</span> class OutputOrderEventCounter <span class="code-keyword">implements</span> InitializingBean {
	
	<span class="code-keyword">private</span> AtomicInteger orderEventWrittenCounter = <span class="code-keyword">new</span> AtomicInteger(0);
    <span class="code-keyword">private</span> AtomicInteger orderEventProcessedCounter = <span class="code-keyword">new</span> AtomicInteger(0);
    <span class="code-keyword">private</span> AtomicInteger orderEventAccountNotFoundCounter = <span class="code-keyword">new</span> AtomicInteger(0);
    
    @GigaSpaceContext(name = <span class="code-quote">"gigaSpace"</span>)
    <span class="code-keyword">private</span> GigaSpace gigaSpace;
    
    <span class="code-keyword">public</span> void afterPropertiesSet() <span class="code-keyword">throws</span> Exception {
		<span class="code-comment">//	Upon bean instantiating counts how many New, Processed and AccountNotFound 
</span>    	<span class="code-comment">//	are in the space and setting the relevant counters.
</span>    	OrderEvent orderEvent = <span class="code-keyword">new</span> OrderEvent();
    	orderEvent.setStatus(<span class="code-quote">"New"</span>);
    	<span class="code-object">int</span> counter = gigaSpace.count(orderEvent);
    	orderEventWrittenCounter = <span class="code-keyword">new</span> AtomicInteger(counter);
    	orderEvent.setStatus(<span class="code-quote">"Processed"</span>);
    	counter = gigaSpace.count(orderEvent);
    	orderEventProcessedCounter = <span class="code-keyword">new</span> AtomicInteger(counter);
    	
    	orderEvent.setStatus(<span class="code-quote">"AccountNotFound"</span>);
    	counter = gigaSpace.count(orderEvent);
    	orderEventAccountNotFoundCounter = <span class="code-keyword">new</span> AtomicInteger(counter);
	}
    
    @SpaceDataEvent
    <span class="code-keyword">public</span> void outputInfo(OrderEvent orderEvent) {
        <span class="code-object">System</span>.out.println(<span class="code-quote">"---{ OrderEvent ["</span>+orderEvent.getStatus()+ 
        					<span class="code-quote">"], Total operations on orderEvents ["</span> + orderEventWrittenCounter + <span class="code-quote">"] }---"</span>);
        <span class="code-keyword">if</span> (orderEvent.getStatus().equals(<span class="code-quote">"New"</span>)){
        	orderEventWrittenCounter.incrementAndGet();
        }
        <span class="code-keyword">else</span> {
        	<span class="code-keyword">if</span> (orderEvent.getStatus().equals(<span class="code-quote">"Processed"</span>)){
            	orderEventProcessedCounter.incrementAndGet();
        	}
        	<span class="code-keyword">else</span> {
            	<span class="code-keyword">if</span> (orderEvent.getStatus().equals(<span class="code-quote">"AccountNotFound"</span>)){
                	orderEventAccountNotFoundCounter.incrementAndGet();
            	}
        	}
        } 	
    }

    <span class="code-keyword">public</span> <span class="code-object">int</span> getOrderEventWrittenCounter() {
        <span class="code-keyword">return</span> orderEventWrittenCounter.intValue();
    }
    
    <span class="code-keyword">public</span> <span class="code-object">int</span> getOrderEventProcessedCounter() {
        <span class="code-keyword">return</span> orderEventProcessedCounter.intValue();
    }
    
    <span class="code-keyword">public</span> <span class="code-object">int</span> getOrderEventAccountNotFoundCounter() {
        <span class="code-keyword">return</span> orderEventAccountNotFoundCounter.intValue();
    }
}</pre>
</div></div>
<p><a href="#XAPOrderManagementTutorial-deck3">Choose another tab</a> (back to top)</p>
</div></div>

<p><a name="XAPOrderManagementTutorial-6"></a></p>
<script type='text/javascript'>//<![CDATA[
function debug() { }
// ]]></script><script type='text/javascript' src='/wiki/download/resources/net.customware.confluence.plugin.composition:composition-setup/js/browser.js'>//<![CDATA[
// ]]></script><script type='text/javascript' src='/wiki/download/resources/net.customware.confluence.plugin.composition:composition-setup/js/behaviour.js'>//<![CDATA[
// ]]></script><script type='text/javascript' src='/wiki/download/resources/net.customware.confluence.plugin.composition:composition-setup/js/memory.js'>//<![CDATA[
// ]]></script><script type='text/javascript' src='/wiki/download/resources/net.customware.confluence.plugin.composition:composition-setup/js/cloak.js'>//<![CDATA[
// ]]></script><script type='text/javascript'>//<![CDATA[
Cloak.closeHTML = "<img src=\'/wiki/download/resources/net.customware.confluence.plugin.composition:toggle-cloak/img/navigate_down_10.gif\'/>";
Cloak.openHTML = "<img src=\'/wiki/download/resources/net.customware.confluence.plugin.composition:toggle-cloak/img/navigate_right_10.gif\'/>";
Cloak.toggleZone = true;
Cloak.memoryDuration = 0;
Cloak.memoryPrefix = "contentId:53903540";
Cloak.memoryPath = "/wiki/";
// ]]></script><style type='text/css'>
.cloakToggle { /* Definition for state toggling image */
cursor:hand;
cursor:pointer;
}
</style><script type='text/javascript' src='/wiki/download/resources/net.customware.confluence.plugin.composition:composition-setup/js/transitions.js'>//<![CDATA[
// ]]></script><script type='text/javascript' src='/wiki/download/resources/net.customware.confluence.plugin.composition:composition-setup/js/deck.js'>//<![CDATA[
// ]]></script><link rel='stylesheet' type='text/css'  href='/wiki/styles/main-action.css?pluginCompleteKey=net.customware.confluence.plugin.composition:composition-setup&stylesheetName=deck&spaceKey=XAP8'/><script type='text/javascript'>//<![CDATA[
Deck.memoryDuration = 0;
Deck.memoryPrefix = "contentId:53903540";
Deck.memoryPath = "/wiki/";
// ]]></script>
<h1><a name="XAPOrderManagementTutorial-WiringwithSpring%28PUConfiguration%29"></a>Wiring with Spring (PU Configuration)</h1>
<div class="greybox" width="100%">
<table cellspacing="0" cellpadding="0"><tr>
<td valign="top"><img src="download/attachments/48760898/urhere.gif"/></td><td width="10px"></td><td><sub><a href="#XAPOrderManagementTutorial-1">Overview</a> - <a href="#XAPOrderManagementTutorial-2">The Application Workflow</a> - <a href="#XAPOrderManagementTutorial-3">Implementation</a> - <a href="#XAPOrderManagementTutorial-4">POJO Domain Model</a> - <a href="#XAPOrderManagementTutorial-5">Writing POJO Services</a> - <img src="download/attachments/17301573/sstar.gif" align="absmiddle" border="0"/> <b><a href="#XAPOrderManagementTutorial-6">Wiring with Spring (PU Configuration)</a></b> - <a href="#XAPOrderManagementTutorial-7">Building and Packaging</a> - <a href="#XAPOrderManagementTutorial-8">Deployment</a> - <a href="#XAPOrderManagementTutorial-9">What's Next?</a></sub></td></tr></table>
</div>

<p>By now, the implementation of the domain model, DAO, and services is done, but you might have noticed that the picture is not yet complete. The configuration of a space, and types of events that the services should handle are some of the things that are not defined anywhere within the code. Instead, we define all of these in the configuration file (<tt>pu.xml</tt>) of each processing unit.</p>

<p>Each <tt>pu.xml</tt> appears below on a different tab.</p>

<p><a name="XAPOrderManagementTutorial-deck4"></a></p>

<div class="panel" style="background-color: #FFFFFF;border-color: #3C78B5;border-style: solid;border-width: 1px;"><div class="panelContent" style="background-color: #FFFFFF;">
<h5><a name="XAPOrderManagementTutorial-FeederProcessingUnit"></a>Feeder Processing Unit</h5>
<hr 
 size="1" 
 color="#3C78B5" 
 >

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-xml"><span class="code-tag">&lt;?xml version=<span class="code-quote">"1.0"</span> encoding=<span class="code-quote">"UTF-8"</span>?&gt;</span>
&lt;beans xmlns=<span class="code-quote">"http://www.springframework.org/schema/beans"</span>
       <span class="code-keyword">xmlns:xsi</span>=<span class="code-quote">"http://www.w3.org/2001/XMLSchema-instance"</span>
       <span class="code-keyword">xmlns:os-core</span>=<span class="code-quote">"http://www.openspaces.org/schema/core"</span>
       <span class="code-keyword">xmlns:os-events</span>=<span class="code-quote">"http://www.openspaces.org/schema/events"</span>
       <span class="code-keyword">xmlns:os-remoting</span>=<span class="code-quote">"http://www.openspaces.org/schema/remoting"</span>
       <span class="code-keyword">xmlns:os-sla</span>=<span class="code-quote">"http://www.openspaces.org/schema/sla"</span>
       xsi:schemaLocation="http://www.springframework.org/schema/beans 
       http://www.springframework.org/schema/beans/spring-beans.xsd
       http://www.openspaces.org/schema/core 
       http://www.openspaces.org/schema/core/openspaces-core.xsd
       http://www.openspaces.org/schema/events 
       http://www.openspaces.org/schema/events/openspaces-events.xsd
       http://www.openspaces.org/schema/remoting
	http://www.openspaces.org/schema/remoting/openspaces-remoting.xsd
       http://www.openspaces.org/schema/sla 
       http://www.openspaces.org/schema/sla/openspaces-sla.xsd"&gt;
    
    &lt;!-- Spring property configurer which allows us to use system properties (such as user.name). 
    	 Here we define a common numberOfAccounts property to be injected to the AccountDataLoader
    	 and to the OrderEventFeeder beans --&gt;
    <span class="code-tag">&lt;bean id=<span class="code-quote">"propertiesConfigurer"</span> class=<span class="code-quote">"org.springframework.beans.factory.config.PropertyPlaceholderConfigurer"</span>&gt;</span>
    	<span class="code-tag">&lt;property name=<span class="code-quote">"properties"</span>&gt;</span>
    		<span class="code-tag">&lt;props&gt;</span>
    			<span class="code-tag">&lt;prop key=<span class="code-quote">"numberOfAccounts"</span>&gt;</span>100<span class="code-tag">&lt;/prop&gt;</span>
    		<span class="code-tag">&lt;/props&gt;</span>
    	<span class="code-tag">&lt;/property&gt;</span>
    <span class="code-tag">&lt;/bean&gt;</span>

	&lt;!-- This component is the RequiredAnnotationBeanPostProcessor class. 
	This is a special BeanPostProcessor implementation that is 
	@Required-aware and actually provides the 'blow up if this 
	required property has not been set' logic. It is very easy to 
	configure; simply drop the following bean definition into your 
	Spring XML configuration. --&gt;
	<span class="code-tag">&lt;bean class=<span class="code-quote">"org.springframework.beans.factory.annotation.RequiredAnnotationBeanPostProcessor"</span>/&gt;</span>

    <span class="code-tag"><span class="code-comment">&lt;!-- Enables the usage of @GigaSpaceContext annotation based injection. --&gt;</span></span>
    <span class="code-tag">&lt;os-core:giga-space-context/&gt;</span>
	
	<span class="code-tag"><span class="code-comment">&lt;!-- A bean representing AccountDataDAO using GigaSpaces (an IAccountDataDAO implementation) --&gt;</span></span>
	<span class="code-tag">&lt;bean id=<span class="code-quote">"accountDataDAO"</span> class=<span class="code-quote">"org.openspaces.example.oms.common.AccountDataDAO"</span>/&gt;</span>
	
    &lt;!-- A bean representing a space (an IJSpace implementation).
         Note, we perform a lookup on the space since we are working against a remote space. --&gt;
    <span class="code-tag">&lt;os-core:space id=<span class="code-quote">"space"</span> url=<span class="code-quote">"jini://*/*/spaceOMS"</span>/&gt;</span>

    <span class="code-tag"><span class="code-comment">&lt;!-- OpenSpaces simplified space API built on top of IJSpace/JavaSpace. --&gt;</span></span>
    <span class="code-tag">&lt;os-core:giga-space id=<span class="code-quote">"gigaSpace"</span> space=<span class="code-quote">"space"</span>/&gt;</span>

	<span class="code-tag"><span class="code-comment">&lt;!-- The AccountData loader bean, writing new 750 unique AccountData objects to the space. --&gt;</span></span>
    <span class="code-tag">&lt;bean id=<span class="code-quote">"accountDataLoader"</span> class=<span class="code-quote">"org.openspaces.example.oms.feeder.AccountDataLoader"</span>&gt;</span>
		<span class="code-tag">&lt;property name=<span class="code-quote">"numberOfAccounts"</span> value=<span class="code-quote">"${numberOfAccounts}"</span> /&gt;</span>
    	<span class="code-tag">&lt;property name=<span class="code-quote">"accountDataDAO"</span> ref=<span class="code-quote">"accountDataDAO"</span> /&gt;</span>
    <span class="code-tag">&lt;/bean&gt;</span>

    &lt;!-- The Data feeder bean, writing new OrderEvents objects to the space in a constant interval.
    	 the depends-on attribute ensures the feeder will start only after the feeder bean is done --&gt;
    &lt;bean id=<span class="code-quote">"orderEventFeeder"</span> class=<span class="code-quote">"org.openspaces.example.oms.feeder.OrderEventFeeder"</span> 

    	depends-on=<span class="code-quote">"accountDataLoader"</span>&gt;
		<span class="code-tag">&lt;property name=<span class="code-quote">"numberOfAccounts"</span> value=<span class="code-quote">"${numberOfAccounts}"</span> /&gt;</span>
    <span class="code-tag">&lt;/bean&gt;</span>

<span class="code-tag">&lt;/beans&gt;</span></pre>
</div></div>
<p><a href="#XAPOrderManagementTutorial-deck4">Choose another tab</a> (back to top)</p>


<h5><a name="XAPOrderManagementTutorial-RuntimeProcessingUnit"></a>Runtime Processing Unit</h5>
<hr 
 size="1" 
 color="#3C78B5" 
 >

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-xml"><span class="code-tag">&lt;?xml version=<span class="code-quote">"1.0"</span> encoding=<span class="code-quote">"UTF-8"</span>?&gt;</span>
&lt;beans xmlns=<span class="code-quote">"http://www.springframework.org/schema/beans"</span>
       <span class="code-keyword">xmlns:xsi</span>=<span class="code-quote">"http://www.w3.org/2001/XMLSchema-instance"</span>
       <span class="code-keyword">xmlns:os-core</span>=<span class="code-quote">"http://www.openspaces.org/schema/core"</span>
       <span class="code-keyword">xmlns:os-events</span>=<span class="code-quote">"http://www.openspaces.org/schema/events"</span>
       <span class="code-keyword">xmlns:os-remoting</span>=<span class="code-quote">"http://www.openspaces.org/schema/remoting"</span>
       <span class="code-keyword">xmlns:os-sla</span>=<span class="code-quote">"http://www.openspaces.org/schema/sla"</span>
       	xsi:schemaLocation="http://www.springframework.org/schema/beans 
       	http://www.springframework.org/schema/beans/spring-beans.xsd
       http://www.openspaces.org/schema/core 
       http://www.openspaces.org/schema/core/openspaces-core.xsd
       http://www.openspaces.org/schema/events 
       http://www.openspaces.org/schema/events/openspaces-events.xsd
       http://www.openspaces.org/schema/remoting 
	http://www.openspaces.org/schema/remoting/openspaces-remoting.xsd
       http://www.openspaces.org/schema/sla 
       http://www.openspaces.org/schema/sla/openspaces-sla.xsd"&gt;

    <span class="code-tag"><span class="code-comment">&lt;!-- Spring property configurer which allows us to use system properties (such as user.name). --&gt;</span></span>
    <span class="code-tag">&lt;bean id=<span class="code-quote">"propertiesConfigurer"</span> class=<span class="code-quote">"org.springframework.beans.factory.config.PropertyPlaceholderConfigurer"</span>/&gt;</span>

	&lt;!-- This component is the RequiredAnnotationBeanPostProcessor class. 
	This is a special BeanPostProcessor implementation that is 
	@Required-aware and actually provides the 'blow up if this 
	required property has not been set' logic. It is very easy to 
	configure; simply drop the following bean definition into your 
	Spring XML configuration. --&gt;
	<span class="code-tag">&lt;bean class=<span class="code-quote">"org.springframework.beans.factory.annotation.RequiredAnnotationBeanPostProcessor"</span>/&gt;</span>

    <span class="code-tag"><span class="code-comment">&lt;!-- Enables the usage of @GigaSpaceContext annotation based injection. --&gt;</span></span>
    <span class="code-tag">&lt;os-core:giga-space-context/&gt;</span>
	
	&lt;!-- Loads a Spring application context (based on a separate Spring xml configuration file - here mode.xml) 
		 only the if processing unit / space is in primary mode and unload it when the processing unit / space 
		 is in backup mode. --&gt;
	<span class="code-tag">&lt;os-core:context-loader id=<span class="code-quote">"spaceMode"</span> location=<span class="code-quote">"classpath:/META-INF/spring/mode/mode.xml"</span>/&gt;</span>
	
	<span class="code-tag"><span class="code-comment">&lt;!-- A bean representing AccountDataDAO using GigaSpaces (an IAccountDataDAO implementation) --&gt;</span></span>
	<span class="code-tag">&lt;bean id=<span class="code-quote">"accountDataDAO"</span> class=<span class="code-quote">"org.openspaces.example.oms.common.AccountDataDAO"</span>/&gt;</span>
	
    &lt;!-- A bean representing a space (an IJSpace implementation).
		 Note, we do not specify here the cluster topology of the space. It is declared outside of
         the processing unit or within the SLA bean. --&gt;
    <span class="code-tag">&lt;os-core:space id=<span class="code-quote">"space"</span> url=<span class="code-quote">"/./spaceOMS"</span>/&gt;</span>

    <span class="code-tag"><span class="code-comment">&lt;!-- OpenSpaces simplified space API built on top of IJSpace/JavaSpace. --&gt;</span></span>
    <span class="code-tag">&lt;os-core:giga-space id=<span class="code-quote">"gigaSpace"</span> space=<span class="code-quote">"space"</span> tx-manager=<span class="code-quote">"transactionManager"</span>/&gt;</span>

    <span class="code-tag"><span class="code-comment">&lt;!-- Defines a local Jini transaction manager. --&gt;</span></span>
    <span class="code-tag">&lt;os-core:local-tx-manager id=<span class="code-quote">"transactionManager"</span> space=<span class="code-quote">"space"</span>/&gt;</span>
	
	<span class="code-tag"><span class="code-comment">&lt;!-- The orderEvent validator bean --&gt;</span></span>
    <span class="code-tag">&lt;bean id=<span class="code-quote">"orderEventValidator"</span> class=<span class="code-quote">"org.openspaces.example.oms.runtime.OrderEventValidator"</span>&gt;</span>
    	<span class="code-tag">&lt;property name=<span class="code-quote">"accountDataDAO"</span> ref=<span class="code-quote">"accountDataDAO"</span> /&gt;</span>
    <span class="code-tag">&lt;/bean&gt;</span>
	
	&lt;!-- A polling event container that performs (by default) polling take operations against
         the space using the provided template (in our case, the new orderEvents objects).
         Once a match is found, the orderEvent processor bean event listener is triggered using the
         annotation adapter. --&gt;
    <span class="code-tag">&lt;os-events:polling-container id=<span class="code-quote">"orderEventValidatorPollingEventContainer"</span> giga-space=<span class="code-quote">"gigaSpace"</span>&gt;</span>
        <span class="code-tag">&lt;os-events:tx-support tx-manager=<span class="code-quote">"transactionManager"</span>/&gt;</span>
        <span class="code-tag">&lt;os-core:template&gt;</span>
            <span class="code-tag">&lt;bean class=<span class="code-quote">"org.openspaces.example.oms.common.OrderEvent"</span>&gt;</span>
                <span class="code-tag">&lt;property name=<span class="code-quote">"status"</span> value=<span class="code-quote">"New"</span>/&gt;</span>
            <span class="code-tag">&lt;/bean&gt;</span>
        <span class="code-tag">&lt;/os-core:template&gt;</span>
        <span class="code-tag">&lt;os-events:listener&gt;</span>
            <span class="code-tag">&lt;os-events:annotation-adapter&gt;</span>
                <span class="code-tag">&lt;os-events:delegate ref=<span class="code-quote">"orderEventValidator"</span>/&gt;</span>
            <span class="code-tag">&lt;/os-events:annotation-adapter&gt;</span>
        <span class="code-tag">&lt;/os-events:listener&gt;</span>
    <span class="code-tag">&lt;/os-events:polling-container&gt;</span>
	
    <span class="code-tag"><span class="code-comment">&lt;!-- The orderEvent processor bean --&gt;</span></span>
    <span class="code-tag">&lt;bean id=<span class="code-quote">"orderEventProcessor"</span> class=<span class="code-quote">"org.openspaces.example.oms.runtime.OrderEventProcessor"</span>&gt;</span>
    	<span class="code-tag">&lt;property name=<span class="code-quote">"accountDataDAO"</span> ref=<span class="code-quote">"accountDataDAO"</span> /&gt;</span>
    <span class="code-tag">&lt;/bean&gt;</span>

    &lt;!-- A polling event container that performs (by default) polling take operations with txn 
    	 support against the space using the provided template (in our case, the pending orderEvent objects).
         Once a match is found, the data processor bean event listener is triggered using the
         annotation adapter. --&gt;
    <span class="code-tag">&lt;os-events:polling-container id=<span class="code-quote">"orderEventProcessorPollingEventContainer"</span> giga-space=<span class="code-quote">"gigaSpace"</span>&gt;</span>
        <span class="code-tag">&lt;os-events:tx-support tx-manager=<span class="code-quote">"transactionManager"</span>/&gt;</span>
        <span class="code-tag">&lt;os-core:template&gt;</span>
            <span class="code-tag">&lt;bean class=<span class="code-quote">"org.openspaces.example.oms.common.OrderEvent"</span>&gt;</span>
                <span class="code-tag">&lt;property name=<span class="code-quote">"status"</span> value=<span class="code-quote">"Pending"</span>/&gt;</span>
            <span class="code-tag">&lt;/bean&gt;</span>
        <span class="code-tag">&lt;/os-core:template&gt;</span>
        <span class="code-tag">&lt;os-events:listener&gt;</span>
            <span class="code-tag">&lt;os-events:annotation-adapter&gt;</span>
                <span class="code-tag">&lt;os-events:delegate ref=<span class="code-quote">"orderEventProcessor"</span>/&gt;</span>
            <span class="code-tag">&lt;/os-events:annotation-adapter&gt;</span>
        <span class="code-tag">&lt;/os-events:listener&gt;</span>
    <span class="code-tag">&lt;/os-events:polling-container&gt;</span>

<span class="code-tag">&lt;/beans&gt;</span></pre>
</div></div>
<p><a href="#XAPOrderManagementTutorial-deck4">Choose another tab</a> (back to top)</p>


<h5><a name="XAPOrderManagementTutorial-StatisticsProcessingUnit"></a>Statistics Processing Unit</h5>
<hr 
 size="1" 
 color="#3C78B5" 
 >

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-xml"><span class="code-tag">&lt;?xml version=<span class="code-quote">"1.0"</span> encoding=<span class="code-quote">"UTF-8"</span>?&gt;</span>
&lt;beans xmlns=<span class="code-quote">"http://www.springframework.org/schema/beans"</span>
       <span class="code-keyword">xmlns:xsi</span>=<span class="code-quote">"http://www.w3.org/2001/XMLSchema-instance"</span>
       <span class="code-keyword">xmlns:os-core</span>=<span class="code-quote">"http://www.openspaces.org/schema/core"</span>
       <span class="code-keyword">xmlns:os-events</span>=<span class="code-quote">"http://www.openspaces.org/schema/events"</span>
       <span class="code-keyword">xmlns:os-remoting</span>=<span class="code-quote">"http://www.openspaces.org/schema/remoting"</span>
       <span class="code-keyword">xmlns:os-sla</span>=<span class="code-quote">"http://www.openspaces.org/schema/sla"</span>
       xsi:schemaLocation="http://www.springframework.org/schema/beans 
       http://www.springframework.org/schema/beans/spring-beans.xsd
       http://www.openspaces.org/schema/core 
       http://www.openspaces.org/schema/core/openspaces-core.xsd
       http://www.openspaces.org/schema/events 
       http://www.openspaces.org/schema/events/openspaces-events.xsd
       http://www.openspaces.org/schema/remoting 
	http://www.openspaces.org/schema/remoting/openspaces-remoting.xsd
       http://www.openspaces.org/schema/sla 
       http://www.openspaces.org/schema/sla/openspaces-sla.xsd"&gt;
    
    &lt;!-- Simply use SLA to add 3 monitors that uses the outputOrderEvent bean to count the globaly
         processed and rejected due to matching account not found orderEvents objects 
         and count the number of new orderEvents written. --&gt;
    <span class="code-tag">&lt;os-sla:sla&gt;</span>
        <span class="code-tag">&lt;os-sla:monitors&gt;</span>
            &lt;os-sla:bean-property-monitor name=<span class="code-quote">"Written OrderEvent"</span> 
            	bean-ref=<span class="code-quote">"outputOrderEvent"</span> property-name=<span class="code-quote">"orderEventWrittenCounter"</span> /&gt;
            &lt;os-sla:bean-property-monitor name=<span class="code-quote">"Processed OrderEvent"</span> 
            	bean-ref=<span class="code-quote">"outputOrderEvent"</span> property-name=<span class="code-quote">"orderEventProcessedCounter"</span> /&gt;
            &lt;os-sla:bean-property-monitor name=<span class="code-quote">"AccountNotFound OrderEvent"</span> 
            	bean-ref=<span class="code-quote">"outputOrderEvent"</span> property-name=<span class="code-quote">"orderEventAccountNotFoundCounter"</span> /&gt;
        <span class="code-tag">&lt;/os-sla:monitors&gt;</span>
    <span class="code-tag">&lt;/os-sla:sla&gt;</span>
    
    <span class="code-tag"><span class="code-comment">&lt;!-- Spring property configurer which allows us to use system properties (such as user.name). --&gt;</span></span>
    <span class="code-tag">&lt;bean id=<span class="code-quote">"propertiesConfigurer"</span> class=<span class="code-quote">"org.springframework.beans.factory.config.PropertyPlaceholderConfigurer"</span>/&gt;</span>

    <span class="code-tag"><span class="code-comment">&lt;!-- Enables the usage of @GigaSpaceContext annotation based injection. --&gt;</span></span>
    <span class="code-tag">&lt;os-core:giga-space-context/&gt;</span>

    &lt;!-- A bean representing a space (an IJSpace implementation).
         Note, we perform a lookup on the space since we are working against a remote space. --&gt;
    <span class="code-tag">&lt;os-core:space id=<span class="code-quote">"space"</span> url=<span class="code-quote">"jini://*/*/spaceOMS"</span>/&gt;</span>

    <span class="code-tag"><span class="code-comment">&lt;!-- OpenSpaces simplified space API built on top of IJSpace/JavaSpace. --&gt;</span></span>
    <span class="code-tag">&lt;os-core:giga-space id=<span class="code-quote">"gigaSpace"</span> space=<span class="code-quote">"space"</span>/&gt;</span>
			
	<span class="code-tag"><span class="code-comment">&lt;!-- This bean outputs the userName and balance attributes of the AccountData object --&gt;</span></span>
    <span class="code-tag">&lt;bean id=<span class="code-quote">"outputAccountData"</span> class=<span class="code-quote">"org.openspaces.example.oms.stats.OutputAccountData"</span>/&gt;</span>
	
	&lt;!-- The notification container, registers for notification on every AccountData write or update and 
	invokes	the outputAccountData listner on a copy of the object that triggered the event --&gt;
	<span class="code-tag">&lt;os-events:notify-container id=<span class="code-quote">"accountDataNotifyContainer"</span> giga-space=<span class="code-quote">"gigaSpace"</span> com-type=<span class="code-quote">"UNICAST"</span>&gt;</span>
		<span class="code-tag"><span class="code-comment">&lt;!-- The notification will occur upon write or update --&gt;</span></span>
		<span class="code-tag">&lt;os-events:notify write=<span class="code-quote">"true"</span> update=<span class="code-quote">"true"</span>/&gt;</span>
		<span class="code-tag">&lt;os-core:template&gt;</span>
	        <span class="code-tag">&lt;bean class=<span class="code-quote">"org.openspaces.example.oms.common.AccountData"</span>&gt;</span>
	        <span class="code-tag"><span class="code-comment">&lt;!-- using template without properties to get all accountData objects --&gt;</span></span>
	        <span class="code-tag">&lt;/bean&gt;</span>
	    <span class="code-tag">&lt;/os-core:template&gt;</span>
	    <span class="code-tag">&lt;os-events:listener&gt;</span>
	        <span class="code-tag">&lt;os-events:annotation-adapter&gt;</span>
	            <span class="code-tag">&lt;!-- The adapter activates the outputAccountData.&lt;method annotated as @SpaceDataEvent&gt;</span> on
	            	 the accontData object --&gt; 
	            <span class="code-tag">&lt;os-events:delegate ref=<span class="code-quote">"outputAccountData"</span>/&gt;</span>
	        <span class="code-tag">&lt;/os-events:annotation-adapter&gt;</span>
	    <span class="code-tag">&lt;/os-events:listener&gt;</span>
	<span class="code-tag">&lt;/os-events:notify-container&gt;</span>

    <span class="code-tag"><span class="code-comment">&lt;!-- This bean outputs the attributes of the orderEvent object --&gt;</span></span>
    <span class="code-tag">&lt;bean id=<span class="code-quote">"outputOrderEvent"</span> class=<span class="code-quote">"org.openspaces.example.oms.stats.OutputOrderEventCounter"</span>/&gt;</span>
    
    &lt;!-- The notification container, registers for notification on every orderEvent write (notify 
    on write is default), invokes the outputOrderEvent listner on a copy of the object that 
    triggered the event --&gt;
	<span class="code-tag">&lt;os-events:notify-container id=<span class="code-quote">"orderEventNotifyContainer"</span> giga-space=<span class="code-quote">"gigaSpace"</span>&gt;</span>
		<span class="code-tag">&lt;os-core:template&gt;</span>
	        <span class="code-tag">&lt;bean class=<span class="code-quote">"org.openspaces.example.oms.common.OrderEvent"</span>&gt;</span>
	        <span class="code-tag">&lt;/bean&gt;</span>
	    <span class="code-tag">&lt;/os-core:template&gt;</span>
	    <span class="code-tag">&lt;os-events:listener&gt;</span>
	        <span class="code-tag">&lt;os-events:annotation-adapter&gt;</span>
	            <span class="code-tag">&lt;os-events:delegate ref=<span class="code-quote">"outputOrderEvent"</span>/&gt;</span>
	        <span class="code-tag">&lt;/os-events:annotation-adapter&gt;</span>
	    <span class="code-tag">&lt;/os-events:listener&gt;</span>
	<span class="code-tag">&lt;/os-events:notify-container&gt;</span>

<span class="code-tag">&lt;/beans&gt;</span></pre>
</div></div>
<p><a href="#XAPOrderManagementTutorial-deck4">Choose another tab</a> (back to top)</p>
</div></div>

<table class='confluenceTable'><tbody>
<tr>
<th class='confluenceTh'>Full Element</th>
<th class='confluenceTh'>Description</th>
</tr>
<tr>
<td class='confluenceTd'><div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">&lt;os-core:giga-space-context/&gt;
&lt;os-core:space id=<span class="code-quote">"space"</span> url=<span class="code-quote">"jini:<span class="code-comment">//*/*/spaceOMS"</span>/&gt;
</span>&lt;os-core:giga-space id=<span class="code-quote">"gigaSpace"</span> space=<span class="code-quote">"space"</span>/&gt;</pre>
</div></div></td>
<td class='confluenceTd'><ul>
	<li>The first element enables the usage of <b><tt>@GigaSpaceContext</tt></b> within the services in the same Processing Unit.</li>
	<li>The second element defines the space that is accessed by the services in that Processing Unit. The space can either be accessed embedded (as in the Runtime PU) using the url <tt>/./spaceOMS</tt>, or remote (as in the other two PUs) using the url <tt>jini://&#42;/&#42;/spaceOMS</tt>. The <tt>spaceOMS</tt> is just the name of the space, which can be any value but has to be consistent throughout the application.</li>
	<li>The third element defines an instance of the <tt>GigaSpace</tt> proxy object, connected to a specific space.</li>
</ul>
</td>
</tr>
<tr>
<td class='confluenceTd'><div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">&lt;!-- Defines a local Jini transaction manager. --&gt;
&lt;os-core:local-tx-manager id=<span class="code-quote">"transactionManager"</span> space=<span class="code-quote">"space"</span>/&gt;</pre>
</div></div></td>
<td class='confluenceTd'> This element defines a transaction manager instance that can be used by the services in that processing unit. </td>
</tr>
<tr>
<td class='confluenceTd'><div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">&lt;bean id=<span class="code-quote">"accountDataDAO"</span> class=<span class="code-quote">"org.openspaces.example.oms.common.AccountDataDAO"</span>/&gt;

&lt;bean id=<span class="code-quote">"orderEventValidator"</span> class=<span class="code-quote">"org.openspaces.example.oms.runtime.OrderEventValidator"</span>&gt;
    &lt;property name=<span class="code-quote">"accountDataDAO"</span> ref=<span class="code-quote">"accountDataDAO"</span> /&gt;
&lt;/bean&gt;</pre>
</div></div></td>
<td class='confluenceTd'> Every service or object can be defined as a Spring Bean within the <tt>bean</tt> element. The first line shows how we define our DAO object for later use. The second definition is of the <tt>OrderEventValidator</tt> that also includes as a property the reference to the DAO. That property is used for the injection of the DAO using the <tt>setAccountDataDAO</tt> method within the validator. </td>
</tr>
<tr>
<td class='confluenceTd'><div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">&lt;os-events:polling-container id=<span class="code-quote">"orderEventValidatorPollingEventContainer"</span> 
		giga-space=<span class="code-quote">"gigaSpace"</span>&gt;
    &lt;os-events:tx-support tx-manager=<span class="code-quote">"transactionManager"</span>/&gt;
    &lt;os-core:template&gt;
        &lt;bean class=<span class="code-quote">"org.openspaces.example.oms.common.OrderEvent"</span>&gt;
            &lt;property name=<span class="code-quote">"status"</span> value=<span class="code-quote">"New"</span>/&gt;
        &lt;/bean&gt;
    &lt;/os-core:template&gt;
    &lt;os-events:listener&gt;
        &lt;os-events:annotation-adapter&gt;
            &lt;os-events:delegate ref=<span class="code-quote">"orderEventValidator"</span>/&gt;
        &lt;/os-events:annotation-adapter&gt;
    &lt;/os-events:listener&gt;
&lt;/os-events:polling-container&gt;</pre>
</div></div></td>
<td class='confluenceTd'> A polling container defines a "pull" type of event-handling for a specific type of events. By default, the polling container performs a take operation every 5 seconds, but both the operation and interval can be changed.
<ul>
	<li><tt>tx-support</tt> sets the transaction manager that is used by the polling container.</li>
	<li>The <tt>template</tt> sub-element defines the template for the take operation. In this example, the template is an <tt>OrderEvent</tt> object with the status attribute set to <tt>New</tt>.</li>
	<li><tt>listener</tt> refers to the id of the service that is triggered by the event, while the method that handles that event is the one that was marked with the <tt>@SpaceDataEvent</tt> annotation. Note that behind the scenes, the container takes from the space one Entry that matches the template, and calls the relevant method in the relevant service, with that Entry as a parameter.</li>
</ul>
</td>
</tr>
<tr>
<td class='confluenceTd'><div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">&lt;os-events:notify-container id=<span class="code-quote">"orderEventNotifyContainer"</span> giga-space=<span class="code-quote">"gigaSpace"</span>&gt;
	&lt;os-core:template&gt;
        &lt;bean class=<span class="code-quote">"org.openspaces.example.oms.common.OrderEvent"</span>&gt;
        &lt;/bean&gt;
    &lt;/os-core:template&gt;
    &lt;os-events:listener&gt;
        &lt;os-events:annotation-adapter&gt;
            &lt;os-events:delegate ref=<span class="code-quote">"outputOrderEvent"</span>/&gt;
        &lt;/os-events:annotation-adapter&gt;
    &lt;/os-events:listener&gt;
	&lt;/os-events:notify-container&gt;</pre>
</div></div></td>
<td class='confluenceTd'>Similar to the polling container, the Notify container receives events according to a defined template, but in a "push" mode. An event will occur every time an operation occurs on the space, by default, a <tt>write</tt> operation.</td>
</tr>
<tr>
<td class='confluenceTd'><div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">&lt;os-sla:sla&gt;
    &lt;os-sla:monitors&gt;
        &lt;os-sla:bean-property-monitor 
                name=<span class="code-quote">"Written OrderEvent"</span> 
                bean-ref=<span class="code-quote">"outputOrderEvent"</span> 
                property-name=<span class="code-quote">"orderEventWrittenCounter"</span> /&gt;
        &lt;os-sla:bean-property-monitor 
                name=<span class="code-quote">"Processed OrderEvent"</span> 
                bean-ref=<span class="code-quote">"outputOrderEvent"</span> 
                property-name=<span class="code-quote">"orderEventProcessedCounter"</span> /&gt;
        &lt;os-sla:bean-property-monitor 
                name=<span class="code-quote">"AccountNotFound OrderEvent"</span> 
                bean-ref=<span class="code-quote">"outputOrderEvent"</span> 
                property-name=<span class="code-quote">"orderEventAccountNotFoundCounter"</span> /&gt;
    &lt;/os-sla:monitors&gt; 
&lt;/os-sla:sla&gt;</pre>
</div></div></td>
<td class='confluenceTd'> Under the SLA element we put the definitions of our SLA, that is the topology of a cluster and failover policies. This element can be defined within the <tt>pu.xml</tt> as shown here, or by overriding another XML file with the SLA element. We will show how to do this later, but here we show how to define monitors. Monitors are attributes from different services that we want to monitor in the GigaSpaces Management Center. </td>
</tr>
</tbody></table>

<p><a name="XAPOrderManagementTutorial-7"></a> </p>
<h1><a name="XAPOrderManagementTutorial-BuildingandPackaging"></a>Building and Packaging</h1>
<div class="greybox" width="100%">
<table cellspacing="0" cellpadding="0"><tr>
<td valign="top"><img src="download/attachments/48760898/urhere.gif"/></td><td width="10px"></td><td><sub><a href="#XAPOrderManagementTutorial-1">Overview</a> - <a href="#XAPOrderManagementTutorial-2">The Application Workflow</a> - <a href="#XAPOrderManagementTutorial-3">Implementation</a> - <a href="#XAPOrderManagementTutorial-4">POJO Domain Model</a> - <a href="#XAPOrderManagementTutorial-5">Writing POJO Services</a> - <a href="#XAPOrderManagementTutorial-6">Wiring with Spring (PU Configuration)</a> - <img src="download/attachments/17301573/sstar.gif" align="absmiddle" border="0"/> <b><a href="#XAPOrderManagementTutorial-7">Building and Packaging</a></b> - <a href="#XAPOrderManagementTutorial-8">Deployment</a> - <a href="#XAPOrderManagementTutorial-9">What's Next?</a></sub></td></tr></table>
</div>

<p>Once everything is ready, we need to build, package and deploy the application.</p>

<p>All the <tt>jar</tt> files under the <tt>&lt;GigaSpaces Root&gt;/lib/required</tt> directory should be included in your classpath. These include:</p>

<ul>
	<li><tt>gs-runtime.jar</tt></li>
	<li><tt>gs-openspaces.jar</tt></li>
	<li><tt>commons-logging.jar</tt></li>
	<li>Spring framework jars (all start with <tt>com.spring*</tt>)</li>
</ul>



<p>In order to deploy the application, we need to deploy each of the three processing units separately. To do this, every processing unit must be deployed to the GSM. Every processing unit is actually a folder or a jar file (whose name is the name of the processing unit later used for deployment) with several subfolders. A typical processing unit directory structure is as follows: </p>

<div class="code panel" style="border-width: 1px;"><div class="codeHeader panelHeader" style="border-bottom-width: 1px;"><b>Processing Unit Structure</b></div><div class="codeContent panelContent">
<pre class="code-java">my-pu
-- lib
---- mylib1.jar
---- mylib2.jar
-- org
---- mypackage
------- MyClass.class
---- META-INF
------ spring
-------- pu.xml</pre>
</div></div>

<p>As shown above, the processing unit is composed of a lib directory under which all the libraries that the processing unit depends on are located. Under <tt>META-INF\spring</tt> we can find the <tt>pu.xml</tt> file, which is a spring XML files that describes the components of the processing unit . Also, directly under the root of the processing unit is our compiled code, with its appropriate package structure. </p>

<p><a name="XAPOrderManagementTutorial-8"></a></p>
<h1><a name="XAPOrderManagementTutorial-Deployment"></a>Deployment</h1>
<div class="greybox" width="100%">
<table cellspacing="0" cellpadding="0"><tr>
<td valign="top"><img src="download/attachments/48760898/urhere.gif"/></td><td width="10px"></td><td><sub><a href="#XAPOrderManagementTutorial-1">Overview</a> - <a href="#XAPOrderManagementTutorial-2">The Application Workflow</a> - <a href="#XAPOrderManagementTutorial-3">Implementation</a> - <a href="#XAPOrderManagementTutorial-4">POJO Domain Model</a> - <a href="#XAPOrderManagementTutorial-5">Writing POJO Services</a> - <a href="#XAPOrderManagementTutorial-6">Wiring with Spring (PU Configuration)</a> - <a href="#XAPOrderManagementTutorial-7">Building and Packaging</a> - <img src="download/attachments/17301573/sstar.gif" align="absmiddle" border="0"/> <b><a href="#XAPOrderManagementTutorial-8">Deployment</a></b> - <a href="#XAPOrderManagementTutorial-9">What's Next?</a></sub></td></tr></table>
</div>

<p>You are now ready to deploy your application, but first, a short recap:</p>

<p>Our Order Management System application has 3 processing units: Feeder, Runtime and Statistics. The domain model includes an order object and an account object, as well as a data access object to encapsulate account-related operations on the space.</p>

<p>There are several ways to deploy the application and to run a processing unit. A PU can either run in standalone mode within your IDE (for development and testing purposes), or on top of the Service Grid, within SLA driven containers that we like to call GSC (Grid Service Container). In this tutorial, we'll show the latter approach, which is used in production environments.</p>

<p>We will do this is two phases. First, we'll show how to deploy the application with a single space (the one that runs embedded within the runtime processing unit, as shown in the first image above). Second, we'll show how to deploy that same application in a clustered environment, where we partition the data and workload to several spaces, meaning we'll run multiple runtime PUs.</p>

<h2><a name="XAPOrderManagementTutorial-DeploymentofaSingleSpace"></a>Deployment of a Single Space</h2>

<ol>
	<li>Because we want to deploy to the Service Grid, we first need to start it. Running the grid is as easy as running the GS-Agent  from the <tt>&lt;GigaSpaces Root\bin</tt> directory, which will start up an agent (which will itself start a Grid Service Manager and two Grid Service Containers) on top of which we run our processing units. The deployed application will then look like this:<br/>
<img src="download/attachments/17301573/XAP Open OMS tutorial SLA Single PUsmall-layout2.jpg" align="absmiddle" border="0"/>
<br clear="all" />
<br clear="all" />
<img class="emoticon" src="images/icons/emoticons/information.gif" height="16" width="16" align="absmiddle" alt="" border="0"/> Even though the image shows one container per processing unit, we can run several processing units on each container. 
<br clear="all" />
<br clear="all" /></li>
	<li>After starting the GSM, execute:
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">&lt;GigaSpaces Root&gt;\bin\gsm.(sh/bat)</pre>
</div></div></li>
	<li>Run two GSCs by execute the following line twice:
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">&lt;GigaSpaces Root&gt;\bin\gsc.(sh/bat)</pre>
</div></div></li>
	<li>Start the GigaSpaces Management Center:
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">&lt;GigaSpaces Root&gt;\bin\gs-ui.(sh/bat)</pre>
</div></div>
<p>The Management Center is displayed: <br clear="all" /> <br clear="all" />
<img src="download/attachments/17301573/spacebrowser011.jpg" align="absmiddle" border="0"/> <br clear="all" /> <br clear="all" /></p></li>
	<li>Click the <b>Deployments, Details</b> tab at the left.<br/>
The Deployments, Details tab is displayed: <br clear="all" /> <br clear="all" />
<img src="download/attachments/17301573/2-deployment_details1.jpg" align="absmiddle" border="0"/> <br clear="all" /> <br clear="all" /></li>
	<li>The two running GSCs are displayed at the bottom of the tab. Both of them are still empty, because no processing units have been deployed.</li>
	<li>To deploy a processing unit, click the deploy button (<img src="download/attachments/17301573/newpackfolder.gif" align="absmiddle" border="0"/>).<br/>
The deployment wizard is displayed: <br clear="all" /> <br clear="all" />
<img src="download/attachments/17301573/deployment_wizard1.jpg" align="absmiddle" border="0"/> <br clear="all" /> <br clear="all" /></li>
	<li>In the first page of the wizard, click the <b>SBA Application - Processing Unit</b> radio button, and click <b>Next</b>.<br/>
The deployment options page is displayed: <br clear="all" /> <br clear="all" />
<img src="download/attachments/17301573/pu_deploy_wizard2.jpg" align="absmiddle" border="0"/> <br clear="all" /> <br clear="all" /></li>
	<li>In the <b>Processing Unit name</b> field, type the name of the Processing Unit. This name should be the same as the name of the processing unit directory, located under the <tt>&lt;GigaSpaces Root&gt;\deploy</tt> directory.<br/>
For example, if you copied the runtime PU folder under the <tt>deploy</tt> directory with the name <tt>oms-runtime</tt>, type <tt>oms-runtime</tt> in the <b>Processing Unit Name</b> field. 
<br clear="all" />
<br clear="all" />
<img class="emoticon" src="images/icons/emoticons/information.gif" height="16" width="16" align="absmiddle" alt="" border="0"/> You can specify an alternative name for the processing unit, which will be displayed in the Management Center interface, using the <b>Override PU Name</b> field (the <b>Processing Unit Name</b> field must still match the name of your PU directory). For example, if your <b>Processing Unit Name</b> is <tt>oms-runtime</tt>, your override name might be something like <tt>Order Management Runtime Module</tt>. 
<br clear="all" />
<br clear="all" /></li>
	<li>Click <b>Deploy</b>.<br/>
The deployment status page is displayed: <br clear="all" /> <br clear="all" />
<img src="download/attachments/17301573/deployment_status_screen1.jpg" align="absmiddle" border="0"/> <br clear="all" /> <br clear="all" /></li>
	<li>Wait until the Processing Unit successfully finishes deploying, then click <b>Close</b>.</li>
	<li>Now, have another look at the lower side of the <b>Deployment, Details</b> tab. You should see that one of the GSCs contains the Processing Unit you just deployed.</li>
	<li>Repeat the deployment process twice more for the other Processing Units (remember, you are deploying the runtime, feeder and statistics processing units).<br/>
At the bottom of the <b>Deployments, Details</b> tab, you should now see three Processing Units deployed in the two running containers: <br clear="all" /> <br clear="all" />
<img src="download/attachments/17301573/deployment_details_with_pu1.jpg" align="absmiddle" border="0"/> <br clear="all" /> <br clear="all" /></li>
	<li>Remember the <tt>os-sla:monitors</tt> elements we mentioned? They were defined in the <tt>pu.xml</tt> of the statistics processing unit. Locate the statistics PU in the containers at the bottom, and double-click its name.<br/>
A visual representation of the monitors is displayed: <br clear="all" /> <br clear="all" />
<img src="download/attachments/17301573/9-stats_monitor1.jpg" align="absmiddle" border="0"/> <br clear="all" /> <br clear="all" /> 
<img class="emoticon" src="images/icons/emoticons/information.gif" height="16" width="16" align="absmiddle" alt="" border="0"/> For each processing unit in which you define a monitor, you can easily access that monitor's view by double-clicking the relevant PU's name.
<br clear="all" />
<br clear="all" /></li>
	<li>Click the <b>Space Browser</b> tab on the left. In the <b>Grid Tree</b> on the left, click <b>Spaces</b>.<br/>
The Service View on the right updates to show your running spaces: <br clear="all" /> <br clear="all" />
<img src="download/attachments/17301573/spacebrowser021.jpg" align="absmiddle" border="0"/> <br clear="all" /> <br clear="all" />
(Currently, you should only have one space running in the runtime PU.)</li>
	<li>In the <b>Grid Tree</b> on the left, click the <b>Statistics</b> node.<br/>
The Service View on the right updates to show statistics for your running space &#8211; how many times different operations were performed on the space: <br clear="all" /> <br clear="all" />
<img src="download/attachments/17301573/oms-statistics_new.jpg" align="absmiddle" border="0"/> <br clear="all" /> <br clear="all" />
<img class="emoticon" src="images/icons/emoticons/information.gif" height="16" width="16" align="absmiddle" alt="" border="0"/> The write and take operations shown in the statistics are the events and accounts written to the space and taken from it. The notify operations are notifications sent to the statistics PU.</li>
</ol>


<h2><a name="XAPOrderManagementTutorial-PartitionedwithSynchronizedBackupDeployment"></a>Partitioned with Synchronized Backup Deployment</h2>

<p><img src="download/attachments/17301573/XAP Open OMS tutorial SLAfullsmall-layout2.jpg" align="absmiddle" border="0"/></p>

<p>As you could see, developing and deploying our application on the grid wasn't too difficult. Following the 4 steps makes the process clear and easy, and with Open Spaces we achieve a lot of abstraction from the code.</p>

<p>So now the application sends events and processes them while using an embedded space to keep the states of the accounts, as well as to deliver events between services, thus using the space as both the data and the messaging layer, and the entire platform is running a full application without the need to integrate any other product.</p>

<p>But how does it scale? Let's say there are more feeders of order events, those events might be coming from many different directions. Eventually, our runtime processing unit that holds the space will become a bottleneck, it will either run out of memory (as all the objects in the space consume memory), or just fully utilize the CPU. So how do we solve this? </p>

<p>We simply scale out, we add more instances of the runtime processing unit on other SLA containers (GSCs) that run on other machines. There are several possible topologies to achieve this scaling, but the most common one is the partitioned-with-backup topology. This means that there are several spaces running, each with a different partition of the entire data, so sticking with our example, imagine two partitions, each with another half of all the user accounts. This way, when an order event comes in, it is automatically routed to the relevant partition according to the username of that order (remember the <tt>@SpaceRouting</tt> annotation in the <tt>OrderEvent</tt> class? That's what it is used for).</p>

<p>In order to achieve better reliability and failover capabilities, each partition also has one backup space, to which it replicates its entire contents in a synchronous manner. In case the primary partition goes down, the backup of that partition automatically takes over, continuing from where the failing primary stopped.</p>

<p>It all must seem quite complicated, but it isn't. Once we've accomplished the previous step of implementation and wiring with Spring, it is just a matter of a small difference in the deployment process. Here's how:</p>

<p>Restart the GSM and two GSC as earlier (to keep things clean just shut down whatever you had running earlier).</p>

<p>Now, within the GigaSpaces Management Center (<tt>&lt;GigaSpaces Root&gt;\bin\gs-ui.bat/sh</tt>), click on the Deployment, Details tab and on the deploy button. Choose again the first option <b>SBA Application - Processing Unit</b>. On the next screen, put the name of the processing unit you want to scale out (because the runtime processing unit is the only one with an embedded space, it makes sense to partition it) as before. But now, choose the cluster schema <b>partitioned</b>, put <tt>2</tt> in <b>Number of Instances</b> and <tt>1</tt> in the <b>Backups</b> fields. Note that the backups value is per partition, meaning in this case we'll have two partitions, <b>each</b> one with a backup. This is how the screen should look:</p>

<p><img src="download/attachments/17301573/pu_deploy_wizard_partitions.jpg" align="absmiddle" border="0"/> </p>

<p>Note that the deployment will take a few seconds longer as it now deploys 4 spaces (two primaries and two backups). Now deploy the feeder and statistics processing units as before.</p>

<p>Back in the Deployments, Details tab you'll now see 4 instances of the runtime processing unit. Note that each primary is on a different container than its backup:</p>

<p><img src="download/attachments/17301573/deployment_details_with_partitions.jpg" align="absmiddle" border="0"/></p>

<p>Finally, click on the Space Browser tab to see the four spaces you've just deployed:</p>

<p><img src="download/attachments/17301573/spacebrowser_partitions_new.jpg" align="absmiddle" border="0"/></p>

<p>That's it! You've just scaled out your application and can scale it even further by deploying it to as many machines as you want.</p>

<p><a name="XAPOrderManagementTutorial-9"></a></p>
<h1><a name="XAPOrderManagementTutorial-What%27sNext%3F"></a>What's Next?</h1>
<div class="greybox" width="100%">
<table cellspacing="0" cellpadding="0"><tr>
<td valign="top"><img src="download/attachments/48760898/urhere.gif"/></td><td width="10px"></td><td><sub><a href="#XAPOrderManagementTutorial-1">Overview</a> - <a href="#XAPOrderManagementTutorial-2">The Application Workflow</a> - <a href="#XAPOrderManagementTutorial-3">Implementation</a> - <a href="#XAPOrderManagementTutorial-4">POJO Domain Model</a> - <a href="#XAPOrderManagementTutorial-5">Writing POJO Services</a> - <a href="#XAPOrderManagementTutorial-6">Wiring with Spring (PU Configuration)</a> - <a href="#XAPOrderManagementTutorial-7">Building and Packaging</a> - <a href="#XAPOrderManagementTutorial-8">Deployment</a> - <img src="download/attachments/17301573/sstar.gif" align="absmiddle" border="0"/> <b><a href="#XAPOrderManagementTutorial-9">What's Next?</a></b></sub></td></tr></table>
</div>

<p><img src="download/attachments/15990817/referto.gif" align="absmiddle" border="0"/> <b><a href="Beyond the Basics.html" title="Beyond the Basics">Try Another Tutorial</a></b><br/>
<img src="download/attachments/15990817/referto.gif" align="absmiddle" border="0"/> <a href="http://www.gigaspaces.com/wiki/display/XAP8/8.0+Documentation+Home" title="8.0 Documentation Home">GigaSpaces XAP Help Portal</a> </p>

                     </td>
</tr>
</table>
<table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr>
<td height="12" background="http://www.gigaspaces.com/wiki/images/border/border_bottom.gif"><img src="images/border/spacer.gif" width="1" height="1" border="0"/></td>
</tr>
<tr>
<td align="center"><font color="grey"><a href="http://www.gigaspaces.com">GigaSpaces.com</a> -
		<a href="http://www.gigaspaces.com/wiki/x/xwBmAg" class="smalltext">Legal Notice</a> -
		<a href="http://www.gigaspaces.com/wiki/x/xgBmAg" class="smalltext">3rd Party Licenses</a> -
		<a href="http://www.gigaspaces.com/wiki/x/BQFmAg" class="smalltext">Site Map</a> -
		<a href="http://www.gigaspaces.com/wiki/display/API/API+Documentation+Portal" class="version-link">API Docs</a> -
		<a href="http://forum.openspaces.org/forum.jspa?forumID=175" class="version-link">Forum</a> -
		<a href="http://www.gigaspaces.com/LatestProductVersion" class="version-link">Downloads</a> -
		<a href="http://blog.gigaspaces.com/" class="version-link">Blog</a> -
		<a href="http://www.gigaspaces.com/os_papers.html" class="version-link">White Papers</a> -
		<a href="mailto:techw@gigaspaces.com">Contact Tech Writing</a> -
		<i><a href="http://www.atlassian.com/software/confluence">Gen. by Atlassian Confluence</a></i></font></td>
</tr>
</table>
     </body>
</html>
