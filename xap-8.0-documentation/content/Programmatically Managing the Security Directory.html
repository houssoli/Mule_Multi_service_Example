<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
     <head>
         <title>XAP 8.0 Documentation : Programmatically Managing the Security Directory</title>
<link rel="stylesheet" href="styles/site.css" type="text/css" />
         <META http-equiv="Content-Type" content="text/html; charset=UTF-8">
		 <style>
.back-to {
	color: #666666;
	font-weight: bold;
}	 
a.back-to:link, a.back-to:visited, a.back-to:hover, a.back-to:active  {
	color: #666666;
}	 
		 </style>
     </head>

     <body>
<table class="pagecontent" border="0" cellpadding="0" cellspacing="0" width="100%" bgcolor="#ffffff">
<tr>
<td valign="top" class="pagebody">
<div class="pageheader">
<span class="back-to">XAP 8.0 Documentation > <a href="index.html">Back to Table of Contents</a></span><br>
<h1>Programmatically Managing the Security Directory</h1>
</div>
<br>



<div style="border-style:solid; border-color:#3C78B5; border-width:thin; padding-left:20px; padding-bottom:20px; padding-top:20px; padding-right:20px; background-color:#D8E4F1"> 

<p><b>Section Summary:</b>  User and Role directory API </p>
</div>

<h1><a name="ProgrammaticallyManagingtheSecurityDirectory-Overview"></a>Overview</h1>

<p>The directory provides the means for managing users and roles. User and role information stored in a persistent storage need to be accessed for authentication purposes and for management (adding/modifying,associating, etc.).</p>

<p><img src="download/attachments/48235229/security-seq5.PNG" align="absmiddle" border="0"/></p>

<p>The <tt>SecurityManager</tt> access the directory for authenticating the user. The authentication process retrieves the user credentials and permissions. On the other hand, you need some tool to access the directory for managing the users/roles. It can be as simple as SQL statements modifying records in a database. </p>

<p>Our default <em><b>file-based security implementation</b></em> uses a local file. Using the UI with the default security, you can add, modify, associate, remove users and roles which are saved to this local file. The UI calls upon the <tt>DirectoryManager</tt> implementation to perform these actions.</p>

<p>In general, if you are using the UI and the default file-based security than you probably don't need this API. If you need a command line tool to manage the users/roles you will probably need to write code either calling the default <tt>DirectoryManager</tt> implementation or write a custom implementation all together.</p>

<h1><a name="ProgrammaticallyManagingtheSecurityDirectory-Accessingthedirectory"></a>Accessing the directory</h1>

<p>The directory has clear distinction between user management and role management. For each there is an associated authority that can be granted to a user. For example, you may grant a user an authority to manage users but at the same time deny role management. </p>

<p>The default user which can access the default file-based security implementation is <b><tt>admin/admin</tt></b>. Note that this is specific to the implementation. You can remove <tt>admin</tt> after first log-in to the directory, but make sure to declare a new user with <b><tt>MANAGE_USERS</tt></b> and/or <b><tt>MANAGE_ROLES</tt></b> authorities.</p>

<h1><a name="ProgrammaticallyManagingtheSecurityDirectory-UserManagement"></a>User Management</h1>

<p>The <tt><a href="http://www.gigaspaces.com/docs/JavaDoc8.0/com/gigaspaces/security/directory/DirectoryManager.html">DirectoryManager</a></tt> interface provides a means to managing users using the <tt><a href="http://www.gigaspaces.com/docs/JavaDoc8.0/com/gigaspaces/security/directory/UserManager.html">UserManager</a></tt> API. Access should be granted only to users with <b><tt>MANAGE_USERS</tt></b> authority. </p>

<p>The <tt><a href="http://www.gigaspaces.com/docs/JavaDoc8.0/com/gigaspaces/security/directory/UserManager.html">UserManager</a></tt> interface has simple methods for declaring users:</p>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java"><span class="code-keyword">public</span> <span class="code-keyword">interface</span> UserManager {
    ...
    void createUser(UserDetails)
    UserDetails getUser(<span class="code-object">String</span>)
    void deleteUser(<span class="code-object">String</span>)
    void updateUser(UserDetails)
    ...
}</pre>
</div></div>

<h1><a name="ProgrammaticallyManagingtheSecurityDirectory-RoleManagement"></a>Role Management</h1>

<p>The <tt><a href="http://www.gigaspaces.com/docs/JavaDoc8.0/com/gigaspaces/security/directory/DirectoryManager.html">DirectoryManager</a></tt> interface provides a means to managing roles using the <tt>RoleManager</tt> API. Access should be granted only to users with <b><tt>MANAGE_ROLES</tt></b> authority.</p>

<p>The <tt><a href="http://www.gigaspaces.com/docs/JavaDoc8.0/com/gigaspaces/security/directory/RoleManager.html">RoleManager</a></tt> interface has simple methods for declaring roles:</p>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java"><span class="code-keyword">public</span> <span class="code-keyword">interface</span> RoleManager {
    ...
    createRole(RoleDetails)
    RoleDetails getRole(<span class="code-object">String</span>)
    deleteRole(<span class="code-object">String</span>)
    updateRole(RoleDetails)
    ...
}</pre>
</div></div>

<h1><a name="ProgrammaticallyManagingtheSecurityDirectory-UsingtheAPI"></a>Using the API</h1>

<p>The directory manager is accessible via the <tt><a href="http://www.gigaspaces.com/docs/JavaDoc8.0/com/gigaspaces/security/SecurityManager.html">SecurityManager</a></tt>. In our default implementation, the user <tt>admin/admin</tt> has both <tt>MANAGE_USERS</tt> and <tt>MANAGE_ROLES</tt>. We will use this user to gain access to the directory manager. Also, we have two default implementations <tt><a href="http://www.gigaspaces.com/docs/JavaDoc8.0/com/gigaspaces/security/User.html">User</a></tt> and <tt><a href="http://www.gigaspaces.com/docs/JavaDoc8.0/com/gigaspaces/security/Role.html">Role</a></tt> implementing <tt><a href="http://www.gigaspaces.com/docs/JavaDoc8.0/com/gigaspaces/security/UserDetails.html">UserDetails</a></tt> and <tt><a href="http://www.gigaspaces.com/docs/JavaDoc8.0/com/gigaspaces/security/RoleDetails.html">RoleDetails</a></tt> respectively.</p>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">Properties securityProperties = <span class="code-keyword">new</span> Properties();
<span class="code-object">SecurityManager</span> securityManager = SecurityFactory.createSecurityManager(securityProperties);

DirectoryManager directoryManager = securityManager.createDirectoryManager(<span class="code-keyword">new</span> User(<span class="code-quote">"admin"</span>, <span class="code-quote">"admin"</span>));</pre>
</div></div>

<p>We can now add a new user using the <tt><a href="http://www.gigaspaces.com/docs/JavaDoc8.0/com/gigaspaces/security/UserManager.html">UserManager</a></tt> API. "Alice" will be added with <tt>READ</tt> authority for class "eg.ClassA".</p>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">UserManager userManager = directoryManager.getUserManager();

userManager.createUser(<span class="code-keyword">new</span> User(<span class="code-quote">"alice"</span>, <span class="code-quote">"password"</span>,
        <span class="code-keyword">new</span> SpaceAuthority(SpacePrivilege.READ, <span class="code-keyword">new</span> ClassFilter(<span class="code-quote">"eg.ClassA"</span>))
    ));</pre>
</div></div>

<p>A role can be declared using the <tt><a href="http://www.gigaspaces.com/docs/JavaDoc8.0/com/gigaspaces/security/RoleManager.html">RoleManager</a></tt> API. The "author" role will be added with <tt>READ, WRITE, TAKE</tt> authorities for class "eg.ClassA".</p>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">RoleManager roleManager = directoryManager.getRoleManager();

roleManager.createRole(<span class="code-keyword">new</span> Role(<span class="code-quote">"author"</span>, <span class="code-quote">"password"</span>,
        <span class="code-keyword">new</span> SpaceAuthority(SpacePrivilege.READ, <span class="code-keyword">new</span> ClassFilter(<span class="code-quote">"eg.ClassA"</span>)),
        <span class="code-keyword">new</span> SpaceAuthority(SpacePrivilege.WRITE, <span class="code-keyword">new</span> ClassFilter(<span class="code-quote">"eg.ClassA"</span>)),
        <span class="code-keyword">new</span> SpaceAuthority(SpacePrivilege.TAKE, <span class="code-keyword">new</span> ClassFilter(<span class="code-quote">"eg.ClassA"</span>))
    ));</pre>
</div></div>

<p>We can assign this role to user "bob".</p>
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">userManager.createUser(<span class="code-keyword">new</span> User(<span class="code-quote">"bob"</span>, <span class="code-quote">"password"</span>,
        <span class="code-keyword">new</span> RoleAuthority(<span class="code-quote">"author"</span>)
    ));</pre>
</div></div>

<p>The <tt>ClassFilter</tt> is one of the restrictive filters available. There is also a <tt>RegexFilter</tt>, <tt>PackageFilter</tt>, etc. A handy utility is the wildcard expression converter which converts a string expression to a filter. This is used by the UI dialog when creating filters.</p>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">userManager.createUser(<span class="code-keyword">new</span> User(<span class="code-quote">"carol"</span>, <span class="code-quote">"password"</span>,
        <span class="code-keyword">new</span> SpaceAuthority(SpacePrivilege.READ,
				WildcardExpressionToFilterConverter.convert(
						<span class="code-quote">"eg.<span class="code-object">Class</span>*"</span>, <span class="code-keyword">true</span>))
    ));</pre>
</div></div>

                     </td>
</tr>
</table>
<table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr>
<td height="12" background="http://www.gigaspaces.com/wiki/images/border/border_bottom.gif"><img src="images/border/spacer.gif" width="1" height="1" border="0"/></td>
</tr>
<tr>
<td align="center"><font color="grey"><a href="http://www.gigaspaces.com">GigaSpaces.com</a> -
		<a href="http://www.gigaspaces.com/wiki/x/xwBmAg" class="smalltext">Legal Notice</a> -
		<a href="http://www.gigaspaces.com/wiki/x/xgBmAg" class="smalltext">3rd Party Licenses</a> -
		<a href="http://www.gigaspaces.com/wiki/x/BQFmAg" class="smalltext">Site Map</a> -
		<a href="http://www.gigaspaces.com/wiki/display/API/API+Documentation+Portal" class="version-link">API Docs</a> -
		<a href="http://forum.openspaces.org/forum.jspa?forumID=175" class="version-link">Forum</a> -
		<a href="http://www.gigaspaces.com/LatestProductVersion" class="version-link">Downloads</a> -
		<a href="http://blog.gigaspaces.com/" class="version-link">Blog</a> -
		<a href="http://www.gigaspaces.com/os_papers.html" class="version-link">White Papers</a> -
		<a href="mailto:techw@gigaspaces.com">Contact Tech Writing</a> -
		<i><a href="http://www.atlassian.com/software/confluence">Gen. by Atlassian Confluence</a></i></font></td>
</tr>
</table>
     </body>
</html>
