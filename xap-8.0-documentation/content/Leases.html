<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
     <head>
         <title>XAP 8.0 Documentation : Leases</title>
<link rel="stylesheet" href="styles/site.css" type="text/css" />
         <META http-equiv="Content-Type" content="text/html; charset=UTF-8">
		 <style>
.back-to {
	color: #666666;
	font-weight: bold;
}	 
a.back-to:link, a.back-to:visited, a.back-to:hover, a.back-to:active  {
	color: #666666;
}	 
		 </style>
     </head>

     <body>
<table class="pagecontent" border="0" cellpadding="0" cellspacing="0" width="100%" bgcolor="#ffffff">
<tr>
<td valign="top" class="pagebody">
<div class="pageheader">
<span class="back-to">XAP 8.0 Documentation > <a href="index.html">Back to Table of Contents</a></span><br>
<h1>Leases</h1>
</div>
<br>

<script type='text/javascript'>//<![CDATA[
function debug() { }
// ]]></script><script type='text/javascript' src='/wiki/download/resources/net.customware.confluence.plugin.composition:composition-setup/js/browser.js'>//<![CDATA[
// ]]></script><script type='text/javascript' src='/wiki/download/resources/net.customware.confluence.plugin.composition:composition-setup/js/behaviour.js'>//<![CDATA[
// ]]></script><script type='text/javascript' src='/wiki/download/resources/net.customware.confluence.plugin.composition:composition-setup/js/memory.js'>//<![CDATA[
// ]]></script><script type='text/javascript' src='/wiki/download/resources/net.customware.confluence.plugin.composition:composition-setup/js/cloak.js'>//<![CDATA[
// ]]></script><script type='text/javascript'>//<![CDATA[
Cloak.closeHTML = "<img src=\'/wiki/download/resources/net.customware.confluence.plugin.composition:toggle-cloak/img/navigate_down_10.gif\'/>";
Cloak.openHTML = "<img src=\'/wiki/download/resources/net.customware.confluence.plugin.composition:toggle-cloak/img/navigate_right_10.gif\'/>";
Cloak.toggleZone = true;
Cloak.memoryDuration = 0;
Cloak.memoryPrefix = "contentId:54822650";
Cloak.memoryPath = "/wiki/";
// ]]></script><style type='text/css'>
.cloakToggle { /* Definition for state toggling image */
cursor:hand;
cursor:pointer;
}
</style><script type='text/javascript' src='/wiki/download/resources/net.customware.confluence.plugin.composition:composition-setup/js/transitions.js'>//<![CDATA[
// ]]></script><script type='text/javascript' src='/wiki/download/resources/net.customware.confluence.plugin.composition:composition-setup/js/deck.js'>//<![CDATA[
// ]]></script><link rel='stylesheet' type='text/css'  href='/wiki/styles/main-action.css?pluginCompleteKey=net.customware.confluence.plugin.composition:composition-setup&stylesheetName=deck&spaceKey=XAP8'/><script type='text/javascript'>//<![CDATA[
Deck.memoryDuration = 0;
Deck.memoryPrefix = "contentId:54822650";
Deck.memoryPath = "/wiki/";
// ]]></script>

<div style="border-style:solid; border-color:#3C78B5; border-width:thin; padding-left:20px; padding-bottom:20px; padding-top:20px; padding-right:20px; background-color:#D8E4F1"> 

<p><b>Section Summary:</b>  Lease basics and explains how Leases can be managed </p>
</div>

<h1><a name="Leases-Overview"></a>Overview</h1>

<p>In distributed applications on a network, where there may be partial failures of the network or of components, there needs to be a way for components to be timed out if they have failed, or have become unreachable. Lease is a basic mechanism GigaSpaces provides to address this problem. GigaSpaces provides this functionality using Jini technology.</p>

<h1><a name="Leases-LeaseBasics"></a>Lease Basics</h1>

<p>The essential idea behind a lease is fairly simple. </p>
<ul>
	<li>When creating a resource, the requestor creates the resource with a  limited life span.</li>
	<li>The grantor of the resource will then give access for some period of time that is no longer than that requested.</li>
	<li>The period of time that is actually granted is returned to the requestor as part of the Lease object.</li>
	<li>A holder of a lease can request that a Lease be renewed, or cancel the Lease at any time.</li>
	<li>Successfully renewing a lease extends the time period during which the lease is in effect.</li>
	<li>Cancelling the lease drops the lease immediately.</li>
</ul>


<p>Few other ways Lease can be managed include,</p>
<ul>
	<li>Specifying the Lease interface constant FOREVER, requests a lease that never expires. When granted such a lease, the grantor is responsible for ensuring that the leased resource is freed when no longer needed.</li>
	<li>Specifying the Lease interface constant ANY, indicates that no particular lease time is desired and that the grantor of the lease should supply a time that is most convenient for the grantor. (GigaSpaces converts leases with ANY constant to FOREVER leases).</li>
</ul>


<h1><a name="Leases-SpaceObjectLease"></a>Space Object Lease</h1>

<p>Leases can be used for objects written to GigaSpaces cluster. All the write operations in <a href="http://www.gigaspaces.com/docs/JavaDoc7.1/org/openspaces/core/GigaSpace.html" target="_blank">GigaSpace</a> interface support Lease. Lease duration is an argument that is passed to the write operations and they return a Lease Context which can be used to manage the Leases.</p>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">GigaSpace gigaSpace = <span class="code-keyword">new</span> GigaSpaceConfigurer (<span class="code-keyword">new</span> UrlSpaceConfigurer(<span class="code-quote">"jini:<span class="code-comment">//*/*/space"</span>)).gigaSpace();
</span>
MyMessage message1 = <span class="code-keyword">new</span> MyMessage();

<span class="code-comment">// Writes the message with 1000 millis/1 sec Lease
</span>LeaseContext&lt;MyMessage&gt; lease1 = gigaSpace.write(message1, 1000);     

MyMessage message2 = <span class="code-keyword">new</span> MyMessage();

<span class="code-comment">// Writes the message with Default Lease of Lease.FOREVER
</span>LeaseContext&lt;MyMessage&gt; lease2 = gigaSpace.write(message2);     

MyMessage message3 = <span class="code-keyword">new</span> MyMessage();

<span class="code-comment">// Writes the message with Lease of Lease.FOREVER
</span>LeaseContext&lt;MyMessage&gt; lease3 = gigaSpace.write(message3, Lease.FOREVER);</pre>
</div></div>

<h1><a name="Leases-ManuallyManagingSpaceObjectLease"></a>Manually Managing Space Object Lease</h1>

<p>GigaSpaces API returns the <tt>LeaseContext</tt> after every write operation/update operation. Space Object Leases can be renewed or cancelled based on the application needs.</p>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">LeaseContext&lt;Order&gt; lease;

...
<span class="code-keyword">public</span> void writeOrder() {
...
<span class="code-comment">//Save lease from write operation
</span>lease = gigaSpace.write(singleOrder);
...

<span class="code-keyword">public</span> void cancelLease() {
...
lease.cancel();</pre>
</div></div>

<p>Another alternative to using LeaseContext objects is to retrieve the objects and updating the Lease to desired duration.</p>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java"><span class="code-comment">//Retrieve all processed low priority orders and expire the lease 
</span>Order template = <span class="code-keyword">new</span> Order();

template.setType(OrderType.LOW);
template.setProcessed(<span class="code-keyword">true</span>);

Order[] processedLowPriorityOrders = gigaSpace.readMultiple(template, 1000);

<span class="code-comment">//Update the lease to expire in 1 second
</span>gigaSpace.writeMultiple(processedLowPriorityOrders, 
		1000,					<span class="code-comment">// Update the Lease to 1 second
</span>		UpdateModifiers.UPDATE_OR_WRITE); <span class="code-comment">// Update existing object</span></pre>
</div></div>

<p><a name="Leases-LeaseRenewalManager"></a></p>
<h1><a name="Leases-ManagingLeasesusingLeaseRenewalManager"></a>Managing Leases using LeaseRenewalManager</h1>

<p>LeaseRenewalManager provides systematic renewal and management of a set of leases associated with one or more remote entities on behalf of a local entity.</p>

<p>Clients of the renewal manager simply give their leases to the manager and the manager renews each lease as necessary to achieve a <em>desired expiration time</em> (which may be later than the lease's current <em>actual expiration time</em>). Failures encountered while renewing a lease can optionally be reflected to the client via <tt>LeaseListener</tt> and <tt>LeaseRenewalEvent</tt> events.</p>

<div class='panelMacro'><table class='noteMacro'><colgroup><col width='24'><col></colgroup><tr><td valign='top'><img src="images/icons/emoticons/warning.gif" width="16" height="16" align="absmiddle" alt="" border="0"></td><td> Clients wishing to use this class must create an instance of this class in their own virtual machine to locally manage the leases granted to them. If the virtual machine that the manager was created in exits or crashes, the renewal manager will be destroyed.</td></tr></table></div>

<div class='panelMacro'><table class='noteMacro'><colgroup><col width='24'><col></colgroup><tr><td valign='top'><img src="images/icons/emoticons/warning.gif" width="16" height="16" align="absmiddle" alt="" border="0"></td><td> <tt>LeaseListener</tt> is invoked only when LeaseRenewalManager gets an exception in renewing the Lease </td></tr></table></div>

<p>The LeaseRenewalManager distinguishes between two time values associated with lease expiration: the <em>desired expiration time</em> for the lease, and the <em>actual expiration time</em> granted when the lease is created or last renewed. The desired expiration represents when the client would like the lease to expire. The actual expiration represents when the lease is going to expire if it is not renewed. Both time values are absolute times, not relative time durations. The <em>desired expiration time</em> can be retrieved using the renewal manager's <tt>getExpiration</tt> method. The <em>actual expiration time</em> of a lease object can be retrieved by invoking the lease's getExpiration method.</p>

<div class='panelMacro'><table class='noteMacro'><colgroup><col width='24'><col></colgroup><tr><td valign='top'><img src="images/icons/emoticons/warning.gif" width="16" height="16" align="absmiddle" alt="" border="0"></td><td> <em>desired expiration time</em> is absolute time and not relative time. When adding Leases to a LeaseRenewalManager, remember to pass appropriate value for <tt>desiredExpiration</tt> parameter. </td></tr></table></div>

<p>Each lease in the managed set also has two other associated attributes: a desired renewal duration, and a remaining desired duration. The desired renewal duration is specified (directly or indirectly) when the lease is added to the set. This duration must normally be a positive number; however, it may be Lease.ANY if the lease's desired expiration is Lease.FOREVER. The remaining desired duration is always the desired expiration less the current time.</p>

<p>Each time a lease is renewed, the renewal manager will ask for an extension equal to the lease's renewal duration if the renewal duration is:</p>

<ul>
	<li>Lease.ANY, or</li>
	<li>less than the remaining desired duration,</li>
</ul>


<p>otherwise it will ask for an extension equal to the lease's remaining desired duration.</p>

<p>Once a lease is given to a lease renewal manager, the manager will continue to renew the lease until one of the following occurs:</p>

<ul>
	<li>The lease's desired or actual expiration time is reached.</li>
	<li>An explicit removal of the lease from the set is requested via a cancel, clear, or remove call on the renewal manager.</li>
	<li>The renewal manager tries to renew the lease and gets a bad object exception, bad invocation exception, or LeaseException.</li>
</ul>


<h3><a name="Leases-ConfiguringLeaseRenewalManager"></a>Configuring LeaseRenewalManager</h3>

<p>LeaseRenewalManager supports <a href="http://www.gigaspaces.com/docs/JiniApi/net/jini/config/Configuration.html">Configuration</a> entries, with component "net.jini.lease.LeaseRenewalManager":</p>

<table class='confluenceTable'><tbody>
<tr>
<th class='confluenceTh'> Property </th>
<th class='confluenceTh'> Type </th>
<th class='confluenceTh'> Default </th>
<th class='confluenceTh'> Description </th>
</tr>
<tr>
<td class='confluenceTd'> roundTripTime </td>
<td class='confluenceTd'> long</td>
<td class='confluenceTd'> 10 * 1000 // 10 seconds </td>
<td class='confluenceTd'> The worst-case latency, expressed in milliseconds, between client and GigaSpace cluster (call to renew a lease). The value must be greater than zero. Unrealistically low values for this entry may result in failure to renew a lease. Leases managed by this manager should have durations exceeding the roundTripTime. This entry is obtained in the constructor.</td>
</tr>
<tr>
<td class='confluenceTd'> renewBatchTimeWindow </td>
<td class='confluenceTd'>long </td>
<td class='confluenceTd'> 5 * 60 * 1000 // 5 minutes </td>
<td class='confluenceTd'> The maximum number of milliseconds earlier than a lease would typically be renewed to allow it to be renewed in order to permit batching its renewal with that of other leases. The value must not be negative. This entry is obtained in the constructor.</td>
</tr>
<tr>
<td class='confluenceTd'> taskManager </td>
<td class='confluenceTd'> TaskManager </td>
<td class='confluenceTd'> new TaskManager(11, 15000, 1.0f) </td>
<td class='confluenceTd'> The object used to manage queuing tasks involved with renewing leases and sending notifications. The value must not be null. The default value creates a maximum of 11 threads for performing operations, waits 15 seconds before removing idle threads, and uses a load factor of 1.0 when determining whether to create a new thread. Note that the implementation of the renewal algorithm includes an assumption that the TaskManager uses a load factor of 1.0.</td>
</tr>
</tbody></table>

<h3><a name="Leases-LeaseRenewalAlgorithm"></a>Lease Renewal Algorithm</h3>

<p>The time at which a lease is scheduled for renewal is based on the expiration time of the lease, possibly adjusted to account for the latency of the renewal call. The configuration entry roundTripTime, which defaults to ten seconds, represents the total time to make the remote call.</p>

<p>The following pseudocode was derived from the code which computes the renewal time. In this code, rtt represents the value of the roundTripTime:</p>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">endTime = lease.getExpiration();
  delta = endTime - now;
  <span class="code-keyword">if</span> (delta &lt;= rtt * 2) {
	delta = rtt;
  } <span class="code-keyword">else</span> <span class="code-keyword">if</span> (delta &lt;= rtt * 8) {
	delta /= 2;
  } <span class="code-keyword">else</span> <span class="code-keyword">if</span> (delta &lt;= 1000 * 60 * 60 * 24 * 7) {
	delta /= 8;
  } <span class="code-keyword">else</span> <span class="code-keyword">if</span> (delta &lt;= 1000 * 60 * 60 * 24 * 14) {
	delta = 1000 * 60 * 60 * 24;
  } <span class="code-keyword">else</span> {
	delta = 1000 * 60 * 60 * 24 * 3;
  }
  renew = endTime - delta;</pre>
</div></div>

<p>It is important to note that delta is never less than rtt when the renewal time is computed. A lease which would expire within this time range will be scheduled for immediate renewal. </p>

<div class='panelMacro'><table class='noteMacro'><colgroup><col width='24'><col></colgroup><tr><td valign='top'><img src="images/icons/emoticons/warning.gif" width="16" height="16" align="absmiddle" alt="" border="0"></td><td> The use of very short lease durations (at or below rtt) can cause the renewal manager to effectively ignore the lease duration and repeatedly schedule the lease for immediate renewal.</td></tr></table></div>

<p>If an attempt to renew a lease fails with an indefinite exception, a renewal is rescheduled with an updated renewal time as computed by the following pseudocode:</p>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">delta = endTime - renew;
  <span class="code-keyword">if</span> (delta &gt; rtt) {
	  <span class="code-keyword">if</span> (delta &lt;= rtt * 3) {
		delta = rtt;
	  } <span class="code-keyword">else</span> <span class="code-keyword">if</span> (delta &lt;= 1000 * 60 * 60) {
		delta /= 3;
	  } <span class="code-keyword">else</span> <span class="code-keyword">if</span> (delta &lt;= 1000 * 60 * 60 * 24) {
		delta = 1000 * 60 * 30;
	  } <span class="code-keyword">else</span> <span class="code-keyword">if</span> (delta &lt;= 1000 * 60 * 60 * 24 * 7) {
		delta = 1000 * 60 * 60 * 3;
	  } <span class="code-keyword">else</span> {
		delta = 1000 * 60 * 60 * 8;
	  }
	  renew += delta;
  }</pre>
</div></div>

<p>Client leases are maintained in a collection sorted by descending renewal time. A renewal thread is spawned whenever the renewal time of the last lease in the collection is reached. This renewal thread examines all of the leases in the collection whose renewal time falls within renewBatchTimeWindow milliseconds of the renewal time of the last lease. If any of these leases can be batch renewed with the last lease (as determined by calling the canBatch method of the last lease) then a LeaseMap is created, all eligible leases are added to it and the LeaseMap.renewAll() method is called. </p>

<p>Otherwise, the last lease is renewed directly.<br/>
The TaskManager that manages the renewal threads has a bound on the number of simultaneous threads it will support. The renewal time of leases may be adjusted earlier in time to reduce the likelihood that the renewal of a lease will be delayed due to exhaustion of the thread pool. Actual renewal times are determined by starting with the lease with the latest (farthest off) desired renewal time and working backwards. When computing the actual renewal time for a lease, the renewals of all leases with later renewal times, which will be initiated during the round trip time of the current lease's renewal, are considered. If using the desired renewal time for the current lease would result in more in-progress renewals than the number of threads allowed, the renewal time of the current lease is shifted earlier in time, such that the maximum number of threads is not exceeded.</p>

<h3><a name="Leases-Example"></a>Example</h3>

<p>Following example shows a client writing <tt>Order</tt>'s to the space with a limited lease. It uses a LeaseRenewalManager to renew the Lease for the <tt>Order</tt>. It also uses a LeaseListener which is triggered in case LeaseRenewalManager runs into errors renewing a lease. Example source can be downloaded from <a href="download/attachments/54822650/LeaseRenewalManager.zip">here</a>.</p>


<div class="panel" style="background-color: #FFFFFF;border-color: #3C78B5;border-style: solid;border-width: 1px;"><div class="panelContent" style="background-color: #FFFFFF;">
<h5><a name="Leases-LeaseManagerClient"></a>LeaseManagerClient</h5>
<hr 
 size="1" 
 color="#3C78B5" 
 >

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">...

<span class="code-keyword">public</span> class LeaseManagerClient {

...

    <span class="code-keyword">public</span> LeaseManagerClient(<span class="code-object">String</span> url) {

	<span class="code-comment">// connect to the space using its URL
</span>	IJSpace space = <span class="code-keyword">new</span> UrlSpaceConfigurer(url).space();
	<span class="code-comment">// use gigaspace wrapper to <span class="code-keyword">for</span> simpler API
</span>	<span class="code-keyword">this</span>.gigaSpace = <span class="code-keyword">new</span> GigaSpaceConfigurer(space).gigaSpace();

	createOrder();

    }

    <span class="code-keyword">private</span> void createOrder() {
	<span class="code-comment">// Create <span class="code-keyword">new</span> order
</span>	Order order = <span class="code-keyword">new</span> Order();
	order.setData(<span class="code-quote">"NewOrder"</span>);
	order.setProcessed(<span class="code-keyword">false</span>);

	DateFormat formatter = <span class="code-keyword">new</span> SimpleDateFormat(<span class="code-quote">"MM/dd/yyyy hh:mm:ss.SSS"</span>);
	Calendar calendar = Calendar.getInstance();

	<span class="code-comment">// Write the order with limited lease
</span>	LeaseContext&lt;Order&gt; lease = gigaSpace.write(order, 10000);

	calendar.setTimeInMillis(<span class="code-object">System</span>.currentTimeMillis());
	logger.info(<span class="code-quote">"Wrote Event at: "</span> + formatter.format(calendar.getTime()));

	calendar.setTimeInMillis(lease.getExpiration());
	logger.info(<span class="code-quote">"<span class="code-object">Object</span> Leased upto: "</span>
			+ formatter.format(calendar.getTime()));

	MyLeaseListener myListener = <span class="code-keyword">new</span> MyLeaseListener();
	LeaseRenewalManager renewer;
	<span class="code-keyword">try</span> {
		
		<span class="code-comment">//Create a LeaseRenewalManager
</span>		renewer = <span class="code-keyword">new</span> LeaseRenewalManager();

		<span class="code-comment">//Renew the order lease <span class="code-keyword">for</span> 1 minute and keep renewing every 10 seconds 
</span>		renewer.renewUntil(lease, <span class="code-object">System</span>.currentTimeMillis() + 60000,
				10000, myListener);

		<span class="code-comment">// Get the expiration of the lease (<span class="code-keyword">this</span> should now point to 1 minute instead of 10 seconds
</span>		<span class="code-object">long</span> leasedUntil = renewer.getExpiration(lease);
		calendar.setTimeInMillis(leasedUntil);
		logger.info(<span class="code-quote">"LeaseRenewalManager manages lease upto: "</span>
				+ formatter.format(calendar.getTime()));
	} <span class="code-keyword">catch</span> (ConfigurationException e1) {
		e1.printStackTrace();
		logger.info(<span class="code-quote">"Error configuring LeaseRenewalManager"</span>);
	} <span class="code-keyword">catch</span> (UnknownLeaseException e) {
		e.printStackTrace();
		logger.info(<span class="code-quote">"Error retrieving Expiration"</span>);
	}
    }

}</pre>
</div></div>


<h5><a name="Leases-UsingCustomLeaseRenewalManagerConfiguration"></a>Using Custom LeaseRenewalManager Configuration</h5>
<hr 
 size="1" 
 color="#3C78B5" 
 >

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java"><span class="code-keyword">public</span> LeaseManagerClient(<span class="code-object">String</span> url) {

... <span class="code-comment">// Same as previous one
</span>
}

<span class="code-keyword">private</span> void createOrder() {

        ... <span class="code-comment">// Same as previous one
</span>
	<span class="code-comment">// Create a custom configuration (use non-<span class="code-keyword">default</span> roundTripTime, <span class="code-keyword">default</span> is 10 secs)
</span>	LeaseRenewalConfiguration myConfig = <span class="code-keyword">new</span> LeaseRenewalConfiguration(1000);

        MyLeaseListener myListener = <span class="code-keyword">new</span> MyLeaseListener();
	LeaseRenewalManager renewer;
	<span class="code-keyword">try</span> {
		
		<span class="code-comment">//Create a LeaseRenewalManager using custom config
</span>		renewer = <span class="code-keyword">new</span> LeaseRenewalManager(myConfig);

		<span class="code-comment">//Renew the order lease <span class="code-keyword">for</span> 1 minute and keep renewing every 10 seconds 
</span>		renewer.renewUntil(lease, <span class="code-object">System</span>.currentTimeMillis() + 60000,
				10000, myListener);

        ... <span class="code-comment">// Same as previous one
</span>
}

<span class="code-keyword">private</span> <span class="code-keyword">static</span> <span class="code-keyword">final</span> class LeaseRenewalConfiguration <span class="code-keyword">implements</span> Configuration {

	<span class="code-keyword">final</span> <span class="code-keyword">private</span> <span class="code-object">Long</span> configRTT;

	<span class="code-keyword">public</span> LeaseRenewalConfiguration(<span class="code-object">long</span> renewRTT) {
		configRTT = renewRTT;
	}

	<span class="code-keyword">public</span> <span class="code-object">Object</span> getEntry(<span class="code-object">String</span> component, <span class="code-object">String</span> name, <span class="code-object">Class</span> type)
			<span class="code-keyword">throws</span> ConfigurationException {
		<span class="code-keyword">return</span> getEntry(component, name, type, -1l, <span class="code-keyword">null</span>);
	}

	<span class="code-keyword">public</span> <span class="code-object">Object</span> getEntry(<span class="code-object">String</span> component, <span class="code-object">String</span> name, <span class="code-object">Class</span> type,
			<span class="code-object">Object</span> defaultValue) <span class="code-keyword">throws</span> ConfigurationException {
		<span class="code-keyword">return</span> getEntry(component, name, type, defaultValue, <span class="code-keyword">null</span>);
	}

	<span class="code-keyword">public</span> <span class="code-object">Object</span> getEntry(<span class="code-object">String</span> component, <span class="code-object">String</span> name, <span class="code-object">Class</span> type,
			<span class="code-object">Object</span> defaultValue, <span class="code-object">Object</span> data) <span class="code-keyword">throws</span> ConfigurationException {

		<span class="code-keyword">if</span> (!component.equals(<span class="code-quote">"net.jini.lease.LeaseRenewalManager"</span>))
			<span class="code-keyword">return</span> defaultValue;
		<span class="code-keyword">if</span> (name.equals(<span class="code-quote">"roundTripTime"</span>))
			<span class="code-keyword">return</span> configRTT; <span class="code-comment">// renewalRTT
</span>		<span class="code-keyword">if</span> (name.equals(<span class="code-quote">"renewBatchTimeWindow"</span>))
			<span class="code-keyword">return</span> 2l; <span class="code-comment">// renewBatchTimeWindow
</span>		<span class="code-keyword">return</span> defaultValue;
	}
}</pre>
</div></div>


<h5><a name="Leases-LeaseListener"></a>LeaseListener</h5>
<hr 
 size="1" 
 color="#3C78B5" 
 >

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java"><span class="code-keyword">public</span> class MyLeaseListener <span class="code-keyword">implements</span> LeaseListener{

	Logger logger = Logger.getLogger(<span class="code-keyword">this</span>.getClass().getName());

	<span class="code-keyword">public</span> MyLeaseListener ()
	{
	}
	
	<span class="code-keyword">public</span> void notify(LeaseRenewalEvent event) {
		logger.info(<span class="code-quote">"LeaseRenewalEvent failed. Received the Event "</span> + event);
	}
}</pre>
</div></div>


<h5><a name="Leases-Order"></a>Order</h5>
<hr 
 size="1" 
 color="#3C78B5" 
 >

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java"><span class="code-keyword">public</span> class Order <span class="code-keyword">implements</span> Serializable {

	<span class="code-keyword">private</span> <span class="code-object">String</span> id;
	<span class="code-keyword">private</span> <span class="code-object">Boolean</span> processed;
	<span class="code-keyword">private</span> <span class="code-object">String</span> data;

	@SpaceId(autoGenerate=<span class="code-keyword">true</span>)
	<span class="code-keyword">public</span> <span class="code-object">String</span> getId() {
		<span class="code-keyword">return</span> id;
	}

	<span class="code-keyword">public</span> void setId(<span class="code-object">String</span> id) {
		<span class="code-keyword">this</span>.id = id;
	}

	<span class="code-keyword">public</span> <span class="code-object">String</span> getData() {
		<span class="code-keyword">return</span> data;
	}

	<span class="code-keyword">public</span> void setData(<span class="code-object">String</span> d) {
		<span class="code-keyword">this</span>.data = d;
	}

	<span class="code-keyword">public</span> <span class="code-object">Boolean</span> getProcessed() {
		<span class="code-keyword">return</span> processed;
	}

	<span class="code-keyword">public</span> void setProcessed(<span class="code-object">Boolean</span> processed) {
		<span class="code-keyword">this</span>.processed = processed;
	}
}</pre>
</div></div>
</div></div>

<p>API page for <a href="http://www.gigaspaces.com/docs/JiniApi/net/jini/lease/LeaseRenewalManager.html">LeaseRenewalManager</a> has additional information.</p>

<h1><a name="Leases-SpaceObjectLeasewithaPersistentSpace"></a>Space Object Lease with a Persistent Space</h1>

<p>When Objects are written to a Persistent Space (backed by a permanent store using ExternalDataSource), objects are written to the permanent store and removed from the space once lease expires. To avoid reloading the expired data into space objects should use @SpaceLeaseExpiration annotation. More information about how @SpaceLeaseExpiration works is <a href="POJO Metadata.html#POJOMetadata-SpaceLeaseExpiration">here</a>.</p>

<h1><a name="Leases-LeaseManager"></a>Lease Manager</h1>

<p>You can control how often this thread invokes the invalidation process. This involves iterating through all the expired space objects since the last invalidation cycle, and allowing the JVM garbage collector to release the memory consumed for the object. To configure the Lease Manager interval use the following:</p>
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">space-config.lease_manager.expiration_time_interval=10000</pre>
</div></div>

<ul class="alternate" type="square">
	<li>When writing objects into the space using a short lease time, it is recommended to configure the lease manager interval to be short.</li>
	<li>The <tt>NOTIFY_LEASE_EXPIRATION</tt> notification is called when the Lease Manager invalidates the object.</li>
	<li>Notifications for expired objects sent <b>both from the primary and the backup space</b> (in case you have a backup running).</li>
	<li>When a transaction is timed out, its locked objects are released when the lease manager thread is triggered. This means that if a client fails while a transaction is opened with locked objects (take, write, read, and update using transactions), the locked objects are released once the lease manager thread identifies the expired transaction.</li>
</ul>


                     </td>
</tr>
</table>
<table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr>
<td height="12" background="http://www.gigaspaces.com/wiki/images/border/border_bottom.gif"><img src="images/border/spacer.gif" width="1" height="1" border="0"/></td>
</tr>
<tr>
<td align="center"><font color="grey"><a href="http://www.gigaspaces.com">GigaSpaces.com</a> -
		<a href="http://www.gigaspaces.com/wiki/x/xwBmAg" class="smalltext">Legal Notice</a> -
		<a href="http://www.gigaspaces.com/wiki/x/xgBmAg" class="smalltext">3rd Party Licenses</a> -
		<a href="http://www.gigaspaces.com/wiki/x/BQFmAg" class="smalltext">Site Map</a> -
		<a href="http://www.gigaspaces.com/wiki/display/API/API+Documentation+Portal" class="version-link">API Docs</a> -
		<a href="http://forum.openspaces.org/forum.jspa?forumID=175" class="version-link">Forum</a> -
		<a href="http://www.gigaspaces.com/LatestProductVersion" class="version-link">Downloads</a> -
		<a href="http://blog.gigaspaces.com/" class="version-link">Blog</a> -
		<a href="http://www.gigaspaces.com/os_papers.html" class="version-link">White Papers</a> -
		<a href="mailto:techw@gigaspaces.com">Contact Tech Writing</a> -
		<i><a href="http://www.atlassian.com/software/confluence">Gen. by Atlassian Confluence</a></i></font></td>
</tr>
</table>
     </body>
</html>
