<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
     <head>
         <title>XAP 8.0 Documentation : How to Set GigaSpaces Over a Firewall</title>
<link rel="stylesheet" href="styles/site.css" type="text/css" />
         <META http-equiv="Content-Type" content="text/html; charset=UTF-8">
		 <style>
.back-to {
	color: #666666;
	font-weight: bold;
}	 
a.back-to:link, a.back-to:visited, a.back-to:hover, a.back-to:active  {
	color: #666666;
}	 
		 </style>
     </head>

     <body>
<table class="pagecontent" border="0" cellpadding="0" cellspacing="0" width="100%" bgcolor="#ffffff">
<tr>
<td valign="top" class="pagebody">
<div class="pageheader">
<span class="back-to">XAP 8.0 Documentation > <a href="index.html">Back to Table of Contents</a></span><br>
<h1>How to Set GigaSpaces Over a Firewall</h1>
</div>
<br>



<div style="border-style:solid; border-color:#3C78B5; border-width:thin; padding-left:20px; padding-bottom:20px; padding-top:20px; padding-right:20px; background-color:#D8E4F1"> 

<p><b>Section Summary:</b>  The GigaSpaces settings to enable functioning over a Firewall.  </p>
</div>

<h1><a name="HowtoSetGigaSpacesOveraFirewall-Overview"></a>Overview</h1>

<p>In many scenarios, you need to set up GigaSpaces in environments which have a firewall running. This section&nbsp;provides&nbsp;GigaSpaces configuration recommendations for several firewall topologies:</p>
<ul>
	<li>Basic configuration: GigaSpaces cluster (GSM and GSCs) running behind the firewall, with clients connecting through the firewall. Multicast traffic is allowed behind the firewall and unicast-only traffic comes from the clients through the firewall.
<br clear="all" />
<br clear="all" /> <img class="emoticon" src="images/icons/emoticons/lightbulb_on.gif" height="16" width="16" align="absmiddle" alt="" border="0"/> <b>Basic configuration, suitable for most scenarios, requires mandatory setting of the following properties</b> (these system property settings are described below):
	<ul>
		<li><tt>com.gs.multicast.discoveryPort</tt></li>
		<li><tt>com.gigaspaces.start.httpPort</tt></li>
		<li><tt>com.gs.transport_protocol.lrmi.bind-port</tt></li>
		<li><tt>com.sun.jini.reggie.initialUnicastDiscoveryPort</tt>.
<br clear="all" />
<br clear="all" /></li>
	</ul>
	</li>
	<li>Same topology as above: All cluster components and clients communicate over <b>unicast only. Multicast traffic is prohibited</b>.</li>
	<li>The firewall divides GigaSpaces cluster into zones. Some components (GSCs, GSM) are running in one firewall zone, while the rest of the components are running in another firewall zone/s. Only unicast traffic is allowed between firewall zones.</li>
</ul>


<p><img class="emoticon" src="images/icons/emoticons/warning.gif" height="16" width="16" align="absmiddle" alt="" border="0"/> In previous releases (before GigaSpaces 6.5), some&nbsp;listener ports used by GigaSpaces could not be statically&nbsp;set.</p>
<p><img src="download/attachments/19890517/referto.gif" align="absmiddle" border="0"/> To learn more about GigaSpaces port usage, refer to <a href="How to Control the Used Ports.html" title="How to Control the Used Ports">How to Control the Used Ports</a>.</p>

<h1><a name="HowtoSetGigaSpacesOveraFirewall-GigaSpacesFirewallSettings"></a>GigaSpaces Firewall Settings</h1>

<div class="error"><span class="error">Error formatting macro: toc-zone: java.lang.NullPointerException</span> 

<p><b>To enable all GigaSpaces components to work over a firewall and control all network activity through explicitly defined static ports, perform the following configuration steps</b>:</p>

<ol>
	<li>All communications traversing the firewall should be switched to Unicast TCP (use GigaSpaces Jini unicast lookup locators and set the -Dcom.gs.multicast.discoveryPort as described in the next section), Jini Multicast discovery should be disabled.</li>
	<li>Specific listener ports of system components should be <b>statically set</b>.</li>
	<li>Necessary listener <b>port ranges</b> should be defined per each IP address, where the GigaSpaces server components reside.<br/>
<img class="emoticon" src="images/icons/emoticons/warning.gif" height="16" width="16" align="absmiddle" alt="" border="0"/> Components such as GSM/Lookup Service, GSC, Mahalo use a single Webster (HTTPD service) and a single LRMI transport port per each component. Accordingly, the same quantity of Webster and LRMI ports should be planned per each IP address where those components reside.<br/>
<img class="emoticon" src="images/icons/emoticons/information.gif" height="16" width="16" align="absmiddle" alt="" border="0"/> Port ranges should be chosen continuously, as Webster and LRMI port bindings are performed <b>sequentially</b>, beginning from the low port number &#8211; each additional component started on the <b>same machine</b> opens sequentially higher Webster and LRMI ports, beginning from the low port in the defined port range.</li>
	<li><b>Firewall rules for incoming traffic</b> should include opening TCP port per each statically defined GigaSpaces component listener, for each IP address where GigaSpaces component is running (excluding JMX MBean server).</li>
	<li><b>JMX listener ports</b> presented in GigaSpaces components and assigned by RMIRegistry mechanism (default port range beginning - 10098; each component opens next available port) can remain dynamically assigned and should not be opened in the firewall. JMX connections are dedicated to administrative purposes and can be accessed by monitoring tools behind the firewall. Of course, MBeanServer and the RMI lookup will not be available outside firewall</li>
	<li>Each static GigaSpaces listener port behind the firewall should be mapped by NAT to the static IP address outside of the firewall. GigaSpaces clients/servers residing outside of the firewall should be set to work versus statically mapped by NAT listeners outside IP addresses.</li>
	<li><b>Mandatory</b> &#8211; the range of port numbers (just free unassigned ports allowed) should be above <tt>1024</tt> and below <tt>65536</tt>.<br/>
<img class="emoticon" src="images/icons/emoticons/lightbulb_on.gif" height="16" width="16" align="absmiddle" alt="" border="0"/> <b>Recommended port ranges</b> &#8211; above <tt>7100</tt> in free unassigned IANA ranges (<tt>7102</tt>&#45;<tt>7120</tt>, <tt>7130</tt>&#45;<tt>7160</tt>, <tt>7167</tt>&#45;<tt>7173</tt>, <tt>7175</tt>&#45;<tt>7199</tt>, <tt>7228</tt>&#45;<tt>7271</tt>, <tt>7282</tt>&#45;<tt>7299</tt>, <tt>7366</tt>&#45;<tt>7390</tt>..., <tt>47558</tt>&#45;<tt>47623</tt>, <tt>47625</tt>&#45;<tt>47805</tt>, <tt>47809</tt>&#45;<tt>47999</tt>, <tt>48004</tt>&#45;<tt>48127</tt>, <tt>48620</tt>&#45;<tt>49150</tt>)</li>
</ol>


<h2><a name="HowtoSetGigaSpacesOveraFirewall-ListenerPortsperGigaSpacesComponent"></a>Listener Ports per GigaSpaces Component</h2>

<table class='confluenceTable'><tbody>
<tr>
<th class='confluenceTh'> Component </th>
<th class='confluenceTh'> Listeners </th>
</tr>
<tr>
<td class='confluenceTd'> GSM </td>
<td class='confluenceTd'> Lookup Service <br clear="all" />
LRMI Transport <br clear="all" />
Webster <br clear="all" />
JMX </td>
</tr>
<tr>
<td class='confluenceTd'> GSC </td>
<td class='confluenceTd'> LRMI Transport <br clear="all" />
Webster <br clear="all" />
JMX </td>
</tr>
<tr>
<td class='confluenceTd'> Transaction Manager <br clear="all" />
(Mahalo) </td>
<td class='confluenceTd'> LRMI Transport <br clear="all" />
Webster <br clear="all" />
JMX </td>
</tr>
</tbody></table>

<h2><a name="HowtoSetGigaSpacesOveraFirewall-RequiredConfigurationModifications"></a>Required Configuration Modifications</h2>
</div>
<div class="error"><span class="error">Error formatting macro: toc-zone: java.lang.NullPointerException</span> 

<p><img class="emoticon" src="images/icons/emoticons/warning.gif" height="16" width="16" align="absmiddle" alt="" border="0"/> These modifications apply to GigaSpaces version 6.5.</p>

<h3><a name="HowtoSetGigaSpacesOveraFirewall-bin%2Fgs.shScriptModifications"></a>bin/gs.sh Script Modifications</h3>

<p>Add the following system properties to the command line:</p>

<ul>
	<li><b>Optional</b> &#8211; use the following system property to <b>disable the Jini multicast activity</b>. For unicast-only solutions:
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">-Dcom.gs.multicast.enabled=<span class="code-keyword">false</span></pre>
</div></div></li>
	<li><b>Mandatory</b> &#8211; Reggie Lookup Service: in this context, modify <tt>com.gs.multicast.discoveryPort</tt>, the port used during discovery for both unicast and multicast requests. Default value is <tt>4166</tt>.
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">-Dcom.gs.multicast.discoveryPort=</pre>
</div></div></li>
	<li><b>Mandatory</b> &#8211; Reggie Lookup Service: in this context, modify <tt>com.sun.jini.reggie.initialUnicastDiscoveryPort</tt>, the port used during unicast discovery. Default value is <tt>0</tt> - any available port.
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">-Dcom.sun.jini.reggie.initialUnicastDiscoveryPort=</pre>
</div></div></li>
	<li><b>Optional</b> &#8211; <tt>RMIRegistry</tt> port (used for RMI lookup and for JMX MBean server). Default value is <tt>10098</tt>.
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">-Dcom.gigaspaces.system.registryPort=</pre>
</div></div></li>
	<li><b>Mandatory</b> &#8211; Webster HTTPD service port.
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">-Dcom.gigaspaces.start.httpPort=</pre>
</div></div></li>
</ul>


<p>Settings example:</p>
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">-Dcom.gs.multicast.enabled=<span class="code-keyword">false</span>
-Dcom.gs.multicast.discoveryPort=7102
-Dcom.gigaspaces.system.registryPort=7103
-Dcom.gigaspaces.start.httpPort=7104</pre>
</div></div>

<h3><a name="HowtoSetGigaSpacesOveraFirewall-bin%2Fgsui.shGUIScriptModificationsOptional%3BneededwhenGUIclientshouldconnectthroughthefirewall"></a>bin/gs-ui.sh GUI Script Modifications &#8211; Optional; needed when GUI client should connect through the firewall</h3>

<p>Add the following system properties to the command line:</p>

<ul>
	<li><b>Mandatory</b> &#8211; use the following system property to <b>disable the Jini multicast activity</b>. For unicast-only solutions:
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">-Dcom.gs.multicast.enabled=<span class="code-keyword">false</span></pre>
</div></div></li>
	<li><b>Mandatory</b> &#8211; Reggie Lookup Service: in this context, modify <tt>com.gs.multicast.discoveryPort</tt>, the port used during discovery for both unicast and multicast requests. Default value is <tt>4166</tt>.
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">-Dcom.gs.multicast.discoveryPort=</pre>
</div></div></li>
	<li><b>Mandatory</b> &#8211; <tt>RMIRegistry</tt> port (used for RMI lookup and for JMX MBean server). Default value is <tt>10098</tt>.
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">-Dcom.gigaspaces.system.registryPort=</pre>
</div></div></li>
	<li><b>Optional</b> &#8211; Webster HTTPD service port.
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">-Dcom.gigaspaces.start.httpPort=</pre>
</div></div></li>
</ul>


<p>Settings example:</p>
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">-Dcom.gs.multicast.enabled=<span class="code-keyword">false</span>
-Dcom.gs.multicast.discoveryPort=7102
-Dcom.gigaspaces.system.registryPort=7103
-Dcom.gigaspaces.start.httpPort=7104</pre>
</div></div>

<h3><a name="HowtoSetGigaSpacesOveraFirewall-bin%2Fsetenv.shScriptModificationsMandatory"></a>bin/setenv.sh Script Modifications &#8211; Mandatory</h3>

<p>Lookup locators unicast discovery port should be the same as defined in <tt>gs.sh</tt>, for example:</p>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">LOOKUPLOCATORS=server111:7102; export LOOKUPLOCATORS</pre>
</div></div>

<h3><a name="HowtoSetGigaSpacesOveraFirewall-LRMICommunicationProtocolPortRangeSettingModifications"></a>LRMI Communication Protocol Port Range Setting Modifications</h3>


<p><img src="download/attachments/19890517/referto.gif" align="absmiddle" border="0"/> For more details on the LRMI communication protocol, see the <a href="Communication Protocol.html" title="Communication Protocol">Communication Protocol</a> section.</p>
<p>The <tt>com.gigaspaces.start.httpPort</tt> Webster port number property can be defined by overriding as shown below, or using a system property:</p>
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">gsm.sh webster.xml
gsc.sh webster.xml
startJiniTX_Mahalo.sh webster.xml</pre>
</div></div>
<p>Content of override file for Webster port definitions:</p>
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-xml"><span class="code-tag">&lt;overrides&gt;</span>
    <span class="code-tag">&lt;Component Name=<span class="code-quote">"com.gigaspaces.start"</span>&gt;</span>
        <span class="code-tag">&lt;Parameter Name=<span class="code-quote">"httpPort"</span> Value=<span class="code-quote">"9099"</span>/&gt;</span>
    <span class="code-tag">&lt;/Component&gt;</span>
<span class="code-tag">&lt;/overrides&gt;</span></pre>
</div></div></div>

<h1><a name="HowtoSetGigaSpacesOveraFirewall-BlockingReliableTake"></a>Blocking Reliable Take</h1>
<p>The blocking Take operation (<tt>timeout &gt;0</tt>) with a remote client opens a network connection between the client and the space and also a <b>reverse</b> network connection between the space and the client before the object is removed from the space to ensure that the client that initiated the blocking take operation is still active. This ensures that the removed object will be actually consumed by the remote client. </p>

<p>There might be cases where the network would not allow the space to perform network operations from the space process back into the client process - for example send SYN_SENT TCP packets over the network. This could happen when the space running within a non-secured network zone (<tt>DMZ</tt>) that sits behind a firewall and the remote client running within a secured network zone. This would cause the take operation to react very slowly since the space network activity (<a href="Communication Protocol.html" title="Communication Protocol">LRMI</a>) will timeout after 5 seconds (this is the default settings) without the ability to complete the take operation correctly. </p>

<p>In such a case you could disable the <tt>Blocking Reliable Take</tt> activity by using the <tt>space-config.engine.reliable_take</tt> property. You can control the Take operation to restore the object in case the client was terminated during the time it was in blocking mode by using transactions - this will ensure that the removed object will reappear within the space in case the client was terminated abnormally or failed. </p>

<p>Here is how you can configure the space to disable the Blocking Reliable Take activity:</p>
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">&lt;os-core:space id=<span class="code-quote">"space"</span> url=<span class="code-quote">"/./space"</span>&gt;
    &lt;os-core:properties&gt;
        &lt;props&gt;
            &lt;prop key=<span class="code-quote">"space-config.engine.reliable_take"</span>&gt;<span class="code-keyword">false</span>&lt;/prop&gt;
        &lt;/props&gt;
    &lt;/os-core:properties&gt;
&lt;/os-core:space&gt;</pre>
</div></div>

                     </td>
</tr>
</table>
<table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr>
<td height="12" background="http://www.gigaspaces.com/wiki/images/border/border_bottom.gif"><img src="images/border/spacer.gif" width="1" height="1" border="0"/></td>
</tr>
<tr>
<td align="center"><font color="grey"><a href="http://www.gigaspaces.com">GigaSpaces.com</a> -
		<a href="http://www.gigaspaces.com/wiki/x/xwBmAg" class="smalltext">Legal Notice</a> -
		<a href="http://www.gigaspaces.com/wiki/x/xgBmAg" class="smalltext">3rd Party Licenses</a> -
		<a href="http://www.gigaspaces.com/wiki/x/BQFmAg" class="smalltext">Site Map</a> -
		<a href="http://www.gigaspaces.com/wiki/display/API/API+Documentation+Portal" class="version-link">API Docs</a> -
		<a href="http://forum.openspaces.org/forum.jspa?forumID=175" class="version-link">Forum</a> -
		<a href="http://www.gigaspaces.com/LatestProductVersion" class="version-link">Downloads</a> -
		<a href="http://blog.gigaspaces.com/" class="version-link">Blog</a> -
		<a href="http://www.gigaspaces.com/os_papers.html" class="version-link">White Papers</a> -
		<a href="mailto:techw@gigaspaces.com">Contact Tech Writing</a> -
		<i><a href="http://www.atlassian.com/software/confluence">Gen. by Atlassian Confluence</a></i></font></td>
</tr>
</table>
     </body>
</html>
