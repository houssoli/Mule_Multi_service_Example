<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
     <head>
         <title>XAP 8.0 Documentation : Local View and Local Cache</title>
<link rel="stylesheet" href="styles/site.css" type="text/css" />
         <META http-equiv="Content-Type" content="text/html; charset=UTF-8">
		 <style>
.back-to {
	color: #666666;
	font-weight: bold;
}	 
a.back-to:link, a.back-to:visited, a.back-to:hover, a.back-to:active  {
	color: #666666;
}	 
		 </style>
     </head>

     <body>
<table class="pagecontent" border="0" cellpadding="0" cellspacing="0" width="100%" bgcolor="#ffffff">
<tr>
<td valign="top" class="pagebody">
<div class="pageheader">
<span class="back-to">XAP 8.0 Documentation > <a href="index.html">Back to Table of Contents</a></span><br>
<h1>Local View and Local Cache</h1>
</div>
<br>

<script type='text/javascript'>//<![CDATA[
function debug() { }
// ]]></script><script type='text/javascript' src='/wiki/download/resources/net.customware.confluence.plugin.composition:composition-setup/js/browser.js'>//<![CDATA[
// ]]></script><script type='text/javascript' src='/wiki/download/resources/net.customware.confluence.plugin.composition:composition-setup/js/behaviour.js'>//<![CDATA[
// ]]></script><script type='text/javascript' src='/wiki/download/resources/net.customware.confluence.plugin.composition:composition-setup/js/memory.js'>//<![CDATA[
// ]]></script><script type='text/javascript' src='/wiki/download/resources/net.customware.confluence.plugin.composition:composition-setup/js/cloak.js'>//<![CDATA[
// ]]></script><script type='text/javascript'>//<![CDATA[
Cloak.closeHTML = "<img src=\'/wiki/download/resources/net.customware.confluence.plugin.composition:toggle-cloak/img/navigate_down_10.gif\'/>";
Cloak.openHTML = "<img src=\'/wiki/download/resources/net.customware.confluence.plugin.composition:toggle-cloak/img/navigate_right_10.gif\'/>";
Cloak.toggleZone = true;
Cloak.memoryDuration = 0;
Cloak.memoryPrefix = "contentId:53903384";
Cloak.memoryPath = "/wiki/";
// ]]></script><style type='text/css'>
.cloakToggle { /* Definition for state toggling image */
cursor:hand;
cursor:pointer;
}
</style><script type='text/javascript' src='/wiki/download/resources/net.customware.confluence.plugin.composition:composition-setup/js/transitions.js'>//<![CDATA[
// ]]></script><script type='text/javascript' src='/wiki/download/resources/net.customware.confluence.plugin.composition:composition-setup/js/deck.js'>//<![CDATA[
// ]]></script><link rel='stylesheet' type='text/css'  href='/wiki/styles/main-action.css?pluginCompleteKey=net.customware.confluence.plugin.composition:composition-setup&stylesheetName=deck&spaceKey=XAP8'/><script type='text/javascript'>//<![CDATA[
Deck.memoryDuration = 0;
Deck.memoryPrefix = "contentId:53903384";
Deck.memoryPath = "/wiki/";
// ]]></script>

<div style="border-style:solid; border-color:#3C78B5; border-width:thin; padding-left:20px; padding-bottom:20px; padding-top:20px; padding-right:20px; background-color:#D8E4F1"> 

<p><b>Section Summary:</b>  A client application may run a local side cache (near cache). There are two variations provided: local cache and local view. These allows the client application to cache specific or recently used data at the client memory address and have it updated automatically by the space when that data changes. </p>
</div>

<h1><a name="LocalViewandLocalCache-ClientSideCacheNearCache"></a>Client Side Cache - Near Cache</h1>

<p>GigaSpaces supports client cache running within the application memory address. There are two variations provided: <br/>
<a href="#LocalViewandLocalCache-LocalView">Local View</a> - This client side cache maintain specific subset of the entire data, where the cache warms up once the client is started.<br/>
<a href="#LocalViewandLocalCache-LocalCache">Local Cache</a> - This client side cache maintain any object used by the application. The cache data is loaded on demand (lazy fashion), based on the client read activities.  </p>

<h1><a name="LocalViewandLocalCache-LocalView"></a>Local View</h1>

<p>The local view maintains a subset of the master space's data, allowing the client to read distributed data without performing any remote calls or serializing the data. Data is streamed into the client local view based on a certain criteria(s) specified when the local view is created. The criteria is defined via a regular template or <a href="SQLQuery.html" title="SQLQuery">SQLQuery</a>, as opposed to the local cache that caches data on the client side in a lazy manner (only after the data has been read for the first time by the application).</p>

<p>The local view is configured using the <tt>LocalViewSpaceFactoryBean</tt> class. The factory exposes the same <tt>IJSpace</tt> interface that a regular <a href="The Space Component.html" title="The Space Component">space component</a> exposes. Nevertheless, <b>it only supports read operations</b> and will never access the remote space when such an operation is called. If the application performs data updates, it should have a second regular proxy and use it for such activities.</p>

<div class="indent20 inline" style="margin-left: 20px;"><style type="text/css">div.inline p:first-child { display: inline; }</style><p><img src="download/attachments/48235229/local_view.jpg" align="absmiddle" border="0"/></p></div>

<p>The following is an example of how a local view can be configured:</p>

<div class="panel" style="background-color: #FFFFFF;border-color: #3C78B5;border-style: solid;border-width: 1px;"><div class="panelContent" style="background-color: #FFFFFF;">
<h5><a name="LocalViewandLocalCache-SpringNamespaceConfiguration"></a>Spring Namespace Configuration</h5>
<hr 
 size="1" 
 color="#3C78B5" 
 >

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-xml"><span class="code-tag">&lt;os-core:space id=<span class="code-quote">"space"</span> url=<span class="code-quote">"jini://*/*/space"</span> /&gt;</span>

<span class="code-tag">&lt;os-core:local-view id=<span class="code-quote">"localViewSpace"</span> space=<span class="code-quote">"space"</span>&gt;</span>
    <span class="code-tag">&lt;os-core:view-query where=<span class="code-quote">"processed = true"</span> class=<span class="code-quote">"com.example.Message"</span>/&gt;</span>
<span class="code-tag">&lt;/os-core:local-view&gt;</span>

<span class="code-tag">&lt;os-core:giga-space id=<span class="code-quote">"gigaSpace"</span> space=<span class="code-quote">"localViewSpace"</span>/&gt;</span></pre>
</div></div>


<h5><a name="LocalViewandLocalCache-PlainSpringXML"></a>Plain Spring XML</h5>
<hr 
 size="1" 
 color="#3C78B5" 
 >

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-xml"><span class="code-tag">&lt;bean id=<span class="code-quote">"space"</span> class=<span class="code-quote">"org.openspaces.core.space.UrlSpaceFactoryBean"</span>&gt;</span>
    <span class="code-tag">&lt;property name=<span class="code-quote">"url"</span> value=<span class="code-quote">"jini://*/*/space"</span> /&gt;</span>
<span class="code-tag">&lt;/bean&gt;</span>

<span class="code-tag">&lt;bean id=<span class="code-quote">"viewSpace"</span> class=<span class="code-quote">"org.openspaces.core.space.cache.LocalViewSpaceFactoryBean"</span>&gt;</span>
    <span class="code-tag">&lt;property name=<span class="code-quote">"space"</span> ref=<span class="code-quote">"space"</span> /&gt;</span>
    <span class="code-tag">&lt;property name=<span class="code-quote">"localViews"</span>&gt;</span>
        <span class="code-tag">&lt;list&gt;</span>
          <span class="code-tag">&lt;bean class=<span class="code-quote">"com.j_spaces.core.client.view.View"</span>&gt;</span>
                <span class="code-tag">&lt;constructor-arg index=<span class="code-quote">"0"</span> value=<span class="code-quote">"com.example.Message"</span> /&gt;</span>
                <span class="code-tag">&lt;constructor-arg index=<span class="code-quote">"1"</span> value=<span class="code-quote">"processed = true"</span> /&gt;</span>
            <span class="code-tag">&lt;/bean&gt;</span>
        <span class="code-tag">&lt;/list&gt;</span>
    <span class="code-tag">&lt;/property&gt;</span>
<span class="code-tag">&lt;/bean&gt;</span></pre>
</div></div>


<h5><a name="LocalViewandLocalCache-Code"></a>Code</h5>
<hr 
 size="1" 
 color="#3C78B5" 
 >

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">IJSpace space = <span class="code-comment">// get Space either by injection or code creation
</span>IJSpace localViewProxy = <span class="code-keyword">new</span> LocalViewSpaceConfigurer(space).
         addView(<span class="code-keyword">new</span> View(<span class="code-quote">"com.example.Message"</span>, <span class="code-quote">"processed = <span class="code-keyword">true</span>"</span>)).localView();
GigaSpace gigaspace = <span class="code-keyword">new</span> GigaSpaceConfigurer(localViewProxy).gigaSpace();</pre>
</div></div>
</div></div>

<h2><a name="LocalViewandLocalCache-StreamingaSubsetoftheMasterSpaceDataintotheClient%27sProcessMemory"></a>Streaming a Subset of the Master Space Data into the Client's Process Memory</h2>
<p>Once the local view is constructed, data is pre-loaded into the client JVM's memory based on the view criteria (as opposed to the local cache that does not perform a pre-load stage). The local view is continuously updated by the master space in an asynchronous manner, using the notifications mechanism. Both write, take and update operations made on the master space are delivered into the client's process based on the view criteria.</p>

<h1><a name="LocalViewandLocalCache-LocalViewConsiderations"></a>Local View Considerations</h1>
<ul class="alternate" type="square">
	<li>All operations (<tt>read</tt> and <tt>readMultiple</tt>) are served by the local view (as opposed to the local cache which reads data from the remote master space when it's first accessed or when <tt>readMultiple</tt>) is called and there are no enough matching objects within the client side cache).</li>
	<li>Data is never evicted from the local view - The cache policy is hard coded to <tt>ALL_IN_CACHE</tt> mode. So you have to be very careful not specify a local view criteria that would cause the local view to retrieve too much data from space. This can cause the local JVM to run out of memory.</li>
	<li>The Local View is a <b>Read-Only</b>. The following operations are not supported when using local view, and should be performed using a regualr space proxy:
	<ul class="alternate" type="square">
		<li>All write operations (<tt>write</tt>, <tt>writeMultiple</tt>).</li>
		<li>All update operations (<tt>update</tt>, <tt>updateMultiple</tt>).</li>
		<li>All take operations (<tt>take</tt>, <tt>takeById</tt>, <tt>takeMultiple</tt>, etc.).</li>
		<li><tt>clear</tt> operation.</li>
		<li>Any operation under a transaction.</li>
	</ul>
	</li>
</ul>


<h1><a name="LocalViewandLocalCache-LocalCache"></a>Local Cache</h1>

<p>The local cache also maintains a subset of the master space's data, but unlike the local view that subset is based on the data that the client application accessed most recently, rather than a predefined subset of data. <br/>
You configure the local cache by using the <tt>LocalCacheSpaceFactoryBean</tt> class. The factory exposes the same <tt>IJSpace</tt> interface that a regular <a href="The Space Component.html" title="The Space Component">space component</a> exposes, with the additional feature of caching recently accessed data locally.</p>

<div class="indent20 inline" style="margin-left: 20px;"><style type="text/css">div.inline p:first-child { display: inline; }</style><p><img src="download/attachments/48235229/local_cache.jpg" align="absmiddle" border="0"/></p></div>

<p>The following is an example of how a local cache can be configured:</p>

<div class="panel" style="background-color: #FFFFFF;border-color: #3C78B5;border-style: solid;border-width: 1px;"><div class="panelContent" style="background-color: #FFFFFF;">
<h5><a name="LocalViewandLocalCache-SpringNamespaceConfiguration"></a>Spring Namespace Configuration</h5>
<hr 
 size="1" 
 color="#3C78B5" 
 >

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-xml"><span class="code-tag">&lt;os-core:space id=<span class="code-quote">"space"</span> url=<span class="code-quote">"jini://*/*/mySpace"</span> /&gt;</span>

<span class="code-tag">&lt;os-core:local-cache id=<span class="code-quote">"localCacheSpace"</span> space=<span class="code-quote">"space"</span> update-mode=<span class="code-quote">"PULL"</span> &gt;</span>
    <span class="code-tag">&lt;os-core:properties&gt;</span>
        <span class="code-tag">&lt;props&gt;</span>
            <span class="code-tag">&lt;prop key=<span class="code-quote">"space-config.engine.cache_size"</span>&gt;</span>5000000<span class="code-tag">&lt;/prop&gt;</span>
            <span class="code-tag">&lt;prop key=<span class="code-quote">"space-config.engine.memory_usage.high_watermark_percentage"</span>&gt;</span>75<span class="code-tag">&lt;/prop&gt;</span>
            <span class="code-tag">&lt;prop key=<span class="code-quote">"space-config.engine.memory_usage.write_only_block_percentage"</span>&gt;</span>73<span class="code-tag">&lt;/prop&gt;</span>
            <span class="code-tag">&lt;prop key=<span class="code-quote">"space-config.engine.memory_usage.write_only_check_percentage"</span>&gt;</span>71<span class="code-tag">&lt;/prop&gt;</span>
            <span class="code-tag">&lt;prop key=<span class="code-quote">"space-config.engine.memory_usage.low_watermark_percentage"</span>&gt;</span>45<span class="code-tag">&lt;/prop&gt;</span>
            <span class="code-tag">&lt;prop key=<span class="code-quote">"space-config.engine.memory_usage.eviction_batch_size"</span>&gt;</span>1000<span class="code-tag">&lt;/prop&gt;</span>
            <span class="code-tag">&lt;prop key=<span class="code-quote">"space-config.engine.memory_usage.retry_yield_time"</span>&gt;</span>100<span class="code-tag">&lt;/prop&gt;</span>
            <span class="code-tag">&lt;prop key=<span class="code-quote">"space-config.engine.memory_usage.retry_count"</span>&gt;</span>20<span class="code-tag">&lt;/prop&gt;</span>
        <span class="code-tag">&lt;/props&gt;</span>
    <span class="code-tag">&lt;/os-core:properties&gt;</span>
<span class="code-tag">&lt;/os-core:local-cache&gt;</span>
<span class="code-tag">&lt;os-core:giga-space id=<span class="code-quote">"gigaSpace"</span> space=<span class="code-quote">"localCacheSpace"</span>/&gt;</span></pre>
</div></div>


<h5><a name="LocalViewandLocalCache-PlainSpringXML"></a>Plain Spring XML</h5>
<hr 
 size="1" 
 color="#3C78B5" 
 >

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-xml"><span class="code-tag">&lt;bean id=<span class="code-quote">"space"</span> class=<span class="code-quote">"org.openspaces.core.space.UrlSpaceFactoryBean"</span>&gt;</span>
    <span class="code-tag">&lt;property name=<span class="code-quote">"url"</span> value=<span class="code-quote">"jini://*/*/space"</span> /&gt;</span>
<span class="code-tag">&lt;/bean&gt;</span>

<span class="code-tag">&lt;bean id=<span class="code-quote">"localCacheSpace"</span> class=<span class="code-quote">"org.openspaces.core.space.cache.LocalCacheSpaceFactoryBean"</span>&gt;</span>
    <span class="code-tag">&lt;property name=<span class="code-quote">"space"</span> ref=<span class="code-quote">"space"</span> /&gt;</span>
    <span class="code-tag">&lt;property name=<span class="code-quote">"updateMode"</span> value=<span class="code-quote">"PULL"</span> /&gt;</span>
<span class="code-tag">&lt;/bean&gt;</span></pre>
</div></div>


<h5><a name="LocalViewandLocalCache-Code"></a>Code</h5>
<hr 
 size="1" 
 color="#3C78B5" 
 >

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">UrlSpaceConfigurer urlSpaceConfigurer = <span class="code-keyword">new</span> UrlSpaceConfigurer(<span class="code-quote">"jini:<span class="code-comment">//*/*/space"</span>);
</span>IJSpace localSpaceProxy = <span class="code-keyword">new</span> LocalCacheSpaceConfigurer(urlSpaceConfigurer.space()).updateMode(UpdateMode.PULL).localCache();
GigaSpace gigaspace = <span class="code-keyword">new</span> GigaSpaceConfigurer(localSpaceProxy).gigaSpace();</pre>
</div></div>
</div></div>

<h1><a name="LocalViewandLocalCache-LocalCacheConsiderations"></a>Local Cache Considerations</h1>

<p><img class="emoticon" src="images/icons/emoticons/information.gif" height="16" width="16" align="absmiddle" alt="" border="0"/> When using a local cache with the <tt>GigaSpace</tt> interface, the cache policy is <tt>LRU</tt> and cannot be changed. When using the local cache with the <tt>GigaMap</tt> interface, the default cache policy is <tt>com.j_spaces.map.eviction.FIFOEvictionStrategy</tt>. You may use other policies. Please refer to the <a href="The Map Component.html#TheMapComponent-TheMapComponentLocalCache">Map Component local cache section</a> for more details.</p>

<p><img class="emoticon" src="images/icons/emoticons/information.gif" height="16" width="16" align="absmiddle" alt="" border="0"/> <b>Local Cache with External Data Source:</b><br/>
When the local cache works with a master space that has an <a href="External Data Source.html" title="External Data Source">External Data Source</a> configured, it is important to make sure that the following guidelines are followed:</p>
<ol>
	<li>Each POJO class should contain a <a href="POJO Support.html#POJOSupport-avaSpacesPOJOPOJOAnnotationsandXMLSpaceMappin...">SpaceVersion</a> property.</li>
	<li>In the database, you should add a VERSION_ID column that will be mapped to this property in the corresponding tables. If you are using Hibernate, add the <tt>versionId</tt> property to the <tt>hbm.xml</tt> file or the <tt>@Version</tt> annotation to the mapped class.</li>
	<li>When initially loading data from the database to the master space, make sure that the version ID of the loaded objects is 1 or higher. This will "imitate" what is happening when writing a new object into the space. This will allow a client running a local cache to load an object into its local cache correctly once there is a cache miss within the local cache when a read operation is called.</li>
	<li>When clearing or taking objects you should make sure that the template used has the version ID field set to ZERO. This will ensure that the space will ignore the version id when performing the template matching.</li>
</ol>


<h1><a name="LocalViewandLocalCache-LocalCacheMemoryEviction"></a>Local Cache Memory Eviction</h1>
<p>In order to properly configure the local cache eviction mechanism, you should consider tuning the following configuration elements:</p>
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">space-config.engine.cache_size 
space-config.engine.memory_usage.high_watermark_percentage 
space-config.engine.memory_usage.write_only_block_percentage
space-config.engine.memory_usage.write_only_check_percentage
space-config.engine.memory_usage.low_watermark_percentage
#when eviction kicks in, how many objects will be evicted on every eviction cycle
space-config.engine.memory_usage.eviction_batch_size
space-config.engine.memory_usage.retry_count 
space-config.engine.memory_usage.explicit-gc
space-config.engine.memory_usage.retry_yield_time</pre>
</div></div>

<p>See the <a href="Memory Management Facilities.html" title="Memory Management Facilities">Memory Management Facilities</a> for additional details on these configuration properties. </p>

<p><img class="emoticon" src="images/icons/emoticons/warning.gif" height="16" width="16" align="absmiddle" alt="" border="0"/> Having the property <tt>space-config.engine.memory_usage.explicit-gc</tt> set to 'enabled' is recommended only in extreme cases when there is high load on the system, with large amount of concurrent users accessing the local cache and when the amount of CPUs/Cores is relatively small.</p>

<h1><a name="LocalViewandLocalCache-LocalCacheMemoryHandling"></a>Local Cache Memory Handling</h1>
<p>There might be cases when the local cache would not be able to evict its data fast enough. This will result in an exception thrown on the client side. The reasons for this behavior might be very large objects stored within the local cache, large amount of concurrent access to the local cache or relatively small JVM heap. In such a case a <tt>RemoteException</tt> will be thrown.<br/>
You should catch this Exception and check its cause. If the cause is <tt>MemoryShortageException</tt> you should sleep for a while and let the client JVM release the evicted memory and retry the operation. See below an example for this:</p>
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">GigaSpace gigaspace;
<span class="code-keyword">while</span>(<span class="code-keyword">true</span>)
{
	<span class="code-keyword">try</span>
	{
		<span class="code-object">Object</span> obj = gigaspace.read(template);
		<span class="code-keyword">break</span>;
	}
	<span class="code-keyword">catch</span> (Exception re) {
		<span class="code-keyword">if</span> (re.getCause() <span class="code-keyword">instanceof</span> MemoryShortageException)
		<span class="code-object">Thread</span>.sleep(1000);
	}			
}</pre>
</div></div>

<h1><a name="LocalViewandLocalCache-LocalCacheUpdatePolicies"></a>Local Cache Update Policies</h1>
<p>The local cache update policy defines how changes with the master Space objects are propagated to the local cache.<br/>
Each change on master space notifies the local cache about the change.</p>
<div class='panelMacro'><table class='infoMacro'><colgroup><col width='24'><col></colgroup><tr><td valign='top'><img src="images/icons/emoticons/information.gif" width="16" height="16" align="absmiddle" alt="" border="0"></td><td>Only <b>actual</b> object changes in master space are propagated to the cache - <b>update</b> and <b>take</b>. Object eviction or reload from the External Data source do not update the local cache.</td></tr></table></div>

<p>There are two local cache update policies you may choose from: <tt>Push</tt> and <tt>Pull</tt>.</p>

<h3><a name="LocalViewandLocalCache-ThePushPolicy"></a>The Push Policy</h3>

<p>When using the <tt>Push</tt> update policy, the local cache get a notification about the change, it receives the recent copy of the object from the master space and 'pushes' the update to the local cache immediately.  </p>

<div class="indent20 inline" style="margin-left: 20px;"><style type="text/css">div.inline p:first-child { display: inline; }</style><p><img src="download/attachments/48235229/local_cache_push.jpg" align="absmiddle" border="0"/></p></div>

<div class='panelMacro'><table class='infoMacro'><colgroup><col width='24'><col></colgroup><tr><td valign='top'><img src="images/icons/emoticons/information.gif" width="16" height="16" align="absmiddle" alt="" border="0"></td><td>This policy should be used for applications that perform more reads than updates, when it is important to reduce cache misses.</td></tr></table></div>

<h3><a name="LocalViewandLocalCache-ThePullPolicy"></a>The Pull Policy</h3>
<p>When using the <tt>Pull</tt> policy, the local cache get a notification about the change, and removes the stale object from the local cache (invalidate). The next time the client tries to read the object, it will be reloaded from the master space and stored in the local cache. </p>

<div class="indent20 inline" style="margin-left: 20px;"><style type="text/css">div.inline p:first-child { display: inline; }</style><p><img src="download/attachments/48235229/local_cache_pull.jpg" align="absmiddle" border="0"/></p></div>

<div class='panelMacro'><table class='infoMacro'><colgroup><col width='24'><col></colgroup><tr><td valign='top'><img src="images/icons/emoticons/information.gif" width="16" height="16" align="absmiddle" alt="" border="0"></td><td>This policy should be used for applications that perform more updates than reads, when it is important that updates don't overload the cache with constant updates and cache misses are acceptable.</td></tr></table></div>

<h2><a name="LocalViewandLocalCache-LocalCacheReadFlow"></a>Local Cache Read Flow</h2>

<p>A <tt>read</tt> operation performed on local cache in the following order:<br/>
1. The local cache is checked. <br/>
2. If the requested object is found in the local cache, it is returned back to the application.<br/>
3. If the requested object is not found in the local cache, the master space is queried. <br/>
4. If the object is found within the master space, the object is stored within the local cache and returned back to the application.</p>

<p>A <tt>readMultiple</tt> operation performed on local cache in the following order:<br/>
1. The local cache is checked. <br/>
2. If all the requested objects are found within the local cache (based on the amount of the <tt>max_objects</tt> parameter of the <tt>readMultiple</tt> call), they are returned back to the application.<br/>
3. If the amount of matching objects found within the local cache is smaller than the specified <tt>max_objects</tt>, the master space is queried. <br/>
4. All relevant matching object are stored into the local cache and returned back to the application.</p>

<p><img class="emoticon" src="images/icons/emoticons/warning.gif" height="16" width="16" align="absmiddle" alt="" border="0"/> To avoid a <tt>readMultiple</tt> call from the master space make sure you do not use <tt>Integer.MAX_VALUE</tt> as the <tt>max_objects</tt> value.</p>

<ul>
	<li><b>Transactional</b> operations are <b>always</b> executed on the master space.</li>
	<li><b>Blocking Read</b> - read with timeout first checks the local cache (without blocking - i.e. timeout=0), and if requested object is not found, the master space is checked.</li>
	<li><b>ReadModifiers</b> - {{ReadModifiers} such as DIRTY_READ or EXCLUSIVE_READ are ignored when using local cache.</li>
</ul>


<h2><a name="LocalViewandLocalCache-LocalCacheUpdate"></a>Local Cache Update</h2>

<p>Cached object updates are executed both on the master space and local cache.</p>

<div class='panelMacro'><table class='infoMacro'><colgroup><col width='24'><col></colgroup><tr><td valign='top'><img src="images/icons/emoticons/information.gif" width="16" height="16" align="absmiddle" alt="" border="0"></td><td> If application holds a reference to a cached object, the object is updated in the cache but it's reference is not updated. So it has to be refreshed by the application.</td></tr></table></div>

<ul>
	<li><b>Transactional</b> object update - updates the object in the master space. It also removes any old copy from the local cache. This is done to provide transactional consistency. Once a transaction is committed, the data is updated within the local cache according to the update policy.</li>
</ul>


<h2><a name="LocalViewandLocalCache-LocalCacheTake"></a>Local Cache Take</h2>

<p>Take is always executed on both the local space and the master space.</p>

<ul>
	<li><b>Blocking Take</b> - take with timeout&gt;0 will block until an object is available on the master space - just like regular take.</li>
</ul>


<h1><a name="LocalViewandLocalCache-ObjectReferenceStorageMode"></a>Object Reference Storage Mode</h1>
<p>Starting with XAP 7.0, the Space API local cache and local view have been modified to return a <b>reference to the space object</b> rather than returning a shallow copy (An object with a copy of the primitive fields and reference to the non-primitive fields) as performed with older versions. An <b>identical object reference</b> will be returned when conducting sub-subsequent read operation for the same object. </p>

<p>When using a local cache/view, a new object reference will be returned when:</p>
<ul class="alternate" type="square">
	<li>The object has been evicted and reloaded from the master space (relevant only for local cache).</li>
	<li>The object has been modified and an updated version has been sent from the master space via notification.</li>
</ul>


<p>This improvement means the read operations using the <tt>GigaSpace.readByID</tt> , <tt>GigaSpace.read</tt>, <tt>GigaSpace.readMultiple</tt> (using a limited max objects where all the objects cached), <tt>GSIterator</tt> - having a local cache/view running at the client side, will be very fast and would not involve <b>any new object generation</b>. </p>

<p>This behavior lowers the JVM garbage collection impact on the application. In addition, all read based operations have been improved to be non-lock calls. This lowers the contention on the system when having large amount of concurrent threads reading data from the local cache/view (ideal for a web applications).</p>

<div class='panelMacro'><table class='tipMacro'><colgroup><col width='24'><col></colgroup><tr><td valign='top'><img src="images/icons/emoticons/check.gif" width="16" height="16" align="absmiddle" alt="" border="0"></td><td>Tests of the <b>local cache</b> with XAP 7.0 having 10 client threads using a local cache resulted 20M read/sec using 8 cores box.</td></tr></table></div>

<p>To control object storage type use the following property use the following:</p>
<ul class="alternate" type="square">
	<li><tt>space-config.dist-cache.storage-type</tt> - (reference | shallowCopy ) - defines how local cache stores its data. Default is <tt>reference</tt>.</li>
</ul>


<div class='panelMacro'><table class='warningMacro'><colgroup><col width='24'><col></colgroup><tr><td valign='top'><img src="images/icons/emoticons/forbidden.gif" width="16" height="16" align="absmiddle" alt="" border="0"></td><td><b>Use Native Serialization mode</b><br/>
When running a local cache/view you should use <a href="Controlling Serialization.html" title="Controlling Serialization">Native Serialization</a> mode with the master space. Running in any other serialization mode might impact the speed of reading objects from the local cache/view and the client Memory utilization behavior. </td></tr></table></div>

<h1><a name="LocalViewandLocalCache-LocalCache%2FLocalViewDisconnection"></a>Local Cache / Local View Disconnection</h1>
<p>When a connection between client local cache/view and remote master space is disrupted, the local cache/view identifies this disconnection and tries to reconnect with the remote space. The Local cache/view tries to reconnect several times before it fails. There are 2 types disconnections:</p>
<ul>
	<li>Temporary disconnection - The local cache/view is reconnected successfully and client application can continue to run normally.  In such a case, the cached data is cleared. This avoids stale data in the cache. There will be some performance impact to allow the cache to reload its data after reconnection. In case of a local view the data is refreshed by reading the view data from the master space.</li>
	<li>Permanent disconnection (remote space is down) - The local/view cache becomes unusable. All data is cleared and further operations on the local cache/view are blocked.</li>
</ul>


<p>Properties to control the reconnection (can be set on the local cache/view bean configuration or via API call):</p>
<ul class="alternate" type="square">
	<li><tt>space-config.dist-cache.retry-connections</tt> - (a number) - defines how many times the local cache should retry to reconnect with the master space in case of a disconnection. Default is 3.</li>
	<li><tt>space-config.dist-cache.delay-between-retries</tt> -  (in milliseconds) - defines wait period between connection retries in case of a disconnection with the master space. Default is 5000 milliseconds.</li>
</ul>


<div class='panelMacro'><table class='infoMacro'><colgroup><col width='24'><col></colgroup><tr><td valign='top'><img src="images/icons/emoticons/information.gif" width="16" height="16" align="absmiddle" alt="" border="0"></td><td>While the reconnection process is in progress, the application can continue to use the data in the cache, but if an access to the remote space is needed (object update for example) and remote space is still not available, the operation will fail.</td></tr></table></div>

<p>Here is an example how to set these parameters with a local view:</p>
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-xml"><span class="code-tag">&lt;os-core:space id=<span class="code-quote">"space"</span> url=<span class="code-quote">"jini://*/*/space"</span> /&gt;</span>
<span class="code-tag">&lt;os-core:local-view id=<span class="code-quote">"localViewSpace"</span> space=<span class="code-quote">"space"</span>&gt;</span>
    <span class="code-tag">&lt;os-core:view-query where=<span class="code-quote">"processed = true"</span> class=<span class="code-quote">"com.example.Message"</span>/&gt;</span>
	<span class="code-tag">&lt;os-core:properties&gt;</span>
		<span class="code-tag">&lt;props&gt;</span>
		    <span class="code-tag">&lt;prop key=<span class="code-quote">"space-config.dist-cache.retry-connections"</span>&gt;</span>10<span class="code-tag">&lt;/prop&gt;</span>
		    <span class="code-tag">&lt;prop key=<span class="code-quote">"space-config.dist-cache.delay-between-retries"</span>&gt;</span>10000<span class="code-tag">&lt;/prop&gt;</span>
		<span class="code-tag">&lt;/props&gt;</span>
	    <span class="code-tag">&lt;/os-core:properties&gt;</span>
<span class="code-tag">&lt;/os-core:local-view&gt;</span>

<span class="code-tag">&lt;os-core:giga-space id=<span class="code-quote">"gigaSpace"</span> space=<span class="code-quote">"localViewSpace"</span>/&gt;</span></pre>
</div></div>

<h1><a name="LocalViewandLocalCache-LocalCache%2FViewConfigurationProperties"></a>Local Cache/View Configuration Properties</h1>

<h2><a name="LocalViewandLocalCache-LocalCacheOnly"></a>Local Cache Only</h2>
<table class='confluenceTable'><tbody>
<tr>
<th class='confluenceTh'> Property </th>
<th class='confluenceTh'> Description </th>
<th class='confluenceTh'> Default Value </th>
<th class='confluenceTh'> Unit </th>
</tr>
<tr>
<td class='confluenceTd'>space-config.dist-cache.update-mode </td>
<td class='confluenceTd'> Control the <a href="#LocalViewandLocalCache-LocalCacheUpdatePolicies">local cache update policy</a>. Relevant only for a local cache. Options: PULL = 1, PUSH = 2</td>
<td class='confluenceTd'> 1</td>
<td class='confluenceTd'>&nbsp;</td>
</tr>
<tr>
<td class='confluenceTd'>space-config.engine.cache_size</td>
<td class='confluenceTd'> Local cache maximum total number of objects.</td>
<td class='confluenceTd'> 5000000 </td>
<td class='confluenceTd'> Number of objects</td>
</tr>
<tr>
<td class='confluenceTd'>space-config.engine.memory_usage.high_watermark_percentage</td>
<td class='confluenceTd'> See the <a href="Memory Management Facilities.html#MemoryManagementFacilities-MemoryManagerParameters">Memory Management Facilities</a> for details.</td>
<td class='confluenceTd'> 95</td>
<td class='confluenceTd'>percentage</td>
</tr>
<tr>
<td class='confluenceTd'>space-config.engine.memory_usage.write_only_block_percentage</td>
<td class='confluenceTd'>See the <a href="Memory Management Facilities.html#MemoryManagementFacilities-MemoryManagerParameters">Memory Management Facilities</a> for details. </td>
<td class='confluenceTd'> 85</td>
<td class='confluenceTd'>percentage</td>
</tr>
<tr>
<td class='confluenceTd'>space-config.engine.memory_usage.write_only_check_percentage</td>
<td class='confluenceTd'>See the <a href="Memory Management Facilities.html#MemoryManagementFacilities-MemoryManagerParameters">Memory Management Facilities</a> for details. </td>
<td class='confluenceTd'> 76</td>
<td class='confluenceTd'>percentage</td>
</tr>
<tr>
<td class='confluenceTd'>space-config.engine.memory_usage.low_watermark_percentage</td>
<td class='confluenceTd'>See the <a href="Memory Management Facilities.html#MemoryManagementFacilities-MemoryManagerParameters">Memory Management Facilities</a> for details. </td>
<td class='confluenceTd'> 75 </td>
<td class='confluenceTd'> percentage</td>
</tr>
<tr>
<td class='confluenceTd'>space-config.engine.memory_usage.eviction_batch_size</td>
<td class='confluenceTd'>See the <a href="Memory Management Facilities.html#MemoryManagementFacilities-MemoryManagerParameters">Memory Management Facilities</a> for details. </td>
<td class='confluenceTd'> 500</td>
<td class='confluenceTd'> number of object</td>
</tr>
<tr>
<td class='confluenceTd'>space-config.engine.memory_usage.retry_yield_time</td>
<td class='confluenceTd'>See the <a href="Memory Management Facilities.html#MemoryManagementFacilities-MemoryManagerParameters">Memory Management Facilities</a> for details. </td>
<td class='confluenceTd'> 50</td>
<td class='confluenceTd'> milliseconds</td>
</tr>
<tr>
<td class='confluenceTd'>space-config.engine.memory_usage.retry_count</td>
<td class='confluenceTd'>See the <a href="Memory Management Facilities.html#MemoryManagementFacilities-MemoryManagerParameters">Memory Management Facilities</a> for details. </td>
<td class='confluenceTd'> 5</td>
<td class='confluenceTd'>&nbsp;</td>
</tr>
<tr>
<td class='confluenceTd'>space-config.engine.memory_usage.explicit-gc </td>
<td class='confluenceTd'>See the <a href="Memory Management Facilities.html#MemoryManagementFacilities-MemoryManagerParameters">Memory Management Facilities</a> for details. </td>
<td class='confluenceTd'> false</td>
<td class='confluenceTd'>&nbsp;</td>
</tr>
<tr>
<td class='confluenceTd'>space-config.dist-cache.events.batch.size </td>
<td class='confluenceTd'> Max batch size to use when updating the local cache</td>
<td class='confluenceTd'> 1000 </td>
<td class='confluenceTd'> objects</td>
</tr>
<tr>
<td class='confluenceTd'>space-config.dist-cache.events.batch.timeout </td>
<td class='confluenceTd'> Determines how frequent the local cache will be updated. Low number means high frequency.</td>
<td class='confluenceTd'> 100 </td>
<td class='confluenceTd'> milliseconds </td>
</tr>
<tr>
<td class='confluenceTd'>space-config.dist-cache.eviction-strategy </td>
<td class='confluenceTd'> Supported only with local cache used with the <a href="The GigaMap Interface.html" title="The GigaMap Interface">GigaMap API</a>.</td>
<td class='confluenceTd'> com.j_spaces.map.eviction.FIFOEvictionStrategy </td>
<td class='confluenceTd'>&nbsp;</td>
</tr>
</tbody></table>

<h2><a name="LocalViewandLocalCache-LocalCache%2FView"></a>Local Cache/View </h2>
<table class='confluenceTable'><tbody>
<tr>
<th class='confluenceTh'> Property </th>
<th class='confluenceTh'> Description </th>
<th class='confluenceTh'> Default Value </th>
<th class='confluenceTh'> Unit </th>
</tr>
<tr>
<td class='confluenceTd'>space-config.dist-cache.retry-connections</td>
<td class='confluenceTd'> Specify how many times the local cache should retry to reconnect with the master space in case of a disconnection.</td>
<td class='confluenceTd'> 3 </td>
<td class='confluenceTd'>&nbsp;</td>
</tr>
<tr>
<td class='confluenceTd'>space-config.dist-cache.delay-between-retries </td>
<td class='confluenceTd'> Specify wait period between connection retries in case of a disconnection with the master space. </td>
<td class='confluenceTd'> 5000 </td>
<td class='confluenceTd'> milliseconds </td>
</tr>
<tr>
<td class='confluenceTd'>space-config.dist-cache.events.enabled </td>
<td class='confluenceTd'> Boolean value. Set this property of <tt>true</tt> to turn on local cache/view automatic updates streaming from the master space</td>
<td class='confluenceTd'> true</td>
<td class='confluenceTd'>&nbsp;</td>
</tr>
<tr>
<td class='confluenceTd'>space-config.dist-cache.events.lease </td>
<td class='confluenceTd'> Local/Cache View lease duration.</td>
<td class='confluenceTd'> 60000</td>
<td class='confluenceTd'> milliseconds </td>
</tr>
<tr>
<td class='confluenceTd'>space-config.dist-cache.events.lease-renew.expiration </td>
<td class='confluenceTd'> Lease renewal expiration time</td>
<td class='confluenceTd'> 9223372036854775807</td>
<td class='confluenceTd'>milliseconds </td>
</tr>
<tr>
<td class='confluenceTd'>space-config.dist-cache.events.lease-renew.duration </td>
<td class='confluenceTd'> Lease renewal duration</td>
<td class='confluenceTd'> 60000 </td>
<td class='confluenceTd'>milliseconds </td>
</tr>
<tr>
<td class='confluenceTd'>space-config.dist-cache.events.lease-renew.round-trip-time </td>
<td class='confluenceTd'> Lease renewal round trip time </td>
<td class='confluenceTd'> 10000</td>
<td class='confluenceTd'>milliseconds </td>
</tr>
<tr>
<td class='confluenceTd'>space-config.dist-cache.storage-type</td>
<td class='confluenceTd'> Specify <a href="#LocalViewandLocalCache-ObjectReferenceStorageMode">how local cache/view stores its data</a>. Options: <b>reference</b> or <b>shallowCopy</b></td>
<td class='confluenceTd'> reference </td>
<td class='confluenceTd'>&nbsp;</td>
</tr>
</tbody></table>

<div class='panelMacro'><table class='tipMacro'><colgroup><col width='24'><col></colgroup><tr><td valign='top'><img src="images/icons/emoticons/check.gif" width="16" height="16" align="absmiddle" alt="" border="0"></td><td>Starting with XAP 8, the local view lease renew settings and notify batch settings are using the same parameters the local cache is using.</td></tr></table></div> 

                     </td>
</tr>
</table>
<table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr>
<td height="12" background="http://www.gigaspaces.com/wiki/images/border/border_bottom.gif"><img src="images/border/spacer.gif" width="1" height="1" border="0"/></td>
</tr>
<tr>
<td align="center"><font color="grey"><a href="http://www.gigaspaces.com">GigaSpaces.com</a> -
		<a href="http://www.gigaspaces.com/wiki/x/xwBmAg" class="smalltext">Legal Notice</a> -
		<a href="http://www.gigaspaces.com/wiki/x/xgBmAg" class="smalltext">3rd Party Licenses</a> -
		<a href="http://www.gigaspaces.com/wiki/x/BQFmAg" class="smalltext">Site Map</a> -
		<a href="http://www.gigaspaces.com/wiki/display/API/API+Documentation+Portal" class="version-link">API Docs</a> -
		<a href="http://forum.openspaces.org/forum.jspa?forumID=175" class="version-link">Forum</a> -
		<a href="http://www.gigaspaces.com/LatestProductVersion" class="version-link">Downloads</a> -
		<a href="http://blog.gigaspaces.com/" class="version-link">Blog</a> -
		<a href="http://www.gigaspaces.com/os_papers.html" class="version-link">White Papers</a> -
		<a href="mailto:techw@gigaspaces.com">Contact Tech Writing</a> -
		<i><a href="http://www.atlassian.com/software/confluence">Gen. by Atlassian Confluence</a></i></font></td>
</tr>
</table>
     </body>
</html>
