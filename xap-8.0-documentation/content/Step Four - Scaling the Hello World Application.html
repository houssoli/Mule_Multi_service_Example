<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
     <head>
         <title>XAP 8.0 Documentation : Step Four - Scaling the Hello World Application</title>
<link rel="stylesheet" href="styles/site.css" type="text/css" />
         <META http-equiv="Content-Type" content="text/html; charset=UTF-8">
		 <style>
.back-to {
	color: #666666;
	font-weight: bold;
}	 
a.back-to:link, a.back-to:visited, a.back-to:hover, a.back-to:active  {
	color: #666666;
}	 
		 </style>
     </head>

     <body>
<table class="pagecontent" border="0" cellpadding="0" cellspacing="0" width="100%" bgcolor="#ffffff">
<tr>
<td valign="top" class="pagebody">
<div class="pageheader">
<span class="back-to">XAP 8.0 Documentation > <a href="index.html">Back to Table of Contents</a></span><br>
<h1>Step Four - Scaling the Hello World Application</h1>
</div>
<br>

<script type='text/javascript'>//<![CDATA[
function debug() { }
// ]]></script><script type='text/javascript' src='/wiki/download/resources/net.customware.confluence.plugin.composition:composition-setup/js/browser.js'>//<![CDATA[
// ]]></script><script type='text/javascript' src='/wiki/download/resources/net.customware.confluence.plugin.composition:composition-setup/js/behaviour.js'>//<![CDATA[
// ]]></script><script type='text/javascript' src='/wiki/download/resources/net.customware.confluence.plugin.composition:composition-setup/js/memory.js'>//<![CDATA[
// ]]></script><script type='text/javascript' src='/wiki/download/resources/net.customware.confluence.plugin.composition:composition-setup/js/cloak.js'>//<![CDATA[
// ]]></script><script type='text/javascript'>//<![CDATA[
Cloak.closeHTML = "<img src=\'/wiki/download/resources/net.customware.confluence.plugin.composition:toggle-cloak/img/navigate_down_10.gif\'/>";
Cloak.openHTML = "<img src=\'/wiki/download/resources/net.customware.confluence.plugin.composition:toggle-cloak/img/navigate_right_10.gif\'/>";
Cloak.toggleZone = true;
Cloak.memoryDuration = 0;
Cloak.memoryPrefix = "contentId:53903680";
Cloak.memoryPath = "/wiki/";
// ]]></script><style type='text/css'>
.cloakToggle { /* Definition for state toggling image */
cursor:hand;
cursor:pointer;
}
</style><script type='text/javascript' src='/wiki/download/resources/net.customware.confluence.plugin.composition:composition-setup/js/transitions.js'>//<![CDATA[
// ]]></script><script type='text/javascript' src='/wiki/download/resources/net.customware.confluence.plugin.composition:composition-setup/js/deck.js'>//<![CDATA[
// ]]></script><link rel='stylesheet' type='text/css'  href='/wiki/styles/main-action.css?pluginCompleteKey=net.customware.confluence.plugin.composition:composition-setup&stylesheetName=deck&spaceKey=XAP8'/><script type='text/javascript'>//<![CDATA[
Deck.memoryDuration = 0;
Deck.memoryPrefix = "contentId:53903680";
Deck.memoryPath = "/wiki/";
// ]]></script>

<script language="JavaScript">
<!--
// Get all div elemnts inside an array
var elements = document.getElementsByTagName('div');
i = 0 ;
var singleDiv = elements[i];
// Loop through the array and unhide every div element with name equals...
while( singleDiv != null )
{ 
	if (singleDiv.getAttribute('name') == "showForVariantjava")
	{
		singleDiv.style.display = 'block';
	}
	singleDiv = elements[i++];
}
-->
</script>

<script language="JavaScript">
<!--
// Get all div elemnts inside an array
var elements = document.getElementsByTagName('div');
i = 0 ;
var singleDiv = elements[i];
// Loop through the array and unhide every div element with name equals...
while( singleDiv != null )
{ 
	if (singleDiv.getAttribute('name') == "showForVariantjdk15")
	{
		singleDiv.style.display = 'block';
	}
	singleDiv = elements[i++];
}
-->
</script>



<p><b>Tutorial summary</b>: Learn how to scale the Hello World Application. <sub>Approx 10 min</sub> </p>


<h2><a name="StepFour-ScalingtheHelloWorldApplication-Overview"></a>Overview</h2>



<p><img src="download/attachments/17301573/folder_icon.gif" align="absmiddle" border="0"/> Example Folder - &lt;GigaSpaces Root&gt;\examples\helloworld<br/>
<img class="emoticon" src="images/icons/emoticons/check.gif" height="16" width="16" align="absmiddle" alt="" border="0"/> Features Introduced - Scaling, Partitioning, Routing, Routing Index.
<br clear="all" /></p>
<hr 
 size="1" 
 color="C9C9C9" 
 >




<h4><a name="StepFour-ScalingtheHelloWorldApplication-Beforeyoubegin"></a>Before you begin</h4>
<p>We recommend that you go through the following steps before starting this tutorial:</p>
<ol>
	<li><a href="Setting Up your IDE to work with GigaSpaces.html" title="Setting Up your IDE to work with GigaSpaces">Download GigaSpaces and Set Up Your Development Environment</a> to work with GigaSpaces - this is needed for running the tutorial sample application.</li>
	<li><a href="Step One - Using Processing Units for Scaling.html" title="Step One - Using Processing Units for Scaling">Step One - Using Processing Units for Scaling</a> - a short introduction to what a Processing Unit is - <b>Recommended</b>.</li>
	<li><a href="Step Two - Creating the Hello World Application.html" title="Step Two - Creating the Hello World Application">Step Two - Creating the Hello World Application</a> - create and run a Processing Unit.</li>
	<li><a href="Step Three - Deploying onto the Service Grid.html" title="Step Three - Deploying onto the Service Grid">Step Three - Deploying the Hello World onto the Service Grid</a> - deploy the Processing Unit onto the Service Grid and monitor it at runtime.
<br clear="all" /></li>
</ol>


<hr 
 size="1" 
 color="C9C9C9" 
 >



<h4><a name="StepFour-ScalingtheHelloWorldApplication-Goals"></a>Goals</h4>
<p>Scale the Hello World application</p>



<h4><a name="StepFour-ScalingtheHelloWorldApplication-Steps"></a>Steps</h4>
<ol>
	<li><a href="#StepFour-ScalingtheHelloWorldApplication-Scaling">Understanding Scaling using Data Partitioning and Routing</a></li>
	<li><a href="#StepFour-ScalingtheHelloWorldApplication-StartServiceGrid">Starting the Service Grid Components</a></li>
	<li><a href="#StepFour-ScalingtheHelloWorldApplication-ConfigureScale3andBuild">Configuring the application to be partitioned over 3 instances</a></li>
	<li><a href="#StepFour-ScalingtheHelloWorldApplication-Deploy3">Deploying the partitioned application</a>
</li>
	<li><a href="#StepFour-ScalingtheHelloWorldApplication-Output3">Expected output</a></li>
	<li><a href="#StepFour-ScalingtheHelloWorldApplication-Undeploy">Undeploying the 3-Instance Deployment</a></li>
	<li><a href="#StepFour-ScalingtheHelloWorldApplication-ConfigureScale2backupandBuild">Configuring scaling to be partitioned over 2 instances, with 1 backup each</a></li>
	<li><a href="#StepFour-ScalingtheHelloWorldApplication-Deploy2withbackup">Deploying the partitioned application</a></li>
	<li><a href="#StepFour-ScalingtheHelloWorldApplication-Output3">Expected output</a></li>
	<li><a href="#StepFour-ScalingtheHelloWorldApplication-TestFailover">Testing Failover Recovery and Self-Healing</a>
<br clear="all" />
<br clear="all" /></li>
</ol>



<hr 
 size="1" 
 color="C9C9C9" 
 >
<table class="sectionMacro" border="0" cellpadding="5" cellspacing="0" width="100%"><tbody><tr>
<td class="confluenceTd"  valign="top" width="40%">
<h4><a name="StepFour-ScalingtheHelloWorldApplication-ApplicationComponents"></a>Application Components</h4>
<p>The Processing Unit we deploy onto the Service Grid is our Hello World Processor application from the <a href="Writing Your First XTP Application.html" title="Writing Your First XTP Application">previous steps</a>. Reminder - a feeder application writes each Message object to the processor Processing Unit, which is in turn processed by the Processor class.
<br clear="all" />
<br clear="all" /></p>
<div class="" align='center'>
<p><img src="download/attachments/48235229/Application Components.jpg" align="absmiddle" border="0"/><br/>
<sub><b>Figure 1. The Hello World Feeder and Processor Processing Units</b></sub></p></div>

</td>
<td class="confluenceTd"  valign="top" width="40%">
<h4><a name="StepFour-ScalingtheHelloWorldApplication-Infrastructure%28ServiceGrid%29Components"></a>Infrastructure (Service Grid) Components </h4>
<p>The <em>Service Grid</em> is a set of containers (<em>Grid Service Containers</em> - GSCs) managed by one or more a managers (<em>Grid Service Managers</em> - GSMs).<br/>
Each Grid Service Container runs inside its own JVM. The containers themselves host <em>Processing Units</em>.<br/>
The Grid Service Manager manages the deployment of processing units and their provisioning to the the Grid Service Containers. In production scenarios you may want to have more than one manager, so it does not become a single point of failure. <br/>
The <em>GigaSpaces Management Center</em> is the graphical user interface for administrating and monitoring the <em>Service Grid</em> and the deployed applications.
<br clear="all" />
<br clear="all" /></p>
<div class="" align='center'>
<p><img src="download/attachments/48235229/Infra Components.jpg" align="absmiddle" border="0"/><br/>
<b><sub>Figure 2. A Service Grid consisting of a Grid Manager and two Grid Containers</sub></b></p></div>
</td>
<p><br clear="all" />
<br clear="all" /></p></tr></tbody></table>

<h4><a name="StepFour-ScalingtheHelloWorldApplication-ScaledOutDeploymentLayout"></a>Scaled-Out Deployment Layout</h4>
<p>In this tutorial we scale the Hello World Processor we created in the the <a href="Writing Your First XTP Application.html" title="Writing Your First XTP Application">previous steps</a>.<br/>
First we scale it to 3 instances (Figure 3), and then into 4 instances, divided into two primary instances and two backup instances (Figure 4).</p>
<table class="sectionMacro" border="0" cellpadding="5" cellspacing="0" width="100%"><tbody><tr>
<td class="confluenceTd"  valign="top" width="40%">
<div class="" align='center'>
<p><img src="download/attachments/48235229/QSG4 Scaled 3.jpg" align="absmiddle" border="0"/><br/>
<sub><b>Figure 3. Scaling out to 3 instances</b></sub> </p></div>
</td>
<td class="confluenceTd"  valign="top" width="40%">
<div class="" align='center'>
<p><img src="download/attachments/48235229/QSG4 Scaled 2 backup.jpg" align="absmiddle" border="0"/><br/>
<sub><b>Figure 4. Scaling out to 2 primaries and 2 backups</b></sub> </p></div>
</td></tr></tbody></table>
<p><br clear="all" />
<br clear="all" /></p>

<p><img src="download/attachments/17301573/Jump arrow green.bmp" align="absmiddle" border="0"/> <font color="green"><b>Jump</b></font> ahead and <a href="#StepFour-ScalingtheHelloWorldApplication-DeployandRun">run the sample application</a>, in case you want to see the final result of the tutorial before we begin.
<br clear="all" />
<br clear="all" /></p>

<p><a name="StepFour-ScalingtheHelloWorldApplication-Scaling"></a></p>
<h2><a name="StepFour-ScalingtheHelloWorldApplication-UnderstandingtheConceptofScaling%2CusingRoutingandPartitions"></a>Understanding the Concept of Scaling, using Routing and Partitions</h2>
<h4><a name="StepFour-ScalingtheHelloWorldApplication-Scalability"></a>Scalability</h4>
<p><b>Scalability</b> is the ability to <ins>grow your application</ins> - i.e. increase its throughput, <ins>without changing code</ins>, and <ins>without sacrificing service levels (latency)</ins>.</p>

<p><b>Linear scalability</b> is the ability to grow as much as needed at fixed hardware/software unit per capacity unit: Adding X hardware unit = getting additional X throughput (again, without sacrificing service levels)- see Figure 5. </p>

<p><font color="#ffffff">blank-line</font></p>
<p><img src="download/attachments/48235229/Linear Scalibility.jpg" align="absmiddle" border="0"/></p>
<div class="" align='center'><sub><b>Figure 5. Linear vs. Non-linear Scalability</b></sub></div>


<h4><a name="StepFour-ScalingtheHelloWorldApplication-ScalingUsingProcessingUnits"></a>Scaling Using Processing Units</h4>
<p>When your application is modeled as a Processing Unit, scaling it is as simple as adding more Processing Unit instances. Since processing units are self sufficient in the sense that they do not depend on any external component, this means that by increasing the number of Processing Unit instances that are used to by your application, you linearly (and of course predictably) increase its throughput. For example, if 2 Processing Unit instances can process 10K operations per second, 3 instances will process 15K, 4 instances 20K, and so on - see Figure 6.  </p>

<div class="" align='center'>
<p><img src="download/attachments/48235229/Partition on machines.jpg" align="absmiddle" border="0"/><br/>
<sub><b>Figure 6. N machines hosting N Grid Service Containers: each Container runs a Processing Unit</b></sub>.</p></div>


<h4><a name="StepFour-ScalingtheHelloWorldApplication-PartitioningandRouting"></a>Partitioning and Routing</h4>
<p>As mentioned earlier, scaling is done by making sure each Processing Unit instance runs independently of the other instances (you may recall the car wash analogy from <a href="Step One - Using Processing Units for Scaling.html" title="Step One - Using Processing Units for Scaling">step one of this tutorial</a>. This is done by making sure that the data that is needed to perform a certain business operation, resides in the same Processing Unit instance that does the actual processing (this is called data affinity). This in turn guarantees two things - latency is kept at a fixed minimum, and is not related to the number of processing unit instances that are used by the application. <br/>
This is achieved by dividing the application data into partitions (each partition resides on a separate Processing Unit instance, in the form of a space), and intelligently distributing the data to these partitions. The business logic services deployed on each instance, operate only on the partition local to them, i.e. the one collocated in the same Processing Unit instance. This ensures extremely low latency, because data is kept in memory. It also ensures linear scalability when increasing the number of Processing Unit instances - see Figure 7 below. </p>

<div class="" align='center'>
<p><img src="download/attachments/48235229/Partition.jpg" align="absmiddle" border="0"/><br/>
<sub><b>Figure 7. 3 Processing Unit instances: each holds a different subset of the data, marked with different colors.</b></sub><br/>
<sub><b>A client connecting to this system, views the space partitions in all of these instances, as a single virtual resource.</b></sub></p></div>


<p><font color="#ffffff">blank-line</font></p>
<p><b>Routing</b> - Partitioning is implemented using a hash-based data routing mechanism. Each Processing Unit is running a separate partition. When a client interacts with the space cluster (reads or writes data), it is routed transparently to the correct partition. The routing mechanism is applied transparently on the client side by the space proxy.</p>
<div class="" align='center'>
<p><img src="download/attachments/48235229/Routing Client.jpg" align="absmiddle" border="0"/><br/>
<sub><b>Figure 8. Partitioning is implemented using a hash-based routing mechanism. Each object is transparently routed to the correct partition by the client side proxy</b>.</sub> </p></div>


<p><font color="#ffffff">blank-line</font></p>
<p><b>Routing Index</b> - When writing an object to a cluster of Processing Units which contains multiple partitions, the routing of that object to a specific partition, is calculated based on the value of one of the object's properties. This property is designated using the <tt>@SpaceRouting</tt> annotation, and is referred to as the <b>Routing Index</b>.</p>

<div class='panelMacro'><table class='tipMacro'><colgroup><col width='24'><col></colgroup><tr><td valign='top'><img src="images/icons/emoticons/check.gif" width="16" height="16" align="absmiddle" alt="" border="0"></td><td>For details about scaling a running space cluster <b>in runtime</b> see the <a href="http://www.gigaspaces.com/wiki/display/SBP/Moving+into+Production+Checklist#MovingintoProductionChecklist-RebalancingDynamicRepartitioning">Dynamic Partitioning</a> section. </td></tr></table></div>


<p><a name="StepFour-ScalingtheHelloWorldApplication-Walkthrough"></a></p>

<h2><a name="StepFour-ScalingtheHelloWorldApplication-WalkthroughtheRoutingIndexappliedtotheMessageObject"></a>Walkthrough - the Routing Index applied to the Message Object</h2>

<p>As you may recall from <a href="Step Two - Creating the Hello World Application.html" title="Step Two - Creating the Hello World Application">step 2 of this tutorial</a>, the @SpaceRouting annotation decorates the getId() method of the Message object. This designates the <em>id</em> as the <b>Routing Index</b> of the Message object. It means that when a Message object is written to the partitioned space, the return value of this method determines the partition to which the Message is written. The calculation is very simple: the hashCode() method of the return value is called, and the result is used in a modulus calculation with the number of partitions. For example, if the result of the hashCode() method call is 30, and the number of partitions is 3, then 30%3 = 0, meaning the object will be sent to the first partition. </p>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">@SpaceRouting
<span class="code-keyword">public</span> <span class="code-object">Integer</span> getId() {
    <span class="code-keyword">return</span> id;
}</pre>
</div></div>
<p><sub><b>Designating the Id property as the routing index for the Message object by annotating its getter method with the @SpaceRouting annotation (Message.java)</b>.</sub></p>

<h4><a name="StepFour-ScalingtheHelloWorldApplication-Let%27sScaleourApplication%21"></a>Let's Scale our Application!</h4>
<p>Next, we show you how to start the service grid components, by starting a grid service manager and a grid service container on each of your machines. We then deploy the processing unit with multiple instances.
<br clear="all" />
<br clear="all" /></p>

<p><a name="StepFour-ScalingtheHelloWorldApplication-DeployandRun"></a></p>
<h2><a name="StepFour-ScalingtheHelloWorldApplication-StartingtheServiceGridComponentsandScalingtheApplication"></a>Starting the Service Grid Components and Scaling the Application</h2>
<p><img src="download/attachments/17301573/Play arrow green.bmp" align="absmiddle" border="0"/> <b>Steps to deploy the application:</b></p>

<p><b>Install GigaSpaces</b></p>

<p><img class="emoticon" src="images/icons/emoticons/warning.gif" height="16" width="16" align="absmiddle" alt="" border="0"/> After going through the previous tutorial <a href="Step Two - Creating the Hello World Application.html" title="Step Two - Creating the Hello World Application">Step Two &#45; Creating the Hello World Application</a>, you should have GigaSpaces installed and the Hello World sample application environment set. If not, please <a href="Setting Up your IDE to work with GigaSpaces.html" title="Setting Up your IDE to work with GigaSpaces">download GigaSpaces and set up your development environment</a> to work with GigaSpaces - this is needed to run the tutorial sample application.</p>

<p><a name="StepFour-ScalingtheHelloWorldApplication-StartServiceGrid"></a></p>
<h4><a name="StepFour-ScalingtheHelloWorldApplication-StartingtheServiceGridComponents"></a>Starting the Service Grid Components </h4>

<ol>
	<li>Start <b>GigaSpaces Management Center (GS-UI)</b> by running <tt>&lt;GigaSpaces Root&gt;/bin/gs-ui.bat(.sh)</tt>.</li>
	<li>Start a <b>GigaSpaces Agent (GSA)</b> by running <tt>&lt;GigaSpaces Root&gt;/bin/gs-agent.(sh/bat)</tt>.<br/>
The GSA, by default, will start 2 local Grid Service Containers, and manage a global Grid Service Manager and a global Lookup Service.<br/>
<span id='tgl_content_AGENT' class='cloakToggle'></span> What is a GigaSpaces Agent...


<div class="panel" style="background-color: white;border-style: solid;border-width: 1px;"><div class="panelContent" style="background-color: white;">
<p><font color="#ffffff">blank-line</font></p>
<p><b>The GigaSpaces Agent</b></p>

<p><font color="#ffffff">blank-line</font></p>
<p><a href="The GigaSpaces Agent.html" title="The GigaSpaces Agent">The GigaSpaces Agent (GSA)</a> acts as a process manager that can spawn and manage Service Grid processes (Operating System level processes) such as the Grid Service Manager (aka <a href="The GigaSpaces Manager.html" title="The GigaSpaces Manager">The GigaSpaces Manager</a>), the Grid Service Container (aka <a href="The GigaSpaces Container.html" title="The GigaSpaces Container">The GigaSpaces Container</a>), and Lookup Service.</p>

<p><font color="#ffffff">blank-line</font></p>
<p><span id='tgl_content_AGENT' class='cloakToggle'></span> <ins>Hide details</ins></p>

<p><font color="#ffffff">blank-line</font></p>
</div></div>


<p>A new Grid Service Manager starts on your local machine, and its output can be viewed by clicking its name <b>gsm-1</b> inside the <b>Hosts</b> tab.<br/>
A new Grid Service Containers start on your local machine, and its output can be viewed by clicking their names <b>gsc-1</b>/<b>gsc-2</b> inside the <b>Hosts</b> tab.<br/>
The Grid Service Manger automatically detects the Grid Service Containers. Now we have a Service Grid with one manager and two containers up and running!</p></li>
	<li>Start <ins>one more</ins> local <b>Grid Service Container</b>, by rigt-clicking <b>gsa-1</b> in the <b>Hosts</b> tab and selecting <b>Start GSC</b>.<br/>
The Service Grid now has 3 <b>Grid Service Containers</b>.</li>
</ol>


<p><sub>(The Service Grid Components started here are <em>local</em> services, all running on your own machine. Naturally, in a production environment, you start them on separate machines, using the startup scripts that the product provides.)</sub></p>


<p><font color="#ffffff">blank-line</font></p>
<h4><a name="StepFour-ScalingtheHelloWorldApplication-Deployingwith3ProcessingUnitInstances"></a>Deploying with 3 Processing Unit Instances </h4>
<p><a name="StepFour-ScalingtheHelloWorldApplication-ConfigureScale3andBuild"></a> <b>Configuring the application to be partitioned over 3 instances</b></p>

<ol>
	<li>Edit the processor's  <b>pu.xml</b> configuration file located under <tt>&lt;GigaSpaces root&gt;/examples/helloworld/processor/src/META-INF/spring</tt> folder.</li>
	<li>Uncomment, or add the following SLA bean definition, which contains the deployment configuration, to the <b>pu.xml</b> file:
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-xml">&lt;os-sla:sla 
	cluster-schema=<span class="code-quote">"partitioned-sync2backup"</span>
	number-of-instances=<span class="code-quote">"3"</span>	
	max-instances-per-vm=<span class="code-quote">"1"</span>&gt;
<span class="code-tag">&lt;/os-sla:sla&gt;</span></pre>
</div></div></li>
	<li>Build the processor Processing Unit by running <tt>&lt;Example Root&gt;/build.bat(.sh) dist</tt>.<br/>
This compiles the processor into a JAR file, ready for deployment located under <tt>&lt;Example Root&gt;/Processor/PU/hello-processor.jar</tt>.</li>
</ol>


<p><a name="StepFour-ScalingtheHelloWorldApplication-Deploy3"></a> <br/>
<b>Deploy the Hello World Processor as a partition of 3 instances</b></p>
<ol>
	<li>Click the <b>Deploy Processing Unit Button</b> <img src="download/attachments/17301573/deploy_processing_unit_button.jpg" align="absmiddle" border="0"/> to open the <b>Deployment Wizard</b> dialog.</li>
	<li>Click the <b>Processing Unit</b> field <b>...</b> button to browse for the processing unit JAR file.</li>
	<li>Browse to the <b>hello-processor.jar</b> JAR file, located at <tt>&lt;Example Root&gt;/Processor/PU</tt> folder and select it.</li>
	<li>Click the <b>Deploy</b> button, to deploy and wait for the processing unit instances to be provisioned to the running Grid Service Containers.</li>
</ol>



<p><font color="#ffffff">blank-line</font></p>
<h4><a name="StepFour-ScalingtheHelloWorldApplication-RunningtheFeeder"></a>Running the Feeder</h4>

<ol>
	<li>Start the feeder by running <tt>&lt;Example root&gt;/build.bat(.sh) run-feeder</tt></li>
</ol>


<p>
<p><font color="#ffffff">blank-line</font></p><a name="StepFour-ScalingtheHelloWorldApplication-Output3"></a></p>

<h4><a name="StepFour-ScalingtheHelloWorldApplication-Expectedoutput"></a>Expected output </h4>
<p>Our Service Grid consists of 3 Grid Service Containers(GSCs). The brackets contain the process id of the gsc, Each gsc contains a Processing Unit instance that stores and processes one third of the objects. The <b>gsc-1</b>,<b>gsc-2</b> and <b>gsc-5</b> in the <b>Hosts</b> tab in Figure 9 below show the output of each Processing Unit instance. Select one of them to see its expected output.</p>

<p><img src="download/attachments/48235229/gsc-output.jpg" align="absmiddle" border="0"/></p>
<div class="" align='center'><sub><b>Figure 9. Service Grid with 3 Grid Service Containers.</sub></b></div>


<hr 
 size="1" 
 color="C9C9C9" 
 >
<p><a name="StepFour-ScalingtheHelloWorldApplication-Undeploy"></a></p>
<h4><a name="StepFour-ScalingtheHelloWorldApplication-Undeployingthe3InstanceDeployment"></a>Undeploying the 3-Instance Deployment</h4>
<p>Before deploying the application with a backup, we first undeploy the currently running configuration:</p>
<ol>
	<li>In the <b>Deployed Processing Unit*tab, under the *Processing Units</b> tree, right click the <b>hello-processor</b> deployment and click <b>Undeploy</b>.</li>
	<li>Click <b>Yes</b> to approve.</li>
</ol>


<hr 
 size="1" 
 color="C9C9C9" 
 >

<h4><a name="StepFour-ScalingtheHelloWorldApplication-Deployingwith2Primaryand2BackupInstances"></a>Deploying with 2 Primary and 2 Backup Instances</h4>
<p><a name="StepFour-ScalingtheHelloWorldApplication-ConfigureScale2backupandBuild"></a> <br/>
<b>Configuring scaling to be partitioned over 2 instances, with 1 backup each</b></p>

<ol>
	<li>Edit the processor's  <b>pu.xml</b> configuration file located under <tt>&lt;GigaSpaces root&gt;/examples/helloworld/processor/src/META-INF/spring</tt> folder.</li>
	<li>Uncomment, or add the following SLA bean definition, which contains the deployment configuration, to the <b>pu.xml</b> file (the number-of-backups sets the number of backups <ins>per instance</ins>):
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-xml">&lt;os-sla:sla 
	cluster-schema=<span class="code-quote">"partitioned-sync2backup"</span>
	number-of-instances=<span class="code-quote">"2"</span>
	number-of-backups=<span class="code-quote">"1"</span>
	max-instances-per-vm=<span class="code-quote">"1"</span>&gt;
<span class="code-tag">&lt;/os-sla:sla&gt;</span></pre>
</div></div></li>
	<li>Build the processor Processing Unit by running <tt>&lt;Example Root&gt;/build.bat(.sh) dist</tt>.<br/>
This compiles the processor into a JAR file, ready for deployment located under <tt>&lt;Example Root&gt;/Processor/PU/hello-processor.jar</tt>.</li>
</ol>


<p><a name="StepFour-ScalingtheHelloWorldApplication-Deploy2withbackup"></a> <br/>
<b>Deploy the Hello World Processor with 2 Primary and 2 Backup Instances</b></p>
<ol>
	<li>Start <ins>one more</ins> local <b>Grid Service Containers</b>, by right-clicking <b>gsa-1</b> in the <b>Hosts</b> tab and selecting <b>Start GSC</b>. The Service Grid should now have 4 Grid Service Containers.</li>
	<li>Click the <b>Deploy Processing Unit Button</b> <img src="download/attachments/17301573/deploy_processing_unit_button.jpg" align="absmiddle" border="0"/> to open the <b>Deployment Wizard</b> dialog.</li>
	<li>Click the <b>Processing Unit</b> field <b>...</b> button to browse for the processing unit JAR file.</li>
	<li>Browse to the <b>hello-processor.jar</b> JAR file located at <tt>&lt;Example Root&gt;/Processor/PU</tt> folder and select it.</li>
	<li>Click the <b>Deploy</b> button, to deploy and wait for the processing unit instances to be provisioned to the running Grid Service Containers.</li>
</ol>



<p><font color="#ffffff">blank-line</font></p>
<h4><a name="StepFour-ScalingtheHelloWorldApplication-RunningtheFeeder"></a>Running the Feeder</h4>

<ol>
	<li>Start the feeder by running <tt>&lt;Example root&gt;/build.bat(.sh) run-feeder</tt>.</li>
</ol>



<p><font color="#ffffff">blank-line</font></p>
<h4><a name="StepFour-ScalingtheHelloWorldApplication-ExpectedOutputforthe2Primaryand2BackupInstancesDeployment"></a>Expected Output for the 2 Primary and 2 Backup Instances Deployment</h4>
<p>Our Service Grid consists of 4 Grid Service Containers. When deploying the application, 2 primary instances and 2 backup instances (a total of 4 instances) are automatically provisioned among the 4 available Grid Service Containers. <br/>
The naming convention used for such deployments is: &lt;<em>Processing unit name</em>&gt;.PU.&lt;<em>partition ID</em>&gt; [<em>&lt;backup ID&gt;</em> (if relevant)]. Since the mode of a certain Processing Unit instance can change over time, you can determine whether it's actually in primary or backup mode by checking the mode of the space contained in it. This can be done by clicking the <b>+</b> sign to the left of the Processing Unit name, to view the space inside it.  The icon <img src="download/attachments/17301573/space_primary2.gif" align="absmiddle" border="0"/> represents a space in primary mode, and the icon <img src="download/attachments/17301573/space_backup3.gif" align="absmiddle" border="0"/> represents a space in backup mode. When a Processing Unit instance contains an embedded space, its mode (primary/backup) is determined by that of the space. <br/>
In the <b>GSC</b> and <b>GSC-1</b> tabs in the UI, you can see the Grid Service Containers hosting the primary Processing Units instances. We can see their outputs: each one processes its own subset of the objects.<br/>
<img src="download/attachments/48235229/output 2.jpg" align="absmiddle" border="0"/></p>
<div class="" align='center'><sub><b>Figure 10. Expected Output for the 2 Primary and 2 Backup Instances Deployment.</b></sub></div>


<p><a name="StepFour-ScalingtheHelloWorldApplication-TestFailover"></a></p>

<p><font color="#ffffff">blank-line</font></p>
<h4><a name="StepFour-ScalingtheHelloWorldApplication-TestingFailoverandSelfHealing"></a>Testing Failover and Self-Healing</h4>
<p>To test failover, you manually shutdown one of the Grid Service Containers that runs a primary instance. This simulates a failure in the system:</p>
<ol>
	<li>To see the failover process in ation, prepare to click the <b>Hosts</b> root inside the <b>Hosts</b> tab after doing the following action: Locate one of the <b>gsc</b> that shows the processor output (select it in the <b>hosts</b> tab) - this indicates that this gsc is running a primary Processing Unit instance. Right-click the gsc in the <b>hosts</b> tab, choose <b>Terminate</b> from the pop-up menu and select <b>yes</b> to terminate the gsc.</li>
	<li>After doing the above, quickly select the <b>hosts</b> root in the <b>hosts</b> tab to see the failover process in action.<br/>
The backup instance of the primary you just shut down becomes the primary. Then a new Processing Unit instance instantiated in another container, itself becomes the backup of the new primary.  </li>
</ol>


<p><img src="download/attachments/48235229/flow260per.jpg" align="absmiddle" border="0"/></p>
<div class="" align='center'><sub><b>Figure 11. Failover and the self-healing process</b></sub></div>


<h2><a name="StepFour-ScalingtheHelloWorldApplication-What%27sNext%3F"></a>What's Next?</h2>
<p>Congratulations! By now you should have implemented your first GigaSpaces application, introduced high availability to it and scaled it out. <br/>
Next, you can go <a href="Beyond the Basics.html" title="Beyond the Basics">Beyond the Basics, and explore GigaSpaces more Advanced Features</a>, or return to the <a href="Quick Start Guide.html" title="Quick Start Guide">Quick Start Guide Home </a>.</p>

                     </td>
</tr>
</table>
<table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr>
<td height="12" background="http://www.gigaspaces.com/wiki/images/border/border_bottom.gif"><img src="images/border/spacer.gif" width="1" height="1" border="0"/></td>
</tr>
<tr>
<td align="center"><font color="grey"><a href="http://www.gigaspaces.com">GigaSpaces.com</a> -
		<a href="http://www.gigaspaces.com/wiki/x/xwBmAg" class="smalltext">Legal Notice</a> -
		<a href="http://www.gigaspaces.com/wiki/x/xgBmAg" class="smalltext">3rd Party Licenses</a> -
		<a href="http://www.gigaspaces.com/wiki/x/BQFmAg" class="smalltext">Site Map</a> -
		<a href="http://www.gigaspaces.com/wiki/display/API/API+Documentation+Portal" class="version-link">API Docs</a> -
		<a href="http://forum.openspaces.org/forum.jspa?forumID=175" class="version-link">Forum</a> -
		<a href="http://www.gigaspaces.com/LatestProductVersion" class="version-link">Downloads</a> -
		<a href="http://blog.gigaspaces.com/" class="version-link">Blog</a> -
		<a href="http://www.gigaspaces.com/os_papers.html" class="version-link">White Papers</a> -
		<a href="mailto:techw@gigaspaces.com">Contact Tech Writing</a> -
		<i><a href="http://www.atlassian.com/software/confluence">Gen. by Atlassian Confluence</a></i></font></td>
</tr>
</table>
     </body>
</html>
