<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
     <head>
         <title>XAP 8.0 Documentation : Controlling Serialization</title>
<link rel="stylesheet" href="styles/site.css" type="text/css" />
         <META http-equiv="Content-Type" content="text/html; charset=UTF-8">
		 <style>
.back-to {
	color: #666666;
	font-weight: bold;
}	 
a.back-to:link, a.back-to:visited, a.back-to:hover, a.back-to:active  {
	color: #666666;
}	 
		 </style>
     </head>

     <body>
<table class="pagecontent" border="0" cellpadding="0" cellspacing="0" width="100%" bgcolor="#ffffff">
<tr>
<td valign="top" class="pagebody">
<div class="pageheader">
<span class="back-to">XAP 8.0 Documentation > <a href="index.html">Back to Table of Contents</a></span><br>
<h1>Controlling Serialization</h1>
</div>
<br>



<div style="border-style:solid; border-color:#3C78B5; border-width:thin; padding-left:20px; padding-bottom:20px; padding-top:20px; padding-right:20px; background-color:#D8E4F1"> 

<p><b>Section Summary:</b>  Controlling the Space Object non-primitive serialization mode when written/read from the space.  </p>
</div>

<h1><a name="ControllingSerialization-Overview"></a>Overview</h1>
<p>GigaSpaces using a unique approach when transporting space objects from one process to another (client-space, space-space). By default, objects are not serialized using the regular <a href="http://java.sun.com/developer/technicalArticles/Programming/serialization/">Java serialization approach</a>, but using GigaSpaces serialization technology. You have several options to control GigaSpaces serialization:</p>
<ul class="alternate" type="square">
	<li>Default mode - Active when your Space class doesn't implement <a href="http://java.sun.com/j2se/1.5.0/docs/api/java/io/Externalizable.html">Externalizable</a>. You may choose one of the Serialization mode listed below to control the way the space object fields are serialized.</li>
	<li><a href="Externalizable Support.html" title="Externalizable Support">Implement Externalizable</a> - In this case, only the Native Serialization is supported. This mode allows you to have total control on the object transport.</li>
</ul>


<p>With the Default mode (when the space class doesn't Implement Externalizable), you can control the serialization mode of <b>Space Class non-primitive fields</b> when they are written or read from the space (remote or embedded) using the following space property:</p>
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">space-config.serialization-type</pre>
</div></div>
<p>Optional Values:</p>
<ul class="alternate" type="square">
	<li>0 - Native Serialization (Default)</li>
	<li>1 - Light Serialization</li>
	<li>2 - Full Serialization</li>
	<li>3 - Compressed Serialization</li>
</ul>


<div class='panelMacro'><table class='tipMacro'><colgroup><col width='24'><col></colgroup><tr><td valign='top'><img src="images/icons/emoticons/check.gif" width="16" height="16" align="absmiddle" alt="" border="0"></td><td><b>primitive and non-primitive fields</b>
<ul class="alternate" type="square">
	<li>Primitive field types includes: java.lang.String, byte, short, int, long, float, double, char, boolean and their <tt>java.lang.</tt> form: java.lang.Byte ,java.lang.Short, java.lang.Integer, java.lang.Long, java.lang.Float, java.lang.Double, java.lang.Character and java.lang.Boolean.</li>
	<li>Non-primitive field types includes: Arrays of Primitive types, user defined classes , Array of user defined Classes, Collections, etc.</li>
</ul>
</td></tr></table></div>

<h1><a name="ControllingSerialization-DefaultSerializationFlow"></a>Default Serialization Flow</h1>
<p>When a client performs a space operation using a remote space (a space running in a different VM than the client program), the POJO non-primitive fields used with the write/update operation, or POJO template non-primitive fields used with the read/take/notify operation are serialized into a special object (packet) and sent to the space. Primitive fields are copied into the packet object. When the POJO or the template packet arrives to the space, non-primitive are de-serialized and their  fields (primitive and non-primitive types) are stored within the space using a generic data structure, or it is used to find a matching objects (read/take/notify) in the space. When a read/take operation is called, the matching object data is serialized and sent back to the client program. When the matching object arrives into the client program VM, it is de-serialized and used by the client application.</p>
<div class="indent20 inline" style="margin-left: 20px;"><style type="text/css">div.inline p:first-child { display: inline; }</style><p><img src="download/attachments/48235229/serialization1.jpg" align="absmiddle" border="0"/></p></div>
<p>The POJO fields values and its meta-data information are extracted in run-time (marshaled), and transferred into the space using GigaSpaces generic portable object. When sent back to the client as a result of a read/take operation, the object is de-marshaled and used by the client application.</p>

<p><img class="emoticon" src="images/icons/emoticons/warning.gif" height="16" width="16" align="absmiddle" alt="" border="0"/> <b>writeObject and readObject</b><br/>
If the POJO class implements <a href="http://java.sun.com/j2se/1.5.0/docs/api/index.html?java/io/Serializable.html" target="_blank">Serializable</a> interface) with the <tt>writeObject()</tt> and <tt>readObject()</tt> methods, these methods <b>are not called</b> when the object is serialized.</p>

<h1><a name="ControllingSerialization-ExternalizableSerializationFlow"></a>Externalizable Serialization Flow</h1>
<p>When the Space Class implements the <a href="http://java.sun.com/j2se/1.5.0/docs/api/index.html?java/io/Externalizable.html" target="_blank">Externalizable</a> interface, <tt>readExternal</tt> and <tt>writeExternal</tt> are called, you may control the stream transferred across the network. The <a href="Externalizable Support.html" title="Externalizable Support">Externalizable Support</a> includes details about this advanced option.</p>

<div class="indent20 inline" style="margin-left: 20px;"><style type="text/css">div.inline p:first-child { display: inline; }</style><p><img src="download/attachments/48235229/serialization2.jpg" align="absmiddle" border="0"/></p></div>

<p><img class="emoticon" src="images/icons/emoticons/information.gif" height="16" width="16" align="absmiddle" alt="" border="0"/> Space Class POJO fields types must be Serializable/Externalizable, since they need to be serialized using the regular Java serialization. </p>

<h1><a name="ControllingSerialization-DefaultmodeSerializationoptions"></a>Default mode - Serialization options</h1>

<p>Below are the supported serialization modes for non-primitive fields:</p>
<table class='confluenceTable'><tbody>
<tr>
<th class='confluenceTh'> Serialization Mode </th>
<th class='confluenceTh'> Description </th>
</tr>
<tr>
<td class='confluenceTd'> Native Serialization (0) </td>
<td class='confluenceTd'> Non-primitive fields are transferred to and stored at the space using their Java Native serialization methods. When using the <tt>Native</tt> serialization mode, the space relies on the implementation of <tt>hashCode()</tt> and <tt>equals()</tt> methods when performing matching. You should make sure these are implemented correctly for non-Primitive fields. This mode is optimized when accessing the space in embedded mode. <div class='panelMacro'><table class='tipMacro'><colgroup><col width='24'><col></colgroup><tr><td valign='top'><img src="images/icons/emoticons/check.gif" width="16" height="16" align="absmiddle" alt="" border="0"></td><td>When running in embedded mode, Space object fields <b>are passed by reference</b> to the space. Extra caution should be taken with non-primitive none mutable fields such as collections (<tt>HashTable, Vector</tt>). Changes made to those fields outside the context of the space will impact the value of those fields in the space and may result in unexpected behavior. For example, index lists aren't maintained because the space is unaware of the modified field values. For those fields it is recommended to pass a cloned value rather then the reference itself. Passing a cloned value is important when several threads access the Object fields - for example application threads and replication threads. </td></tr></table></div> </td>
</tr>
<tr>
<td class='confluenceTd'> Light (1) </td>
<td class='confluenceTd'> Non-primitive fields are transferred to and stored at the space as marshalled objects <tt>com.j_spaces.kernel.lrmi.MarshObject</tt>. With this mode there is no need to implement <tt>hashCode()</tt> and <tt>equals()</tt> when performing matching on non-primitive fields. </td>
</tr>
<tr>
<td class='confluenceTd'> Full Serialization (2) </td>
<td class='confluenceTd'> Non-primitive fields are transferred to and stored at the space as marshalled objects (see <a href="http://java.sun.com/j2se/1.5.0/docs/api/index.html?java/rmi/MarshalledObject.html" target="_blank">Javadoc</a>). This mode impacts the performance and should be used only when other serialization modes are not viable. </td>
</tr>
<tr>
<td class='confluenceTd'> Compressed (3) </td>
<td class='confluenceTd'> Non-primitive fields are Compressed before transferred into the space and stored within the space in compressed mode. This option is useful when the object includes fields with a relatively large amount of data such as XML data (DOM objects). This mode speeds up the access to remote space and reduces the space memory footprint when dealing with large entries. The compression algorithm using the <tt>java.util.zip</tt> package. </td>
</tr>
</tbody></table>

<div class='panelMacro'><table class='tipMacro'><colgroup><col width='24'><col></colgroup><tr><td valign='top'><img src="images/icons/emoticons/check.gif" width="16" height="16" align="absmiddle" alt="" border="0"></td><td>For additional optimization when serializing objects, refer to the <a href="Externalizable Support.html" title="Externalizable Support">Externalizable Support</a> section. </td></tr></table></div> 

<h2><a name="ControllingSerialization-EmbeddedMode"></a>Embedded Mode</h2>

<ul>
	<li>Native mode &#8211; non-primitive Space Object field types are not serialized &#8211; the space stores the references of the non-primitive fields. This mode provides the best performance. In multi-threaded environments, be careful when accessing the non-primitive fields after their parent Object has been stored into the space.</li>
</ul>


<ul>
	<li>Light/Full Serialization mode &#8211; non-primitive Space Object field types are serialized &#8211; the space stores a clone of the fields object. This impacts the performance.</li>
</ul>


<h3><a name="ControllingSerialization-ReadingandChangingObjectinEmbeddedModewithoutWritingitBack"></a>Reading and Changing Object in Embedded Mode without Writing it Back</h3>

<p>In embedded mode, GigaSpaces do not store the object reference, but stores its non-primitive references (complex fields' references) and the primitive fields data. When you know you might end up with multiple threads accessing the same object, you should clone the entry before you write it and continue and work with the cloned version.<br/>
If you read an object from the space and change it without writing it back, you might modify one of its complex type fields that another thread holding its reference. One simple solution for this would be to use the <a href="GigaSpaces Read Modifiers.html#GigaSpacesReadModifiers-ExclusiveReadLock">exclusive read lock</a> mode to block other threads from reading the same entry in the same time.</p>

<h2><a name="ControllingSerialization-Remotemode"></a>Remote mode</h2>

<p>In remote mode, the Object's non-primitive fields are serialized in any case, but the serialization mode determine how it is done:</p>
<ul>
	<li>Native mode &#8211; non-primitive Object fields are serialized using their native serialization. These are de-serialized at the space side before they are stored inside the space.</li>
	<li>Light mode &#8211; when non-primitive fields are serialized, they are wrapped with GigaSpaces special Marshaled Object. When stored inside the space, these field are not de-serialized, but stored as in their serialized form. This improves performance, but does not perform matching using thee fields.</li>
	<li>Full mode &#8211; supports the <a href="http://java.sun.com/products/jini/2.1/doc/specs/html/js-spec.html">JavaSpace specification</a>. When serialized, non-primitive fields are wrapped with a<br/>
<a href="http://java.sun.com/j2se/1.5.0/docs/api/index.html?java/rmi/MarshalledObject.html" target="_blank">MarshalledObject</a>. The <tt>MarshalledObject</tt> is de-serialized at the space side before it is stored, allowing you to perform matching using these fields. This mode is slow compared other options.</li>
	<li>Compressed mode &#8211; non-primitive fields are compressed before being sent to the space at the client side. These are stored in compressed mode within the space.</li>
</ul>


<p>With Space Classes that implements <a href="Externalizable Support.html" title="Externalizable Support">Externalizable</a> make sure you use <tt>Native</tt> Serialization mode. In many cases this is the best way to boost remote space access. Externalizable based classes are not relevant for embedded space mode. </p>

                     </td>
</tr>
</table>
<table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr>
<td height="12" background="http://www.gigaspaces.com/wiki/images/border/border_bottom.gif"><img src="images/border/spacer.gif" width="1" height="1" border="0"/></td>
</tr>
<tr>
<td align="center"><font color="grey"><a href="http://www.gigaspaces.com">GigaSpaces.com</a> -
		<a href="http://www.gigaspaces.com/wiki/x/xwBmAg" class="smalltext">Legal Notice</a> -
		<a href="http://www.gigaspaces.com/wiki/x/xgBmAg" class="smalltext">3rd Party Licenses</a> -
		<a href="http://www.gigaspaces.com/wiki/x/BQFmAg" class="smalltext">Site Map</a> -
		<a href="http://www.gigaspaces.com/wiki/display/API/API+Documentation+Portal" class="version-link">API Docs</a> -
		<a href="http://forum.openspaces.org/forum.jspa?forumID=175" class="version-link">Forum</a> -
		<a href="http://www.gigaspaces.com/LatestProductVersion" class="version-link">Downloads</a> -
		<a href="http://blog.gigaspaces.com/" class="version-link">Blog</a> -
		<a href="http://www.gigaspaces.com/os_papers.html" class="version-link">White Papers</a> -
		<a href="mailto:techw@gigaspaces.com">Contact Tech Writing</a> -
		<i><a href="http://www.atlassian.com/software/confluence">Gen. by Atlassian Confluence</a></i></font></td>
</tr>
</table>
     </body>
</html>
