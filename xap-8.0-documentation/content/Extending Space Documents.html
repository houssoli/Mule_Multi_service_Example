<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
     <head>
         <title>XAP 8.0 Documentation : Extending Space Documents</title>
<link rel="stylesheet" href="styles/site.css" type="text/css" />
         <META http-equiv="Content-Type" content="text/html; charset=UTF-8">
		 <style>
.back-to {
	color: #666666;
	font-weight: bold;
}	 
a.back-to:link, a.back-to:visited, a.back-to:hover, a.back-to:active  {
	color: #666666;
}	 
		 </style>
     </head>

     <body>
<table class="pagecontent" border="0" cellpadding="0" cellspacing="0" width="100%" bgcolor="#ffffff">
<tr>
<td valign="top" class="pagebody">
<div class="pageheader">
<span class="back-to">XAP 8.0 Documentation > <a href="index.html">Back to Table of Contents</a></span><br>
<h1>Extending Space Documents</h1>
</div>
<br>



<div style="border-style:solid; border-color:#3C78B5; border-width:thin; padding-left:20px; padding-bottom:20px; padding-top:20px; padding-right:20px; background-color:#D8E4F1"> 

<p><b>Section Summary:</b>  Extending the SpaceDocument class </p>
</div>

<h1><a name="ExtendingSpaceDocuments-Overview"></a>Overview</h1>

<p>While documents provide us with a dynamic schema, they force us to give up Java's type-safety for working with typeless key-value pairs. GigaSpaces supports extending the SpaceDocument class to provide a type-safe wrapper for documents which is much easier to code with, while maintaining the dynamic schema.<br/>
<a href='http://www.gigaspaces.com/wiki/download/attachments/48235229/document_arch.jpg' target='document_arch.jpg' onClick='window.open("http://www.gigaspaces.com/wiki/download/attachments/48235229/document_arch.jpg", "document_arch.jpg", "height=470,width=580,menubar=no,status=no,toolbar=no"); return false;'><img src="download/thumbnails/48235229/document_arch.jpg" align="absmiddle" border="0"/></a><br/>
<img class="emoticon" src="images/icons/emoticons/add.gif" height="16" width="16" align="absmiddle" alt="" border="0"/> Do not confuse this with <a href="Document-POJO Interoperability.html" title="Document-POJO Interoperability">Document-POJO interoperability</a>, which is a different feature.</p>

<h1><a name="ExtendingSpaceDocuments-CreatingtheExtensionClass"></a>Creating the Extension Class</h1>

<p>Let's create a type-safe document wrapper for the <b>Product</b> type described in the <a href="Document (Schema-Free) API.html" title="Document (Schema-Free) API">Document Support</a> page. The extensions are:</p>
<ul>
	<li>Provide a parameterless constructor, since the type name is fixed.</li>
	<li>Provide type-safe properties, but instead of using private fields to store/retrieve the values, use the getProperty/setProperty methods from the SpaceDocument class.</li>
</ul>


<p>Here's an example (only parts of the properties have been implemented to keep the example short):</p>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java"><span class="code-keyword">public</span> class ProductDocument <span class="code-keyword">extends</span> SpaceDocument {
    <span class="code-keyword">private</span> <span class="code-keyword">static</span> <span class="code-keyword">final</span> <span class="code-object">String</span> TYPE_NAME = <span class="code-quote">"Product"</span>;
    <span class="code-keyword">private</span> <span class="code-keyword">static</span> <span class="code-keyword">final</span> <span class="code-object">String</span> PROPERTY_CATALOG_NUMBER = <span class="code-quote">"CatalogNumber"</span>;
    <span class="code-keyword">private</span> <span class="code-keyword">static</span> <span class="code-keyword">final</span> <span class="code-object">String</span> PROPERTY_NAME = <span class="code-quote">"Name"</span>;
    <span class="code-keyword">private</span> <span class="code-keyword">static</span> <span class="code-keyword">final</span> <span class="code-object">String</span> PROPERTY_PRICE = <span class="code-quote">"Price"</span>;

    <span class="code-keyword">public</span> ProductDocument() {
        <span class="code-keyword">super</span>(TYPE_NAME);
    }
    
    <span class="code-keyword">public</span> <span class="code-object">String</span> getCatalogNumber() {
        <span class="code-keyword">return</span> <span class="code-keyword">super</span>.getProperty(PROPERTY_CATALOG_NUMBER);
    }
    <span class="code-keyword">public</span> ProductDocument setCatalogNumber(<span class="code-object">String</span> catalogNumber) {
        <span class="code-keyword">super</span>.setProperty(PROPERTY_CATALOG_NUMBER, catalogNumber);
        <span class="code-keyword">return</span> <span class="code-keyword">this</span>;
    }

    <span class="code-keyword">public</span> <span class="code-object">String</span> getName() {
        <span class="code-keyword">return</span> <span class="code-keyword">super</span>.getProperty(PROPERTY_NAME);
    }
    <span class="code-keyword">public</span> ProductDocument setName(<span class="code-object">String</span> name) {
        <span class="code-keyword">super</span>.setProperty(PROPERTY_NAME, name);
        <span class="code-keyword">return</span> <span class="code-keyword">this</span>;
    }
    
    <span class="code-keyword">public</span> <span class="code-object">float</span> getPrice() {
        <span class="code-keyword">return</span> <span class="code-keyword">super</span>.getProperty(PROPERTY_PRICE);
    }
    <span class="code-keyword">public</span> ProductDocument setPrice(<span class="code-object">float</span> price) {
        <span class="code-keyword">super</span>.setProperty(PROPERTY_PRICE, price);
        <span class="code-keyword">return</span> <span class="code-keyword">this</span>;
    }
}</pre>
</div></div>

<h1><a name="ExtendingSpaceDocuments-RegisteringtheExtensionClass"></a>Registering the Extension Class</h1>

<p>If your only intention is to write/update document entries, creating the extension class is sufficient - from the space's perspective it is equivalent to a <tt>SpaceDocument</tt> instance. However, if you attempt to read/take entries from the space, the results will be <tt>SpaceDocument</tt> instances, and the cast to <tt>ProductDocument</tt> will throw an exception.<br/>
To overcome that, we need to include the document wrapper class in the type introduction:</p>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java"><span class="code-keyword">public</span> void registerProductType(GigaSpace gigaspace) {
    <span class="code-comment">// Create type descriptor:
</span>    SpaceTypeDescriptor typeDescriptor = 
        <span class="code-keyword">new</span> SpaceTypeDescriptorBuilder(<span class="code-quote">"Product"</span>)
        <span class="code-comment">// ... Other type settings
</span>        .setDocumentWrapperClass(ProductDocument.class)
        .create();
    <span class="code-comment">// Register type:
</span>    gigaspace.getTypeManager().registerTypeDescriptor(typeDescriptor);
}</pre>
</div></div>

<p>This wrapper type-registration is kept in the proxy and not propagated to the server, so that from the server's perspective this is still a virtual document type with no affiliated POJO class.</p>

<h1><a name="ExtendingSpaceDocuments-UsingtheExtensionClass"></a>Using the Extension Class</h1>

<p>The following code snippet demonstrate usage of the <tt>ProductDocument</tt> extensions we've created to write and read documents from the space.</p>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java"><span class="code-keyword">public</span> void example(GigaSpace gigaSpace) {
    <span class="code-comment">// Create a product document:
</span>    ProductDocument product = <span class="code-keyword">new</span> ProductDocument()
        .setCatalogNumber(<span class="code-quote">"hw-1234"</span>)
        .setName(<span class="code-quote">"Anvil"</span>)
        .setPrice(9.99f);
    <span class="code-comment">// Write a product document:
</span>    gigaSpace.write(product);
    
    <span class="code-comment">// Read product document using a template:
</span>    ProductDocument template = <span class="code-keyword">new</span> ProductDocument()
        .setName(<span class="code-quote">"Anvil"</span>);
    ProductDocument result1 = gigaSpace.read(template);
    <span class="code-comment">// Read product document using a SQL query:
</span>    SQLQuery&lt;ProductDocument&gt; query = 
        <span class="code-keyword">new</span> SQLQuery&lt;ProductDocument&gt;(<span class="code-quote">"Product"</span>, <span class="code-quote">"Price &gt; ?"</span>);
    query.setParameter(1, 5.5f);
    ProductDocument result2 = gigaSpace.read(query);
    <span class="code-comment">// Read product document by ID:
</span>    ProductDocument result3 = 
        gigaSpace.readById(<span class="code-keyword">new</span> IdQuery&lt;ProductDocument&gt;(<span class="code-quote">"Product"</span>, <span class="code-quote">"hw-1234"</span>));
}</pre>
</div></div>

                     </td>
</tr>
</table>
<table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr>
<td height="12" background="http://www.gigaspaces.com/wiki/images/border/border_bottom.gif"><img src="images/border/spacer.gif" width="1" height="1" border="0"/></td>
</tr>
<tr>
<td align="center"><font color="grey"><a href="http://www.gigaspaces.com">GigaSpaces.com</a> -
		<a href="http://www.gigaspaces.com/wiki/x/xwBmAg" class="smalltext">Legal Notice</a> -
		<a href="http://www.gigaspaces.com/wiki/x/xgBmAg" class="smalltext">3rd Party Licenses</a> -
		<a href="http://www.gigaspaces.com/wiki/x/BQFmAg" class="smalltext">Site Map</a> -
		<a href="http://www.gigaspaces.com/wiki/display/API/API+Documentation+Portal" class="version-link">API Docs</a> -
		<a href="http://forum.openspaces.org/forum.jspa?forumID=175" class="version-link">Forum</a> -
		<a href="http://www.gigaspaces.com/LatestProductVersion" class="version-link">Downloads</a> -
		<a href="http://blog.gigaspaces.com/" class="version-link">Blog</a> -
		<a href="http://www.gigaspaces.com/os_papers.html" class="version-link">White Papers</a> -
		<a href="mailto:techw@gigaspaces.com">Contact Tech Writing</a> -
		<i><a href="http://www.atlassian.com/software/confluence">Gen. by Atlassian Confluence</a></i></font></td>
</tr>
</table>
     </body>
</html>
