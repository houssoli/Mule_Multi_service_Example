<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
     <head>
         <title>XAP 8.0 Documentation : Direct Persistency</title>
<link rel="stylesheet" href="styles/site.css" type="text/css" />
         <META http-equiv="Content-Type" content="text/html; charset=UTF-8">
		 <style>
.back-to {
	color: #666666;
	font-weight: bold;
}	 
a.back-to:link, a.back-to:visited, a.back-to:hover, a.back-to:active  {
	color: #666666;
}	 
		 </style>
     </head>

     <body>
<table class="pagecontent" border="0" cellpadding="0" cellspacing="0" width="100%" bgcolor="#ffffff">
<tr>
<td valign="top" class="pagebody">
<div class="pageheader">
<span class="back-to">XAP 8.0 Documentation > <a href="index.html">Back to Table of Contents</a></span><br>
<h1>Direct Persistency</h1>
</div>
<br>

<script type='text/javascript'>//<![CDATA[
function debug() { }
// ]]></script><script type='text/javascript' src='/wiki/download/resources/net.customware.confluence.plugin.composition:composition-setup/js/browser.js'>//<![CDATA[
// ]]></script><script type='text/javascript' src='/wiki/download/resources/net.customware.confluence.plugin.composition:composition-setup/js/behaviour.js'>//<![CDATA[
// ]]></script><script type='text/javascript' src='/wiki/download/resources/net.customware.confluence.plugin.composition:composition-setup/js/memory.js'>//<![CDATA[
// ]]></script><script type='text/javascript' src='/wiki/download/resources/net.customware.confluence.plugin.composition:composition-setup/js/cloak.js'>//<![CDATA[
// ]]></script><script type='text/javascript'>//<![CDATA[
Cloak.closeHTML = "<img src=\'/wiki/download/resources/net.customware.confluence.plugin.composition:toggle-cloak/img/navigate_down_10.gif\'/>";
Cloak.openHTML = "<img src=\'/wiki/download/resources/net.customware.confluence.plugin.composition:toggle-cloak/img/navigate_right_10.gif\'/>";
Cloak.toggleZone = true;
Cloak.memoryDuration = 0;
Cloak.memoryPrefix = "contentId:53903405";
Cloak.memoryPath = "/wiki/";
// ]]></script><style type='text/css'>
.cloakToggle { /* Definition for state toggling image */
cursor:hand;
cursor:pointer;
}
</style><script type='text/javascript' src='/wiki/download/resources/net.customware.confluence.plugin.composition:composition-setup/js/transitions.js'>//<![CDATA[
// ]]></script><script type='text/javascript' src='/wiki/download/resources/net.customware.confluence.plugin.composition:composition-setup/js/deck.js'>//<![CDATA[
// ]]></script><link rel='stylesheet' type='text/css'  href='/wiki/styles/main-action.css?pluginCompleteKey=net.customware.confluence.plugin.composition:composition-setup&stylesheetName=deck&spaceKey=XAP8'/><script type='text/javascript'>//<![CDATA[
Deck.memoryDuration = 0;
Deck.memoryPrefix = "contentId:53903405";
Deck.memoryPath = "/wiki/";
// ]]></script>


<div style="border-style:solid; border-color:#3C78B5; border-width:thin; padding-left:20px; padding-bottom:20px; padding-top:20px; padding-right:20px; background-color:#D8E4F1"> 

<p><b>Section Summary:</b>  Direct persistency mode support Read-Write Through </p>
</div>

<h1><a name="DirectPersistency-Overview"></a>Overview</h1>
<p>When running in direct persistency mode (i.e. Read-Write Through) the IMDG interacts with the External Data Source to persist its data where the client application would get the acknowledge for the IMDG operation only after <b>both</b> the IMDG and the External Data Source acknowledged the operation. With this persistency mode, the IMDG operations performance would be heavily depended on the speed of the External Data Source to commit the data and provide acknowledge back to the IMDG for the successful operation of the transaction. When having a mapping layer in between the IMDG and the External Data Source that converts the IMDG objects to relational database tables data (i.e. <a href="http://www.hibernate.org">Hibernate</a>), the time which takes to perform the conversion would also impact the acknowledge time and the application overall performance.</p>

<p>The above means you should be careful when using this persistency mode in case your application have the requirement to respond quickly (low latency) and scale in linear manner.</p>

<p><img src="download/attachments/19890517/referto.gif" align="absmiddle" border="0"/> See the <a href="Asynchronous Persistency with the Mirror.html" title="Asynchronous Persistency with the Mirror">Asynchronous Persistency</a> mode that allows you to delegate the IMDG operation to the External Data Source as a background activity without impacting the application performance.</p>

<p>When the application reading data from the IMDG there are two operational modes you should consider:</p>
<ul class="alternate" type="square">
	<li>Having <b>part</b> of the Application Data within the IMDG - Enabled when running in <tt>LRU</tt> Cache policy mode. IMDG will perform lazy load (i.e. Read Through) in case of matching object can't be found within the IMDG. Lazy load might impact the performance and the scalability of the application.</li>
	<li>Having <b>All</b> Application Data within the IMDG - Enabled when running in <tt>ALL_IN_CACHE</tt> Cache policy mode. IMDG will not perform any lazy load in case matching object can't be found within the IMDG.</li>
</ul>


<p><img src="download/attachments/19890517/referto.gif" align="absmiddle" border="0"/> See the <a href="Memory Management Facilities.html" title="Memory Management Facilities">Memory Management Facilities</a> for details about the differences between <tt>ALL_IN_CACHE</tt> and the <tt>LRU</tt> cache policies.</p>

<p>The Cache policy mode impacts also the initialization of the IMDG instance and the way it is reading data from the External Data Source to bootstrap itself. </p>
<ul class="alternate" type="square">
	<li>With <b><tt>ALL_IN_CACHE</tt></b> Cache policy - Each IMDG instance iterating through the database and loading all the relevant data.</li>
	<li>With <b><tt>LRU</tt></b> Cache policy - Each IMDG instance iterating through the database and loading only partial amount of data (based on the Memory-Usage and Cache Size settings).</li>
</ul>


<p><img src="download/attachments/19890517/referto.gif" align="absmiddle" border="0"/> See the <a href="External Data Source Initial Load.html" title="External Data Source Initial Load">External Data Source Initial Load</a> for details how you can change the default behavior of the IMDG bootstrapping process once started.</p>

<p>Direct persistency mode supports the following database topologies:</p>
<ul>
	<li><a href="#DirectPersistency-central">A central database</a>
<div class="indent20 inline" style="margin-left: 20px;"><style type="text/css">div.inline p:first-child { display: inline; }</style><p><img src="download/attachments/48235229/data-grid-sync-persist.jpg" align="absmiddle" border="0"/></p></div></li>
	<li><a href="#DirectPersistency-distributed">Distributed databases</a>
<div class="indent20 inline" style="margin-left: 20px;"><style type="text/css">div.inline p:first-child { display: inline; }</style><p><img src="download/attachments/48235229/data-grid-sync-persist_non_central_db.jpg" align="absmiddle" border="0"/></p></div></li>
</ul>


<p><a name="DirectPersistency-central"></a></p>
<h1><a name="DirectPersistency-CentralDatabase"></a>Central Database</h1>
<p>With the central database topology, a single database instance is used to store all the IMDG data. In this case only the primary IMDG instance will update the database. The backup IMDG instance will not update the database. The backup IMDG instance will update the database only once it will turn to be a primary in case of a failure or shutdown of the primary IMDG instance. </p>

<p>A Data-Grid running in Direct persistency mode using central database topology, having all data within the IMDG would have the following configuration:</p>
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-xml"><span class="code-tag">&lt;os-core:space id=<span class="code-quote">"space"</span> url=<span class="code-quote">"/./space"</span> schema=<span class="code-quote">"persistent"</span> external-data-source=<span class="code-quote">"hibernateDataSource"</span>&gt;</span>
    <span class="code-tag">&lt;os-core:properties&gt;</span>
        <span class="code-tag">&lt;props&gt;</span>
            <span class="code-tag"><span class="code-comment">&lt;!-- Use ALL IN CACHE - No Read Performed from the database in lazy manner--&gt;</span></span>
            <span class="code-tag">&lt;prop key=<span class="code-quote">"space-config.engine.cache_policy"</span>&gt;</span>1<span class="code-tag">&lt;/prop&gt;</span>
            <span class="code-tag">&lt;prop key=<span class="code-quote">"space-config.external-data-source.usage"</span>&gt;</span>read-write<span class="code-tag">&lt;/prop&gt;</span>
            <span class="code-tag">&lt;prop key=<span class="code-quote">"cluster-config.cache-loader.external-data-source"</span>&gt;</span>true<span class="code-tag">&lt;/prop&gt;</span>
            <span class="code-tag">&lt;prop key=<span class="code-quote">"cluster-config.cache-loader.central-data-source"</span>&gt;</span>true<span class="code-tag">&lt;/prop&gt;</span>            
        <span class="code-tag">&lt;/props&gt;</span>
    <span class="code-tag">&lt;/os-core:properties&gt;</span>
<span class="code-tag">&lt;/os-core:space&gt;</span>

<span class="code-tag">&lt;bean id=<span class="code-quote">"hibernateDataSource"</span> class=<span class="code-quote">"org.openspaces.persistency.hibernate.DefaultHibernateExternalDataSource"</span>&gt;</span>
    <span class="code-tag">&lt;property name=<span class="code-quote">"sessionFactory"</span> ref=<span class="code-quote">"sessionFactory"</span>/&gt;</span>
<span class="code-tag">&lt;/bean&gt;</span></pre>
</div></div>

<p><a name="DirectPersistency-distributed"></a></p>
<h1><a name="DirectPersistency-DistributedDatabases"></a>Distributed Databases</h1>
<p>With the distributed databases topology, each IMDG instance uses its own database instance to store its data. In this case both the primary and the backup IMDG instances will update the database once IMDG operation is called or being replicated (to the backup).</p>

<p>A Data-Grid running in Direct persistency mode using distributed databases topology (non-central), having all the data within the IMDG would have the following configuration:</p>
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-xml"><span class="code-tag">&lt;os-core:space id=<span class="code-quote">"space"</span> url=<span class="code-quote">"/./space"</span> schema=<span class="code-quote">"persistent"</span> external-data-source=<span class="code-quote">"hibernateDataSource"</span>&gt;</span>
    <span class="code-tag">&lt;os-core:properties&gt;</span>
        <span class="code-tag">&lt;props&gt;</span>
            <span class="code-tag"><span class="code-comment">&lt;!-- Use ALL IN CACHE - No Read Performed from the database in lazy manner--&gt;</span></span>
            <span class="code-tag">&lt;prop key=<span class="code-quote">"space-config.engine.cache_policy"</span>&gt;</span>1<span class="code-tag">&lt;/prop&gt;</span>
            <span class="code-tag">&lt;prop key=<span class="code-quote">"space-config.external-data-source.usage"</span>&gt;</span>read-write<span class="code-tag">&lt;/prop&gt;</span>
            <span class="code-tag">&lt;prop key=<span class="code-quote">"cluster-config.cache-loader.external-data-source"</span>&gt;</span>true<span class="code-tag">&lt;/prop&gt;</span>
            <span class="code-tag">&lt;prop key=<span class="code-quote">"cluster-config.cache-loader.central-data-source"</span>&gt;</span>false<span class="code-tag">&lt;/prop&gt;</span>            
        <span class="code-tag">&lt;/props&gt;</span>
    <span class="code-tag">&lt;/os-core:properties&gt;</span>
<span class="code-tag">&lt;/os-core:space&gt;</span>

<span class="code-tag">&lt;bean id=<span class="code-quote">"hibernateDataSource"</span> class=<span class="code-quote">"org.openspaces.persistency.hibernate.DefaultHibernateExternalDataSource"</span>&gt;</span>
    <span class="code-tag">&lt;property name=<span class="code-quote">"sessionFactory"</span> ref=<span class="code-quote">"sessionFactory"</span>/&gt;</span>
<span class="code-tag">&lt;/bean&gt;</span></pre>
</div></div>

<p><img src="download/attachments/19890517/referto.gif" align="absmiddle" border="0"/> See the <a href="Hibernate External Data Source.html" title="Hibernate External Data Source">Hibernate External Data Source</a> section for full details about the EDS properties you may configure.</p>

<h1><a name="DirectPersistency-SupportedOptions"></a>Supported Options</h1>
<p>The following table lists the supported options:</p>
<table class='confluenceTable'><tbody>
<tr>
<th class='confluenceTh'><b>Cache Policy</b></th>
<th class='confluenceTh'><b>Central Data Source</b></th>
<th class='confluenceTh'><b>Replication Recovery enabled</b></th>
<th class='confluenceTh'><b>Amount of data loaded via the initial load</b></th>
<th class='confluenceTh'><b>Data filtering at the initial load enabled</b></th>
</tr>
<tr>
<td class='confluenceTd'>LRU</td>
<td class='confluenceTd'>YES</td>
<td class='confluenceTd'>NO</td>
<td class='confluenceTd'>Up to amount of initial load percentage value *</td>
<td class='confluenceTd'>YES</td>
</tr>
<tr>
<td class='confluenceTd'>ALL_IN_CACHE</td>
<td class='confluenceTd'>YES</td>
<td class='confluenceTd'>YES</td>
<td class='confluenceTd'>All database data </td>
<td class='confluenceTd'>YES</td>
</tr>
<tr>
<td class='confluenceTd'>LRU</td>
<td class='confluenceTd'>NO</td>
<td class='confluenceTd'>YES</td>
<td class='confluenceTd'>Up to amount of initial load percentage value *</td>
<td class='confluenceTd'>NO</td>
</tr>
<tr>
<td class='confluenceTd'>ALL_IN_CACHE</td>
<td class='confluenceTd'>NO</td>
<td class='confluenceTd'>YES</td>
<td class='confluenceTd'>All database data </td>
<td class='confluenceTd'>NO </td>
</tr>
</tbody></table>

<p><tt>*</tt> Up to amount of initial load percentage value (50%) that is the percentage of <tt>cache_size</tt> value. </p>

                     </td>
</tr>
</table>
<table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr>
<td height="12" background="http://www.gigaspaces.com/wiki/images/border/border_bottom.gif"><img src="images/border/spacer.gif" width="1" height="1" border="0"/></td>
</tr>
<tr>
<td align="center"><font color="grey"><a href="http://www.gigaspaces.com">GigaSpaces.com</a> -
		<a href="http://www.gigaspaces.com/wiki/x/xwBmAg" class="smalltext">Legal Notice</a> -
		<a href="http://www.gigaspaces.com/wiki/x/xgBmAg" class="smalltext">3rd Party Licenses</a> -
		<a href="http://www.gigaspaces.com/wiki/x/BQFmAg" class="smalltext">Site Map</a> -
		<a href="http://www.gigaspaces.com/wiki/display/API/API+Documentation+Portal" class="version-link">API Docs</a> -
		<a href="http://forum.openspaces.org/forum.jspa?forumID=175" class="version-link">Forum</a> -
		<a href="http://www.gigaspaces.com/LatestProductVersion" class="version-link">Downloads</a> -
		<a href="http://blog.gigaspaces.com/" class="version-link">Blog</a> -
		<a href="http://www.gigaspaces.com/os_papers.html" class="version-link">White Papers</a> -
		<a href="mailto:techw@gigaspaces.com">Contact Tech Writing</a> -
		<i><a href="http://www.atlassian.com/software/confluence">Gen. by Atlassian Confluence</a></i></font></td>
</tr>
</table>
     </body>
</html>
