<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
     <head>
         <title>XAP 8.0 Documentation : Troubleshooting Tools</title>
<link rel="stylesheet" href="styles/site.css" type="text/css" />
         <META http-equiv="Content-Type" content="text/html; charset=UTF-8">
		 <style>
.back-to {
	color: #666666;
	font-weight: bold;
}	 
a.back-to:link, a.back-to:visited, a.back-to:hover, a.back-to:active  {
	color: #666666;
}	 
		 </style>
     </head>

     <body>
<table class="pagecontent" border="0" cellpadding="0" cellspacing="0" width="100%" bgcolor="#ffffff">
<tr>
<td valign="top" class="pagebody">
<div class="pageheader">
<span class="back-to">XAP 8.0 Documentation > <a href="index.html">Back to Table of Contents</a></span><br>
<h1>Troubleshooting Tools</h1>
</div>
<br>



<div style="border-style:solid; border-color:#3C78B5; border-width:thin; padding-left:20px; padding-bottom:20px; padding-top:20px; padding-right:20px; background-color:#D8E4F1"> 

<p><b>Section Summary:</b>  Troubleshooting tools for testing a running product and environmental issues.  </p>
</div>

<h1><a name="TroubleshootingTools-CPUandMemoryDumper"></a>CPU and Memory Dumper</h1>

<h2><a name="TroubleshootingTools-CPUDumperJavaUtilityforWindows"></a>CPU Dumper Java Utility for Windows</h2>
<p>The application starts a space and collects the memory and CPU utilization and dumps the threads when the CPU britches the configured CPU level.</p>
<ul>
	<li>Extract the <b><a href="download/attachments/53903590/winJVMDumper.zip">zip</a></b> under <tt>Gigaspaces root dir/bin</tt>.</li>
	<li>Modify the config.dat and set the proper classpath, the CPU (in % beyond it the dump will be created) and the TIME (in msc of the time which lasts the application to breech beyond the configured CPU value)</li>
	<li>Run the GetJvmDump.exe</li>
</ul>


<h2><a name="TroubleshootingTools-AScriptUtilityforLinux"></a>A Script Utility for Linux</h2>
<p>The <a href="download/attachments/53903590/gsInstanceDumper.zip">attached gsInstance.sh script</a> script starts a space using the regular gsInstance.sh equivalent and dumps the threads once the application breeches a certain CPU level for a certain period, set by the TIME value. The CPU and TIME can be passed as additional arguments to the script. <br/>
You can also simply copy the following section into any script:</p>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">CPUUSAGE=$1
TIME=$2
<span class="code-keyword">if</span> [ $# -lt  2 ] ; then
  echo  ""
  echo  <span class="code-quote">"USAGE:    ./gsInstance.sh &lt;CPU&gt; &lt;TIME&gt;"</span>
  echo  ""
  echo  <span class="code-quote">"             &lt;CPU&gt; - CPU Utilization in percents (%)"</span>
  echo  <span class="code-quote">"             &lt;TIME&gt; - Time in seconds"</span>
  echo  ""
  echo  <span class="code-quote">"Example: ./gsInstance.sh 80 20 \"</span>/./TestSpace\<span class="code-quote">" "</span>
  exit
fi

myPid=$$
chk=0
cpu=0
<span class="code-keyword">while</span> [ 1 ]
<span class="code-keyword">do</span>
   str=`ps --ppid $myPid --no-headers -o pcpu,rss,pid,cmd| grep java `
   cpu=`echo $str | awk '{print $1}'|cut -d. -f1`
   mem=`echo $str | awk '{print $2}'`

   echo <span class="code-quote">"*********************************************"</span>
   echo <span class="code-quote">"***  CPU= $cpu %   MEMORY= $mem K"</span>
   echo <span class="code-quote">"*********************************************"</span>
   <span class="code-keyword">if</span> [ $cpu -gt  $CPUUSAGE ]; then
         chk=`expr $chk + 1`
   <span class="code-keyword">else</span>
         chk=0
   fi
   <span class="code-keyword">if</span> [ $chk -ge $TIME ];then
       pid=`ps --ppid $myPid  -o pid,pcpu,cmd | awk '{print $1}'`
       kill -3 $pid
   fi
   sleep 1 
done</pre>
</div></div>

<h2><a name="TroubleshootingTools-WindowsDebuggingTools"></a>Windows Debugging Tools</h2>
<ol>
	<li><b>userdump</b> - (correct version should be chosen - 32 or 64-bit according to the application) to get a dump</li>
	<li><b><a href="http://www.microsoft.com/whdc/DevTools/Debugging/default.mspx">Debugging Tools for Windows</a></b> - to navigate in the dump. While userdump is by default non-intrusive and should not kill the application, it causes the application freeze which could be for a few seconds and it, eventually, could crash the application. So, it is NOT 100% safe.<br/>
Debugging Tools for Windows is GUI wrapper for debugging tools that could be used to simplify process identification, debugging, dump reading, it shows stack per each thread, etc.<br/>
Both tools are well tested and common in Windows environment.</li>
	<li><b>jstack Utility</b> - (part of JDK 1.6, including Windows) which shows thread stack and locking state per thread. It is non-disruptive and is very light with almost immediate execution (subsecond; tested), so it should not be a problem to run it even in pretty loaded environment</li>
	<li><b>Performance Monitor</b> - As trigger to shoot jstack when CPU goes up, built-in Windows XP Performance Monitor could be used (Control Panel/Administrative Tools/Performance). It has alerts on any of resource events, including CPU. Alert could start any program when chosen metric comes to the predefined value. It should start jstack-based script producing each time the file with the unique name (timestamp+). To avoid overloading the system with jstack runs, sampling interval could be set to 1min in alert definition.</li>
	<li><b>JRockit Mission Control</b> - When we'll get stacks of the process, likely, it will be not that easy to interpret it, as we should know what are the threads with most of activity. It could be done with no impact on performance with BEA JRockit "Mission Control" profiler, for example.</li>
</ol>


<h1><a name="TroubleshootingTools-PacketSniffer%2FNetworkAnalyzerTool"></a>Packet Sniffer/Network Analyzer Tool</h1>
<p><img class="emoticon" src="images/icons/emoticons/information.gif" height="16" width="16" align="absmiddle" alt="" border="0"/> See <a href="How to Configure Multicast.html#HowtoConfigureMulticast-PacketSniffer%2FNetworkAnalyzerTool">Packet Sniffer/Network Analyzer Tool</a> section for more details. </p>

<h1><a name="TroubleshootingTools-ThreadsDumper"></a>Threads Dumper</h1>
<h2><a name="TroubleshootingTools-SendSignalUtility"></a>SendSignal Utility</h2>
<p>Java has this great feature where if you hit Ctrl-break on the console, it dumps a list of threads and all their held locks to stdout. If your app is stuck or overwhelmed with too many threads, you can figure out what it is doing. If it is deadlocked/overwhelmed, sometimes the JVM can even tell you exactly which threads are involved. The problem is that if you can't get to the console, you can't hit ctrl-break. This commonly happens to us when we are running under an IDE. The IDE captures stdout and there is no console. If the app deadlocks, there is no way to get the crucial debugging info. Another common usage scenario is once we do not have access to the console itself.</p>

<p>A very useful utility can be used for sending a Windows Ctrl+break signal to any process (or Java Process) and which will dump the threads.<br/>
The nice thing is that only the target process is affected, and any process (even a windowed process) can be targeted.</p>

<p><img class="emoticon" src="images/icons/emoticons/information.gif" height="16" width="16" align="absmiddle" alt="" border="0"/> Download the Send.Signal EXE file from <b><a href="download/attachments/53903590/SendSignal.zip">HERE</a></b> or from the <a href="http://www.latenighthacking.com/projects/2003/sendSignal/">project webpage</a></p>

<p>Usage:<br/>
SendSignal &lt;pid&gt;<br/>
  &lt;pid&gt; - send ctrl-break to process &lt;pid&gt; (hex ok)</p>

<h1><a name="TroubleshootingTools-LogCorrelationTool"></a>Log Correlation Tool</h1>
<p>In many scenarios, mainly in production or large deployments, you many times face issues occurred in the same time over several components and cross several distributed machines. In order to track down what was the root cause of the event and which were just symptoms you need to review many log files and correlate what happened in that specific time. </p>

<p>In order to correlate events from different log files and visualize it you have to create a Log Correlation which is where the <b><a href="download/attachments/53903590/Eclipse TPTP - Log And Trace Analyzer.doc">Eclipse Log and Trace Analyzer component (TPTP LTA)</a></b> shines. This component is an extensive and extendable framework that includes built in probes mechanism.</p>

                     </td>
</tr>
</table>
<table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr>
<td height="12" background="http://www.gigaspaces.com/wiki/images/border/border_bottom.gif"><img src="images/border/spacer.gif" width="1" height="1" border="0"/></td>
</tr>
<tr>
<td align="center"><font color="grey"><a href="http://www.gigaspaces.com">GigaSpaces.com</a> -
		<a href="http://www.gigaspaces.com/wiki/x/xwBmAg" class="smalltext">Legal Notice</a> -
		<a href="http://www.gigaspaces.com/wiki/x/xgBmAg" class="smalltext">3rd Party Licenses</a> -
		<a href="http://www.gigaspaces.com/wiki/x/BQFmAg" class="smalltext">Site Map</a> -
		<a href="http://www.gigaspaces.com/wiki/display/API/API+Documentation+Portal" class="version-link">API Docs</a> -
		<a href="http://forum.openspaces.org/forum.jspa?forumID=175" class="version-link">Forum</a> -
		<a href="http://www.gigaspaces.com/LatestProductVersion" class="version-link">Downloads</a> -
		<a href="http://blog.gigaspaces.com/" class="version-link">Blog</a> -
		<a href="http://www.gigaspaces.com/os_papers.html" class="version-link">White Papers</a> -
		<a href="mailto:techw@gigaspaces.com">Contact Tech Writing</a> -
		<i><a href="http://www.atlassian.com/software/confluence">Gen. by Atlassian Confluence</a></i></font></td>
</tr>
</table>
     </body>
</html>
