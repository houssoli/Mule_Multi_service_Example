<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
     <head>
         <title>XAP 8.0 Documentation : Asynchronous Persistency with the Mirror</title>
<link rel="stylesheet" href="styles/site.css" type="text/css" />
         <META http-equiv="Content-Type" content="text/html; charset=UTF-8">
		 <style>
.back-to {
	color: #666666;
	font-weight: bold;
}	 
a.back-to:link, a.back-to:visited, a.back-to:hover, a.back-to:active  {
	color: #666666;
}	 
		 </style>
     </head>

     <body>
<table class="pagecontent" border="0" cellpadding="0" cellspacing="0" width="100%" bgcolor="#ffffff">
<tr>
<td valign="top" class="pagebody">
<div class="pageheader">
<span class="back-to">XAP 8.0 Documentation > <a href="index.html">Back to Table of Contents</a></span><br>
<h1>Asynchronous Persistency with the Mirror</h1>
</div>
<br>

<script type='text/javascript'>//<![CDATA[
function debug() { }
// ]]></script><script type='text/javascript' src='/wiki/download/resources/net.customware.confluence.plugin.composition:composition-setup/js/browser.js'>//<![CDATA[
// ]]></script><script type='text/javascript' src='/wiki/download/resources/net.customware.confluence.plugin.composition:composition-setup/js/behaviour.js'>//<![CDATA[
// ]]></script><script type='text/javascript' src='/wiki/download/resources/net.customware.confluence.plugin.composition:composition-setup/js/memory.js'>//<![CDATA[
// ]]></script><script type='text/javascript' src='/wiki/download/resources/net.customware.confluence.plugin.composition:composition-setup/js/cloak.js'>//<![CDATA[
// ]]></script><script type='text/javascript'>//<![CDATA[
Cloak.closeHTML = "<img src=\'/wiki/download/resources/net.customware.confluence.plugin.composition:toggle-cloak/img/navigate_down_10.gif\'/>";
Cloak.openHTML = "<img src=\'/wiki/download/resources/net.customware.confluence.plugin.composition:toggle-cloak/img/navigate_right_10.gif\'/>";
Cloak.toggleZone = true;
Cloak.memoryDuration = 0;
Cloak.memoryPrefix = "contentId:53903555";
Cloak.memoryPath = "/wiki/";
// ]]></script><style type='text/css'>
.cloakToggle { /* Definition for state toggling image */
cursor:hand;
cursor:pointer;
}
</style><script type='text/javascript' src='/wiki/download/resources/net.customware.confluence.plugin.composition:composition-setup/js/transitions.js'>//<![CDATA[
// ]]></script><script type='text/javascript' src='/wiki/download/resources/net.customware.confluence.plugin.composition:composition-setup/js/deck.js'>//<![CDATA[
// ]]></script><link rel='stylesheet' type='text/css'  href='/wiki/styles/main-action.css?pluginCompleteKey=net.customware.confluence.plugin.composition:composition-setup&stylesheetName=deck&spaceKey=XAP8'/><script type='text/javascript'>//<![CDATA[
Deck.memoryDuration = 0;
Deck.memoryPrefix = "contentId:53903555";
Deck.memoryPath = "/wiki/";
// ]]></script>


<div style="border-style:solid; border-color:#3C78B5; border-width:thin; padding-left:20px; padding-bottom:20px; padding-top:20px; padding-right:20px; background-color:#D8E4F1"> 

<p><b>Section Summary:</b>  Reliable Asynchronous Persistency (Mirror) </p>
</div>

<h1><a name="AsynchronousPersistencywiththeMirror-Overview"></a>Overview</h1>

<p>The GigaSpaces Mirror Service (also known as Persistency as a Service, or PaaS) provides reliable asynchronous persistency. This allows you to asynchronously delegate the operations conducted with the In-Memory-Data-Grid (IMDG) into a backend database, significantly reducing the performance overhead.</p>
<div class="indent20 inline" style="margin-left: 20px;"><style type="text/css">div.inline p:first-child { display: inline; }</style><p><img src="download/attachments/48235229/data-grid-async-persist.jpg" align="absmiddle" border="0"/></p></div>
<p>The Mirror service ensures that data will not be lost in the event of a failure. This way, you can add persistency to your application just by running the Mirror Service, without touching the real-time portion of your application in either configuration or code. This service provides fine-grained control of which object needs to be persisted.</p>

<p>The mirror does need a backup since it does not hold any state. The actual state of the latest committed database transaction stored within the primary and the backup space instances, <b>not in the Mirror</b>. Essentially, the Mirror acts as a dispatcher and push the changes done at the space (all primary partitions) into the Database (or any other external data source) in an asynchronous reliable manner. In case of a failure of the Mirror, it will be restarted automatically and the primary instances will playback the un-committed transactions while the Mirror was down. The Mirror PU (like any deployed service) is mobile. It can run on any machine running a GSC, so the GSM will pick one of the existing GSCs to provision the missing Mirror PU.</p>

<p>If from some reason the SLA you applied forcing the Mirror PU to run on a specific machine that is unavailable (for example on a specific zone which does not have any running containers), the primary and backup will hold the transaction data within their redo log queue in memory. In some point they will store it on file until the Mirror machine will be restarted.</p>

<div class='panelMacro'><table class='tipMacro'><colgroup><col width='24'><col></colgroup><tr><td valign='top'><img src="images/icons/emoticons/check.gif" width="16" height="16" align="absmiddle" alt="" border="0"></td><td>You should not deploy the mirror in clustered mode nor have multiple instances of it. It should have a single instance as part of its SLA configuration.</td></tr></table></div>

<p>Enabling the Mirror Service involves the following:</p>
<ul class="alternate" type="square">
	<li>The Data-Grid Processing Unit Mirror Settings</li>
	<li>The Mirror Service Processing Unit Settings</li>
</ul>


<p>The above share the <b>same</b> <a href="External Data Source.html" title="External Data Source">External Data Source</a> settings but have different space settings. See the <a href="Hibernate External Data Source.html" title="Hibernate External Data Source">Hibernate External Data Source</a> for details how to use the built-in <tt>HibernateExternalDataSource</tt>.</p>

<h1><a name="AsynchronousPersistencywiththeMirror-TheDataGridProcessingUnit"></a>The Data-Grid Processing Unit</h1>

<p>The <tt>cluster-config.mirror-service</tt> <tt>space</tt> settings specify the interaction between the IMDG primary spaces and the Mirror Service. The <tt>mirror="true"</tt> <tt>space</tt> element tag enables the replication mechanism from the IMDG Primary spaces to the Mirror Service. Once the <tt>mirror="true"</tt> is specified, all IMDG members will be Mirror aware and will be delegating their activities into the Mirror service. The IMDG primary instance will replicate the operations that have been logged within the primary redo log every <tt>interval-millis</tt> amount of time or <tt>interval-opers</tt> amount of operations. Both of these mechanisms are always active and the first one that is breached triggers the replication event.</p>

<div class='panelMacro'><table class='tipMacro'><colgroup><col width='24'><col></colgroup><tr><td valign='top'><img src="images/icons/emoticons/check.gif" width="16" height="16" align="absmiddle" alt="" border="0"></td><td>If you are not using the <tt>mirror="true"</tt> with the Data-Grid PU, you should use the following property instead:<br/>
<tt>cluster-config.mirror-service.enabled=true</tt></td></tr></table></div>

<p>The IMDG Mirror replication settings includes the following options:</p>
<table class='confluenceTable'><tbody>
<tr>
<th class='confluenceTh'> Property </th>
<th class='confluenceTh'> Description </th>
<th class='confluenceTh'> Default </th>
</tr>
<tr>
<td class='confluenceTd'> cluster-config.mirror-service.url </td>
<td class='confluenceTd'> used to locate the Mirror Service. In case you change the name of the Mirror Service specified as part of the Mirror PU, you should modify this parameter value to facilitate the correct Mirror service URL. </td>
<td class='confluenceTd'> jini://*/mirror-service_container/mirror-service </td>
</tr>
<tr>
<td class='confluenceTd'> cluster-config.mirror-service.bulk-size </td>
<td class='confluenceTd'> The amount of operations to be transmitted in one bulk (in quantity and not actual memory size) from an active IMDG primary to the Mirror Service. </td>
<td class='confluenceTd'> 100 </td>
</tr>
<tr>
<td class='confluenceTd'> cluster-config.mirror-service.interval-millis </td>
<td class='confluenceTd'> The replication frequency - Replication will happen every <tt>interval-millis</tt> mulliseconds </td>
<td class='confluenceTd'> 2000 </td>
</tr>
<tr>
<td class='confluenceTd'> cluster-config.mirror-service.interval-opers </td>
<td class='confluenceTd'> The replication buffer size - Replication will happen every <tt>interval-opers</tt> operations. </td>
<td class='confluenceTd'> 100 </td>
</tr>
<tr>
<td class='confluenceTd'> cluster-config.groups.group.repl-policy.repl-original-state </td>
<td class='confluenceTd'> The replication reconciliation mode - This settings should be enabled to ensure that write/take operations or multiple updates for the same space object will be sent to the mirror and not will be discarded when sent within the same batch. </td>
<td class='confluenceTd'> true </td>
</tr>
<tr>
<td class='confluenceTd'> cluster-config.mirror-service.on-redo-log-capacity-exceeded </td>
<td class='confluenceTd'> Available options: <br clear="all" />block-operations - all cluster operations that need to be replicated (write/update/take) are blocked until the redo log size decreases below the capacity. (Users get RedoLogCapacityExceededException exceptions while trying to execute these operations.)
<br clear="all" />drop-oldest - the oldest packet in the redo log is dropped. <br clear="all" />See the <a href="Controlling the Replication Redo Log.html" title="Controlling the Replication Redo Log">Controlling the Replication Redo Log</a> for details. </td>
<td class='confluenceTd'> block-operations </td>
</tr>
<tr>
<td class='confluenceTd'> cluster-config.mirror-service.redo-log-capacity </td>
<td class='confluenceTd'> Specifies the total capacity of replication packets the redo log can hold for a mirror service replication target.<br clear="all" />See the <a href="Controlling the Replication Redo Log.html" title="Controlling the Replication Redo Log">Controlling the Replication Redo Log</a> for details. </td>
<td class='confluenceTd'> 1000000 </td>
</tr>
<tr>
<td class='confluenceTd'>cluster-config.groups.group.repl-policy.async-replication.async-channel-shutdown-timeout </td>
<td class='confluenceTd'> Determines how long (in ms) the primary space will wait before replicating all existing redo log data into its targets before shutting down. </td>
<td class='confluenceTd'> 300000 ms </td>
</tr>
</tbody></table>

<div class='panelMacro'><table class='noteMacro'><colgroup><col width='24'><col></colgroup><tr><td valign='top'><img src="images/icons/emoticons/warning.gif" width="16" height="16" align="absmiddle" alt="" border="0"></td><td>The Mirror Service may receive replication events from multiple active primary partitions. Each active partition sends its operations to the Mirror service via dedicated replication channel. The Mirror handles incoming replication requests simultaneously. Every Primary Space sending its operations to the Mirror Service in the same order the operations have been executed allowing the Mirror preserve the consistency of the data within the External Data Source.</td></tr></table></div>
<p>The Data-Grid Space settings would look like this:</p>
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-xml">&lt;os-core:space id=<span class="code-quote">"space"</span> url=<span class="code-quote">"/./space"</span> schema=<span class="code-quote">"persistent"</span> 
    mirror=<span class="code-quote">"true"</span> external-data-source=<span class="code-quote">"hibernateDataSource"</span>&gt;
    <span class="code-tag">&lt;os-core:properties&gt;</span>
        <span class="code-tag">&lt;props&gt;</span>
            <span class="code-tag"><span class="code-comment">&lt;!-- Use ALL IN CACHE - Read Only from the database--&gt;</span></span>
            <span class="code-tag">&lt;prop key=<span class="code-quote">"space-config.engine.cache_policy"</span>&gt;</span>1<span class="code-tag">&lt;/prop&gt;</span>
            <span class="code-tag">&lt;prop key=<span class="code-quote">"space-config.external-data-source.usage"</span>&gt;</span>read-only<span class="code-tag">&lt;/prop&gt;</span>
            <span class="code-tag">&lt;prop key=<span class="code-quote">"cluster-config.cache-loader.external-data-source"</span>&gt;</span>true<span class="code-tag">&lt;/prop&gt;</span>
            <span class="code-tag">&lt;prop key=<span class="code-quote">"cluster-config.cache-loader.central-data-source"</span>&gt;</span>true<span class="code-tag">&lt;/prop&gt;</span>
            <span class="code-tag">&lt;prop key=<span class="code-quote">"cluster-config.mirror-service.url"</span>&gt;</span>
                jini://*/mirror-service_container/mirror-service
            <span class="code-tag">&lt;/prop&gt;</span>
            <span class="code-tag">&lt;prop key=<span class="code-quote">"cluster-config.mirror-service.bulk-size"</span>&gt;</span>100<span class="code-tag">&lt;/prop&gt;</span>
            <span class="code-tag">&lt;prop key=<span class="code-quote">"cluster-config.mirror-service.interval-millis"</span>&gt;</span>2000<span class="code-tag">&lt;/prop&gt;</span>
            <span class="code-tag">&lt;prop key=<span class="code-quote">"cluster-config.mirror-service.interval-opers"</span>&gt;</span>100<span class="code-tag">&lt;/prop&gt;</span>
            <span class="code-tag">&lt;prop key=<span class="code-quote">"cluster-config.groups.group.repl-policy.repl-original-state"</span>&gt;</span>true<span class="code-tag">&lt;/prop&gt;</span>
        <span class="code-tag">&lt;/props&gt;</span>
    <span class="code-tag">&lt;/os-core:properties&gt;</span>
<span class="code-tag">&lt;/os-core:space&gt;</span>

<span class="code-tag">&lt;bean id=<span class="code-quote">"hibernateDataSource"</span> class=<span class="code-quote">"org.openspaces.persistency.hibernate.DefaultHibernateExternalDataSource"</span>&gt;</span>
    <span class="code-tag">&lt;property name=<span class="code-quote">"sessionFactory"</span> ref=<span class="code-quote">"sessionFactory"</span>/&gt;</span>
<span class="code-tag">&lt;/bean&gt;</span></pre>
</div></div>
<p>The above example:</p>
<ul class="alternate" type="square">
	<li>Configures the Space to connect to its mirror Space. By default, it will lookup a mirror Space called <tt>mirror-service</tt>.</li>
	<li>Configures the Space to only read data from the external data source (See the <tt>space-config.external-data-source.usage</tt> property). This means that all destructive operations will be delegated into the database via the Mirror service.</li>
	<li>Configures the Data-Grid to use an external data source that is <b>central</b> to the cluster. This means that both primary and backup IMDG instances will interact with the same External Data Source.</li>
</ul>


<p><img src="download/attachments/19890517/referto.gif" align="absmiddle" border="0"/> See the <a href="External Data Source Advanced Topics.html#ExternalDataSourceAdvancedTopics-Properties">External Data Source Properties</a> and the <a href="Hibernate External Data Source.html" title="Hibernate External Data Source">Hibernate External Data Source</a> for full details about the EDS properties the you may configure.</p>
<p>You <b>must use a Data-Grid cluster schema that includes a backup</b> (i.e. <tt>partitioned-sync2backup</tt>) when running a Mirror Service. Without having backup, the Primary IMDG Spaces <b>will not</b> replicate their activities to the Mirror Service. For testing purposes, in case you don't want to start backup spaces, you can use the <tt>partitioned-sync2backup</tt> cluster schema and have 0 as the number of backups - this will still allow the primary spaces to replicate their operations to the Mirror.</p>

<h1><a name="AsynchronousPersistencywiththeMirror-TheMirrorProcessingUnit"></a>The Mirror Processing Unit</h1>

<p>The Mirror Service is constructed using the <tt>Mirror</tt> tag. The Mirror Service itself is <b>not</b> a regular Space. It is dispatching the operations which have been replicated from the IMDG primary spaces to the External Data Source (i.e. Database). The Mirror Service should be constructed as a separate processing unit, which includes only its definition. </p>

<p>The Mirror settings includes the following options:</p>
<table class='confluenceTable'><tbody>
<tr>
<th class='confluenceTh'> Property </th>
<th class='confluenceTh'> Description </th>
<th class='confluenceTh'> Default </th>
</tr>
<tr>
<td class='confluenceTd'>operation-grouping</td>
<td class='confluenceTd'> Options: <br clear="all" />group-by-space-transaction - Mirror delegating each transaction seperatly to the external data source (database).
<br clear="all" />group-by-replication-bulk - Mirror delegating all replicated items as one bulk to the external data source (database).<br clear="all" />See the <a href="Async Persistency - Mirror - Advanced.html#AsyncPersistency-Mirror-Advanced-MirrorbehaviorwithDistributedTransactions">Mirror behavior with Distributed Transactions</a> for details</td>
<td class='confluenceTd'> group-by-replication-bulk </td>
</tr>
<tr>
<td class='confluenceTd'>source-space name</td>
<td class='confluenceTd'> The name of source space (cluster) this mirror serves </td>
<td class='confluenceTd'> NONE, must be supplied </td>
</tr>
<tr>
<td class='confluenceTd'>source-space partitions</td>
<td class='confluenceTd'> The number of partitions in source space (cluster) this mirror serves </td>
<td class='confluenceTd'> NONE, must be supplied </td>
</tr>
<tr>
<td class='confluenceTd'>source-space backups</td>
<td class='confluenceTd'> The number of backups per partition in source space (cluster) this mirror serves </td>
<td class='confluenceTd'> NONE, must be supplied </td>
</tr>
</tbody></table>

<p>The following configuration shows how to configure a processing unit, to act as the Mirror Service:</p>
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-xml"><span class="code-tag">&lt;os-sla:sla number-of-instances=<span class="code-quote">"1"</span> /&gt;</span>

<span class="code-tag">&lt;os-core:mirror id=<span class="code-quote">"mirror"</span> url=<span class="code-quote">"/./mirror-service"</span> external-data-source=<span class="code-quote">"hibernateDataSource"</span> operation-grouping=<span class="code-quote">"group-by-replication-bulk"</span>&gt;</span>
    <span class="code-tag">&lt;os-core:source-space name=<span class="code-quote">"mySpace"</span> partitions=<span class="code-quote">"2"</span> backups=<span class="code-quote">"1"</span>/&gt;</span>
<span class="code-tag">&lt;/os-core:mirror&gt;</span>

<span class="code-tag">&lt;bean id=<span class="code-quote">"hibernateDataSource"</span> class=<span class="code-quote">"org.openspaces.persistency.hibernate.DefaultHibernateExternalDataSource"</span>&gt;</span>
    <span class="code-tag">&lt;property name=<span class="code-quote">"sessionFactory"</span> ref=<span class="code-quote">"sessionFactory"</span>/&gt;</span>
<span class="code-tag">&lt;/bean&gt;</span></pre>
</div></div>

<p>The OpenSpaces mirror name space is a syntactic sugar and it is equivalent to the following configuration using regular space properties:</p>
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-xml"><span class="code-tag">&lt;os-core:space id=<span class="code-quote">"mirror"</span> url=<span class="code-quote">"/./mirror-service"</span> schema=<span class="code-quote">"mirror"</span> external-data-source=<span class="code-quote">"hibernateDataSource"</span>&gt;</span>
    <span class="code-tag">&lt;os-core:properties&gt;</span>
	<span class="code-tag">&lt;props&gt;</span>
             <span class="code-tag">&lt;prop key=<span class="code-quote">"space-config.mirror-service.cluster.name"</span>&gt;</span>mySpace<span class="code-tag">&lt;/prop&gt;</span>
             <span class="code-tag">&lt;prop key=<span class="code-quote">"space-config.mirror-service.cluster.partitions"</span>&gt;</span>2<span class="code-tag">&lt;/prop&gt;</span>
             <span class="code-tag">&lt;prop key=<span class="code-quote">"space-config.mirror-service.cluster.backups-per-partition"</span>&gt;</span>1<span class="code-tag">&lt;/prop&gt;</span>
	     <span class="code-tag">&lt;prop key=<span class="code-quote">"space-config.mirror-service.operation-grouping"</span>&gt;</span>group-by-replication-bulk<span class="code-tag">&lt;/prop&gt;</span>
	<span class="code-tag">&lt;/props&gt;</span>
    <span class="code-tag">&lt;/os-core:properties&gt;</span>    
<span class="code-tag">&lt;/os-core:space&gt;</span></pre>
</div></div>

<ul class="alternate" type="square">
	<li>The above configuration constructs a Mirror Service using GigaSpaces built-in <a href="Hibernate External Data Source.html" title="Hibernate External Data Source">Hibernate External Data Source</a>. The <tt>hibernateDataSource</tt> should have its <tt>sessionFactory</tt> injected.</li>
	<li>The name of the Mirror Space is important. The <tt>mirror-service</tt> is the default name for a mirror Space, which is then used by the IMDG to connect to its mirror.</li>
	<li>The <tt>os-sla</tt> definition insures that there will be only one Mirror Service instance running.</li>
	<li>The configuration above should exist within the mirror PU pu.xml file.</li>
</ul>


<h2><a name="AsynchronousPersistencywiththeMirror-TheMirrorPUContent"></a>The Mirror PU Content</h2>

<p>The Mirror processing unit structure is shown below:</p>
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">-- example-mirror
------ META-INF
---------- spring
-------------- pu.xml</pre>
</div></div>
<p>See the <a href="The Processing Unit Structure and Configuration.html" title="The Processing Unit Structure and Configuration">The Processing Unit Structure and Configuration</a> for more information on the processing unit structure.</p>

<p>The relevant Hibernate JAR file and its third party dependencies should be available to the mirror processing unit. The jar files should be placed in the processing unit <tt>lib</tt> directory.</p>

<h2><a name="AsynchronousPersistencywiththeMirror-MirrorUndeploy"></a>Mirror Undeploy</h2>

<p>When cluster is undeployed, the mirror service must be undeployed last. This will ensure that all data is persisted properly through mirror async persistency.<br/>
Before primary space is undeployed/redeployed, all data changes are flushed to mirror. This operation is limited by timeout that can be configured using the following property:</p>
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-xml"><span class="code-tag"><span class="code-comment">&lt;!-- default value is 5 minutes --&gt;</span></span>
&lt;prop 
    key=<span class="code-quote">"cluster-config.groups.group.repl-policy.async-replication.async-channel-shutdown-timeout"</span>&gt;
    300000
<span class="code-tag">&lt;/prop&gt;</span></pre>
</div></div>

<h1><a name="AsynchronousPersistencywiththeMirror-OptimizingtheMirrorActivity"></a>Optimizing the Mirror Activity</h1>

<div class='panelMacro'><table class='warningMacro'><colgroup><col width='24'><col></colgroup><tr><td valign='top'><img src="images/icons/emoticons/forbidden.gif" width="16" height="16" align="absmiddle" alt="" border="0"></td><td>
<p>The database update rate by the Mirror is a function of the number of IMDG partitions, database update speed with a single thread, database transaction size, network latency between the Mirror and the Database, hibernate overhead (if hibernate is being used as the persistence mechanism), relevant table indexed columns, and the database record size. Also, when distributed transactions are used with the IMDG, this may improve the database update rate (since multiple partitions will be sending their updates to the Mirror, which can batch all cumulative updates to the database), but this will impact the IMDG transaction latency. </p></td></tr></table></div>

<p>You might want to tune the IMDG and the Mirror activity to push data into the database faster. Here are some recommendations you should consider:</p>
<ul class="alternate" type="square">
	<li>Optimize the Space Class structure to include fewer fields. Less fields means less overhead when the IMDG replicates the data to the Mirror Service.</li>
	<li>Tune the <tt>bulk-size</tt>, <tt>interval-millis</tt> and <tt>interval-opers</tt> to perform the replication in larger batches and less frequently. This means you should increase the <tt>bulk-size</tt>, <tt>interval-millis</tt> and <tt>interval-opers</tt> to have larger values than the defaults. The exact values depends with the network speed, the average size of the objects and the database configuration and machine speed. Here is an example for a configuration that is relevant for IMDG with relatively small objects (less than one K) and high rate of operations (more than 10,000 operations per second for partition):
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-xml"><span class="code-tag">&lt;prop key=<span class="code-quote">"cluster-config.mirror-service.bulk-size"</span>&gt;</span>10000<span class="code-tag">&lt;/prop&gt;</span>
<span class="code-tag">&lt;prop key=<span class="code-quote">"cluster-config.mirror-service.interval-millis"</span>&gt;</span>5000<span class="code-tag">&lt;/prop&gt;</span>
<span class="code-tag">&lt;prop key=<span class="code-quote">"cluster-config.mirror-service.interval-opers"</span>&gt;</span>50000<span class="code-tag">&lt;/prop&gt;</span></pre>
</div></div>
<p>With the above configuration the primary partition will replicate its redo log activitities to the Mirror service every 5 seconds or every 50,000 operations. The replication will occure in batches of 10,000 objects per batch.</p></li>
	<li>Tune the External Data Source to commit data into the database in batches.</li>
	<li>Optimize the database transaction support.</li>
	<li>Use stateless session with the <a href="Hibernate External Data Source.html" title="Hibernate External Data Source">Hibernate External Data Source</a> configuration. See the <tt>StatelessHibernateExternalDataSource</tt>.</li>
	<li>Implement a Mirror Service that will write the incoming data into a CSV file. This should be faster than writing data into the database. Later import the data into the database. (normally very fast operation)</li>
	<li>Increase the database maximum connections.</li>
	<li>Optimize Hibernate mapping and configuration. Using a proper <a href="External Data Source Advanced Topics.html#ExternalDataSourceAdvancedTopics-HibernateIDGeneration">Hibernate ID generator</a> is crucial for getting optimum performance.</li>
	<li>Use PARTIAL_UPDATE (see <a href="http://www.gigaspaces.com/wiki/display/XAP8/POJO+Support">Partial Update</a>). Updates to an object that are performed using the PARTIAL_UPDATE modifier can be executed on the mirror as partial update as well. This can increase the performance in case a lot of updates are performed on a large object.<br/>
To use this optimization you need to set the following space property:</li>
</ul>


<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-xml"><span class="code-tag">&lt;prop key=<span class="code-quote">"cluster-config.mirror-service.supports-partial-update"</span>&gt;</span>true<span class="code-tag">&lt;/prop&gt;</span></pre>
</div></div>

<p>If you are using a custom implementation of the External Data Source you also need to implement how the partial update is persisted. <br/>
See com.gigaspaces.datasource.BulkItem for more details.</p>

<h1><a name="AsynchronousPersistencywiththeMirror-MirrorMonitoring"></a>Mirror Monitoring</h1>
<p>The activity of the mirror service can be monitored using the <a href="Administration and Monitoring API.html#AdministrationandMonitoringAPI-dministrationandMonitoringAPIMonitoringtheMir...">Administration and monitoring API</a>. This API exposes statistics on operations that were executed by the mirror and can be used to monitor the mirror throughput and health status. </p>

<p>You may view Mirror and its replication statistics via the <a href="GigaSpaces Management Center.html" title="GigaSpaces Management Center">GigaSpaces Management Center</a>. Move into the Space Browser tab, click the top tree Spaces icon, right click the table columns title area on the right panel, select the columns you would to view as part of the table and click OK.</p>
<div class="indent20 inline" style="margin-left: 20px;"><style type="text/css">div.inline p:first-child { display: inline; }</style><p><a href='http://www.gigaspaces.com/wiki/download/attachments/48235229/mirror_ui_stats.jpg' target='mirror_ui_stats.jpg' onClick='window.open("http://www.gigaspaces.com/wiki/download/attachments/48235229/mirror_ui_stats.jpg", "mirror_ui_stats.jpg", "height=516,width=922,menubar=no,status=no,toolbar=no"); return false;'><img src="download/thumbnails/48235229/mirror_ui_stats.jpg" align="absmiddle" border="0"/></a></p></div>

<div class='panelMacro'><table class='tipMacro'><colgroup><col width='24'><col></colgroup><tr><td valign='top'><img src="images/icons/emoticons/check.gif" width="16" height="16" align="absmiddle" alt="" border="0"></td><td>See also the <a href="http://www.gigaspaces.com/wiki/display/SBP/Mirror+Monitor" title="Mirror Monitor">Mirror Monitor JMX utility</a> for graphical mirror service monitoring via JMX</td></tr></table></div>

<h1><a name="AsynchronousPersistencywiththeMirror-AdvancedInformation%26Operations"></a>Advanced Information &amp; Operations</h1>

<p><img src="download/attachments/19890517/referto.gif" align="absmiddle" border="0"/> For more advanced operations and information see <a href="Async Persistency - Mirror - Advanced.html" title="Async Persistency - Mirror - Advanced">Async Persistency &#45; Mirror &#45; Advanced</a>.</p>

                     </td>
</tr>
</table>
<table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr>
<td height="12" background="http://www.gigaspaces.com/wiki/images/border/border_bottom.gif"><img src="images/border/spacer.gif" width="1" height="1" border="0"/></td>
</tr>
<tr>
<td align="center"><font color="grey"><a href="http://www.gigaspaces.com">GigaSpaces.com</a> -
		<a href="http://www.gigaspaces.com/wiki/x/xwBmAg" class="smalltext">Legal Notice</a> -
		<a href="http://www.gigaspaces.com/wiki/x/xgBmAg" class="smalltext">3rd Party Licenses</a> -
		<a href="http://www.gigaspaces.com/wiki/x/BQFmAg" class="smalltext">Site Map</a> -
		<a href="http://www.gigaspaces.com/wiki/display/API/API+Documentation+Portal" class="version-link">API Docs</a> -
		<a href="http://forum.openspaces.org/forum.jspa?forumID=175" class="version-link">Forum</a> -
		<a href="http://www.gigaspaces.com/LatestProductVersion" class="version-link">Downloads</a> -
		<a href="http://blog.gigaspaces.com/" class="version-link">Blog</a> -
		<a href="http://www.gigaspaces.com/os_papers.html" class="version-link">White Papers</a> -
		<a href="mailto:techw@gigaspaces.com">Contact Tech Writing</a> -
		<i><a href="http://www.atlassian.com/software/confluence">Gen. by Atlassian Confluence</a></i></font></td>
</tr>
</table>
     </body>
</html>
