<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
     <head>
         <title>XAP 8.0 Documentation : Using JMS with OpenSpaces Example</title>
<link rel="stylesheet" href="styles/site.css" type="text/css" />
         <META http-equiv="Content-Type" content="text/html; charset=UTF-8">
		 <style>
.back-to {
	color: #666666;
	font-weight: bold;
}	 
a.back-to:link, a.back-to:visited, a.back-to:hover, a.back-to:active  {
	color: #666666;
}	 
		 </style>
     </head>

     <body>
<table class="pagecontent" border="0" cellpadding="0" cellspacing="0" width="100%" bgcolor="#ffffff">
<tr>
<td valign="top" class="pagebody">
<div class="pageheader">
<span class="back-to">XAP 8.0 Documentation > <a href="index.html">Back to Table of Contents</a></span><br>
<h1>Using JMS with OpenSpaces Example</h1>
</div>
<br>

<script type='text/javascript'>//<![CDATA[
function debug() { }
// ]]></script><script type='text/javascript' src='/wiki/download/resources/net.customware.confluence.plugin.composition:composition-setup/js/browser.js'>//<![CDATA[
// ]]></script><script type='text/javascript' src='/wiki/download/resources/net.customware.confluence.plugin.composition:composition-setup/js/behaviour.js'>//<![CDATA[
// ]]></script><script type='text/javascript' src='/wiki/download/resources/net.customware.confluence.plugin.composition:composition-setup/js/memory.js'>//<![CDATA[
// ]]></script><script type='text/javascript' src='/wiki/download/resources/net.customware.confluence.plugin.composition:composition-setup/js/cloak.js'>//<![CDATA[
// ]]></script><script type='text/javascript'>//<![CDATA[
Cloak.closeHTML = "<img src=\'/wiki/download/resources/net.customware.confluence.plugin.composition:toggle-cloak/img/navigate_down_10.gif\'/>";
Cloak.openHTML = "<img src=\'/wiki/download/resources/net.customware.confluence.plugin.composition:toggle-cloak/img/navigate_right_10.gif\'/>";
Cloak.toggleZone = true;
Cloak.memoryDuration = 0;
Cloak.memoryPrefix = "contentId:53903418";
Cloak.memoryPath = "/wiki/";
// ]]></script><style type='text/css'>
.cloakToggle { /* Definition for state toggling image */
cursor:hand;
cursor:pointer;
}
</style><script type='text/javascript' src='/wiki/download/resources/net.customware.confluence.plugin.composition:composition-setup/js/transitions.js'>//<![CDATA[
// ]]></script><script type='text/javascript' src='/wiki/download/resources/net.customware.confluence.plugin.composition:composition-setup/js/deck.js'>//<![CDATA[
// ]]></script><link rel='stylesheet' type='text/css'  href='/wiki/styles/main-action.css?pluginCompleteKey=net.customware.confluence.plugin.composition:composition-setup&stylesheetName=deck&spaceKey=XAP8'/><script type='text/javascript'>//<![CDATA[
Deck.memoryDuration = 0;
Deck.memoryPrefix = "contentId:53903418";
Deck.memoryPath = "/wiki/";
// ]]></script>


<div style="border-style:solid; border-color:#3C78B5; border-width:thin; padding-left:20px; padding-bottom:20px; padding-top:20px; padding-right:20px; background-color:#D8E4F1"> 

<p><b>Section Summary:</b>  Including a JMS feeder in a processing unit using Spring JmsTemplate, and using the JMS message converter to send POJOs to the space, using the JMS API. </p>
</div>

<table class="sectionMacro" border="0" cellpadding="5" cellspacing="0" width="100%"><tbody><tr>
<td class="confluenceTd"  valign="top" width="6%"></td>
<td class="confluenceTd"  valign="top" width="86%">
<div class="" align='center'><table class='confluenceTable'><tbody>
<tr>
<th class='confluenceTh'><img src="download/attachments/53903418/wiki_icon_folder.gif" align="absmiddle" border="0"/></th>
<th class='confluenceTh'>Example Root</th>
<td class='confluenceTd'><tt>&lt;GigaSpaces Root&gt;\examples\data</tt> </td>
</tr>
</tbody></table></div>
</td>
<td class="confluenceTd"  valign="top" width="6%"></td></tr></tbody></table>

<h1><a name="UsingJMSwithOpenSpacesExample-Overview"></a>Overview</h1>
<p>The <a href="http://www.gigaspaces.com/wiki/display/GS6/OpenSpaces+Data+Example">OpenSpace Data Example</a> demonstrates how to use a JMS feeder to send POJOs to the space. In order to make it happen we use two main features: Spring <a href="http://static.springframework.org/spring/docs/2.0.x/api/org/springframework/jms/core/JmsTemplate.html">JmsTemplate</a> and JMS <a href="JMS-Space Interoperability.html" title="JMS-Space Interoperability">MessageConverter</a>. This section describes how those features are used in the example.</p>

<h1><a name="UsingJMSwithOpenSpacesExample-Architecture"></a>Architecture</h1>

<p>A processing unit runs the <tt>JMSDataFeeder</tt> that writes <tt>Data</tt> objects with raw data into the remote space. The <tt>JMSDataFeeder</tt> uses Spring's <a href="http://static.springframework.org/spring/docs/2.0.x/api/org/springframework/jms/core/JmsTemplate.html">JmsTemplate</a> over GigaSpaces JMS, to write non-processed <tt>Data</tt> objects into the space every second. The <tt>JMSDataFeeder</tt> uses an <tt>ObjectMessage2ObjectConverter</tt> to convert the JMS ObjectMessages to <tt>Data</tt> objects before they are written to the space. Every <tt>Data</tt> object is written to the space with the processed value set to false, which is later set to true by the <tt>DataProcessor</tt>.</p>

<h1><a name="UsingJMSwithOpenSpacesExample-JMSDataFeeder"></a>JMSDataFeeder</h1>

<p>The <tt>JMSDataFeeder</tt> is similar to the <tt>DataFeeder</tt>. The difference between the beans is that the <tt>JMSDataFeeder</tt> uses Spring's <a href="http://static.springframework.org/spring/docs/2.0.x/api/org/springframework/jms/core/JmsTemplate.html">JmsTemplate</a> on top of the GigaSpaces JMS implementation to write the <tt>Data</tt> objects to the space; no space API is used directly. This is possible due to the usage of a <tt>MessageConverter</tt> that converts JMS messages into any required POJO type, in this case, <tt>Data</tt>. In this example, we configure the <tt>ConnectionFactory</tt> to use the <tt>ObjectMessage2ObjectConverter</tt> that comes with the GigaSpaces JMS implementation. The <tt>ObjectMessage2ObjectConverter</tt> receives a JMS <tt>ObjectMessage</tt> and returns the message's content (body) as the object to write to the space. The JMS <tt>ObjectMessage</tt> itself, including headers, properties etc., is not written. The <tt>JMSDataFeeder</tt> uses Spring's <a href="http://static.springframework.org/spring/docs/2.0.x/api/org/springframework/jms/core/JmsTemplate.html">JmsTemplate</a> and <tt>MessageCreator</tt> to send <tt>ObjectMessages</tt> that contain the <tt>Data</tt> objects, and the converter makes sure that only the contained <tt>Data</tt> objects are written.</p>


<div class="panel" style="background-color: #FFFFFF;border-color: #3C78B5;border-style: solid;border-width: 1px;"><div class="panelContent" style="background-color: #FFFFFF;">
<h5><a name="UsingJMSwithOpenSpacesExample-Code"></a>Code</h5>
<hr 
 size="1" 
 color="#3C78B5" 
 >

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java"><span class="code-keyword">public</span> class JMSDataFeeder <span class="code-keyword">implements</span> InitializingBean, DisposableBean {
    [..]
    Data data = <span class="code-keyword">new</span> Data(Data.TYPES[counter++ % Data.TYPES.length], <span class="code-quote">"FEEDER "</span> + <span class="code-object">Long</span>.toString(time));
    data.setProcessed(<span class="code-keyword">false</span>);
    jmsTemplate.send(<span class="code-keyword">new</span> MessageCreator() {
        <span class="code-keyword">public</span> Message createMessage(Session session) <span class="code-keyword">throws</span> JMSException {
            <span class="code-keyword">return</span> session.createObjectMessage(data);
        }
    });
    [..]
}</pre>
</div></div>


<h5><a name="UsingJMSwithOpenSpacesExample-Configuration"></a>Configuration</h5>
<hr 
 size="1" 
 color="#3C78B5" 
 >

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-xml"><span class="code-tag">&lt;bean id=<span class="code-quote">"jmsDataFeeder"</span> class=<span class="code-quote">"org.openspaces.example.data.feeder.JMSDataFeeder"</span>/&gt;</span></pre>
</div></div>
</div></div>

<p>The <tt>JMSDataFeeder</tt> is injected with a Spring <a href="http://static.springframework.org/spring/docs/2.0.x/api/org/springframework/jms/core/JmsTemplate.html">JmsTemplate</a>. The <a href="http://static.springframework.org/spring/docs/2.0.x/api/org/springframework/jms/core/JmsTemplate.html">JmsTemplate</a> is injected with a JMS <tt>ConnectionFactory</tt> and a destination of type <tt>Queue</tt>. Unlike the <tt>DataFeeder</tt>, the <tt>JMSDataFeeder</tt> does not declare an instance of <tt>GigaSpace</tt>. <tt>GigaSpace</tt> is injected into the <tt>ConnectionFactory</tt> bean, and is used behind the scenes by the JMS layer. In addition, the <tt>ConnectionFactory</tt> is injected with a <a href="JMS-Space Interoperability.html" title="JMS-Space Interoperability">MessageConverter</a> of type <tt>ObjectMessage2ObjectConverter</tt>.</p>


<div class="panel" style="background-color: #FFFFFF;border-color: #3C78B5;border-style: solid;border-width: 1px;"><div class="panelContent" style="background-color: #FFFFFF;">
<h5><a name="UsingJMSwithOpenSpacesExample-Code"></a>Code</h5>
<hr 
 size="1" 
 color="#3C78B5" 
 >

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java"><span class="code-keyword">public</span> class JMSDataFeeder <span class="code-keyword">implements</span> InitializingBean, DisposableBean {
    [..]
    /** Sets the JmsTemplate */
    <span class="code-keyword">public</span> void setJmsTemplate(JmsTemplate jmsTemplate)
    {
        <span class="code-keyword">this</span>.jmsTemplate = jmsTemplate;
    }
    [..]
}</pre>
</div></div>


<h5><a name="UsingJMSwithOpenSpacesExample-Configuration"></a>Configuration</h5>
<hr 
 size="1" 
 color="#3C78B5" 
 >

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-xml"><span class="code-tag">&lt;bean id=<span class="code-quote">"jmsDataFeeder"</span> class=<span class="code-quote">"org.openspaces.example.data.feeder.JMSDataFeeder"</span>&gt;</span>
    <span class="code-tag">&lt;property name=<span class="code-quote">"instanceId"</span> value=<span class="code-quote">"${clusterInfo.instanceId}"</span> /&gt;</span>
    <span class="code-tag">&lt;property name=<span class="code-quote">"numberOfTypes"</span> value=<span class="code-quote">"${numberOfTypes}"</span> /&gt;</span>
    <span class="code-tag">&lt;property name=<span class="code-quote">"jmsTemplate"</span> ref=<span class="code-quote">"jmsTemplate"</span> /&gt;</span>
<span class="code-tag">&lt;/bean&gt;</span>

<span class="code-tag">&lt;bean id=<span class="code-quote">"jmsTemplate"</span> class=<span class="code-quote">"org.springframework.jms.core.JmsTemplate"</span>&gt;</span>
    <span class="code-tag">&lt;property name=<span class="code-quote">"connectionFactory"</span> ref=<span class="code-quote">"connectionFactory"</span>/&gt;</span>
    <span class="code-tag">&lt;property name=<span class="code-quote">"defaultDestination"</span> ref=<span class="code-quote">"destination"</span> /&gt;</span>
<span class="code-tag">&lt;/bean&gt;</span>

<span class="code-tag">&lt;os-jms:queue id=<span class="code-quote">"destination"</span> name=<span class="code-quote">"MyQueue"</span> /&gt;</span>

<span class="code-tag">&lt;os-jms:connection-factory id=<span class="code-quote">"connectionFactory"</span> giga-space=<span class="code-quote">"gigaSpace"</span> message-converter=<span class="code-quote">"messageConverter"</span> /&gt;</span>

<span class="code-tag">&lt;bean id=<span class="code-quote">"messageConverter"</span> class=<span class="code-quote">"com.j_spaces.jms.utils.ObjectMessage2ObjectConverter"</span> /&gt;</span></pre>
</div></div>
</div></div>

<p>Because the <tt>JMSDataFeeder</tt> implements Spring's <tt>InitializingBean</tt> and <tt>DisposableBean</tt> interfaces, its <tt>afterPropertiesSet()</tt> and <tt>destroy()</tt> methods are called when it is created or destroyed, respectively.</p>

                     </td>
</tr>
</table>
<table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr>
<td height="12" background="http://www.gigaspaces.com/wiki/images/border/border_bottom.gif"><img src="images/border/spacer.gif" width="1" height="1" border="0"/></td>
</tr>
<tr>
<td align="center"><font color="grey"><a href="http://www.gigaspaces.com">GigaSpaces.com</a> -
		<a href="http://www.gigaspaces.com/wiki/x/xwBmAg" class="smalltext">Legal Notice</a> -
		<a href="http://www.gigaspaces.com/wiki/x/xgBmAg" class="smalltext">3rd Party Licenses</a> -
		<a href="http://www.gigaspaces.com/wiki/x/BQFmAg" class="smalltext">Site Map</a> -
		<a href="http://www.gigaspaces.com/wiki/display/API/API+Documentation+Portal" class="version-link">API Docs</a> -
		<a href="http://forum.openspaces.org/forum.jspa?forumID=175" class="version-link">Forum</a> -
		<a href="http://www.gigaspaces.com/LatestProductVersion" class="version-link">Downloads</a> -
		<a href="http://blog.gigaspaces.com/" class="version-link">Blog</a> -
		<a href="http://www.gigaspaces.com/os_papers.html" class="version-link">White Papers</a> -
		<a href="mailto:techw@gigaspaces.com">Contact Tech Writing</a> -
		<i><a href="http://www.atlassian.com/software/confluence">Gen. by Atlassian Confluence</a></i></font></td>
</tr>
</table>
     </body>
</html>
