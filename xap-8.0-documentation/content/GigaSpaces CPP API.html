<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
     <head>
         <title>XAP 8.0 Documentation : GigaSpaces CPP API</title>
<link rel="stylesheet" href="styles/site.css" type="text/css" />
         <META http-equiv="Content-Type" content="text/html; charset=UTF-8">
		 <style>
.back-to {
	color: #666666;
	font-weight: bold;
}	 
a.back-to:link, a.back-to:visited, a.back-to:hover, a.back-to:active  {
	color: #666666;
}	 
		 </style>
     </head>

     <body>
<table class="pagecontent" border="0" cellpadding="0" cellspacing="0" width="100%" bgcolor="#ffffff">
<tr>
<td valign="top" class="pagebody">
<div class="pageheader">
<span class="back-to">XAP 8.0 Documentation > <a href="index.html">Back to Table of Contents</a></span><br>
<h1>GigaSpaces CPP API</h1>
</div>
<br>



<div style="border-style:solid; border-color:#3C78B5; border-width:thin; padding-left:20px; padding-bottom:20px; padding-top:20px; padding-right:20px; background-color:#D8E4F1"> 

<p><b>Section Summary:</b>  An overview of the main capabilities provided by GigaSpaces C++ API </p>
</div>

<h1><a name="GigaSpacesCPPAPI-Overview"></a>Overview</h1>

<p>The <tt>SpaceProxy</tt> is the primary interface that allows you to connect to the space and perform space operations. The basic space operations include the following:</p>
<ul>
	<li><b>write</b> &#8211; writes an object into the space.</li>
	<li><b>read</b> &#8211; reads an object from the space that matches a given template.</li>
	<li><b>take</b> &#8211; reads an object from the space that matches the given template and removing it from the space in one atomic operation.</li>
	<li><b>update</b> &#8211; updates an entry in the space.</li>
	<li><b>notify</b> &#8211; notifies a specified listener object, when an object that matches a given template is written/taken/updated/expires in the space.</li>
</ul>


<p>The <tt>SpaceProxy</tt> is used with the different space topologies and runtime modes in a transparent manner. You can use the <tt>SpaceProxy</tt> object with an embedded, remote, single, or clustered replicated or partitioned space.</p>

<p>The <tt>SpaceProxy</tt> supports single and batch space operations. Batch operations are used to optimize space operations with multiple objects and can boost the application performance when interacting with the space.</p>

<p><img class="emoticon" src="images/icons/emoticons/lightbulb_on.gif" height="16" width="16" align="absmiddle" alt="" border="0"/> Please refer to the <a href="http://www.gigaspaces.com/docs/cppdocs6.5">GigaSpaces C+&#43; Documentation</a> for the API Documentation.</p>

<h2><a name="GigaSpacesCPPAPI-WritingandReadingfromSpace"></a>Writing and Reading from Space</h2>

<p>The following code example constructs a space proxy by passing a <a href="Space URL.html" title="Space URL">space URL</a> string into the <tt>SpaceFinder.find()</tt> method. The returned object is the <tt>SpaceProxy</tt> object. This allows performing all space operations such as write, read, take, notify registration, etc.</p>
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">SpaceFinder		finder;
<span class="code-comment">// Getting space proxy using the standard Space URL
</span>SpaceProxyPtr spaceProxy = finder.find( <span class="code-quote">"jini:<span class="code-comment">//lookup-host/container-name/space-name"</span> );
</span>
<span class="code-comment">// Prepare an object
</span>Person person;
person.name = <span class="code-quote">"Jack"</span>;
person.city = <span class="code-quote">"New York"</span>;	<span class="code-comment">// Routing field (must be specified <span class="code-keyword">if</span> space is a cluster)
</span>person.age = 40;

<span class="code-comment">// Write the object to the space giving it lease time of 10 seconds
</span>Lease lease = spaceProxy-&gt;write(&amp;person, NULL_TX, 10000, 0, WRITE_ONLY);

<span class="code-comment">// Prepare the template
</span>Person personTemplate;
personTemplate.name = <span class="code-quote">"Jack"</span>;
personTemplate.city = <span class="code-quote">"New York"</span>;	<span class="code-comment">// Routing field (must be specified <span class="code-keyword">if</span> space is a cluster and timeout &gt; 0)
</span>
<span class="code-comment">// Read the person <span class="code-quote">"Jack"</span> from the space (use smart pointer). Wait 10 seconds at most.
</span>PersonPtr personResponse;
personResponse.reset ( spaceProxy-&gt;read(&amp;personTemplate, NULL_TX, 10000) );
<span class="code-keyword">if</span> (personResponse == NULL) {
	std::cout &lt;&lt; <span class="code-quote">"ERROR: Failed to read person 'Jack'"</span> &lt;&lt; std::endl;
}

<span class="code-comment">// Take the person <span class="code-quote">"Jack"</span> from the space. Wait at most 1 second.
</span>personResponse.reset((Person*)spaceProxy-&gt;take( &amp;personTemplate, NULL_TX, 1000));
<span class="code-keyword">if</span> (personResponse == NULL) {
	std::cout &lt;&lt; <span class="code-quote">"ERROR: Failed to take person 'Jack'"</span> &lt;&lt; std::endl;
}</pre>
</div></div>

<h1><a name="GigaSpacesCPPAPI-WritingBatchofObjectstoSpace"></a>Writing Batch of Objects to Space</h1>

<p>In some cases, you might want to write a batch of objects into the space using one space call. This can be used when the C+&#43; application accesses a remote space. In this case, batch write operations is more efficient than multiple separate single write operations. This is because the communication protocol transforms the C+&#43; objects to PBS, and their transportation to the space is performed in one single operations rather than multiple separate calls.</p>

<p>Below is an example for a <tt>writeMultiple</tt> call:</p>
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java"><span class="code-comment">// Prepare a vector (batch) of Person objects
</span>std::vector&lt;IEntry*&gt; myBatch(100);
<span class="code-keyword">for</span> (<span class="code-object">int</span> i = 0; i &lt; 100; i++) {
	Person* pPerson = <span class="code-keyword">new</span> Person;
	pPerson-&gt;name = <span class="code-quote">"Jack"</span>;
	pPerson-&gt;city = i % 2 ? <span class="code-quote">"New York"</span> : <span class="code-quote">"London"</span>;	<span class="code-comment">// Routing field (must be specified <span class="code-keyword">if</span> space is a cluster)
</span>	pPerson-&gt;age = i;
	myBatch[i] = pPerson;
}

<span class="code-comment">// Write the batch
</span><span class="code-keyword">try</span> {
	std::vector&lt;Lease&gt; results = spaceProxy-&gt;writeMultiple(myBatch,NULL_TX,Lease::FOREVER);
}
<span class="code-keyword">catch</span>(XAPException &amp;e){
	std::cout &lt;&lt; <span class="code-quote">"ERROR - writeMultiple failed"</span> &lt;&lt; std::endl;
}

<span class="code-comment">// Memory cleanup
</span><span class="code-keyword">for</span> (<span class="code-object">int</span> i = 0; i &lt; 100; i++) {
	delete myBatch[i];
}</pre>
</div></div>

<h1><a name="GigaSpacesCPPAPI-ReadingBatchofObjectsfromSpace"></a>Reading Batch of Objects from Space</h1>

<p>You can read a single object or multiple matching objects from the space. When using the <tt>readMultiple</tt> operation, the returned object includes all of the matching objects found in the space. This operation should be used carefully, since it might return a large amount of objects; causing the space and the client to use a large amount of memory, and cause a load on the network.</p>

<p>Below is an example of performing the <tt>readMultiple</tt> operation using <tt>SQLQuery</tt>:</p>
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">Person personQueryTemplate;
personQueryTemplate.age = 30;
<span class="code-comment">// Match all Person entries where 'city' begins with 'A' and 'age' is older than 30
</span>SqlQuery personQuery(&amp;personQueryTemplate, <span class="code-quote">"city like 'N%' AND age &gt; ?"</span>);
<span class="code-comment">// Read all matching Person entries (at most 1000)
</span>responseBatch = spaceProxy-&gt;readMultiple(personQuery,NULL_TX,1000);
std::cout &lt;&lt; <span class="code-quote">"<span class="code-object">Number</span> of persons that live in New York aged 30+ is: "</span> &lt;&lt; responseBatch.size() &lt;&lt; std::endl;

<span class="code-comment">// Memory cleanup
</span><span class="code-keyword">for</span> (<span class="code-object">int</span> i = 0; i &lt; responseBatch.size(); i++) {
	delete responseBatch[i];
}</pre>
</div></div>

<h1><a name="GigaSpacesCPPAPI-ReceivingNotificationsonSpaceOperations"></a>Receiving Notifications on Space Operations</h1>

<p>The space allows C+&#43; client applications to receive notifications when a matching event occurs in the space. To allow the C+&#43; application to receive notifications, the following should be conducted:</p>
<ul>
	<li>The <tt>IRemoteEventListener</tt> listener class should implemented</li>
	<li>Registering the listener via the <tt>DataEventSession</tt></li>
</ul>


<p>Once the listener is registered with a relevant template and operation type, and a matching event occurs in the space (as a result of write, take, update, or lease expiration) the registered client <tt>IRemoteEventListener.notify()</tt> implementation is called, passing the event object originator.</p>
<div class="indent20 inline" style="margin-left: 20px;"><style type="text/css">div.inline p:first-child { display: inline; }</style><p><img src="download/attachments/53903504/image008.jpg" align="absmiddle" border="0"/></p></div>
<p>Below is an example for an <tt>IRemoteEventListener</tt> listener implementation:</p>
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java"><span class="code-comment">// The Listener class <span class="code-keyword">for</span> a Person entry
</span> class PersonNotifyListener : <span class="code-keyword">public</span> IRemoteEventListener
 {
 <span class="code-keyword">public</span>:

 	<span class="code-comment">// Implement IRemoteEventListener method
</span> 	virtual bool notify( <span class="code-keyword">const</span> RemoteEvent&amp; remoteEvent )
 	{
 		IEntryPtr temp(remoteEvent.getIEntry());
 		<span class="code-keyword">return</span> <span class="code-keyword">true</span>;
 	}

 };</pre>
</div></div>
<p>Below is an example for a registered listener with a template and a <tt>WRITE</tt> operation type:</p>
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java"><span class="code-comment">// Prepare the session
</span>  EventSessionFactoryPtr factory( EventSessionFactory::getFactory(spaceProxy));

  <span class="code-comment">// create a session configuration
</span>  EventSessionConfigPtr config( EventSessionConfig::CreateSessionConfig(spaceProxy));
  config-&gt;setComType(ComType::UNICAST); <span class="code-comment">// or MULTIPLEX,MULTICAST
</span>
  <span class="code-comment">// creating a <span class="code-keyword">new</span> DataEventSession
</span>  DataEventSessionPtr session (factory-&gt;newDataEventSession(config) );

  <span class="code-comment">// Create the listener using the class we defined
</span>  PersonNotifyListener listener;

  <span class="code-comment">// Register <span class="code-keyword">for</span> notifications by adding the listener to the space with the Person template
</span>
  Person personTemplate;
  EventRegistrationPtr reg( session-&gt;addListener( &amp;personTemplate, &amp;listener, Lease::FOREVER, NotifyModifiers::NOTIFY_WRITE));</pre>
</div></div>

<h1><a name="GigaSpacesCPPAPI-UsingTransactions"></a>Using Transactions</h1>

<p>Space operations can be conducted using transactions. Transactions provide ACID: Atomicity, Consistency, Isolation, and Durability. For more information on using JavaSpaces transactions, see <a href="Transaction Management.html" title="Transaction Management">Transaction Management</a>.</p>

<p>When using transactions, the following basic operations should be conducted:</p>
<ol>
	<li>Constructing the transaction manager</li>
	<li>Constructing the transaction object</li>
	<li>Performing the space operation(s)</li>
	<li>Committing/rolling back the transaction</li>
</ol>


<p>There are two types of transaction managers and their respective types of transactions:</p>
<ul>
	<li><b>Local</b> &#45; for operations over a single space instance</li>
	<li><b>Distributed</b> &#45; for operations that span over multiple spaces</li>
</ul>


<p>When working with only a single space instance, the Local Transaction (Manager) should be used. When working with a clustered topology, and performing operations that span over several cluster members, the Distributed Transaction (Manager) should be used.<br/>
Note, this can be avoided when working with the SBA model, where each cluster member works only with its local space instance.</p>

<p>Here is an example for creating a Local Transaction:</p>
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">SpaceFinder spaceFinder;
SpaceProxyPtr spaceProxy = spaceFinder.find(<span class="code-quote">"jini:<span class="code-comment">//lookup-host/container-name/space-name"</span>);
</span><span class="code-comment">// Get the Local Transaction Manager
</span>ITransactionManagerPtr localTxnMgr = spaceProxy-&gt;getLocalTransactionManager();
<span class="code-comment">// Create a transaction
</span>TransactionPtr txn = localTxnMgr-&gt;create();
A Local Transaction can also be created directly using:
TransactionPtr txn = spaceProxy-&gt;getLocalTransaction();</pre>
</div></div>
<p>Here is an example of creating a Distributed Transaction based on Jini Mahalo:</p>
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">#define LOOKUP_GROUPS <span class="code-quote">"MY-LOOKUP-GROUPS"</span>	<span class="code-comment">// Lookup groups <span class="code-keyword">for</span> Jini Mahalo
</span>SpaceFinder spaceFinder;
<span class="code-comment">// The space must use the same lookup groups as the Jini Mahalo
</span>SpaceProxyPtr spaceProxy = spaceFinder.find(<span class="code-quote">"jini:<span class="code-comment">//lookup-host/container-name/space-name"</span>);
</span><span class="code-comment">// Define a Jini Mahalo config object
</span>IConfigPtr config(<span class="code-keyword">new</span> JiniConfig(<span class="code-quote">"", "</span>", LOOKUP_GROUPS));
<span class="code-comment">// Get a Distributed Transaction Manager based on Jini Mahalo
</span>ITransactionManagerPtr distTxnMgr = spaceProxy-getDistributedTransactionManager(config);
<span class="code-comment">// Create a transaction
</span>TransactionPtr txn = distTxnMgr-&gt;create();</pre>
</div></div>
<p>Once a transaction is created it can be used with any of the space operations until it is either committed or aborted.</p>

<p>Here is an example of using a transaction:</p>
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">Person person;
Person personTemplate;
PersonPtr personResponse;

<span class="code-comment">// Create a local transaction with lease time of 10 seconds
</span>TransactionPtr txn = spaceProxy-&gt;getLocalTransaction(10000);

<span class="code-comment">// Prepare the entry
</span>person.name = <span class="code-quote">"Jack"</span>;
person.city = <span class="code-quote">"New York"</span>;	<span class="code-comment">// Routing field (must be specified <span class="code-keyword">if</span> space is a cluster)
</span>person.age = 40;

<span class="code-comment">// Write the entry to the space giving it lease time forever. Use the Transaction.
</span>Lease lease = spaceProxy-&gt;write(&amp;person, txn, Lease::FOREVER);

<span class="code-comment">// Update the entry inside the transaction (returns the old value)
</span>person.age = 42;
personResponse.reset ( spaceProxy-&gt;update(&amp;person, txn, Lease::FOREVER, 10000, UPDATE_ONLY));
<span class="code-keyword">if</span> (personResponse == NULL || personResponse-&gt;age != 40) {
	std::cout &lt;&lt; <span class="code-quote">"ERROR: Failed to update person age"</span> &lt;&lt; std::endl;
}

<span class="code-comment">// Commit the Transaction
</span>txn-&gt;commit();</pre>
</div></div>

<h1><a name="GigaSpacesCPPAPI-IteratingLargeAmountsofData"></a>Iterating Large Amounts of Data</h1>

<p>The GSIterator provides the ability to exhaustively read through all of the Entries from a space that match one or more templates. GSIterator is based on JavaSpaces Iterator&#42;** .</p>

<p>A GSIterator is created by providing one or more matching templates. Iterating through the matching entries is done by calling the <tt>getNext</tt> method.</p>

<p>The following example demonstrates how to create and use a GSIterator that matches <tt>Person</tt> entries:</p>
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java"><span class="code-comment">// Create a GSIterator using an empty Person template to match all Person entries
</span>Person personTemplate;
GSIteratorPtr gsIterator(<span class="code-keyword">new</span> GSIterator(spaceProxy, &amp;personTemplate, 100, ExistingAndFutureEntries, Lease::FOREVER));

<span class="code-comment">// Iterate over the entries
</span>PersonPtr nextPerson;
<span class="code-keyword">while</span> (gsIterator-&gt;hasNext())
{
	nextPerson.reset((Person*)gsIterator-&gt;getNext());
	<span class="code-keyword">if</span> (nextPerson == NULL) {
		std::cout &lt;&lt; <span class="code-quote">"ERROR: Failed to get next person"</span> &lt;&lt; std::endl;
	}
	<span class="code-keyword">else</span> {
		std::cout &lt;&lt; nextPerson-&gt;name &lt;&lt; <span class="code-quote">" | "</span> &lt;&lt; nextPerson-&gt;city &lt;&lt; <span class="code-quote">" | "</span> &lt;&lt; nextPerson-&gt;age &lt;&lt; std::endl;
	}
}</pre>
</div></div>
<p>Note the use of <tt>ExistingAndFutureEntries</tt> argument when creating the GSIterator. It enables matching both entries that are already in space at the time of creation, as well as entries that will be written afterwards.</p>

<p>Here is another example, this time using <em>blocking iteration</em>:</p>
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java"><span class="code-comment">// Create a GSIterator
</span>Person personTemplate;
GSIteratorPtr gsIteratorBlocking(<span class="code-keyword">new</span> GSIterator(spaceProxy, &amp;personTemplate, 100, ExistingAndFutureEntries, Lease::FOREVER));
IEntryPtr nextValue;
<span class="code-keyword">const</span> <span class="code-object">long</span> NEXT_TIMEOUT = 2000; <span class="code-comment">// 2 seconds
</span>count = 0;
<span class="code-keyword">while</span> (<span class="code-keyword">true</span>)
{
	nextValue.reset(gsIteratorBlocking-&gt;getNext(NEXT_TIMEOUT));
	<span class="code-keyword">if</span> (nextValue == NULL)
		<span class="code-keyword">break</span>;
	count++;
}</pre>
</div></div>

<h1><a name="GigaSpacesCPPAPI-ParellilazingandScalingUsingtheC%5CProcessingUnit"></a>Parellilazing and Scaling Using the C+&#43; Processing Unit</h1>

<p>The POCO C+&#43; worker API allows a C+&#43; developer to embed native code within the same process space as the SBA container; and can also be used to call other languages such as C, running the business logic as part of the same memory address as the space.</p>

<p>The process of building a C+&#43; Worker is very straightforward: the developer implements a shared object or dynamically loaded library that derives from the abstract GigaSpaces interface, exports a couple of well-known entry points and he is all set to go.</p>

<p>The C+&#43; worker implementation must derive from the <tt>ICppWorker</tt> class, so that the GigaSpaces space worker can load it dynamically during runtime.</p>

<p>The <tt>ICppWorker</tt> includes the following methods:</p>
<table class='confluenceTable'><tbody>
<tr>
<th class='confluenceTh'> Return value </th>
<th class='confluenceTh'> Method </th>
</tr>
<tr>
<td class='confluenceTd'> <tt>virtual</tt> </td>
<td class='confluenceTd'> <tt>&#126;ICppWorker()</tt> &#8211; destructor </td>
</tr>
<tr>
<td class='confluenceTd'> <tt>virtual const char *</tt> </td>
<td class='confluenceTd'> <tt>cppType()=0</tt> &#8211; well-known entry point <tt>cppType()</tt> </td>
</tr>
<tr>
<td class='confluenceTd'> <tt>virtual const char *</tt> </td>
<td class='confluenceTd'> <tt>className()=0</tt> &#8211; well-known entry point <tt>className()</tt> </td>
</tr>
<tr>
<td class='confluenceTd'> <tt>virtual bool</tt> </td>
<td class='confluenceTd'> <tt>Initialize(IWorkerPeer &#42;Host)=0</tt> &#8211; initialize </td>
</tr>
<tr>
<td class='confluenceTd'> <tt>virtual CommandObjectPtr</tt> </td>
<td class='confluenceTd'> {{ run(CommandObjectPtr );}} </td>
</tr>
<tr>
<td class='confluenceTd'> <tt>virtual bool</tt> </td>
<td class='confluenceTd'> <tt>Destroy()=0</tt> &#8211; destroy. This entry point is called before the worker becomes eligible for unload. </td>
</tr>
</tbody></table>

<h2><a name="GigaSpacesCPPAPI-Architecture"></a>Architecture</h2>

<p>The basic architecture consists of the following components:</p>
<ul>
	<li><b>C+&#43; application process</b> &#8211; this process accesses the space via a remote call.</li>
	<li><b>Space</b> &#8211; runs in standalone mode or as part of a Processing Unit.</li>
	<li><b>Java worker wrapper</b> running in the space. This worker is injected with the space proxy.</li>
	<li><b>C+&#43; worker wrapper</b> &#8211; this worker might pass objects to the <tt>ICppWorker</tt> implementation.</li>
	<li><tt><b>ICppWorker</b></tt> <b>implementation</b> &#8211; the C+&#43; implementation can access the space directly, or receive data from the space via the Java worker wrapper and its C+&#43; worker wrapper counterpart.</li>
</ul>


<p><img src="download/attachments/53903504/image012.jpg" align="absmiddle" border="0"/></p>

<p>***Link required</p>

                     </td>
</tr>
</table>
<table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr>
<td height="12" background="http://www.gigaspaces.com/wiki/images/border/border_bottom.gif"><img src="images/border/spacer.gif" width="1" height="1" border="0"/></td>
</tr>
<tr>
<td align="center"><font color="grey"><a href="http://www.gigaspaces.com">GigaSpaces.com</a> -
		<a href="http://www.gigaspaces.com/wiki/x/xwBmAg" class="smalltext">Legal Notice</a> -
		<a href="http://www.gigaspaces.com/wiki/x/xgBmAg" class="smalltext">3rd Party Licenses</a> -
		<a href="http://www.gigaspaces.com/wiki/x/BQFmAg" class="smalltext">Site Map</a> -
		<a href="http://www.gigaspaces.com/wiki/display/API/API+Documentation+Portal" class="version-link">API Docs</a> -
		<a href="http://forum.openspaces.org/forum.jspa?forumID=175" class="version-link">Forum</a> -
		<a href="http://www.gigaspaces.com/LatestProductVersion" class="version-link">Downloads</a> -
		<a href="http://blog.gigaspaces.com/" class="version-link">Blog</a> -
		<a href="http://www.gigaspaces.com/os_papers.html" class="version-link">White Papers</a> -
		<a href="mailto:techw@gigaspaces.com">Contact Tech Writing</a> -
		<i><a href="http://www.atlassian.com/software/confluence">Gen. by Atlassian Confluence</a></i></font></td>
</tr>
</table>
     </body>
</html>
