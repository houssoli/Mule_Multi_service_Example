<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
     <head>
         <title>XAP 8.0 Documentation : Authenticating against an LDAP repository</title>
<link rel="stylesheet" href="styles/site.css" type="text/css" />
         <META http-equiv="Content-Type" content="text/html; charset=UTF-8">
		 <style>
.back-to {
	color: #666666;
	font-weight: bold;
}	 
a.back-to:link, a.back-to:visited, a.back-to:hover, a.back-to:active  {
	color: #666666;
}	 
		 </style>
     </head>

     <body>
<table class="pagecontent" border="0" cellpadding="0" cellspacing="0" width="100%" bgcolor="#ffffff">
<tr>
<td valign="top" class="pagebody">
<div class="pageheader">
<span class="back-to">XAP 8.0 Documentation > <a href="index.html">Back to Table of Contents</a></span><br>
<h1>Authenticating against an LDAP repository</h1>
</div>
<br>

<script type='text/javascript'>//<![CDATA[
function debug() { }
// ]]></script><script type='text/javascript' src='/wiki/download/resources/net.customware.confluence.plugin.composition:composition-setup/js/browser.js'>//<![CDATA[
// ]]></script><script type='text/javascript' src='/wiki/download/resources/net.customware.confluence.plugin.composition:composition-setup/js/behaviour.js'>//<![CDATA[
// ]]></script><script type='text/javascript' src='/wiki/download/resources/net.customware.confluence.plugin.composition:composition-setup/js/memory.js'>//<![CDATA[
// ]]></script><script type='text/javascript' src='/wiki/download/resources/net.customware.confluence.plugin.composition:composition-setup/js/cloak.js'>//<![CDATA[
// ]]></script><script type='text/javascript'>//<![CDATA[
Cloak.closeHTML = "<img src=\'/wiki/download/resources/net.customware.confluence.plugin.composition:toggle-cloak/img/navigate_down_10.gif\'/>";
Cloak.openHTML = "<img src=\'/wiki/download/resources/net.customware.confluence.plugin.composition:toggle-cloak/img/navigate_right_10.gif\'/>";
Cloak.toggleZone = true;
Cloak.memoryDuration = 0;
Cloak.memoryPrefix = "contentId:53903576";
Cloak.memoryPath = "/wiki/";
// ]]></script><style type='text/css'>
.cloakToggle { /* Definition for state toggling image */
cursor:hand;
cursor:pointer;
}
</style><script type='text/javascript' src='/wiki/download/resources/net.customware.confluence.plugin.composition:composition-setup/js/transitions.js'>//<![CDATA[
// ]]></script><script type='text/javascript' src='/wiki/download/resources/net.customware.confluence.plugin.composition:composition-setup/js/deck.js'>//<![CDATA[
// ]]></script><link rel='stylesheet' type='text/css'  href='/wiki/styles/main-action.css?pluginCompleteKey=net.customware.confluence.plugin.composition:composition-setup&stylesheetName=deck&spaceKey=XAP8'/><script type='text/javascript'>//<![CDATA[
Deck.memoryDuration = 0;
Deck.memoryPrefix = "contentId:53903576";
Deck.memoryPath = "/wiki/";
// ]]></script>


<div style="border-style:solid; border-color:#3C78B5; border-width:thin; padding-left:20px; padding-bottom:20px; padding-top:20px; padding-right:20px; background-color:#D8E4F1"> 

<p><b>Section Summary:</b>  Using LDAP (Lightweight Directory Access Protocol) with Spring Security </p>
</div>

<h1><a name="AuthenticatingagainstanLDAPrepository-Introduction"></a>Introduction</h1>

<p>LDAP is often used by organizations as a central repository for user information and as an authentication service. It can also be used to store the role information for application users.</p>

<p>You should be familiar with LDAP before trying to use it with Spring Security. There are some concepts involved in setting up an LDAP server. To get you started you can take a look at a free LDAP server <tt>OpenLDAP</tt>, or the Apache Directory Project <tt>ApacheDS</tt> which also comes with a convenient browser.</p>

<h1><a name="AuthenticatingagainstanLDAPrepository-LDAPDataInterchangeFormat%28LDIF%29"></a>LDAP Data Interchange Format (LDIF)</h1>

<p>The LDAP Data Interchange Format (LDIF) is a standard data interchange format for representing LDAP directory content. Here is a snippet of an <tt>ldif</tt> that demonstrates how users and groups are associated with GigaSpaces granted authorities.</p>

<p>Consider for example our "Box-Office Employee"s: Edward, Arthur, and Thomas. They have been granted privileges to list all movies and their available seats, and to reserve a seat. More specifically, granted <tt>READ</tt> privileges for class <tt>eg.cinema.Movie</tt> and for <tt>class eg.cinema.Seat</tt>, and <tt>WRITE</tt> privileges to update a <tt>eg.cinema.Seat</tt> as reserved.</p>
<table class="sectionMacro" border="0" cellpadding="5" cellspacing="0" width="100%"><tbody><tr>
<td class="confluenceTd"  valign="top">
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">...
dn: cn=Box-Office Employee,ou=groups,dc=example,dc=com
objectclass: top
objectclass: groupOfNames
cn: Box-Office Employee
member: uid=Edward,ou=people,dc=example,dc=com
member: uid=Arthur,ou=people,dc=example,dc=com
member: uid=Thomas,ou=people,dc=example,dc=com
ou: SpacePrivilege READ ClassFilter eg.cinema.Movie
ou: SpacePrivilege READ ClassFilter eg.cinema.Seat
ou: SpacePrivilege WRITE ClassFilter eg.cinema.Seat

...

dn: uid=Edward,ou=people,dc=example,dc=com
objectclass: top
objectclass: person
objectclass: organizationalPerson
objectclass: inetOrgPerson
cn: Edward Jones
sn: Jones
uid: Edward
userPassword: koala

...</pre>
</div></div>
<p>&nbsp;&nbsp;&nbsp;&nbsp; <a href="download/attachments/53903576/sample.ldif">sample.ldif</a></p></td>
<td class="confluenceTd"  valign="top">
<p><img src="download/attachments/48235229/SpringSecurity-LDAP.png" align="absmiddle" border="0"/></p></td></tr></tbody></table>

<h1><a name="AuthenticatingagainstanLDAPrepository-ConfigureSpringtouseanLDAPServer"></a>Configure Spring to use an LDAP Server</h1>

<p>Spring Security supports authentication against LDAP through <tt>LdapAuthenticationProvider</tt>, an authentication provider that knows how to check user credentials against and LDAP repository.</p>
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">&lt;bean id=<span class="code-quote">"ldapAuthenticationProvider"</span>
      class=<span class="code-quote">"org.springframework.security.ldap.authentication.LdapAuthenticationProvider"</span>&gt;

    &lt;!-- strategy <span class="code-keyword">for</span> handling the actual authentication against the LDAP repository --&gt;
    &lt;constructor-arg ref=<span class="code-quote">"authenticator"</span> /&gt;

    &lt;!-- strategy <span class="code-keyword">for</span> retrieving a user's set of granted authorities --&gt;
    &lt;constructor-arg ref=<span class="code-quote">"populator"</span> /&gt;
&lt;/bean&gt;</pre>
</div></div>

<div class='panelMacro'><table class='infoMacro'><colgroup><col width='24'><col></colgroup><tr><td valign='top'><img src="images/icons/emoticons/information.gif" width="16" height="16" align="absmiddle" alt="" border="0"></td><td>An LDAP Spring Security configuration file can be found under &lt;GigaSpaces root&gt;/config/security/ldap-security-config.xml</td></tr></table></div>

<h2><a name="AuthenticatingagainstanLDAPrepository-AuthenticatingwithLDAPbinding"></a>Authenticating with LDAP binding</h2>

<p>Spring Security comes with an <tt>LdapAuthenticator</tt> implementation called <tt>BindAuthenticator</tt>. <tt>Bindauthenticator</tt> uses an LDAP bind operator to bind as a user to the LDAP server. This approach relies on the LDAP server to authenticate the user's credentials.</p>
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">&lt;bean id=<span class="code-quote">"authenticator"</span>
      class=<span class="code-quote">"org.springframework.security.ldap.authentication.BindAuthenticator"</span>&gt;
    &lt;constructor-arg ref=<span class="code-quote">"contextSource"</span> /&gt;
    &lt;!--  how to find a user in LDAP --&gt;
    &lt;property name=<span class="code-quote">"userDnPatterns"</span>&gt;
        &lt;list&gt;
	    &lt;!-- {0} servers as a pattern argument placeholder <span class="code-keyword">for</span> a username --&gt;
	    &lt;value&gt;uid={0},ou=people&lt;/value&gt;
	&lt;/list&gt;
    &lt;/property&gt;
&lt;/bean&gt;

&lt;bean id=<span class="code-quote">"contextSource"</span>
      class=<span class="code-quote">"org.springframework.security.ldap.DefaultSpringSecurityContextSource"</span>&gt;
    &lt;constructor-arg value=<span class="code-quote">"ldap:<span class="code-comment">//localhost:10389/dc=example,dc=com"</span> /&gt;
</span>&lt;/bean&gt;</pre>
</div></div>
<p>The <tt>userDnPatterns</tt> property is used to tell the authenticator how to find a user in LDAP. In this case we are only using a single DN pattern. For example, if the username is Edward, the DN used to bind to LDAP will be <tt>uid=Edward,ou=people</tt> relative to the initial context <tt>dc=example,dc=com</tt>.</p>

<h2><a name="AuthenticatingagainstanLDAPrepository-Authenticatingbycomparingpasswords"></a>Authenticating by comparing passwords</h2>

<p>Spring Security also supports authentication by password comparison with <tt>PasswordComparisonAuthenticator</tt>. <tt>PasswordComparisonAuthenticator</tt> compares the supplied password with a password attribute (<tt>userpassword</tt>, by default) in the user record. The password is encoded using the password encoder, by default <tt>LdapShaPasswordEncoder</tt>.</p>
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">&lt;bean id=<span class="code-quote">"authenticator"</span>
      class=<span class="code-quote">"org.springframework.security.ldap.authentication.PasswordComparisonAuthenticator"</span>&gt;
    &lt;constructor-arg ref=<span class="code-quote">"contextSource"</span> /&gt;
...
    &lt;property name=<span class="code-quote">"passwordAttributeName"</span> value=<span class="code-quote">"userpassword"</span> /&gt;
    &lt;property name=<span class="code-quote">"passwordEncoder"</span>&gt;
        &lt;bean class=<span class="code-quote">"org.springframework.security.authentication.encoding.LdapShaPasswordEncoder"</span> /&gt;
    &lt;/property&gt;
...</pre>
</div></div>
<p>Unlike <tt>BindAuthenticator</tt>, <tt>PasswordComparisonAuthenticator</tt> doesn't bind to LDAP using the user's DN. It is fine if your LDAP provider allows anonymous binding. Otherwise, you will need to provide a <tt>userDN</tt> and <tt>password</tt>.</p>
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">&lt;bean id=<span class="code-quote">"contextSource"</span>
    class=<span class="code-quote">"org.springframework.security.ldap.DefaultSpringSecurityContextSource"</span>&gt;
    &lt;constructor-arg value=<span class="code-quote">"ldap:<span class="code-comment">//localhost:10389/dc=example,dc=com"</span> /&gt;
</span>
    &lt;property name=<span class="code-quote">"userDn"</span> value=<span class="code-quote">"cn=manager,dc=example,dc=com"</span> /&gt;
    &lt;property name=<span class="code-quote">"password"</span> value=<span class="code-quote">"password"</span> /&gt;
&lt;/bean&gt;</pre>
</div></div>

<h2><a name="AuthenticatingagainstanLDAPrepository-Declaringthepopulator"></a>Declaring the populator</h2>

<p>Once the user identity is confirmed, <tt>LdapAuthenticationProvider</tt> must retrieve a list of the user's granted authorities. Spring Security comes with <tt>DefaultLdapAuthoritiesPopulator</tt>. Here's how a populator is configured:</p>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">&lt;bean id=<span class="code-quote">"populator"</span>
      class=<span class="code-quote">"org.springframework.security.ldap.userdetails.DefaultLdapAuthoritiesPopulator"</span>&gt;
    &lt;constructor-arg ref=<span class="code-quote">"contextSource"</span> /&gt;
    &lt;!--  group based DN - we will be searching <span class="code-keyword">for</span> groups in <span class="code-quote">"ou=groups,dc=example,dc=com"</span> --&gt;
    &lt;constructor-arg value=<span class="code-quote">"ou=groups"</span> /&gt;
    
    &lt;!-- the name of the attribute that will contain role information (which
         effectively translates to a user's granted authorities. Default is <span class="code-quote">"cn"</span> --&gt;
    &lt;property name=<span class="code-quote">"groupRoleAttribute"</span> value=<span class="code-quote">"ou"</span> /&gt;
    
    &lt;!-- <span class="code-keyword">case</span> normalization to upper <span class="code-keyword">case</span>. Default is <span class="code-keyword">true</span> --&gt;
    &lt;property name=<span class="code-quote">"convertToUpperCase"</span> value=<span class="code-quote">"<span class="code-keyword">false</span>"</span> /&gt;
    
    &lt;!-- role prefix to append to the group name. Default is <span class="code-quote">"ROLE_"</span>. --&gt;
    &lt;property name=<span class="code-quote">"rolePrefix"</span> value="" /&gt;
&lt;/bean&gt;</pre>
</div></div>

<p>The <tt>groupRoleAttribute</tt> property specifies the name of the attribute that will contain role information which effectively translate into a user's granted authorities. It defaults to <tt>cn</tt>, but for our example, we've set it to <tt>ou</tt>.</p>

<div class="panel" style="background-color: #FFFFCE;border-width: 1px;"><div class="panelContent" style="background-color: #FFFFCE;">
<p><img class="emoticon" src="images/icons/emoticons/warning.gif" height="16" width="16" align="absmiddle" alt="" border="0"/> Notice that the <tt>convertToUpperCase</tt> and <tt>rolePrefix</tt> are different than the defaults. The granted authorities should be returned as-is, without any conversion. For example, the authority <tt>SpacePrivilege READ ClassFilter eg.cinema.Movie</tt> <b>should not</b> be converted to upper case, nor should it be prefixed with a role prefix "ROLE_".</p>
</div></div>

<p>Configured this way, the <tt>DefaultLdapAuthoritiesPopulator</tt> will retrieve all groups (roles) that the user is a member of - that is, all groups that have a <tt>member</tt> attribute with the user's DN.</p>

<h3><a name="AuthenticatingagainstanLDAPrepository-AdditionalRoles"></a>Additional Roles</h3>

<p>The <tt>DefaultLdapAuthoritiesPopulator</tt> allows us to obtain any additional roles for the given user (on top of those obtained from the standard search implemented by this class). This is done by overriding <tt>getAdditionalRoles</tt> to return the extra roles which will be merged with those returned by the group search.</p>

<p>Take for example Emily, our "Box-Office Administrator" which needs extra authorities which are not part of the "Box-Office Administrator" role. We would like to be able to grant specific authorities on top of the user record, as illustrated below:</p>

<p><img src="download/attachments/48235229/SpringSecurity-LDAP-extra.png" align="absmiddle" border="0"/> </p>

                     </td>
</tr>
</table>
<table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr>
<td height="12" background="http://www.gigaspaces.com/wiki/images/border/border_bottom.gif"><img src="images/border/spacer.gif" width="1" height="1" border="0"/></td>
</tr>
<tr>
<td align="center"><font color="grey"><a href="http://www.gigaspaces.com">GigaSpaces.com</a> -
		<a href="http://www.gigaspaces.com/wiki/x/xwBmAg" class="smalltext">Legal Notice</a> -
		<a href="http://www.gigaspaces.com/wiki/x/xgBmAg" class="smalltext">3rd Party Licenses</a> -
		<a href="http://www.gigaspaces.com/wiki/x/BQFmAg" class="smalltext">Site Map</a> -
		<a href="http://www.gigaspaces.com/wiki/display/API/API+Documentation+Portal" class="version-link">API Docs</a> -
		<a href="http://forum.openspaces.org/forum.jspa?forumID=175" class="version-link">Forum</a> -
		<a href="http://www.gigaspaces.com/LatestProductVersion" class="version-link">Downloads</a> -
		<a href="http://blog.gigaspaces.com/" class="version-link">Blog</a> -
		<a href="http://www.gigaspaces.com/os_papers.html" class="version-link">White Papers</a> -
		<a href="mailto:techw@gigaspaces.com">Contact Tech Writing</a> -
		<i><a href="http://www.atlassian.com/software/confluence">Gen. by Atlassian Confluence</a></i></font></td>
</tr>
</table>
     </body>
</html>
