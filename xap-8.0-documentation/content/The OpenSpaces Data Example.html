<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
     <head>
         <title>XAP 8.0 Documentation : The OpenSpaces Data Example</title>
<link rel="stylesheet" href="styles/site.css" type="text/css" />
         <META http-equiv="Content-Type" content="text/html; charset=UTF-8">
		 <style>
.back-to {
	color: #666666;
	font-weight: bold;
}	 
a.back-to:link, a.back-to:visited, a.back-to:hover, a.back-to:active  {
	color: #666666;
}	 
		 </style>
     </head>

     <body>
<table class="pagecontent" border="0" cellpadding="0" cellspacing="0" width="100%" bgcolor="#ffffff">
<tr>
<td valign="top" class="pagebody">
<div class="pageheader">
<span class="back-to">XAP 8.0 Documentation > <a href="index.html">Back to Table of Contents</a></span><br>
<h1>The OpenSpaces Data Example</h1>
</div>
<br>

<script type='text/javascript'>//<![CDATA[
function debug() { }
// ]]></script><script type='text/javascript' src='/wiki/download/resources/net.customware.confluence.plugin.composition:composition-setup/js/browser.js'>//<![CDATA[
// ]]></script><script type='text/javascript' src='/wiki/download/resources/net.customware.confluence.plugin.composition:composition-setup/js/behaviour.js'>//<![CDATA[
// ]]></script><script type='text/javascript' src='/wiki/download/resources/net.customware.confluence.plugin.composition:composition-setup/js/memory.js'>//<![CDATA[
// ]]></script><script type='text/javascript' src='/wiki/download/resources/net.customware.confluence.plugin.composition:composition-setup/js/cloak.js'>//<![CDATA[
// ]]></script><script type='text/javascript'>//<![CDATA[
Cloak.closeHTML = "<img src=\'/wiki/download/resources/net.customware.confluence.plugin.composition:toggle-cloak/img/navigate_down_10.gif\'/>";
Cloak.openHTML = "<img src=\'/wiki/download/resources/net.customware.confluence.plugin.composition:toggle-cloak/img/navigate_right_10.gif\'/>";
Cloak.toggleZone = true;
Cloak.memoryDuration = 0;
Cloak.memoryPrefix = "contentId:53903674";
Cloak.memoryPath = "/wiki/";
// ]]></script><style type='text/css'>
.cloakToggle { /* Definition for state toggling image */
cursor:hand;
cursor:pointer;
}
</style><script type='text/javascript' src='/wiki/download/resources/net.customware.confluence.plugin.composition:composition-setup/js/transitions.js'>//<![CDATA[
// ]]></script><script type='text/javascript' src='/wiki/download/resources/net.customware.confluence.plugin.composition:composition-setup/js/deck.js'>//<![CDATA[
// ]]></script><link rel='stylesheet' type='text/css'  href='/wiki/styles/main-action.css?pluginCompleteKey=net.customware.confluence.plugin.composition:composition-setup&stylesheetName=deck&spaceKey=XAP8'/><script type='text/javascript'>//<![CDATA[
Deck.memoryDuration = 0;
Deck.memoryPrefix = "contentId:53903674";
Deck.memoryPath = "/wiki/";
// ]]></script>


<div style="border-style:solid; border-color:#3C78B5; border-width:thin; padding-left:20px; padding-bottom:20px; padding-top:20px; padding-right:20px; background-color:#D8E4F1"> 

<p><b>Section Summary:</b>  This example gives an extensive overview of the OpenSpaces APIs, the Processing Unit concept and the configuration options in the <tt>sla.xml</tt> and <tt>pu.xml</tt> files. The example contains two Processing Units; one that feeds data objects into the system, and another that reads those objects and processes them. </p>
</div>

<h1><a name="TheOpenSpacesDataExample-Overview"></a>Overview</h1>

<div class='panelMacro'><table class='infoMacro'><colgroup><col width='24'><col></colgroup><tr><td valign='top'><img src="images/icons/emoticons/information.gif" width="16" height="16" align="absmiddle" alt="" border="0"></td><td>The example is located under <tt>&lt;GigaSpaces Root&gt;/examples/data</tt></td></tr></table></div>

<div class='panelMacro'><table class='noteMacro'><colgroup><col width='24'><col></colgroup><tr><td valign='top'><img src="images/icons/emoticons/warning.gif" width="16" height="16" align="absmiddle" alt="" border="0"></td><td><b>Note for community edition users</b><br /><br/>
The example uses a clustered space topology which is not supported in the community edition. To run the example with the community edition you will have to modify the SLA of the processor processing unit to run a single space. Please refer to <a href="Configuring the Processing Unit SLA.html" title="Configuring the Processing Unit SLA">this page</a> for more details on how to configure a processing unit's SLA</td></tr></table></div>

<p>The purpose of this example is to show many of the capabilities of GigaSpaces XAP and its mainstream APi, namely OpenSpaces. The example uses the following features:</p>
<ul>
	<li>POJO Annotations</li>
	<li>The <tt>GigaSpace</tt> class</li>
	<li>Declarative transactions</li>
	<li>Event containers (polling and notify containers)</li>
	<li>OpenSpaces remoting</li>
	<li>OpenSpaces clustering and SLA</li>
	<li>Using the JMS <a href="JMS-Space Interoperability.html" title="JMS-Space Interoperability">MessageConverter</a> feature that writes POJOs to the space using the JMS API</li>
</ul>


<p>This example shows a PU that contains several services that are independent of each other and serve different purposes within one application. Moreover, the example show how different processing units use the space to share data. </p>

<h1><a name="TheOpenSpacesDataExample-Architecture"></a>Architecture</h1>

<p>This example includes two modules that are deployed to the service grid, and a domain model that consists of the <tt>Data</tt> class (shared between two modules). Each module runs within a processing unit, one runs the <a href="#TheOpenSpacesDataExample-datafeeder">DataFeeder</a> bean, the <a href="#TheOpenSpacesDataExample-jms">JMSDataFeeder</a> bean and the <a href="#TheOpenSpacesDataExample-remoting">DataRemoting</a> bean, all write <tt>Data</tt> instances with raw data into the remote space. The space is actually embedded within the second processing unit, which runs the <a href="#TheOpenSpacesDataExample-dataprocessor">DataProcessor</a> bean. The <tt>DataProcessor</tt> service takes the new <tt>Data</tt> objects, processes the raw data and writes them back to the space. Both processing units run additional services that interact with the space or with the other services, either in via a polling container, a notify container or via GigaSpaces remoting support.</p>

<p>The entire application looks like this:</p>

<p><img src="download/attachments/53903674/diag.jpg" align="absmiddle" border="0"/></p>

<h2><a name="TheOpenSpacesDataExample-ApplicationWorkflow"></a>Application Workflow</h2>

<ol>
	<li>The <a href="#TheOpenSpacesDataExample-datafeeder">DataFeeder</a> writes unprocessed <tt>Data</tt> objects into the space every second.</li>
	<li>The <a href="#TheOpenSpacesDataExample-jms">JMSDataFeeder</a> uses Spring's <tt>JmsTemplate</tt> over GigaSpaces JMS to write unprocessed <tt>Data</tt> objects into the space every second.</li>
	<li>The <a href="#TheOpenSpacesDataExample-view">ViewDataCounter</a> performs a count operation on the space every second to count all of the <tt>Data</tt> instances (processed and unprocessed).</li>
	<li>the <a href="#TheOpenSpacesDataExample-remoting">DataRemoting</a> performs direct remote calls on the <tt>DataProcessor</tt> service.</li>
	<li>The <a href="#TheOpenSpacesDataExample-dataprocessor">DataProcessor</a> takes unprocessed <tt>Data</tt> objects, processes them and writes them back to the space.</li>
	<li>The <a href="#TheOpenSpacesDataExample-processedata">ProcessedDataCount</a> receives notifications of processed <tt>Data</tt> objects that are written or updated in the space. Notifications are configured to arrive in batches of 10 objects or every 5 seconds.</li>
</ol>


<p><img class="emoticon" src="images/icons/emoticons/warning.gif" height="16" width="16" align="absmiddle" alt="" border="0"/> The services described above are independent of each other. They are merely explained here to show the various capabilities of GigaSpaces XAP and the OpenSpaces API.</p>

<h1><a name="TheOpenSpacesDataExample-ThePOJODomainModel"></a>The POJO Domain Model</h1>

<p>The only object in our model is the <tt>Data</tt> object.</p>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">@SpaceClass
<span class="code-keyword">public</span> class Data <span class="code-keyword">implements</span> Serializable {

    <span class="code-keyword">public</span> <span class="code-keyword">static</span> <span class="code-object">long</span>[] TYPES = {1, 2, 3, 4};
    <span class="code-keyword">private</span> <span class="code-object">String</span> id;
    <span class="code-keyword">private</span> <span class="code-object">Long</span> type;
    <span class="code-keyword">private</span> <span class="code-object">String</span> rawData;
    <span class="code-keyword">private</span> <span class="code-object">String</span> data;
    <span class="code-keyword">private</span> <span class="code-object">Boolean</span> processed;
[..]
	@SpaceId
    <span class="code-keyword">public</span> <span class="code-object">String</span> getId() {
        <span class="code-keyword">return</span> id;
    }

    /**
     * The type of the data object. Used as the routing field when working with
     * a partitioned space.
     */
    @SpaceRouting
    <span class="code-keyword">public</span> <span class="code-object">Long</span> getType() {
        <span class="code-keyword">return</span> type;
    }
[..]</pre>
</div></div>

<p>Note the annotations that are used in this object:</p>
<ul>
	<li><tt>@SpaceClass</tt> &#8211; the marked object can be written to a space.</li>
	<li><tt>@SpaceId</tt> &#8211; marks the <tt>id</tt> attribute of the <tt>Data</tt> class as the unique identifier of this class. Each instance of <tt>Data</tt> should have a unique ID value.</li>
	<li><tt>@SpaceRouting</tt> &#8211; when using a partitioned cluster topology, <tt>Data</tt> objects are routed to the appropriate partitions according to the specified attribute, in this case <tt>type</tt> (this means that two instances with the same value for this field will end up in the same partition).</li>
</ul>


<p>Basically, every <tt>Data</tt> object is written to the space by the <tt>DataFeeder</tt> or by the <tt>JMSDataFeeder</tt> with the <tt>processed</tt> value set to <tt>false</tt>, and this value is later set to <tt>true</tt> by the <tt>DataProcessor</tt>.</p>

<p><img class="emoticon" src="images/icons/emoticons/information.gif" height="16" width="16" align="absmiddle" alt="" border="0"/> Even though our object implements <tt>Serializable</tt>, it doesn't have to in all cases. This is relevant only when the <tt>Data</tt> object is used as a parameter in remote calls.</p>

<h1><a name="TheOpenSpacesDataExample-POJOServicesandWiringwithSpring"></a>POJO Services and Wiring with Spring</h1>

<p>According to the diagram above, there are 5 different services in our application, each is independent of the others and performs different actions as detailed below. </p>

<p><a name="TheOpenSpacesDataExample-dataprocessor"></a></p>

<h2><a name="TheOpenSpacesDataExample-DataProcessor"></a>DataProcessor</h2>
<p>The data processor is implemented in the class <tt>rg.openspaces.example.data.processor.DataProcessor</tt>. <br/>
It is configured in the <tt>pu.xml</tt> file of the processor module. </p>

<p>The most interesting part of the <tt>DataProcessor</tt> class is the <tt>processData()</tt> method. Note that it is marked with the <tt>@SpaceDataEvent</tt> annotation. This annotation marks the method to be called whenever a <tt>Data</tt> object that matches our criteria is available for processing (in our case, change the <tt>processed</tt> attribute to <tt>true</tt>) and write the object back to the space.</p>

<p>You might also have noticed that the <tt>DataProcessor</tt> implements <tt>IDataProcessor</tt>. This simple interface is used to expose the <tt>DataProcessor</tt> to remote clients via space based remoting. In our example, as you can see in the diagram above, the <tt>DataRemoting</tt> service which is part of the processor processing unit, makes a remote call to the <tt>DataProcessor</tt> which is located in the processor processing unit (which runs in another process, or even another machine). This is exactly why our <tt>Data</tt> object is <tt>Serializable</tt>.</p>

<p>The event processing aspect of the <tt>DataProcessor</tt> is enabled using GigaSpaces polling container. <br/>
The polling container is created since the <tt>DataProcessor</tt> class is annotated with <tt>@Polling</tt> annotation. The value returned from the method annotated with the <tt>@EventTemplate</tt> annotation will be used as the <em>template</em> for the polling container, i.e. the polling container will use it in the take operations it does periodically. This means that it will determine the criteria of the <tt>Data</tt> objects to be processed (in this case with the <tt>processed</tt> attribute set to <tt>false</tt>. <br/>
Note the the <tt>pu.xml</tt> file of the processor module contains the <tt>&lt;context:annotation-config/&gt;</tt> and <tt>&lt;os-events:annotation-support/&gt;</tt> tags to instruct the infrastructure to look for classes annotated with <tt>@EventDriven</tt> and <tt>@Polling</tt> and create polling container for them. Also note that <tt>@TransactionalEvent</tt> annotation which means that event will automatically be processed under a new transaction which will commit unless an exception is thrown. </p>

<p><a name="TheOpenSpacesDataExample-processedata"></a></p>

<h2><a name="TheOpenSpacesDataExample-DataProcessedCounter"></a>DataProcessedCounter</h2>

<p>The <tt>DataProcessedCounter</tt> is a service that is also part of the processor module. It also contains a method that is marked with the <tt>@SpaceDataEvent</tt> annotation. However, there are two differences between the <tt>DataProcessedCounter</tt> and the <tt>DataProcessor</tt>. The minor difference is that the <tt>DataProcessedCounter</tt> processes <tt>Data</tt> objects with the <tt>processed</tt> attribute set to <tt>true</tt> (meaning objects that were already processed by the <tt>DataProcessor</tt> and written back to the space).</p>

<p>The bigger difference is that unlike the <tt>DataProcessor</tt>, which <b>takes</b> objects from the space to the processes them, the <tt>DataProcessedCounter</tt> is <b>notified</b> whenever these objects are written to the space or updated in the space. Moreover, instead of receiving the events one by one, the <tt>DataProcessedCounter</tt> receives batches of events that can be based on the number of objects, interval in milliseconds, or both:<br/>
This is expressed in the following annotations: </p>
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">@EventDriven
<span class="code-comment">//Event notification mechanism
</span>@Notify
<span class="code-comment">//batching behavior
</span>@NotifyBatch(size = 10, time = 5000)
<span class="code-comment">//notify <span class="code-keyword">for</span> write and update operations
</span>@NotifyType(write = <span class="code-keyword">true</span>, update = <span class="code-keyword">true</span>)</pre>
</div></div>
<p>Similar to the polling container, the <tt>@EventTemplate</tt> annotation is used to annotate the method which returns the template for the notify registration. <br/>
Unlike the <tt>DataProcessor</tt>, which defines the template in the form of a <tt>Data</tt> instance, the <tt>DataProcessedCounter</tt> defines a <tt>SQLQuery</tt>, using the class type and and the <tt>WHERE</tt> clause of the query. The SQL query is equivalent to the way we defined the template, and either can be used (although the <tt>SQLQuery</tt> allows more flexibility since it support <tt>OR</tt>, <em>greater than</em> and <em>less than</em> semantics.<br/>
As with the polling container, the <tt>pu.xml</tt> should include the <tt>&lt;context:annotation-config/&gt;</tt> and <tt>&lt;os-events:annotation-support/&gt;</tt> tags (it's enough to specify them once for the entire processing unit, regardless of the number of actual event containers in your processing unit)</p>

<p><img class="emoticon" src="images/icons/emoticons/information.gif" height="16" width="16" align="absmiddle" alt="" border="0"/> Note that code only contains the implementation of the counter. Everything else is configured through annotation (or alternatively can be configured via XML), which means you can change the event-handling mode without changing the handling code.</p>


<p><a name="TheOpenSpacesDataExample-datafeeder"></a></p>

<h2><a name="TheOpenSpacesDataExample-DataFeeder"></a>DataFeeder</h2>
<p>The <tt>DataFeeder</tt> class belongs to the feeder module, and is configured as a Spring bean that repetitively (every one second) creates new <tt>Data</tt> objects with one of the four types (1, 2, 3 or 4), sets the <tt>processed</tt> value to <tt>false</tt>, and writes them to the space:</p>

<div class="panel" style="background-color: #FFFFFF;border-color: #3C78B5;border-style: solid;border-width: 1px;"><div class="panelContent" style="background-color: #FFFFFF;">
<h5><a name="TheOpenSpacesDataExample-Code"></a>Code</h5>
<hr 
 size="1" 
 color="#3C78B5" 
 >

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java"><span class="code-keyword">public</span> class DataFeeder {
[..]
Data data = <span class="code-keyword">new</span> Data((counter++ % numberOfTypes), <span class="code-quote">"FEEDER "</span> + <span class="code-object">Long</span>.toString(time));
data.setId(startIdFrom + counter);
data.setProcessed(<span class="code-keyword">false</span>);
gigaSpace.write(data);
[..]</pre>
</div></div>


<h5><a name="TheOpenSpacesDataExample-Configuration"></a>Configuration</h5>
<hr 
 size="1" 
 color="#3C78B5" 
 >

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-xml"><span class="code-tag">&lt;bean id=<span class="code-quote">"dataFeeder"</span> class=<span class="code-quote">"org.openspaces.example.data.feeder.DataFeeder"</span>/&gt;</span></pre>
</div></div>
</div></div>
<p>The <tt>gigaSpace</tt> member is an instance of <tt>GigaSpace</tt> &#8211; which represent the client side proxy to the space. Note that the instance is injected to the <tt>DataFeeder</tt> in a declarative manner:</p>

<div class="panel" style="background-color: #FFFFFF;border-color: #3C78B5;border-style: solid;border-width: 1px;"><div class="panelContent" style="background-color: #FFFFFF;">
<h5><a name="TheOpenSpacesDataExample-Code"></a>Code</h5>
<hr 
 size="1" 
 color="#3C78B5" 
 >

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">@GigaSpaceContext(name = <span class="code-quote">"gigaSpace"</span>)
<span class="code-keyword">private</span> GigaSpace gigaSpace;</pre>
</div></div>


<h5><a name="TheOpenSpacesDataExample-Configuration"></a>Configuration</h5>
<hr 
 size="1" 
 color="#3C78B5" 
 >

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-xml">&lt;!--
    Enables the usage of @GigaSpaceContext annotation based injection.
--&gt;
<span class="code-tag">&lt;os-core:giga-space-context/&gt;</span>

&lt;!--
    A bean representing a space (an IJSpace implementation).
    Note, we perform a lookup on the space since we are working against a remote space.
--&gt;
<span class="code-tag">&lt;os-core:space id=<span class="code-quote">"space"</span> url=<span class="code-quote">"jini://*/*/space"</span> /&gt;</span>

&lt;!--
    OpenSpaces simplified space API built on top of IJSpace/JavaSpace.
--&gt;
<span class="code-tag">&lt;os-core:giga-space id=<span class="code-quote">"gigaSpace"</span> space=<span class="code-quote">"space"</span>/&gt;</span></pre>
</div></div>
</div></div>
<p>In the Configuration tab above, we show how to define the space with its URL, and then define the <tt>GigaSpace</tt> instance which is based on that space. In this case, the space URL points to a remote space location (this is because the space is located within the <tt>DataProcessor</tt> Processing Unit, which is remote to the Processing Unit in which <tt>DataFeeder</tt> is running). This approach not only allows you to easily configure the application, but also to completely change the <tt>GigaSpace</tt> functionality implementation, without changing the code of your original application.</p>

<p>Because the <tt>DataFeeder</tt> includes JSR-250's <tt>@PostConstruct</tt> and <tt>@PreDestroy</tt> annotations, its annotated methods (<tt>construct()</tt> and <tt>destroy()</tt>} are called when it is created and destroyed, respectively.</p>

<p><a name="TheOpenSpacesDataExample-jms"></a></p>

<h2><a name="TheOpenSpacesDataExample-JMSDataFeeder"></a>JMSDataFeeder</h2>

<p>The <tt>JMSDataFeeder</tt> is similar to the <tt>DataFeeder</tt>. The difference between the beans is that the <tt>JMSDataFeeder</tt> uses Spring's <tt>JmsTemplate</tt> on top of the GigaSpaces JMS implementation to write the <tt>Data</tt> objects to the space; no space API is used directly. This is possible due to the usage of a <tt>MessageConverter</tt> that converts JMS messages into any required POJO type, in this case, <tt>Data</tt>. In this example, we configure the <tt>ConnectionFactory</tt> to use the <tt>ObjectMessage2ObjectConverter</tt> that comes with the GigaSpaces JMS implementation. The <tt>ObjectMessage2ObjectConverter</tt> receives a JMS <tt>ObjectMessage</tt> and returns the message's content (body) as the object to write to the space. The JMS <tt>ObjectMessage</tt> itself, including headers, properties etc., is not written. The <tt>JMSDataFeeder</tt> uses Spring's <tt>JmsTemplate</tt> and <tt>MessageCreator</tt> to send <tt>ObjectMessages</tt> that contain the <tt>Data</tt> objects, and the converter makes sure that only the contained <tt>Data</tt> objects are written.</p>


<div class="panel" style="background-color: #FFFFFF;border-color: #3C78B5;border-style: solid;border-width: 1px;"><div class="panelContent" style="background-color: #FFFFFF;">
<h5><a name="TheOpenSpacesDataExample-Code"></a>Code</h5>
<hr 
 size="1" 
 color="#3C78B5" 
 >

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java"><span class="code-keyword">public</span> class JMSDataFeeder {
    [..]
    Data data = <span class="code-keyword">new</span> Data(Data.TYPES[counter++ % Data.TYPES.length], <span class="code-quote">"FEEDER "</span> + <span class="code-object">Long</span>.toString(time));
    data.setProcessed(<span class="code-keyword">false</span>);
    jmsTemplate.send(<span class="code-keyword">new</span> MessageCreator() {
        <span class="code-keyword">public</span> Message createMessage(Session session) <span class="code-keyword">throws</span> JMSException {
            <span class="code-keyword">return</span> session.createObjectMessage(data);
        }
    });
    [..]
}</pre>
</div></div>


<h5><a name="TheOpenSpacesDataExample-Configuration"></a>Configuration</h5>
<hr 
 size="1" 
 color="#3C78B5" 
 >

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-xml"><span class="code-tag">&lt;bean id=<span class="code-quote">"jmsDataFeeder"</span> class=<span class="code-quote">"org.openspaces.example.data.feeder.JMSDataFeeder"</span>/&gt;</span></pre>
</div></div>
</div></div>

<p>The <tt>JMSDataFeeder</tt> is injected with a Spring <tt>JmsTemplate</tt>. The <tt>JmsTemplate</tt> is injected with a JMS <tt>ConnectionFactory</tt> and a destination of type <tt>Queue</tt>. Unlike the <tt>DataFeeder</tt>, the <tt>JMSDataFeeder</tt> does not declare an instance of <tt>GigaSpace</tt>. <tt>GigaSpace</tt> is injected into the <tt>ConnectionFactory</tt> bean and is used behind the scenes by the JMS layer. In addition, the <tt>ConnectionFactory</tt> is injected with a <tt>MessageConverter</tt> of type <tt>ObjectMessage2ObjectConverter</tt>.</p>

<div class="panel" style="background-color: #FFFFFF;border-color: #3C78B5;border-style: solid;border-width: 1px;"><div class="panelContent" style="background-color: #FFFFFF;">
<h5><a name="TheOpenSpacesDataExample-Code"></a>Code</h5>
<hr 
 size="1" 
 color="#3C78B5" 
 >

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java"><span class="code-keyword">public</span> class JMSDataFeeder {
    [..]
    /** Sets the JmsTemplate */
    <span class="code-keyword">public</span> void setJmsTemplate(JmsTemplate jmsTemplate)
    {
        <span class="code-keyword">this</span>.jmsTemplate = jmsTemplate;
    }
    [..]
}</pre>
</div></div>


<h5><a name="TheOpenSpacesDataExample-Configuration"></a>Configuration</h5>
<hr 
 size="1" 
 color="#3C78B5" 
 >

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-xml"><span class="code-tag">&lt;bean id=<span class="code-quote">"jmsDataFeeder"</span> class=<span class="code-quote">"org.openspaces.example.data.feeder.JMSDataFeeder"</span> depends-on=<span class="code-quote">"gigaSpace"</span>&gt;</span>
    <span class="code-tag">&lt;property name=<span class="code-quote">"instanceId"</span> value=<span class="code-quote">"${clusterInfo.instanceId}"</span> /&gt;</span>
    <span class="code-tag">&lt;property name=<span class="code-quote">"numberOfTypes"</span> value=<span class="code-quote">"${numberOfTypes}"</span> /&gt;</span>
    <span class="code-tag">&lt;property name=<span class="code-quote">"jmsTemplate"</span>&gt;</span>
        <span class="code-tag">&lt;bean class=<span class="code-quote">"org.springframework.jms.core.JmsTemplate"</span>&gt;</span>
            <span class="code-tag">&lt;property name=<span class="code-quote">"connectionFactory"</span> ref=<span class="code-quote">"connectionFactory"</span>/&gt;</span>
            <span class="code-tag">&lt;property name=<span class="code-quote">"defaultDestination"</span> ref=<span class="code-quote">"destination"</span> /&gt;</span>
        <span class="code-tag">&lt;/bean&gt;</span>
    <span class="code-tag">&lt;/property&gt;</span>
<span class="code-tag">&lt;/bean&gt;</span>

&lt;!--
    The JMS ConnectionFactory used by the JMS feeder
--&gt;
&lt;os-jms:connection-factory id=<span class="code-quote">"connectionFactory"</span> giga-space=<span class="code-quote">"gigaSpace"</span> 
                           message-converter=<span class="code-quote">"messageConverter"</span> /&gt;

&lt;!--
    The MessageConverter used by the JMS layer to convert JMS message to any POJO/s before sending.
--&gt;
<span class="code-tag">&lt;bean id=<span class="code-quote">"messageConverter"</span> class=<span class="code-quote">"com.j_spaces.jms.utils.ObjectMessage2ObjectConverter"</span> /&gt;</span>

&lt;!--
    A JMS destination used when sending messages
--&gt;
<span class="code-tag">&lt;os-jms:queue id=<span class="code-quote">"destination"</span> name=<span class="code-quote">"MyQueue"</span> /&gt;</span></pre>
</div></div>
</div></div>

<p>Because the <tt>JMSDataFeeder</tt> includes JSR-250's <tt>@PostConstruct</tt> and <tt>@PreDestroy</tt> annotations, its annotated methods (<tt>construct()</tt> and <tt>destroy()</tt>} are called when it is created and destroyed, respectively.</p>

<p><a name="TheOpenSpacesDataExample-view"></a></p>

<h2><a name="TheOpenSpacesDataExample-ViewDataCounter"></a>ViewDataCounter</h2>

<p>The <tt>ViewDataCounter</tt> is a simple service that performs a count operation on the space every second.</p>

<div class="panel" style="background-color: #FFFFFF;border-color: #3C78B5;border-style: solid;border-width: 1px;"><div class="panelContent" style="background-color: #FFFFFF;">
<h5><a name="TheOpenSpacesDataExample-Code"></a>Code</h5>
<hr 
 size="1" 
 color="#3C78B5" 
 >

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java"><span class="code-object">int</span> count = gigaSpace.count(<span class="code-keyword">new</span> Data());</pre>
</div></div>


<h5><a name="TheOpenSpacesDataExample-Configuration"></a>Configuration</h5>
<hr 
 size="1" 
 color="#3C78B5" 
 >

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-xml"><span class="code-tag">&lt;bean id=<span class="code-quote">"viewDataCounter"</span> class=<span class="code-quote">"org.openspaces.example.data.feeder.ViewDataCounter"</span>/&gt;</span></pre>
</div></div>
</div></div>

<p>Note that the <tt>ViewDataCounter</tt> is configured in the same <tt>pu.xml</tt> file as the <tt>DataFeeder</tt>, however, there is one major difference in how the two services connect to the space. The <tt>DataFeeder</tt> uses a <tt>GigaSpace</tt> instance to access the space remotely, while the <tt>ViewDataCounter</tt> uses a different instance &#8211; a local view of the space. A local view is like a local filter defined in the client side that registers for specific templates. Every object that is written to the space or updated in it that matches the template is immediately sent to the local view of that client. This way, different clients can keep different local caches according to their interests, and gain in memory read speeds. </p>

<p>In this example, the <tt>ViewDataCounter</tt> is interested only in processed <tt>Data</tt> objects, so it defines a local view with a template and uses a <tt>GigaSpace</tt> instance that uses the local view.</p>

<div class="panel" style="background-color: #FFFFFF;border-color: #3C78B5;border-style: solid;border-width: 1px;"><div class="panelContent" style="background-color: #FFFFFF;">
<h5><a name="TheOpenSpacesDataExample-Code"></a>Code</h5>
<hr 
 size="1" 
 color="#3C78B5" 
 >

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">@GigaSpaceContext(name = <span class="code-quote">"processedViewGigaSpace"</span>)
<span class="code-keyword">private</span> GigaSpace gigaSpace;</pre>
</div></div>


<h5><a name="TheOpenSpacesDataExample-Configuration"></a>Configuration</h5>
<hr 
 size="1" 
 color="#3C78B5" 
 >

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-xml"><span class="code-tag">&lt;os-core:local-view id=<span class="code-quote">"processedViewSpace"</span> space=<span class="code-quote">"space"</span>&gt;</span>
	<span class="code-tag">&lt;os-core:view-query where=<span class="code-quote">"processed = true"</span> class=<span class="code-quote">"org.openspaces.example.data.common.Data"</span>/&gt;</span>
<span class="code-tag">&lt;/os-core:local-view&gt;</span></pre>
</div></div>
</div></div>
<p>Because the <tt>ViewDataCounter</tt> includes JSR-250's <tt>@PostConstruct</tt> and <tt>@PreDestroy</tt> annotations, its annotated methods (<tt>construct()</tt> and <tt>destroy()</tt>} are called when it is created and destroyed, respectively.</p>

<p><a name="TheOpenSpacesDataExample-remoting"></a></p>

<h2><a name="TheOpenSpacesDataExample-DataRemoting"></a>DataRemoting</h2>

<p><tt>DataRemoting</tt> demonstrates the remoting capabilities of OpenSpaces, using the space as the transport layer for the remote calls.</p>

<p>Implementing a remote service is quite straightforward, you just need to expose your remote interface and add the proper configuration. In our example, we want to be able to access the <tt>DataProcessor</tt> remotely, so we added the <tt>IDataProcessor</tt> interface. <tt>DataRemoting</tt> only uses <tt>IDataProcessor</tt>, and is completely unaware to the underlying space.</p>


<div class="panel" style="background-color: #FFFFFF;border-color: #3C78B5;border-style: solid;border-width: 1px;"><div class="panelContent" style="background-color: #FFFFFF;">
<h5><a name="TheOpenSpacesDataExample-Code"></a>Code</h5>
<hr 
 size="1" 
 color="#3C78B5" 
 >

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">[..]
@EventDrivenProxy(gigaSpace = <span class="code-quote">"gigaSpace"</span>, timeout = 30000)
<span class="code-keyword">private</span> IDataProcessor dataProcessor;
[..]
    Data data = <span class="code-keyword">new</span> Data((counter++ % numberOfTypes), <span class="code-quote">"FEEDER "</span> + <span class="code-object">Long</span>.toString(time));
    data.setProcessed(<span class="code-keyword">false</span>);
    <span class="code-object">System</span>.out.println(<span class="code-quote">"--- REMOTING PARAMETER "</span> + data);
    dataProcessor.sayData(data);
    data = dataProcessor.processData(data);
    <span class="code-object">System</span>.out.println(<span class="code-quote">"--- REMOTING RESULT   "</span> + data);
[..]</pre>
</div></div>


<h5><a name="TheOpenSpacesDataExample-Configuration"></a>Configuration</h5>
<hr 
 size="1" 
 color="#3C78B5" 
 >

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-xml"><span class="code-tag">&lt;os-remoting:annotation-support/&gt;</span>
&lt;!--
	The DataRemoting bean, uses the proxied dataProcessor without any knowledge of the remoting invocation.
--&gt;
<span class="code-tag">&lt;bean id=<span class="code-quote">"dataRemoting"</span> class=<span class="code-quote">"org.openspaces.example.data.feeder.DataRemoting"</span>&gt;</span>
	<span class="code-tag">&lt;property name=<span class="code-quote">"dataProcessor"</span> ref=<span class="code-quote">"dataProcessor"</span>/&gt;</span>
<span class="code-tag">&lt;/bean&gt;</span></pre>
</div></div>
</div></div>

<h1><a name="TheOpenSpacesDataExample-BuildingandPackaging"></a>Building and Packaging</h1>

<p>This example includes a <tt>build.xml</tt> <tt>ant</tt> file and with a <tt>build.bat/sh</tt> script to invoke <tt>Ant</tt> (there is no need to pre-install <tt>Ant</tt>, the <tt>Ant</tt> jars are already bundled in the <tt>&lt;GigaSpaces Root&gt;/lib/platform</tt> directory).</p>

<p>From the <tt>&lt;Example Root&gt;</tt> directory (<tt>&lt;GigaSpaces Root&gt;/examples/data</tt>) call:</p>
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">build.bat/sh build</pre>
</div></div>
<p>This compiles the code to a <tt>pu</tt> directory and copies the Processing Unit Deployment Descriptors, namely the <tt>pu.xml</tt> and <tt>sla.xml</tt>.</p>

<p><img class="emoticon" src="images/icons/emoticons/warning.gif" height="16" width="16" align="absmiddle" alt="" border="0"/> The Deployment Descriptor should always reside under the <tt>META-INF\spring</tt> directory of your application.</p>

<h1><a name="TheOpenSpacesDataExample-BuildAndDeployment"></a>Build And Deployment </h1>

<p>The example uses ant as its build tool and uses a standard <tt>build.xml</tt> file. It comes with a build script that runs Ant automatically. Running the build script with no parameters within the current directory will list all the relevant tasks that can be run with this example.</p>

<p>Running <tt>build.(sh/bat) build</tt> will compile all the different modules. In case of the Processor and Feeder modules, it will compile the classes directly into their respective PU structure.</p>

<p>Running <tt>build.(sh/bat) dist</tt> will finalize the processing unit structure of both the Processor and the Feeder by copying the Common module jar file into the <tt>lib</tt> directory within the processing unit structure. In case of the processor module, it will copy the jar file to <tt>processor/pu/data-processor/lib</tt>, and will make <tt>processor/pu/data-processor</tt> a ready to use processing unit.</p>

<p>In order to deploy the data example onto the Service Grid, simply run gs-agent which will start a GSM and <b>two</b> GSCs (note, we need two GSCs because of the SLA defined within the processor module). Next, <tt>build.(sh/bat) deploy</tt> will need to be executed. The task will deploy the <tt>processor.jar</tt> and the <tt>feeder.jar</tt> onto the running GSM.  <br/>
This will cause the feeder to be deployed into one of the GSC and start feeding unprocessed data into the two processing units.<br/>
Run the GS-UI in order to see the 4 PU instances deployed (two partitions, each with one backup).</p>

<p>Another option to deploy the example can be using the GS CLI using the deploy option. An interesting example of externally providing the SLA that applies to the deployed processing unit can be running:</p>
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">gs.(sh/bat) deploy -sla ../examples/openspaces/data/partitioned-sla.xml data-processor/dist/data-processor.jar</pre>
</div></div>
<p>This allows to deploy the data-processor example using a partitioned space (and not a partitioned-sync2backup) which is defined in the <tt>sla.xml</tt>.<br/>
In order to run the feeder using the GS CLI please execute <tt>gs.(sh/bat) deploy data-feeder/dist/data-feeder.jar</tt>.</p>

<p>Some ways to play with the examples:</p>
<ol>
	<li>Start another GSC and relocate (click and drag on GS-UI) the feeder to the other GSC. This will simplify the output since on the GSC that used to run both a processor and a feeder, you will only have the processor now. And on the new GSC, you will see the feeder.</li>
	<li>Kill one of the GSC that runs the Processor processing unit. Thanks to the SLA, each GSC will run a primary partition, and a backup partition (of the other primary partition). This means that the feeder should keep on running, and the active GSC should have its backup partition space turn into a primary one. While this is happening, the two other instances of the processor PU will get relocated to the GSC that is running the Feeder PU.</li>
</ol>


                     </td>
</tr>
</table>
<table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr>
<td height="12" background="http://www.gigaspaces.com/wiki/images/border/border_bottom.gif"><img src="images/border/spacer.gif" width="1" height="1" border="0"/></td>
</tr>
<tr>
<td align="center"><font color="grey"><a href="http://www.gigaspaces.com">GigaSpaces.com</a> -
		<a href="http://www.gigaspaces.com/wiki/x/xwBmAg" class="smalltext">Legal Notice</a> -
		<a href="http://www.gigaspaces.com/wiki/x/xgBmAg" class="smalltext">3rd Party Licenses</a> -
		<a href="http://www.gigaspaces.com/wiki/x/BQFmAg" class="smalltext">Site Map</a> -
		<a href="http://www.gigaspaces.com/wiki/display/API/API+Documentation+Portal" class="version-link">API Docs</a> -
		<a href="http://forum.openspaces.org/forum.jspa?forumID=175" class="version-link">Forum</a> -
		<a href="http://www.gigaspaces.com/LatestProductVersion" class="version-link">Downloads</a> -
		<a href="http://blog.gigaspaces.com/" class="version-link">Blog</a> -
		<a href="http://www.gigaspaces.com/os_papers.html" class="version-link">White Papers</a> -
		<a href="mailto:techw@gigaspaces.com">Contact Tech Writing</a> -
		<i><a href="http://www.atlassian.com/software/confluence">Gen. by Atlassian Confluence</a></i></font></td>
</tr>
</table>
     </body>
</html>
