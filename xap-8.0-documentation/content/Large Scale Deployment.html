<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
     <head>
         <title>XAP 8.0 Documentation : Large Scale Deployment</title>
<link rel="stylesheet" href="styles/site.css" type="text/css" />
         <META http-equiv="Content-Type" content="text/html; charset=UTF-8">
		 <style>
.back-to {
	color: #666666;
	font-weight: bold;
}	 
a.back-to:link, a.back-to:visited, a.back-to:hover, a.back-to:active  {
	color: #666666;
}	 
		 </style>
     </head>

     <body>
<table class="pagecontent" border="0" cellpadding="0" cellspacing="0" width="100%" bgcolor="#ffffff">
<tr>
<td valign="top" class="pagebody">
<div class="pageheader">
<span class="back-to">XAP 8.0 Documentation > <a href="index.html">Back to Table of Contents</a></span><br>
<h1>Large Scale Deployment</h1>
</div>
<br>



<div style="border-style:solid; border-color:#3C78B5; border-width:thin; padding-left:20px; padding-bottom:20px; padding-top:20px; padding-right:20px; background-color:#D8E4F1"> 

<p><b>Section Summary:</b>  Instructions and best practices for tuning large-scale deployments. </p>
</div>

<h1><a name="LargeScaleDeployment-LargeClusterConsiderations"></a>Large Cluster Considerations</h1>

<div class="error"><span class="error">Error formatting macro: toc-zone: java.lang.NullPointerException</span> 

<p>When designing a large cluster, there are several things that need to be taken into account to assure that the cluster will be able to handle heavy loads, and perform quickly and stably.</p>

<p>When speaking of a larger cluster, we are referring to more than <b>few hundreds</b>. If this is the size of cluster you intend to build, the following considerations are relevant for you.</p>

<h2><a name="LargeScaleDeployment-UnregisteringSpaces%22Disappear%22fromLUS"></a>Unregistering Spaces "Disappear" from LUS</h2>

<p>This occurs when a large amount of memory is consumed in the process, causing extensive JVM GC spikes. This results in high CPU usage and distracts the <tt>LeaseRenewManager</tt> (a long GC/CPU clock causes the <tt>LeaseRenewManager</tt> to miss the default 4 seconds, or to attempt to renew the lease, firing a space service un-registering event). If the LUS fires an event to unregister a space, the UI spaces tree node represents it using a specific icon. Additionally, specific logging is printed out in the UI.</p>

<p>To avoid the unregistering of spaces, add resources (memory, CPU) or spaces, or tune the <tt>LeaseRenewal maxLeaseDuration</tt> and <tt>roundTripTime</tt>. These two values can be configured using the <tt>config\services\advanced-space.config</tt> file (can be found inside <tt>JSpaces.jar</tt>):</p>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java"><span class="code-comment">//Default value <span class="code-keyword">for</span> net.jini.lease.LeaseRenewalManager.roundTripTime <span class="code-keyword">default</span> value 4 seconds
</span>roundTripTime=4000;
<span class="code-comment">//Default value <span class="code-keyword">for</span> net.jini.lookup.JoinManager.maxLeaseDuration <span class="code-keyword">default</span> value 8 seconds.
</span>maxLeaseDuration=8000;</pre>
</div></div>

<p><img class="emoticon" src="images/icons/emoticons/lightbulb_on.gif" height="16" width="16" align="absmiddle" alt="" border="0"/>  It is recommended to <b>increase these values to 40000/80000 respectively</b> in case a large cluster is used.</p>

<div class='panelMacro'><table class='noteMacro'><colgroup><col width='24'><col></colgroup><tr><td valign='top'><img src="images/icons/emoticons/warning.gif" width="16" height="16" align="absmiddle" alt="" border="0"></td><td>Increasing these values causes a delay when the space recognizes failover, since the active election infrastructure is based on space un-registration.</td></tr></table></div>

<h2><a name="LargeScaleDeployment-MinimizeRMIRegistryOverhead"></a>Minimize RMIRegistry Overhead</h2>

<p>Since every space container starts an embedded <tt>RMIRegistry</tt> service, it creates a set of threads which consume a large amount of resources.</p>

<p><img class="emoticon" src="images/icons/emoticons/lightbulb_on.gif" height="16" width="16" align="absmiddle" alt="" border="0"/> If the <tt>RMIRegistry</tt> service is not used, or if a full replication cluster or a large cluster is used; it is recommended to disable the <tt>RMIRegistry</tt> service in the space container and in the GSC/GSM.</p>
<p><img src="download/attachments/19890517/referto.gif" align="absmiddle" border="0"/> For details on how to disable the space container <tt>RMIRegistry</tt>, refer to the <a href="Overriding Default Configuration.html" title="Overriding Default Configuration">Overwriting Default Configuration</a> section.</p>

<h2><a name="LargeScaleDeployment-ServiceGridCPU%2CMemory%2CDiskCPUMeasurementOverhead"></a>Service Grid CPU, Memory, Disk CPU Measurement Overhead</h2>

<p><img class="emoticon" src="images/icons/emoticons/lightbulb_on.gif" height="16" width="16" align="absmiddle" alt="" border="0"/> Avoid/disable the Service Grid measurements for CPU, memory, and disk; since these perform an intensive update of Jini lookup attributes across all Lookup services every 15 sec.</p>

<p>For more details, see the following <tt>services.config</tt> file elements:</p>
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">com.gigaspaces.management.system.memory
com.gigaspaces.management.system.cpu
com.gigaspaces.management.system.disk</pre>
</div></div>

<h2><a name="LargeScaleDeployment-SettingRedundanttotalmembersforClusters"></a>Setting Redundant total_members for Clusters</h2>

<p><img class="emoticon" src="images/icons/emoticons/lightbulb_on.gif" height="16" width="16" align="absmiddle" alt="" border="0"/> Avoid setting <tt>total_member=100</tt> if you need only 50 spaces. The overhead in such a case is high, especially in fully replicated clusters.</p>

<h2><a name="LargeScaleDeployment-LookupandMahaloServiceSettings"></a>Lookup and Mahalo Service Settings</h2>

<p><img class="emoticon" src="images/icons/emoticons/lightbulb_on.gif" height="16" width="16" align="absmiddle" alt="" border="0"/> Set at least a 600 MB maximum heap for your LUS/GSM/Mahalo. Do not start more than 2 instances per cluster, and preferably start the cluster on your strongest machine.</p>

<h2><a name="LargeScaleDeployment-SettingListofJARsAccessiblethroughrmi.server.codebaseorHTTPD"></a>Setting List of JARs Accessible through rmi.server.codebase or HTTPD</h2>

<p>When adding a very long list of files (or very large files in size), all clients attempt to download these files over the wire. This causes dozens of MBs go over the wires repeatedly per each type of client, exhausting the HTTPD and the network.</p>

<p><img class="emoticon" src="images/icons/emoticons/lightbulb_on.gif" height="16" width="16" align="absmiddle" alt="" border="0"/>  <b>Recommendations</b></p>
<ul>
	<li>Do not add third party JAR files which are not used by the space/service directly.</li>
	<li>Pay special attention to the size of files.</li>
	<li>Avoid using <tt>rmi.server.codebase</tt> wherever possible.</li>
	<li>Use the <div class="preformatted panel" style="border-width: 1px;"><div class="preformattedContent panelContent">
<pre>file://</pre>
</div></div> protocol instead of the <div class="preformatted panel" style="border-width: 1px;"><div class="preformattedContent panelContent">
<pre>http://</pre>
</div></div> protocol wherever possible.</li>
</ul>


<p>This <a href="download/attachments/53903516/example_of_wrong_settings_of_files.xml"><b>Example</b></a> of a Service Grid Deployment Descriptor contains a long list of files. See also the 50MB <tt>weblogic.jar</tt>.</p>

<h2><a name="LargeScaleDeployment-ClusterAvailabilityMonitoring"></a>Cluster Availability Monitoring</h2>

<p>When a large cluster is monitored for availability, it is recommended to increase the value of the <tt>Monitor</tt> thread to a maximum. Usually, when there is no failover or when there are no backup-only spaces, the <tt>Monitor</tt> thread can be safely set to its maximum value; since clients directly interact with the space members. If either is detected as unavailable, the <tt>Detector</tt> thread is responsible for detecting their re-availability.</p>

<p><img src="download/attachments/19890517/referto.gif" align="absmiddle" border="0"/> For more details, refer to the <a href="Viewing Clustered Space Status.html" title="Viewing Clustered Space Status">Viewing Clustered Space Status</a> section.</p>
</div>

<h1><a name="LargeScaleDeployment-ManyClientsAccessingSpace"></a>Many Clients Accessing Space</h1>

<p>When attempting to run hundreds of clients, which need to find a space and perform operations; a few considerations need to be taken.</p>

<h2><a name="LargeScaleDeployment-CallingSpaceFinder"></a>Calling SpaceFinder</h2>

<p><img class="emoticon" src="images/icons/emoticons/lightbulb_on.gif" height="16" width="16" align="absmiddle" alt="" border="0"/> If <b>hundreds</b> of clients are calling <tt>SpaceFinder</tt> at the same time, <b>RMI calls</b> should be used. If this isn't possible, you should use Jini Unicast lookup only (without Multicast and groups set). Use Jini Multicast discovery as the last option, since it has the most overhead.</p>

<h2><a name="LargeScaleDeployment-ClusterAvailabilityMonitoring"></a>Cluster Availability Monitoring</h2>

<p>When there are many clients monitoring the availability of a cluster, it is recommended to increase the value of the <tt>Monitor</tt> thread to a maximum. Usually, when there is no failover or there are no backup-only spaces, the <tt>Monitor</tt> thread can be safely set to its maximum value; since clients directly interact with the space members. If either is detected as unavailable, the <tt>Detector</tt> thread is responsible for detecting their re-availability.</p>
<p><img src="download/attachments/19890517/referto.gif" align="absmiddle" border="0"/> For more details, refer to the <a href="Viewing Clustered Space Status.html" title="Viewing Clustered Space Status">Viewing Clustered Space Status</a> section.</p>

                     </td>
</tr>
</table>
<table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr>
<td height="12" background="http://www.gigaspaces.com/wiki/images/border/border_bottom.gif"><img src="images/border/spacer.gif" width="1" height="1" border="0"/></td>
</tr>
<tr>
<td align="center"><font color="grey"><a href="http://www.gigaspaces.com">GigaSpaces.com</a> -
		<a href="http://www.gigaspaces.com/wiki/x/xwBmAg" class="smalltext">Legal Notice</a> -
		<a href="http://www.gigaspaces.com/wiki/x/xgBmAg" class="smalltext">3rd Party Licenses</a> -
		<a href="http://www.gigaspaces.com/wiki/x/BQFmAg" class="smalltext">Site Map</a> -
		<a href="http://www.gigaspaces.com/wiki/display/API/API+Documentation+Portal" class="version-link">API Docs</a> -
		<a href="http://forum.openspaces.org/forum.jspa?forumID=175" class="version-link">Forum</a> -
		<a href="http://www.gigaspaces.com/LatestProductVersion" class="version-link">Downloads</a> -
		<a href="http://blog.gigaspaces.com/" class="version-link">Blog</a> -
		<a href="http://www.gigaspaces.com/os_papers.html" class="version-link">White Papers</a> -
		<a href="mailto:techw@gigaspaces.com">Contact Tech Writing</a> -
		<i><a href="http://www.atlassian.com/software/confluence">Gen. by Atlassian Confluence</a></i></font></td>
</tr>
</table>
     </body>
</html>
